<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Quantum GIS API Documentation: src/core/qgsexpression.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Quantum GIS API Documentation
   &#160;<span id="projectnumber">1.8</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">src/core/qgsexpression.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qgsexpression_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">                              qgsexpression.cpp</span>
<a name="l00003"></a>00003 <span class="comment">                             -------------------</span>
<a name="l00004"></a>00004 <span class="comment">    begin                : August 2011</span>
<a name="l00005"></a>00005 <span class="comment">    copyright            : (C) 2011 Martin Dobias</span>
<a name="l00006"></a>00006 <span class="comment">    email                : wonder.sk at gmail dot com</span>
<a name="l00007"></a>00007 <span class="comment"> ***************************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> *                                                                         *</span>
<a name="l00009"></a>00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00010"></a>00010 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00011"></a>00011 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00012"></a>00012 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00013"></a>00013 <span class="comment"> *                                                                         *</span>
<a name="l00014"></a>00014 <span class="comment"> ***************************************************************************/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="qgsexpression_8h.html">qgsexpression.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;QtDebug&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;QDomDocument&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;QSettings&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="qgsdistancearea_8h.html">qgsdistancearea.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="qgsfeature_8h.html">qgsfeature.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="qgsgeometry_8h.html">qgsgeometry.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="qgslogger_8h.html">qgslogger.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">// from parser</span>
<a name="l00031"></a>00031 <span class="keyword">extern</span> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="qgsexpression_8cpp.html#acfd296fb34ada71a182dcd17e844df7b">parseExpression</a>( <span class="keyword">const</span> QString&amp; str, QString&amp; parserErrorMsg );
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00035"></a>00035 <span class="comment">// three-value logic</span>
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">00037</a> <span class="keyword">enum</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a>
<a name="l00038"></a>00038 {
<a name="l00039"></a><a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">00039</a>   <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>,
<a name="l00040"></a><a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">00040</a>   <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>,
<a name="l00041"></a><a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">00041</a>   <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>
<a name="l00042"></a>00042 };
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="qgsexpression_8cpp.html#a4584615fec342fa7a9ed1bdfb796fd37">00044</a> <span class="keyword">static</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> <a class="code" href="qgsexpression_8cpp.html#a4584615fec342fa7a9ed1bdfb796fd37">AND</a>[3][3] =
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046   <span class="comment">// false  true    unknown</span>
<a name="l00047"></a>00047   { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>,   False },   <span class="comment">// false</span>
<a name="l00048"></a>00048   { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>,    <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a> }, <span class="comment">// true</span>
<a name="l00049"></a>00049   { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>, Unknown }  <span class="comment">// unknown</span>
<a name="l00050"></a>00050 };
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="qgsexpression_8cpp.html#af723dab70650b4de44f091216ba95dfa">00052</a> <span class="keyword">static</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> <a class="code" href="qgsexpression_8cpp.html#af723dab70650b4de44f091216ba95dfa">OR</a>[3][3] =
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054   { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>,   <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a> },  <span class="comment">// false</span>
<a name="l00055"></a>00055   { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>,    <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>, True },     <span class="comment">// true</span>
<a name="l00056"></a>00056   { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a> }   <span class="comment">// unknown</span>
<a name="l00057"></a>00057 };
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="qgsexpression_8cpp.html#a3dea20adcefd386e9daec0381d5d76be">00059</a> <span class="keyword">static</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> <a class="code" href="qgsexpression_8cpp.html#a3dea20adcefd386e9daec0381d5d76be">NOT</a>[3] = { <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>, <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a> };
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="qgsexpression_8cpp.html#aa591871f07bb6e0a698151b720016f87">00061</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#aa591871f07bb6e0a698151b720016f87">tvl2variant</a>( <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> v )
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063   <span class="keywordflow">switch</span> ( v )
<a name="l00064"></a>00064   {
<a name="l00065"></a>00065     <span class="keywordflow">case</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>: <span class="keywordflow">return</span> 0;
<a name="l00066"></a>00066     <span class="keywordflow">case</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a>: <span class="keywordflow">return</span> 1;
<a name="l00067"></a>00067     <span class="keywordflow">case</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>:
<a name="l00068"></a>00068     <span class="keywordflow">default</span>:
<a name="l00069"></a>00069       <span class="keywordflow">return</span> QVariant();
<a name="l00070"></a>00070   }
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">00073</a> <span class="preprocessor">#define TVL_True     QVariant(1)</span>
<a name="l00074"></a><a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define TVL_False    QVariant(0)</span>
<a name="l00075"></a><a class="code" href="qgsexpression_8cpp.html#a773396cccbd1ecd1596db50fb3eb5182">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define TVL_Unknown  QVariant()</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00078"></a>00078 <span class="comment">// QVariant checks and conversions</span>
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="qgsexpression_8cpp.html#a6f495aacc43767959ab49dfb2065b0ff">00080</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="qgsexpression_8cpp.html#a6f495aacc43767959ab49dfb2065b0ff">isIntSafe</a>( <span class="keyword">const</span> QVariant&amp; v )
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082   <span class="keywordflow">if</span> ( v.type() == QVariant::Int ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00083"></a>00083   <span class="keywordflow">if</span> ( v.type() == QVariant::Double ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00084"></a>00084   <span class="keywordflow">if</span> ( v.type() == QVariant::String ) { <span class="keywordtype">bool</span> ok; v.toString().toInt( &amp;ok ); <span class="keywordflow">return</span> ok; }
<a name="l00085"></a>00085   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00086"></a>00086 }
<a name="l00087"></a><a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">00087</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( <span class="keyword">const</span> QVariant&amp; v )
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089   <span class="keywordflow">if</span> ( v.type() == QVariant::Double || v.type() == QVariant::Int ) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00090"></a>00090   <span class="keywordflow">if</span> ( v.type() == QVariant::String ) { <span class="keywordtype">bool</span> ok; v.toString().toDouble( &amp;ok ); <span class="keywordflow">return</span> ok; }
<a name="l00091"></a>00091   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">00094</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( <span class="keyword">const</span> QVariant&amp; v ) { <span class="keywordflow">return</span> v.isNull(); }
<a name="l00095"></a>00095 
<a name="l00097"></a>00097 <span class="comment">// evaluation error macros</span>
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">00099</a> <span class="preprocessor">#define ENSURE_NO_EVAL_ERROR   {  if (parent-&gt;hasEvalError()) return QVariant(); }</span>
<a name="l00100"></a><a class="code" href="qgsexpression_8cpp.html#ace2372f87f2c940015b973f921947083">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_EVAL_ERROR(x)   { parent-&gt;setEvalErrorString(x); return QVariant(); }</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>
<a name="l00103"></a>00103 <span class="comment">// operators</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classQgsExpression.html#a056130107ebe0f5afdf298b4a93c5ac2">QgsExpression::BinaryOperatorText</a>[] =
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107   <span class="stringliteral">&quot;OR&quot;</span>, <span class="stringliteral">&quot;AND&quot;</span>,
<a name="l00108"></a>00108   <span class="stringliteral">&quot;=&quot;</span>, <span class="stringliteral">&quot;&lt;&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;=&quot;</span>, <span class="stringliteral">&quot;&gt;=&quot;</span>, <span class="stringliteral">&quot;&lt;&quot;</span>, <span class="stringliteral">&quot;&gt;&quot;</span>, <span class="stringliteral">&quot;~&quot;</span>, <span class="stringliteral">&quot;LIKE&quot;</span>, <span class="stringliteral">&quot;NOT LIKE&quot;</span>, <span class="stringliteral">&quot;ILIKE&quot;</span>, <span class="stringliteral">&quot;NOT ILIKE&quot;</span>, <span class="stringliteral">&quot;IS&quot;</span>, <span class="stringliteral">&quot;IS NOT&quot;</span>,
<a name="l00109"></a>00109   <span class="stringliteral">&quot;+&quot;</span>, <span class="stringliteral">&quot;-&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, <span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;^&quot;</span>,
<a name="l00110"></a>00110   <span class="stringliteral">&quot;||&quot;</span>
<a name="l00111"></a>00111 };
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">QgsExpression::BinaryOgcOperatorText</a>[] =
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115   <span class="stringliteral">&quot;Or&quot;</span>, <span class="stringliteral">&quot;And&quot;</span>,
<a name="l00116"></a>00116   <span class="stringliteral">&quot;PropertyIsEqualTo&quot;</span>, <span class="stringliteral">&quot;PropertyIsNotEqualTo&quot;</span>,
<a name="l00117"></a>00117   <span class="stringliteral">&quot;PropertyIsGreaterThanOrEqualTo&quot;</span>, <span class="stringliteral">&quot;PropertyIsLessThanOrEqualTo&quot;</span>,
<a name="l00118"></a>00118   <span class="stringliteral">&quot;PropertyIsLessThan&quot;</span>, <span class="stringliteral">&quot;PropertyIsGreaterThan&quot;</span>,
<a name="l00119"></a>00119   <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;PropertyIsLike&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00120"></a>00120   <span class="stringliteral">&quot;Add&quot;</span>, <span class="stringliteral">&quot;Sub&quot;</span>, <span class="stringliteral">&quot;Mul&quot;</span>, <span class="stringliteral">&quot;Div&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l00121"></a>00121   <span class="stringliteral">&quot;&quot;</span>
<a name="l00122"></a>00122 };
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classQgsExpression.html#a768ab64f1c96dc9d0182d455327e8f30">QgsExpression::UnaryOperatorText</a>[] =
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126   <span class="stringliteral">&quot;NOT&quot;</span>, <span class="stringliteral">&quot;-&quot;</span>
<a name="l00127"></a>00127 };
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">QgsExpression::UnaryOgcOperatorText</a>[] =
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131   <span class="stringliteral">&quot;Not&quot;</span>, <span class="stringliteral">&quot;&quot;</span>
<a name="l00132"></a>00132 };
<a name="l00133"></a>00133 
<a name="l00135"></a>00135 <span class="comment">// functions</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">// implicit conversion to string</span>
<a name="l00138"></a><a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">00138</a> <span class="keyword">static</span> QString <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( <span class="keyword">const</span> QVariant&amp; value, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* )
<a name="l00139"></a>00139 {
<a name="l00140"></a>00140   <span class="keywordflow">return</span> value.toString();
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">00143</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( <span class="keyword">const</span> QVariant&amp; value, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00144"></a>00144 {
<a name="l00145"></a>00145   <span class="keywordtype">bool</span> ok;
<a name="l00146"></a>00146   <span class="keywordtype">double</span> x = value.toDouble( &amp;ok );
<a name="l00147"></a>00147   <span class="keywordflow">if</span> ( !ok )
<a name="l00148"></a>00148   {
<a name="l00149"></a>00149     parent-&gt;<a class="code" href="classQgsExpression.html#a3ec34c45a27ddd208dee50bb99686aee" title="Set evaluation error (used internally by evaluation functions)">setEvalErrorString</a>( QObject::tr( <span class="stringliteral">&quot;Cannot convert &#39;%1&#39; to double&quot;</span> ).arg( value.toString() ) );
<a name="l00150"></a>00150     <span class="keywordflow">return</span> 0;
<a name="l00151"></a>00151   }
<a name="l00152"></a>00152   <span class="keywordflow">return</span> x;
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">00155</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( <span class="keyword">const</span> QVariant&amp; value, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157   <span class="keywordtype">bool</span> ok;
<a name="l00158"></a>00158   qint64 x = value.toLongLong( &amp;ok );
<a name="l00159"></a>00159   <span class="keywordflow">if</span> ( ok &amp;&amp; x &gt;= <a class="code" href="namespaceMathUtils.html#a5a39e80b84c74c7b254f7cdba6f7872a" title="returns the minimum of two doubles or the first argument if both are equal">std::numeric_limits&lt;int&gt;::min</a>() &amp;&amp; x &lt;= <a class="code" href="namespaceMathUtils.html#a03a5498829ab10bdad9decf694e78674" title="returns the maximum of two doubles or the first argument if both are equal">std::numeric_limits&lt;int&gt;::max</a>() )
<a name="l00160"></a>00160   {
<a name="l00161"></a>00161     <span class="keywordflow">return</span> x;
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163   <span class="keywordflow">else</span>
<a name="l00164"></a>00164   {
<a name="l00165"></a>00165     parent-&gt;<a class="code" href="classQgsExpression.html#a3ec34c45a27ddd208dee50bb99686aee" title="Set evaluation error (used internally by evaluation functions)">setEvalErrorString</a>( QObject::tr( <span class="stringliteral">&quot;Cannot convert &#39;%1&#39; to int&quot;</span> ).arg( value.toString() ) );
<a name="l00166"></a>00166     <span class="keywordflow">return</span> 0;
<a name="l00167"></a>00167   }
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="comment">// this handles also NULL values</span>
<a name="l00172"></a><a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">00172</a> <span class="keyword">static</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( <span class="keyword">const</span> QVariant&amp; value, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174   <span class="comment">// we need to convert to TVL</span>
<a name="l00175"></a>00175   <span class="keywordflow">if</span> ( value.isNull() )
<a name="l00176"></a>00176     <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <span class="keywordflow">if</span> ( value.type() == QVariant::Int )
<a name="l00179"></a>00179     <span class="keywordflow">return</span> value.toInt() != 0 ? <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a> : <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordtype">bool</span> ok;
<a name="l00182"></a>00182   <span class="keywordtype">double</span> x = value.toDouble( &amp;ok );
<a name="l00183"></a>00183   <span class="keywordflow">if</span> ( !ok )
<a name="l00184"></a>00184   {
<a name="l00185"></a>00185     parent-&gt;<a class="code" href="classQgsExpression.html#a3ec34c45a27ddd208dee50bb99686aee" title="Set evaluation error (used internally by evaluation functions)">setEvalErrorString</a>( QObject::tr( <span class="stringliteral">&quot;Cannot convert &#39;%1&#39; to boolean&quot;</span> ).arg( value.toString() ) );
<a name="l00186"></a>00186     <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>;
<a name="l00187"></a>00187   }
<a name="l00188"></a>00188   <span class="keywordflow">return</span> x != 0 ? <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a> : <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41af9d46b7804d93a4fcde88489a1b68c24">False</a>;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="qgsexpression_8cpp.html#a9cc2142280338805a2039cbe110c5188">00193</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a9cc2142280338805a2039cbe110c5188">fcnSqrt</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* <span class="comment">/*f*/</span>, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00196"></a>00196   <span class="keywordflow">return</span> QVariant( sqrt( x ) );
<a name="l00197"></a>00197 }
<a name="l00198"></a><a class="code" href="qgsexpression_8cpp.html#ab8c95cdc5aaad6e588b124b8b7de7b31">00198</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#ab8c95cdc5aaad6e588b124b8b7de7b31">fcnSin</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00201"></a>00201   <span class="keywordflow">return</span> QVariant( sin( x ) );
<a name="l00202"></a>00202 }
<a name="l00203"></a><a class="code" href="qgsexpression_8cpp.html#a84fdb9c9e05e85eefc1bc362089b2b64">00203</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a84fdb9c9e05e85eefc1bc362089b2b64">fcnCos</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00206"></a>00206   <span class="keywordflow">return</span> QVariant( cos( x ) );
<a name="l00207"></a>00207 }
<a name="l00208"></a><a class="code" href="qgsexpression_8cpp.html#a215cda745f7d773f73d7ab87556704b0">00208</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a215cda745f7d773f73d7ab87556704b0">fcnTan</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00211"></a>00211   <span class="keywordflow">return</span> QVariant( tan( x ) );
<a name="l00212"></a>00212 }
<a name="l00213"></a><a class="code" href="qgsexpression_8cpp.html#ab44ecd6734919d854b5c0ad6a3fb0493">00213</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#ab44ecd6734919d854b5c0ad6a3fb0493">fcnAsin</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00214"></a>00214 {
<a name="l00215"></a>00215   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00216"></a>00216   <span class="keywordflow">return</span> QVariant( asin( x ) );
<a name="l00217"></a>00217 }
<a name="l00218"></a><a class="code" href="qgsexpression_8cpp.html#a895068adf93e02a53397b39eecf601e8">00218</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a895068adf93e02a53397b39eecf601e8">fcnAcos</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00219"></a>00219 {
<a name="l00220"></a>00220   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00221"></a>00221   <span class="keywordflow">return</span> QVariant( acos( x ) );
<a name="l00222"></a>00222 }
<a name="l00223"></a><a class="code" href="qgsexpression_8cpp.html#a73a4e889293aec70b49d428b2c7dd7b0">00223</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a73a4e889293aec70b49d428b2c7dd7b0">fcnAtan</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00226"></a>00226   <span class="keywordflow">return</span> QVariant( atan( x ) );
<a name="l00227"></a>00227 }
<a name="l00228"></a><a class="code" href="qgsexpression_8cpp.html#a262ff867c9a9493866d0052d81079b19">00228</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a262ff867c9a9493866d0052d81079b19">fcnAtan2</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230   <span class="keywordtype">double</span> y = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00231"></a>00231   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 1 ), parent );
<a name="l00232"></a>00232   <span class="keywordflow">return</span> QVariant( atan2( y, x ) );
<a name="l00233"></a>00233 }
<a name="l00234"></a><a class="code" href="qgsexpression_8cpp.html#ac68065b1e0c3d6c3497abb3970f07d49">00234</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#ac68065b1e0c3d6c3497abb3970f07d49">fcnExp</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00237"></a>00237   <span class="keywordflow">return</span> QVariant( exp( x ) );
<a name="l00238"></a>00238 }
<a name="l00239"></a><a class="code" href="qgsexpression_8cpp.html#aa8ebb747ae7d9dd69afefb0aa3b9205b">00239</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#aa8ebb747ae7d9dd69afefb0aa3b9205b">fcnLn</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00242"></a>00242   <span class="keywordflow">if</span> ( x &lt;= 0 )
<a name="l00243"></a>00243     <span class="keywordflow">return</span> QVariant();
<a name="l00244"></a>00244   <span class="keywordflow">return</span> QVariant( log( x ) );
<a name="l00245"></a>00245 }
<a name="l00246"></a><a class="code" href="qgsexpression_8cpp.html#ad6b69a4abab2da730e82e20aec4f45a3">00246</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#ad6b69a4abab2da730e82e20aec4f45a3">fcnLog10</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00249"></a>00249   <span class="keywordflow">if</span> ( x &lt;= 0 )
<a name="l00250"></a>00250     <span class="keywordflow">return</span> QVariant();
<a name="l00251"></a>00251   <span class="keywordflow">return</span> QVariant( log10( x ) );
<a name="l00252"></a>00252 }
<a name="l00253"></a><a class="code" href="qgsexpression_8cpp.html#af898741c869a3144a2fa310d99f5389a">00253</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#af898741c869a3144a2fa310d99f5389a">fcnLog</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255   <span class="keywordtype">double</span> b = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent );
<a name="l00256"></a>00256   <span class="keywordtype">double</span> x = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 1 ), parent );
<a name="l00257"></a>00257   <span class="keywordflow">if</span> ( x &lt;= 0 || b &lt;= 0 )
<a name="l00258"></a>00258     <span class="keywordflow">return</span> QVariant();
<a name="l00259"></a>00259   <span class="keywordflow">return</span> QVariant( log( x ) / log( b ) );
<a name="l00260"></a>00260 }
<a name="l00261"></a><a class="code" href="qgsexpression_8cpp.html#a1e4f03217f55a80bbc10ed01d291e021">00261</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a1e4f03217f55a80bbc10ed01d291e021">fcnToInt</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263   <span class="keywordflow">return</span> QVariant( <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( values.at( 0 ), parent ) );
<a name="l00264"></a>00264 }
<a name="l00265"></a><a class="code" href="qgsexpression_8cpp.html#a060be4a0ba39bc2d172f8835e39c924f">00265</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a060be4a0ba39bc2d172f8835e39c924f">fcnToReal</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267   <span class="keywordflow">return</span> QVariant( <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( values.at( 0 ), parent ) );
<a name="l00268"></a>00268 }
<a name="l00269"></a><a class="code" href="qgsexpression_8cpp.html#a620d61b85296c14411f99c998efdb28b">00269</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a620d61b85296c14411f99c998efdb28b">fcnToString</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271   <span class="keywordflow">return</span> QVariant( <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent ) );
<a name="l00272"></a>00272 }
<a name="l00273"></a><a class="code" href="qgsexpression_8cpp.html#a2e80679a057a6f806698fa7ed623753d">00273</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a2e80679a057a6f806698fa7ed623753d">fcnLower</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275   QString str = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent );
<a name="l00276"></a>00276   <span class="keywordflow">return</span> QVariant( str.toLower() );
<a name="l00277"></a>00277 }
<a name="l00278"></a><a class="code" href="qgsexpression_8cpp.html#a59ac3d82f7e46feaa70aebb288a23b96">00278</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a59ac3d82f7e46feaa70aebb288a23b96">fcnUpper</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280   QString str = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent );
<a name="l00281"></a>00281   <span class="keywordflow">return</span> QVariant( str.toUpper() );
<a name="l00282"></a>00282 }
<a name="l00283"></a><a class="code" href="qgsexpression_8cpp.html#a71e3c685b1076e2725695896efe46462">00283</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a71e3c685b1076e2725695896efe46462">fcnLength</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285   QString str = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent );
<a name="l00286"></a>00286   <span class="keywordflow">return</span> QVariant( str.length() );
<a name="l00287"></a>00287 }
<a name="l00288"></a><a class="code" href="qgsexpression_8cpp.html#a5b81ac8ba62d55393d2766a14ae6252f">00288</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a5b81ac8ba62d55393d2766a14ae6252f">fcnReplace</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290   QString str = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent );
<a name="l00291"></a>00291   QString before = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 1 ), parent );
<a name="l00292"></a>00292   QString after = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 2 ), parent );
<a name="l00293"></a>00293   <span class="keywordflow">return</span> QVariant( str.replace( before, after ) );
<a name="l00294"></a>00294 }
<a name="l00295"></a><a class="code" href="qgsexpression_8cpp.html#ad33e6e1b3809ab6b000ebc6f490d87cb">00295</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#ad33e6e1b3809ab6b000ebc6f490d87cb">fcnRegexpReplace</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297   QString str = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent );
<a name="l00298"></a>00298   QString regexp = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 1 ), parent );
<a name="l00299"></a>00299   QString after = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 2 ), parent );
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   QRegExp re( regexp );
<a name="l00302"></a>00302   <span class="keywordflow">if</span> ( !re.isValid() )
<a name="l00303"></a>00303   {
<a name="l00304"></a>00304     parent-&gt;<a class="code" href="classQgsExpression.html#a3ec34c45a27ddd208dee50bb99686aee" title="Set evaluation error (used internally by evaluation functions)">setEvalErrorString</a>( QObject::tr( <span class="stringliteral">&quot;Invalid regular expression &#39;%1&#39;: %2&quot;</span> ).arg( regexp ).arg( re.errorString() ) );
<a name="l00305"></a>00305     <span class="keywordflow">return</span> QVariant();
<a name="l00306"></a>00306   }
<a name="l00307"></a>00307   <span class="keywordflow">return</span> QVariant( str.replace( re, after ) );
<a name="l00308"></a>00308 }
<a name="l00309"></a><a class="code" href="qgsexpression_8cpp.html#a82f00d4b641ff9b47d10b2ee89b75a8a">00309</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a82f00d4b641ff9b47d10b2ee89b75a8a">fcnSubstr</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311   QString str = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( values.at( 0 ), parent );
<a name="l00312"></a>00312   <span class="keywordtype">int</span> from = <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( values.at( 1 ), parent );
<a name="l00313"></a>00313   <span class="keywordtype">int</span> len = <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( values.at( 2 ), parent );
<a name="l00314"></a>00314   <span class="keywordflow">return</span> QVariant( str.mid( from -1, len ) );
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a><a class="code" href="qgsexpression_8cpp.html#a88f6bd7c862ef25b09dbe6832fe223ac">00317</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a88f6bd7c862ef25b09dbe6832fe223ac">fcnRowNumber</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* , <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319   <span class="keywordflow">return</span> QVariant( parent-&gt;<a class="code" href="classQgsExpression.html#a0fd2c5e0a8e082d8080112dd7170ea68" title="Return the number used for $rownum special column.">currentRowNumber</a>() );
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="qgsexpression_8cpp.html#a703431ac2eebd9aed888c0c8db587b88">00322</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a703431ac2eebd9aed888c0c8db587b88">fcnFeatureId</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* )
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324   <span class="comment">// TODO: handling of 64-bit feature ids?</span>
<a name="l00325"></a>00325   <span class="keywordflow">return</span> f ? QVariant(( <span class="keywordtype">int</span> )f-&gt;<a class="code" href="classQgsFeature.html#ab16e0aa72ae9904e5260f29816ac4fac" title="Get the feature id for this feature.">id</a>() ) : QVariant();
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">00328</a> <span class="preprocessor">#define ENSURE_GEOM_TYPE(f, g, geomtype)   if (!f) return QVariant(); \</span>
<a name="l00329"></a>00329 <span class="preprocessor">  QgsGeometry* g = f-&gt;geometry(); \</span>
<a name="l00330"></a>00330 <span class="preprocessor">  if (!g || g-&gt;type() != geomtype) return QVariant();</span>
<a name="l00331"></a>00331 <span class="preprocessor"></span>
<a name="l00332"></a>00332 
<a name="l00333"></a><a class="code" href="qgsexpression_8cpp.html#a68f399a3673f975fd4a9e28bc62873e5">00333</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a68f399a3673f975fd4a9e28bc62873e5">fcnX</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* )
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335   <a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">ENSURE_GEOM_TYPE</a>( f, g, <a class="code" href="classQGis.html#a09947eb19394302eeeed44d3e81dd74ba2c6376a16e5f3dc830ffd0a72597c276">QGis::Point</a> );
<a name="l00336"></a>00336   <span class="keywordflow">if</span> ( g-&gt;isMultipart() )
<a name="l00337"></a>00337   {
<a name="l00338"></a>00338     <span class="keywordflow">return</span> g-&gt;asMultiPoint()[ 0 ].x();
<a name="l00339"></a>00339   }
<a name="l00340"></a>00340   <span class="keywordflow">else</span>
<a name="l00341"></a>00341   {
<a name="l00342"></a>00342     <span class="keywordflow">return</span> g-&gt;asPoint().x();
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344 }
<a name="l00345"></a><a class="code" href="qgsexpression_8cpp.html#aa39bd2b4511d6b82c44315a08414591b">00345</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#aa39bd2b4511d6b82c44315a08414591b">fcnY</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* )
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347   <a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">ENSURE_GEOM_TYPE</a>( f, g, <a class="code" href="classQGis.html#a09947eb19394302eeeed44d3e81dd74ba2c6376a16e5f3dc830ffd0a72597c276">QGis::Point</a> );
<a name="l00348"></a>00348   <span class="keywordflow">if</span> ( g-&gt;isMultipart() )
<a name="l00349"></a>00349   {
<a name="l00350"></a>00350     <span class="keywordflow">return</span> g-&gt;asMultiPoint()[ 0 ].y();
<a name="l00351"></a>00351   }
<a name="l00352"></a>00352   <span class="keywordflow">else</span>
<a name="l00353"></a>00353   {
<a name="l00354"></a>00354     <span class="keywordflow">return</span> g-&gt;asPoint().y();
<a name="l00355"></a>00355   }
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="qgsexpression_8cpp.html#ae19c94cb08d584a48f956011e3a8ea23">00358</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#ae19c94cb08d584a48f956011e3a8ea23">pointAt</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent ) <span class="comment">// helper function</span>
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360   <span class="keywordtype">int</span> idx = <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( values.at( 0 ), parent );
<a name="l00361"></a>00361   <a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">ENSURE_GEOM_TYPE</a>( f, g, <a class="code" href="classQGis.html#a09947eb19394302eeeed44d3e81dd74ba84e19f581d8cf4e8855821b21bff0714">QGis::Line</a> );
<a name="l00362"></a>00362   <a class="code" href="qgsgeometry_8h.html#ae40bfa8c4815c0ea40009f8a13deae52" title="polyline is represented as a vector of points">QgsPolyline</a> polyline = g-&gt;asPolyline();
<a name="l00363"></a>00363   <span class="keywordflow">if</span> ( idx &lt; 0 )
<a name="l00364"></a>00364     idx += polyline.count();
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="keywordflow">if</span> ( idx &lt; 0 || idx &gt;= polyline.count() )
<a name="l00367"></a>00367   {
<a name="l00368"></a>00368     parent-&gt;<a class="code" href="classQgsExpression.html#a3ec34c45a27ddd208dee50bb99686aee" title="Set evaluation error (used internally by evaluation functions)">setEvalErrorString</a>( QObject::tr( <span class="stringliteral">&quot;Index is out of range&quot;</span> ) );
<a name="l00369"></a>00369     <span class="keywordflow">return</span> QVariant();
<a name="l00370"></a>00370   }
<a name="l00371"></a>00371   <span class="keywordflow">return</span> QVariant( QPointF( polyline[idx].x(), polyline[idx].y() ) );
<a name="l00372"></a>00372 }
<a name="l00373"></a>00373 
<a name="l00374"></a><a class="code" href="qgsexpression_8cpp.html#a67ebc17c7d4c05e3f5c7bc0e5deb0e45">00374</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a67ebc17c7d4c05e3f5c7bc0e5deb0e45">fcnXat</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376   QVariant v = <a class="code" href="qgsexpression_8cpp.html#ae19c94cb08d584a48f956011e3a8ea23">pointAt</a>( values, f, parent );
<a name="l00377"></a>00377   <span class="keywordflow">if</span> ( v.type() == QVariant::PointF )
<a name="l00378"></a>00378     <span class="keywordflow">return</span> QVariant( v.toPointF().x() );
<a name="l00379"></a>00379   <span class="keywordflow">else</span>
<a name="l00380"></a>00380     <span class="keywordflow">return</span> QVariant();
<a name="l00381"></a>00381 }
<a name="l00382"></a><a class="code" href="qgsexpression_8cpp.html#a36ed521013c059bcad6180b9bf97f239">00382</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a36ed521013c059bcad6180b9bf97f239">fcnYat</a>( <span class="keyword">const</span> QVariantList&amp; values, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   QVariant v = <a class="code" href="qgsexpression_8cpp.html#ae19c94cb08d584a48f956011e3a8ea23">pointAt</a>( values, f, parent );
<a name="l00385"></a>00385   <span class="keywordflow">if</span> ( v.type() == QVariant::PointF )
<a name="l00386"></a>00386     <span class="keywordflow">return</span> QVariant( v.toPointF().y() );
<a name="l00387"></a>00387   <span class="keywordflow">else</span>
<a name="l00388"></a>00388     <span class="keywordflow">return</span> QVariant();
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a><a class="code" href="qgsexpression_8cpp.html#af0747c46fd1043aebe36cd8fb40f3ebe">00391</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#af0747c46fd1043aebe36cd8fb40f3ebe">fcnGeomArea</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393   <a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">ENSURE_GEOM_TYPE</a>( f, g, <a class="code" href="classQGis.html#a09947eb19394302eeeed44d3e81dd74bab4c5ba16ad4d29832d3abbc6398d195b">QGis::Polygon</a> );
<a name="l00394"></a>00394   <a class="code" href="classQgsDistanceArea.html" title="General purpose distance and area calculator.">QgsDistanceArea</a>* calc = parent-&gt;<a class="code" href="classQgsExpression.html#aa12bd59c4460f57d2d7598bde076f56e" title="Return calculator used for distance and area calculations (used by internal functions)">geomCalculator</a>();
<a name="l00395"></a>00395   <span class="keywordflow">return</span> QVariant( calc-&gt;<a class="code" href="classQgsDistanceArea.html#a43534b97b21240376398ff4116e599d2" title="general measurement (line distance or polygon area)">measure</a>( f-&gt;<a class="code" href="classQgsFeature.html#ab0a934a1b173ce5ad8d13363c20ef3c8" title="Get the geometry object associated with this feature.">geometry</a>() ) );
<a name="l00396"></a>00396 }
<a name="l00397"></a><a class="code" href="qgsexpression_8cpp.html#aebdaaae32be9fb9cdf95aeb983a8a220">00397</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#aebdaaae32be9fb9cdf95aeb983a8a220">fcnGeomLength</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399   <a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">ENSURE_GEOM_TYPE</a>( f, g, <a class="code" href="classQGis.html#a09947eb19394302eeeed44d3e81dd74ba84e19f581d8cf4e8855821b21bff0714">QGis::Line</a> );
<a name="l00400"></a>00400   <a class="code" href="classQgsDistanceArea.html" title="General purpose distance and area calculator.">QgsDistanceArea</a>* calc = parent-&gt;<a class="code" href="classQgsExpression.html#aa12bd59c4460f57d2d7598bde076f56e" title="Return calculator used for distance and area calculations (used by internal functions)">geomCalculator</a>();
<a name="l00401"></a>00401   <span class="keywordflow">return</span> QVariant( calc-&gt;<a class="code" href="classQgsDistanceArea.html#a43534b97b21240376398ff4116e599d2" title="general measurement (line distance or polygon area)">measure</a>( f-&gt;<a class="code" href="classQgsFeature.html#ab0a934a1b173ce5ad8d13363c20ef3c8" title="Get the geometry object associated with this feature.">geometry</a>() ) );
<a name="l00402"></a>00402 }
<a name="l00403"></a><a class="code" href="qgsexpression_8cpp.html#a3d447d450d7d5c106827690f5e02b92b">00403</a> <span class="keyword">static</span> QVariant <a class="code" href="qgsexpression_8cpp.html#a3d447d450d7d5c106827690f5e02b92b">fcnGeomPerimeter</a>( <span class="keyword">const</span> QVariantList&amp; , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent )
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405   <a class="code" href="qgsexpression_8cpp.html#a9dae3027fac52a08ed357043c3629ebb">ENSURE_GEOM_TYPE</a>( f, g, <a class="code" href="classQGis.html#a09947eb19394302eeeed44d3e81dd74bab4c5ba16ad4d29832d3abbc6398d195b">QGis::Polygon</a> );
<a name="l00406"></a>00406   <a class="code" href="classQgsDistanceArea.html" title="General purpose distance and area calculator.">QgsDistanceArea</a>* calc = parent-&gt;<a class="code" href="classQgsExpression.html#aa12bd59c4460f57d2d7598bde076f56e" title="Return calculator used for distance and area calculations (used by internal functions)">geomCalculator</a>();
<a name="l00407"></a>00407   <span class="keywordflow">return</span> QVariant( calc-&gt;<a class="code" href="classQgsDistanceArea.html#ad0c0b0ff846a1b333cb302cc7556d32a" title="measures perimeter of polygon">measurePerimeter</a>( f-&gt;<a class="code" href="classQgsFeature.html#ab0a934a1b173ce5ad8d13363c20ef3c8" title="Get the geometry object associated with this feature.">geometry</a>() ) );
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 QList&lt;QgsExpression::FunctionDef&gt; <a class="code" href="classQgsExpression.html#ac6a8ea87928ae3bbef66accc19edb934">QgsExpression::gmBuiltinFunctions</a>;
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">00412</a> <span class="keyword">const</span> QList&lt;QgsExpression::FunctionDef&gt; &amp;<a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">QgsExpression::BuiltinFunctions</a>()
<a name="l00413"></a>00413 {
<a name="l00414"></a>00414   <span class="keywordflow">if</span> ( <a class="code" href="classQgsExpression.html#ac6a8ea87928ae3bbef66accc19edb934">gmBuiltinFunctions</a>.isEmpty() )
<a name="l00415"></a>00415   {
<a name="l00416"></a>00416     <span class="comment">// math</span>
<a name="l00417"></a>00417     <a class="code" href="classQgsExpression.html#ac6a8ea87928ae3bbef66accc19edb934">gmBuiltinFunctions</a>
<a name="l00418"></a>00418     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;sqrt&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a9cc2142280338805a2039cbe110c5188">fcnSqrt</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00419"></a>00419     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;sin&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#ab8c95cdc5aaad6e588b124b8b7de7b31">fcnSin</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00420"></a>00420     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;cos&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a84fdb9c9e05e85eefc1bc362089b2b64">fcnCos</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00421"></a>00421     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;tan&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a215cda745f7d773f73d7ab87556704b0">fcnTan</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00422"></a>00422     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;asin&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#ab44ecd6734919d854b5c0ad6a3fb0493">fcnAsin</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00423"></a>00423     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;acos&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a895068adf93e02a53397b39eecf601e8">fcnAcos</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00424"></a>00424     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;atan&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a73a4e889293aec70b49d428b2c7dd7b0">fcnAtan</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00425"></a>00425     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;atan2&quot;</span>, 2, <a class="code" href="qgsexpression_8cpp.html#a262ff867c9a9493866d0052d81079b19">fcnAtan2</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00426"></a>00426     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;exp&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#ac68065b1e0c3d6c3497abb3970f07d49">fcnExp</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00427"></a>00427     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;ln&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#aa8ebb747ae7d9dd69afefb0aa3b9205b">fcnLn</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00428"></a>00428     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;log10&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#ad6b69a4abab2da730e82e20aec4f45a3">fcnLog10</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00429"></a>00429     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;log&quot;</span>, 2, <a class="code" href="qgsexpression_8cpp.html#af898741c869a3144a2fa310d99f5389a">fcnLog</a>, QObject::tr( <span class="stringliteral">&quot;Math&quot;</span> ) )
<a name="l00430"></a>00430     <span class="comment">// casts</span>
<a name="l00431"></a>00431     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;toint&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a1e4f03217f55a80bbc10ed01d291e021">fcnToInt</a>, QObject::tr( <span class="stringliteral">&quot;Conversions&quot;</span> ) )
<a name="l00432"></a>00432     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;toreal&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a060be4a0ba39bc2d172f8835e39c924f">fcnToReal</a>, QObject::tr( <span class="stringliteral">&quot;Conversions&quot;</span> ) )
<a name="l00433"></a>00433     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;tostring&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a620d61b85296c14411f99c998efdb28b">fcnToString</a>, QObject::tr( <span class="stringliteral">&quot;Conversions&quot;</span> ) )
<a name="l00434"></a>00434     <span class="comment">// string manipulation</span>
<a name="l00435"></a>00435     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;lower&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a2e80679a057a6f806698fa7ed623753d">fcnLower</a>, QObject::tr( <span class="stringliteral">&quot;String&quot;</span> ) )
<a name="l00436"></a>00436     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;upper&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a59ac3d82f7e46feaa70aebb288a23b96">fcnUpper</a>, QObject::tr( <span class="stringliteral">&quot;String&quot;</span> ) )
<a name="l00437"></a>00437     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;length&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a71e3c685b1076e2725695896efe46462">fcnLength</a>, QObject::tr( <span class="stringliteral">&quot;String&quot;</span> ) )
<a name="l00438"></a>00438     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;replace&quot;</span>, 3, <a class="code" href="qgsexpression_8cpp.html#a5b81ac8ba62d55393d2766a14ae6252f">fcnReplace</a>, QObject::tr( <span class="stringliteral">&quot;String&quot;</span> ) )
<a name="l00439"></a>00439     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;regexp_replace&quot;</span>, 3, <a class="code" href="qgsexpression_8cpp.html#ad33e6e1b3809ab6b000ebc6f490d87cb">fcnRegexpReplace</a>, QObject::tr( <span class="stringliteral">&quot;String&quot;</span> ) )
<a name="l00440"></a>00440     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;substr&quot;</span>, 3, <a class="code" href="qgsexpression_8cpp.html#a82f00d4b641ff9b47d10b2ee89b75a8a">fcnSubstr</a>, QObject::tr( <span class="stringliteral">&quot;String&quot;</span> ) )
<a name="l00441"></a>00441     <span class="comment">// geometry accessors</span>
<a name="l00442"></a>00442     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;xat&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a67ebc17c7d4c05e3f5c7bc0e5deb0e45">fcnXat</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span> )
<a name="l00443"></a>00443     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;yat&quot;</span>, 1, <a class="code" href="qgsexpression_8cpp.html#a36ed521013c059bcad6180b9bf97f239">fcnYat</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span> )
<a name="l00444"></a>00444     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$area&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#af0747c46fd1043aebe36cd8fb40f3ebe">fcnGeomArea</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span> )
<a name="l00445"></a>00445     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$length&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#aebdaaae32be9fb9cdf95aeb983a8a220">fcnGeomLength</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span> )
<a name="l00446"></a>00446     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$perimeter&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#a3d447d450d7d5c106827690f5e02b92b">fcnGeomPerimeter</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span> )
<a name="l00447"></a>00447     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$x&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#a68f399a3673f975fd4a9e28bc62873e5">fcnX</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span> )
<a name="l00448"></a>00448     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$y&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#aa39bd2b4511d6b82c44315a08414591b">fcnY</a>, QObject::tr( <span class="stringliteral">&quot;Geometry&quot;</span> ), <span class="stringliteral">&quot;&quot;</span> , <span class="keyword">true</span> )
<a name="l00449"></a>00449     <span class="comment">// special columns</span>
<a name="l00450"></a>00450     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$rownum&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#a88f6bd7c862ef25b09dbe6832fe223ac">fcnRowNumber</a>, QObject::tr( <span class="stringliteral">&quot;Record&quot;</span> ) )
<a name="l00451"></a>00451     &lt;&lt; <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>( <span class="stringliteral">&quot;$id&quot;</span>, 0, <a class="code" href="qgsexpression_8cpp.html#a703431ac2eebd9aed888c0c8db587b88">fcnFeatureId</a>, QObject::tr( <span class="stringliteral">&quot;Record&quot;</span> ) )
<a name="l00452"></a>00452     ;
<a name="l00453"></a>00453   }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#ac6a8ea87928ae3bbef66accc19edb934">gmBuiltinFunctions</a>;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a><a class="code" href="classQgsExpression.html#abf7eb21534bb222b208290a5cf6794d3">00459</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#abf7eb21534bb222b208290a5cf6794d3">QgsExpression::isFunctionName</a>( QString name )
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a2e7920502e0f1937ab18c364e6f2e137">functionIndex</a>( name ) != -1;
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a><a class="code" href="classQgsExpression.html#a2e7920502e0f1937ab18c364e6f2e137">00464</a> <span class="keywordtype">int</span> <a class="code" href="classQgsExpression.html#a2e7920502e0f1937ab18c364e6f2e137">QgsExpression::functionIndex</a>( QString name )
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   <span class="keywordtype">int</span> count = <a class="code" href="classQgsExpression.html#a290e46c4bfcb4af3ab0ac944cdf927a2" title="Returns the number of functions defined in the parser.">functionCount</a>();
<a name="l00467"></a>00467   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; count; i++ )
<a name="l00468"></a>00468   {
<a name="l00469"></a>00469     <span class="keywordflow">if</span> ( QString::compare( name, <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>()[i].mName, Qt::CaseInsensitive ) == 0 )
<a name="l00470"></a>00470       <span class="keywordflow">return</span> i;
<a name="l00471"></a>00471   }
<a name="l00472"></a>00472   <span class="keywordflow">return</span> -1;
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 
<a name="l00475"></a><a class="code" href="classQgsExpression.html#a290e46c4bfcb4af3ab0ac944cdf927a2">00475</a> <span class="keywordtype">int</span> <a class="code" href="classQgsExpression.html#a290e46c4bfcb4af3ab0ac944cdf927a2" title="Returns the number of functions defined in the parser.">QgsExpression::functionCount</a>()
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>().size();
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 
<a name="l00481"></a><a class="code" href="classQgsExpression.html#ad6fb2304bf9bb52faff3c159b99dfd0a">00481</a> <a class="code" href="classQgsExpression.html#a883d6a2bff57f3a6a3e40659e6e19d98">QgsExpression::QgsExpression</a>( <span class="keyword">const</span> QString&amp; expr )
<a name="l00482"></a>00482     : mExpression( expr ), mRowNumber( 0 ), mCalc( NULL )
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484   <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> = <a class="code" href="qgsexpression_8cpp.html#acfd296fb34ada71a182dcd17e844df7b">::parseExpression</a>( <a class="code" href="classQgsExpression.html#a5fc69aab5b55d776d3ca51d70608d07b">mExpression</a>, <a class="code" href="classQgsExpression.html#af36fb5a54fb93231ca39cd88be339b2d">mParserErrorString</a> );
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="keywordflow">if</span> ( <a class="code" href="classQgsExpression.html#af36fb5a54fb93231ca39cd88be339b2d">mParserErrorString</a>.isNull() )
<a name="l00487"></a>00487   {
<a name="l00488"></a>00488     Q_ASSERT( <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> != NULL );
<a name="l00489"></a>00489   }
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a><a class="code" href="classQgsExpression.html#ad2935db36c7bacfeb2cdf1f984ad0b57">00492</a> <a class="code" href="classQgsExpression.html#ad2935db36c7bacfeb2cdf1f984ad0b57">QgsExpression::~QgsExpression</a>()
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494   <span class="keyword">delete</span> <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>;
<a name="l00495"></a>00495   <span class="keyword">delete</span> <a class="code" href="classQgsExpression.html#ae043e3deec1129dd2549c9e08dca62f3">mCalc</a>;
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="classQgsExpression.html#a2840ff7b8453e4087a446988999f4770">00498</a> QStringList <a class="code" href="classQgsExpression.html#a2840ff7b8453e4087a446988999f4770" title="Get list of columns referenced by the expression.">QgsExpression::referencedColumns</a>()
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00501"></a>00501     <span class="keywordflow">return</span> QStringList();
<a name="l00502"></a>00502   QStringList columns = <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a81e0df7c055ecf815647c86123603de4">referencedColumns</a>();
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="comment">// filter out duplicates</span>
<a name="l00505"></a>00505   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; columns.count(); i++ )
<a name="l00506"></a>00506   {
<a name="l00507"></a>00507     QString col = columns.at( i );
<a name="l00508"></a>00508     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = i + 1; j &lt; columns.count(); j++ )
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510       <span class="keywordflow">if</span> ( QString::compare( col, columns[j], Qt::CaseInsensitive ) == 0 )
<a name="l00511"></a>00511       {
<a name="l00512"></a>00512         <span class="comment">// this column is repeated: remove it!</span>
<a name="l00513"></a>00513         columns.removeAt( j-- );
<a name="l00514"></a>00514       }
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516   }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <span class="keywordflow">return</span> columns;
<a name="l00519"></a>00519 }
<a name="l00520"></a>00520 
<a name="l00521"></a><a class="code" href="classQgsExpression.html#a457ea260f8f9a79f2b6db67b9e9fd17e">00521</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a457ea260f8f9a79f2b6db67b9e9fd17e" title="Returns true if the expression uses feature geometry for some computation.">QgsExpression::needsGeometry</a>()
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00524"></a>00524     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00525"></a>00525   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#ae90edfcd18b28bb5dbd9b28c33d8a733">needsGeometry</a>();
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="classQgsExpression.html#a64f2c176ab9e20040b4dcfe26ac1cb57">00528</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a64f2c176ab9e20040b4dcfe26ac1cb57">QgsExpression::initGeomCalculator</a>()
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530   <a class="code" href="classQgsExpression.html#ae043e3deec1129dd2549c9e08dca62f3">mCalc</a> = <span class="keyword">new</span> <a class="code" href="classQgsDistanceArea.html" title="General purpose distance and area calculator.">QgsDistanceArea</a>;
<a name="l00531"></a>00531   <a class="code" href="classQgsExpression.html#ae043e3deec1129dd2549c9e08dca62f3">mCalc</a>-&gt;<a class="code" href="classQgsDistanceArea.html#a60133000e1d2ecc8fd6c955fb9478e46" title="sets whether coordinates must be projected to ellipsoid before measuring">setProjectionsEnabled</a>( <span class="keyword">false</span> );
<a name="l00532"></a>00532   QSettings settings;
<a name="l00533"></a>00533   QString ellipsoid = settings.value( <span class="stringliteral">&quot;/qgis/measure/ellipsoid&quot;</span>, <span class="stringliteral">&quot;WGS84&quot;</span> ).toString();
<a name="l00534"></a>00534   <a class="code" href="classQgsExpression.html#ae043e3deec1129dd2549c9e08dca62f3">mCalc</a>-&gt;<a class="code" href="classQgsDistanceArea.html#aa8616be62f778a3d9a7aa604611d5549" title="sets ellipsoid by its acronym">setEllipsoid</a>( ellipsoid );
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846">00537</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::prepare</a>( <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l00538"></a>00538 {
<a name="l00539"></a>00539   <a class="code" href="classQgsExpression.html#a7dc26b6c0d30edeb057aeb2cfc172b1b">mEvalErrorString</a> = QString();
<a name="l00540"></a>00540   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00541"></a>00541   {
<a name="l00542"></a>00542     <a class="code" href="classQgsExpression.html#a7dc26b6c0d30edeb057aeb2cfc172b1b">mEvalErrorString</a> = QObject::tr( <span class="stringliteral">&quot;No root node! Parsing failed?&quot;</span> );
<a name="l00543"></a>00543     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00544"></a>00544   }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06b00463ee3220f3b63c683143bb4c20">prepare</a>( <span class="keyword">this</span>, fields );
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="classQgsExpression.html#a3aa14b9feb0eb42e4a6e48739681e0b1">00549</a> QVariant <a class="code" href="classQgsExpression.html#a3aa14b9feb0eb42e4a6e48739681e0b1" title="Evaluate the feature and return the result.">QgsExpression::evaluate</a>( <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   <a class="code" href="classQgsExpression.html#a7dc26b6c0d30edeb057aeb2cfc172b1b">mEvalErrorString</a> = QString();
<a name="l00552"></a>00552   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00553"></a>00553   {
<a name="l00554"></a>00554     <a class="code" href="classQgsExpression.html#a7dc26b6c0d30edeb057aeb2cfc172b1b">mEvalErrorString</a> = QObject::tr( <span class="stringliteral">&quot;No root node! Parsing failed?&quot;</span> );
<a name="l00555"></a>00555     <span class="keywordflow">return</span> QVariant();
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a2d7d24c38205d80b13da095ae8b005ae">eval</a>( <span class="keyword">this</span>, f );
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="classQgsExpression.html#a0f547665d76f78defab0e5c292ee8a5a">00561</a> QVariant <a class="code" href="classQgsExpression.html#a3aa14b9feb0eb42e4a6e48739681e0b1" title="Evaluate the feature and return the result.">QgsExpression::evaluate</a>( <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563   <span class="comment">// first prepare</span>
<a name="l00564"></a>00564   <span class="keywordtype">bool</span> res = <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">prepare</a>( fields );
<a name="l00565"></a>00565   <span class="keywordflow">if</span> ( !res )
<a name="l00566"></a>00566     <span class="keywordflow">return</span> QVariant();
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   <span class="comment">// then evaluate</span>
<a name="l00569"></a>00569   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a3aa14b9feb0eb42e4a6e48739681e0b1" title="Evaluate the feature and return the result.">evaluate</a>( f );
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb">00572</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::dump</a>()<span class="keyword"> const</span>
<a name="l00573"></a>00573 <span class="keyword"></span>{
<a name="l00574"></a>00574   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00575"></a>00575     <span class="keywordflow">return</span> QObject::tr( <span class="stringliteral">&quot;(no root)&quot;</span> );
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   <span class="keywordflow">return</span> <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06678388ac891f94284bd83ae2c3ccb0">dump</a>();
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">00580</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l00581"></a>00581 <span class="keyword"></span>{
<a name="l00582"></a>00582   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00583"></a>00583     <span class="keywordflow">return</span>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a990fe68de4a381dbb183505ffecfd39e">toOgcFilter</a>( doc, element );
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a><a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">00588</a> <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::createFromOgcFilter</a>( QDomElement &amp;element )
<a name="l00589"></a>00589 {
<a name="l00590"></a>00590   <span class="keywordflow">if</span> ( element.isNull() || !element.hasChildNodes() )
<a name="l00591"></a>00591     <span class="keywordflow">return</span> NULL;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a> *expr = <span class="keyword">new</span> <a class="code" href="classQgsExpression.html#a883d6a2bff57f3a6a3e40659e6e19d98">QgsExpression</a>();
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   QDomElement childElem = element.firstChildElement();
<a name="l00596"></a>00596   <span class="keywordflow">while</span> ( !childElem.isNull() )
<a name="l00597"></a>00597   {
<a name="l00598"></a>00598     QString errorMsg;
<a name="l00599"></a>00599     <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *node = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( childElem, errorMsg );
<a name="l00600"></a>00600     <span class="keywordflow">if</span> ( !node )
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602       <span class="comment">// invalid expression, parser error</span>
<a name="l00603"></a>00603       expr-&gt;<a class="code" href="classQgsExpression.html#af36fb5a54fb93231ca39cd88be339b2d">mParserErrorString</a> = errorMsg;
<a name="l00604"></a>00604       <span class="keywordflow">return</span> expr;
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="comment">// use the concat binary operator to append to the root node</span>
<a name="l00608"></a>00608     <span class="keywordflow">if</span> ( !expr-&gt;<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00609"></a>00609     {
<a name="l00610"></a>00610       expr-&gt;<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> = node;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     <span class="keywordflow">else</span>
<a name="l00613"></a>00613     {
<a name="l00614"></a>00614       expr-&gt;<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aad16fd22b27282b0157f3eb8095d15949">boConcat</a>, expr-&gt;<a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>, node );
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     childElem = childElem.nextSiblingElement();
<a name="l00618"></a>00618   }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620   <span class="keywordflow">return</span> expr;
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a><a class="code" href="classQgsExpression.html#ad35d36b5f7d06e7e45383a2db8905505">00623</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#ad35d36b5f7d06e7e45383a2db8905505" title="entry function for the visitor pattern">QgsExpression::acceptVisitor</a>( <a class="code" href="classQgsExpression_1_1Visitor.html" title="support for visitor pattern - algorithms dealing with the expressions may be implemented without modi...">QgsExpression::Visitor</a>&amp; v )
<a name="l00624"></a>00624 {
<a name="l00625"></a>00625   <span class="keywordflow">if</span> ( <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a> )
<a name="l00626"></a>00626     <a class="code" href="classQgsExpression.html#a0991c254a9767a8de1c473550d7f2954">mRootNode</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a30429578806210857511325a1ce721da">accept</a>( v );
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 
<a name="l00630"></a><a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">00630</a> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::Node::createFromOgcFilter</a>( QDomElement &amp;element, QString &amp;errorMessage )
<a name="l00631"></a>00631 {
<a name="l00632"></a>00632   <span class="keywordflow">if</span> ( element.isNull() )
<a name="l00633"></a>00633     <span class="keywordflow">return</span> NULL;
<a name="l00634"></a>00634 
<a name="l00635"></a>00635   <span class="comment">// check for unary operators</span>
<a name="l00636"></a>00636   <span class="keywordtype">int</span> unaryOpCount = <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">UnaryOgcOperatorText</a> ) / <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">UnaryOgcOperatorText</a>[0] );
<a name="l00637"></a>00637   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; unaryOpCount; i++ )
<a name="l00638"></a>00638   {
<a name="l00639"></a>00639     QString ogcOperatorName = <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">UnaryOgcOperatorText</a>[ i ];
<a name="l00640"></a>00640     <span class="keywordflow">if</span> ( ogcOperatorName.isEmpty() )
<a name="l00641"></a>00641       <span class="keywordflow">continue</span>;
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <span class="keywordflow">if</span> ( element.localName() == ogcOperatorName )
<a name="l00644"></a>00644     {
<a name="l00645"></a>00645       <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *node = <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::NodeUnaryOperator::createFromOgcFilter</a>( element, errorMessage );
<a name="l00646"></a>00646       <span class="keywordflow">if</span> ( node )
<a name="l00647"></a>00647         <span class="keywordflow">return</span> node;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649       <span class="keywordflow">return</span> NULL;
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651   }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   <span class="comment">// check for binary operators</span>
<a name="l00654"></a>00654   <span class="keywordtype">int</span> binaryOpCount = <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a> ) / <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a>[0] );
<a name="l00655"></a>00655   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; binaryOpCount; i++ )
<a name="l00656"></a>00656   {
<a name="l00657"></a>00657     QString ogcOperatorName = <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a>[ i ];
<a name="l00658"></a>00658     <span class="keywordflow">if</span> ( ogcOperatorName.isEmpty() )
<a name="l00659"></a>00659       <span class="keywordflow">continue</span>;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="keywordflow">if</span> ( element.localName() == ogcOperatorName )
<a name="l00662"></a>00662     {
<a name="l00663"></a>00663       <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *node = <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::NodeBinaryOperator::createFromOgcFilter</a>( element, errorMessage );
<a name="l00664"></a>00664       <span class="keywordflow">if</span> ( node )
<a name="l00665"></a>00665         <span class="keywordflow">return</span> node;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <span class="keywordflow">return</span> NULL;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669   }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   <span class="comment">// check for other OGC operators, convert them to expressions</span>
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   <span class="keywordflow">if</span> ( element.localName() == <span class="stringliteral">&quot;PropertyIsNull&quot;</span> )
<a name="l00674"></a>00674   {
<a name="l00675"></a>00675     <span class="keywordflow">return</span> <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::NodeBinaryOperator::createFromOgcFilter</a>( element, errorMessage );
<a name="l00676"></a>00676   }
<a name="l00677"></a>00677   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( element.localName() == <span class="stringliteral">&quot;Literal&quot;</span> )
<a name="l00678"></a>00678   {
<a name="l00679"></a>00679     <span class="keywordflow">return</span> <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::NodeLiteral::createFromOgcFilter</a>( element, errorMessage );
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( element.localName() == <span class="stringliteral">&quot;Function&quot;</span> )
<a name="l00682"></a>00682   {
<a name="l00683"></a>00683     <span class="keywordflow">return</span> <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::NodeFunction::createFromOgcFilter</a>( element, errorMessage );
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( element.localName() == <span class="stringliteral">&quot;PropertyName&quot;</span> )
<a name="l00686"></a>00686   {
<a name="l00687"></a>00687     <span class="keywordflow">return</span> <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">QgsExpression::NodeColumnRef::createFromOgcFilter</a>( element, errorMessage );
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( element.localName() == <span class="stringliteral">&quot;PropertyIsBetween&quot;</span> )
<a name="l00690"></a>00690   {
<a name="l00691"></a>00691     <span class="comment">// &lt;ogc:PropertyIsBetween&gt; encode a Range check</span>
<a name="l00692"></a>00692     <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *operand = 0, *lowerBound = 0, *upperBound = 0;
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     QDomElement operandElem = element.firstChildElement( <span class="stringliteral">&quot;LowerBoundary&quot;</span> );
<a name="l00695"></a>00695     <span class="keywordflow">if</span> ( !operandElem.isNull() )
<a name="l00696"></a>00696       lowerBound = <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     operandElem = element.firstChildElement( <span class="stringliteral">&quot;UpperBoundary&quot;</span> );
<a name="l00699"></a>00699     <span class="keywordflow">if</span> ( !operandElem.isNull() )
<a name="l00700"></a>00700       upperBound = <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="comment">// &lt;ogc:expression&gt;</span>
<a name="l00703"></a>00703     operandElem = element.firstChildElement();
<a name="l00704"></a>00704     <span class="keywordflow">while</span> ( !operandElem.isNull() )
<a name="l00705"></a>00705     {
<a name="l00706"></a>00706       <span class="keywordflow">if</span> ( operandElem.localName() != <span class="stringliteral">&quot;LowerBoundary&quot;</span> &amp;&amp;
<a name="l00707"></a>00707            operandElem.localName() != <span class="stringliteral">&quot;UpperBoundary&quot;</span> )
<a name="l00708"></a>00708       {
<a name="l00709"></a>00709         operand = <a class="code" href="classQgsExpression_1_1Node.html#aeafa3d479b29715860446a8c8af6e27f">createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l00710"></a>00710         <span class="keywordflow">break</span>;
<a name="l00711"></a>00711       }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713       operandElem = operandElem.nextSiblingElement();
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="keywordflow">if</span> ( !operand || !lowerBound || !upperBound )
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718       <span class="keywordflow">if</span> ( operand )
<a name="l00719"></a>00719         <span class="keyword">delete</span> operand;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       <span class="keywordflow">if</span> ( lowerBound )
<a name="l00722"></a>00722         <span class="keyword">delete</span> lowerBound;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724       <span class="keywordflow">if</span> ( upperBound )
<a name="l00725"></a>00725         <span class="keyword">delete</span> upperBound;
<a name="l00726"></a>00726 
<a name="l00727"></a>00727       errorMessage = <span class="stringliteral">&quot;missing some required sub-elements in ogc:PropertyIsBetween&quot;</span>;
<a name="l00728"></a>00728       <span class="keywordflow">return</span> NULL;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *geOperator = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa70b1d9e9b219fe55d294e3e408ab2d22">boGE</a>, operand, lowerBound );
<a name="l00732"></a>00732     <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *leOperator = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8d17d0c4976b738e99790f3b8753caa0">boLE</a>, operand, upperBound );
<a name="l00733"></a>00733     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa22faebaab32a746ab389bc9a8bf71cd3">boAnd</a>, geOperator, leOperator );
<a name="l00734"></a>00734   }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   errorMessage += QString( <span class="stringliteral">&quot;unable to convert &#39;%1&#39; element to a valid expression: it is not supported yet or it has invalid arguments&quot;</span> ).arg( element.tagName() );
<a name="l00737"></a>00737   <span class="keywordflow">return</span> NULL;
<a name="l00738"></a>00738 }
<a name="l00739"></a>00739 
<a name="l00741"></a>00741 <span class="comment">// nodes</span>
<a name="l00742"></a>00742 
<a name="l00743"></a><a class="code" href="classQgsExpression_1_1NodeList.html#a8950d5a4d483ae069561972a77fe951e">00743</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeList::dump</a>()<span class="keyword"> const</span>
<a name="l00744"></a>00744 <span class="keyword"></span>{
<a name="l00745"></a>00745   QString msg; <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
<a name="l00746"></a>00746   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mList )
<a name="l00747"></a>00747   {
<a name="l00748"></a>00748     <span class="keywordflow">if</span> ( !first ) msg += <span class="stringliteral">&quot;, &quot;</span>; <span class="keywordflow">else</span> first = <span class="keyword">false</span>;
<a name="l00749"></a>00749     msg += n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06678388ac891f94284bd83ae2c3ccb0">dump</a>();
<a name="l00750"></a>00750   }
<a name="l00751"></a>00751   <span class="keywordflow">return</span> msg;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="classQgsExpression_1_1NodeList.html#aafa67fe5c10e2b839da0ac9b4de587e7">00754</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeList::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l00755"></a>00755 <span class="keyword"></span>{
<a name="l00756"></a>00756   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mList )
<a name="l00757"></a>00757   {
<a name="l00758"></a>00758     n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a990fe68de4a381dbb183505ffecfd39e">toOgcFilter</a>( doc, element );
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760 }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762 <span class="comment">//</span>
<a name="l00763"></a>00763 
<a name="l00764"></a><a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html#a60642cce9314d15150f8356ae552fbdd">00764</a> QVariant <a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html#a60642cce9314d15150f8356ae552fbdd">QgsExpression::NodeUnaryOperator::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l00765"></a>00765 {
<a name="l00766"></a>00766   QVariant val = mOperand-&gt;eval( parent, f );
<a name="l00767"></a>00767   <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00768"></a>00768 
<a name="l00769"></a>00769   <span class="keywordflow">switch</span> ( mOp )
<a name="l00770"></a>00770   {
<a name="l00771"></a>00771     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ac0c6e28972f9c80484a9e49e5bae7073a2efee32e4a87e98bed7c3bba5b098e6c">uoNot</a>:
<a name="l00772"></a>00772     {
<a name="l00773"></a>00773       <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> tvl = <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( val, parent );
<a name="l00774"></a>00774       <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00775"></a>00775       <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#aa591871f07bb6e0a698151b720016f87">tvl2variant</a>( <a class="code" href="qgsexpression_8cpp.html#a3dea20adcefd386e9daec0381d5d76be">NOT</a>[tvl] );
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ac0c6e28972f9c80484a9e49e5bae7073a0589d5eaf58e42453925f65906e957fd">uoMinus</a>:
<a name="l00779"></a>00779       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#a6f495aacc43767959ab49dfb2065b0ff">isIntSafe</a>( val ) )
<a name="l00780"></a>00780         <span class="keywordflow">return</span> QVariant( - <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( val, parent ) );
<a name="l00781"></a>00781       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( val ) )
<a name="l00782"></a>00782         <span class="keywordflow">return</span> QVariant( - <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( val, parent ) );
<a name="l00783"></a>00783       <span class="keywordflow">else</span>
<a name="l00784"></a>00784         <a class="code" href="qgsexpression_8cpp.html#ace2372f87f2c940015b973f921947083">SET_EVAL_ERROR</a>( QObject::tr( <span class="stringliteral">&quot;Unary minus only for numeric values.&quot;</span> ) );
<a name="l00785"></a>00785       <span class="keywordflow">break</span>;
<a name="l00786"></a>00786     <span class="keywordflow">default</span>:
<a name="l00787"></a>00787       Q_ASSERT( 0 &amp;&amp; <span class="stringliteral">&quot;unknown unary operation&quot;</span> );
<a name="l00788"></a>00788   }
<a name="l00789"></a>00789   <span class="keywordflow">return</span> QVariant();
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html#a9d3947e3b28742b48e4e122a15f2fa17">00792</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeUnaryOperator::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794   <span class="keywordflow">return</span> mOperand-&gt;prepare( parent, fields );
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html#ac07139d5b2f1a196071d4cc57439e528">00797</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeUnaryOperator::dump</a>()<span class="keyword"> const</span>
<a name="l00798"></a>00798 <span class="keyword"></span>{
<a name="l00799"></a>00799   <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;%1 %2&quot;</span> ).arg( <a class="code" href="classQgsExpression.html#a768ab64f1c96dc9d0182d455327e8f30">UnaryOperatorText</a>[mOp] ).arg( mOperand-&gt;dump() );
<a name="l00800"></a>00800 }
<a name="l00801"></a>00801 
<a name="l00802"></a><a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html#afc76bb843d42bfe2300d45df2215f994">00802</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeUnaryOperator::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l00803"></a>00803 <span class="keyword"></span>{
<a name="l00804"></a>00804   QDomElement uoElem;
<a name="l00805"></a>00805   <span class="keywordflow">switch</span> ( mOp )
<a name="l00806"></a>00806   {
<a name="l00807"></a>00807     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ac0c6e28972f9c80484a9e49e5bae7073a0589d5eaf58e42453925f65906e957fd">uoMinus</a>:
<a name="l00808"></a>00808       uoElem = doc.createElement( <span class="stringliteral">&quot;ogc:Literal&quot;</span> );
<a name="l00809"></a>00809       uoElem.appendChild( doc.createTextNode( <span class="stringliteral">&quot;-&quot;</span> ) );
<a name="l00810"></a>00810       <span class="keywordflow">break</span>;
<a name="l00811"></a>00811     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ac0c6e28972f9c80484a9e49e5bae7073a2efee32e4a87e98bed7c3bba5b098e6c">uoNot</a>:
<a name="l00812"></a>00812       uoElem = doc.createElement( <span class="stringliteral">&quot;ogc:Not&quot;</span> );
<a name="l00813"></a>00813       <span class="keywordflow">break</span>;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="keywordflow">default</span>:
<a name="l00816"></a>00816       element.appendChild( doc.createComment( QString( <span class="stringliteral">&quot;Unary operator %1 not implemented yet&quot;</span> ).arg( <a class="code" href="classQgsExpression.html#a768ab64f1c96dc9d0182d455327e8f30">UnaryOperatorText</a>[mOp] ) ) );
<a name="l00817"></a>00817       <span class="keywordflow">return</span>;
<a name="l00818"></a>00818   }
<a name="l00819"></a>00819   mOperand-&gt;toOgcFilter( doc, uoElem );
<a name="l00820"></a>00820   element.appendChild( uoElem );
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a><a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html#addebaa5446a5d1cc0c38c26ba63670d4">00823</a> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::NodeUnaryOperator::createFromOgcFilter</a>( QDomElement &amp;element, QString &amp;errorMessage )
<a name="l00824"></a>00824 {
<a name="l00825"></a>00825   <span class="keywordflow">if</span> ( element.isNull() )
<a name="l00826"></a>00826     <span class="keywordflow">return</span> NULL;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   <span class="keywordtype">int</span> unaryOpCount = <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">UnaryOgcOperatorText</a> ) / <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">UnaryOgcOperatorText</a>[0] );
<a name="l00829"></a>00829   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; unaryOpCount; i++ )
<a name="l00830"></a>00830   {
<a name="l00831"></a>00831     QString ogcOperatorName = <a class="code" href="classQgsExpression.html#a5447fda15a53d27583a56290fdc28a4c">UnaryOgcOperatorText</a>[ i ];
<a name="l00832"></a>00832     <span class="keywordflow">if</span> ( ogcOperatorName.isEmpty() )
<a name="l00833"></a>00833       <span class="keywordflow">continue</span>;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     <span class="keywordflow">if</span> ( element.localName() != ogcOperatorName )
<a name="l00836"></a>00836       <span class="keywordflow">continue</span>;
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     QDomElement operandElem = element.firstChildElement();
<a name="l00839"></a>00839     <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* operand = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l00840"></a>00840     <span class="keywordflow">if</span> ( !operand )
<a name="l00841"></a>00841     {
<a name="l00842"></a>00842       <span class="keywordflow">if</span> ( errorMessage.isEmpty() )
<a name="l00843"></a>00843         errorMessage = QString( <span class="stringliteral">&quot;invalid operand for &#39;%1&#39; unary operator&quot;</span> ).arg( ogcOperatorName );
<a name="l00844"></a>00844       <span class="keywordflow">return</span> NULL;
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeUnaryOperator.html">QgsExpression::NodeUnaryOperator</a>(( <a class="code" href="classQgsExpression.html#ac0c6e28972f9c80484a9e49e5bae7073">UnaryOperator</a> ) i, operand );
<a name="l00848"></a>00848   }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850   errorMessage = QString( <span class="stringliteral">&quot;%1 unary operator not supported.&quot;</span> ).arg( element.tagName() );
<a name="l00851"></a>00851   <span class="keywordflow">return</span> NULL;
<a name="l00852"></a>00852 }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 <span class="comment">//</span>
<a name="l00855"></a>00855 
<a name="l00856"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#a5941afc50c859ae6e3368e32da406b8e">00856</a> QVariant <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#a5941afc50c859ae6e3368e32da406b8e">QgsExpression::NodeBinaryOperator::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l00857"></a>00857 {
<a name="l00858"></a>00858   QVariant vL = mOpLeft-&gt;eval( parent, f );
<a name="l00859"></a>00859   <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00860"></a>00860   QVariant vR = mOpRight-&gt;eval( parent, f );
<a name="l00861"></a>00861   <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00862"></a>00862 
<a name="l00863"></a>00863   <span class="keywordflow">switch</span> ( mOp )
<a name="l00864"></a>00864   {
<a name="l00865"></a>00865     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa6fab8d4081c4895f37e96cc41df911e4">boPlus</a>:
<a name="l00866"></a>00866     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aac28bc81129fcdc61b61d5d15e54dfd51">boMinus</a>:
<a name="l00867"></a>00867     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa4da616886b37fa56cb23135dfabdeda2">boMul</a>:
<a name="l00868"></a>00868     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa71e9704355bfc06d84d2406d9c361cc6">boDiv</a>:
<a name="l00869"></a>00869     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa4ddd2b935e22147464918ad0f61112f7">boMod</a>:
<a name="l00870"></a>00870       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) || <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) )
<a name="l00871"></a>00871         <span class="keywordflow">return</span> QVariant();
<a name="l00872"></a>00872       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#a6f495aacc43767959ab49dfb2065b0ff">isIntSafe</a>( vL ) &amp;&amp; <a class="code" href="qgsexpression_8cpp.html#a6f495aacc43767959ab49dfb2065b0ff">isIntSafe</a>( vR ) )
<a name="l00873"></a>00873       {
<a name="l00874"></a>00874         <span class="comment">// both are integers - let&#39;s use integer arithmetics</span>
<a name="l00875"></a>00875         <span class="keywordtype">int</span> iL = <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00876"></a>00876         <span class="keywordtype">int</span> iR = <a class="code" href="qgsexpression_8cpp.html#ad72b457951ea0bf725ee15414e48fd08">getIntValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00877"></a>00877         <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa71e9704355bfc06d84d2406d9c361cc6">boDiv</a> &amp;&amp; iR == 0 ) <span class="keywordflow">return</span> QVariant(); <span class="comment">// silently handle division by zero and return NULL</span>
<a name="l00878"></a>00878         <span class="keywordflow">return</span> QVariant( computeInt( iL, iR ) );
<a name="l00879"></a>00879       }
<a name="l00880"></a>00880       <span class="keywordflow">else</span>
<a name="l00881"></a>00881       {
<a name="l00882"></a>00882         <span class="comment">// general floating point arithmetic</span>
<a name="l00883"></a>00883         <span class="keywordtype">double</span> fL = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00884"></a>00884         <span class="keywordtype">double</span> fR = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00885"></a>00885         <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa71e9704355bfc06d84d2406d9c361cc6">boDiv</a> &amp;&amp; fR == 0 )
<a name="l00886"></a>00886           <span class="keywordflow">return</span> QVariant(); <span class="comment">// silently handle division by zero and return NULL</span>
<a name="l00887"></a>00887         <span class="keywordflow">return</span> QVariant( computeDouble( fL, fR ) );
<a name="l00888"></a>00888       }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa72d81c3bbca07cedb6969e8885c5bc03">boPow</a>:
<a name="l00891"></a>00891       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) || <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) )
<a name="l00892"></a>00892         <span class="keywordflow">return</span> QVariant();
<a name="l00893"></a>00893       <span class="keywordflow">else</span>
<a name="l00894"></a>00894       {
<a name="l00895"></a>00895         <span class="keywordtype">double</span> fL = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00896"></a>00896         <span class="keywordtype">double</span> fR = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00897"></a>00897         <span class="keywordflow">return</span> QVariant( pow( fL, fR ) );
<a name="l00898"></a>00898       }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa22faebaab32a746ab389bc9a8bf71cd3">boAnd</a>:
<a name="l00901"></a>00901     {
<a name="l00902"></a>00902       <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> tvlL = <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( vL, parent ), tvlR = <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( vR, parent );
<a name="l00903"></a>00903       <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00904"></a>00904       <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#aa591871f07bb6e0a698151b720016f87">tvl2variant</a>( <a class="code" href="qgsexpression_8cpp.html#a4584615fec342fa7a9ed1bdfb796fd37">AND</a>[tvlL][tvlR] );
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa76a48ac820474b70b6f8faa08f9fbeb8">boOr</a>:
<a name="l00908"></a>00908     {
<a name="l00909"></a>00909       <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> tvlL = <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( vL, parent ), tvlR = <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( vR, parent );
<a name="l00910"></a>00910       <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00911"></a>00911       <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#aa591871f07bb6e0a698151b720016f87">tvl2variant</a>( <a class="code" href="qgsexpression_8cpp.html#af723dab70650b4de44f091216ba95dfa">OR</a>[tvlL][tvlR] );
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aadcb265c1b60c488c8eeeaf6ba6848c6a">boEQ</a>:
<a name="l00915"></a>00915     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa6a03ee082ea1dd1fd501e2bce09bf0f8">boNE</a>:
<a name="l00916"></a>00916     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa3a7c1f19680afdef89e4ba02962f473a">boLT</a>:
<a name="l00917"></a>00917     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa1b68b909fd5ed7cb3cc9ca815ea48a83">boGT</a>:
<a name="l00918"></a>00918     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8d17d0c4976b738e99790f3b8753caa0">boLE</a>:
<a name="l00919"></a>00919     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa70b1d9e9b219fe55d294e3e408ab2d22">boGE</a>:
<a name="l00920"></a>00920       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) || <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) )
<a name="l00921"></a>00921       {
<a name="l00922"></a>00922         <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#a773396cccbd1ecd1596db50fb3eb5182">TVL_Unknown</a>;
<a name="l00923"></a>00923       }
<a name="l00924"></a>00924       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( vL ) &amp;&amp; <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( vR ) )
<a name="l00925"></a>00925       {
<a name="l00926"></a>00926         <span class="comment">// do numeric comparison if both operators can be converted to numbers</span>
<a name="l00927"></a>00927         <span class="keywordtype">double</span> fL = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00928"></a>00928         <span class="keywordtype">double</span> fR = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00929"></a>00929         <span class="keywordflow">return</span> compare( fL - fR ) ? <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a> : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a>;
<a name="l00930"></a>00930       }
<a name="l00931"></a>00931       <span class="keywordflow">else</span>
<a name="l00932"></a>00932       {
<a name="l00933"></a>00933         <span class="comment">// do string comparison otherwise</span>
<a name="l00934"></a>00934         QString sL = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00935"></a>00935         QString sR = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00936"></a>00936         <span class="keywordtype">int</span> diff = QString::compare( sL, sR );
<a name="l00937"></a>00937         <span class="keywordflow">return</span> compare( diff ) ? <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a> : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a>;
<a name="l00938"></a>00938       }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a>:
<a name="l00941"></a>00941     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaabf111823af81070abdcfd67529ca74b">boIsNot</a>:
<a name="l00942"></a>00942       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) &amp;&amp; <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) ) <span class="comment">// both operators null</span>
<a name="l00943"></a>00943         <span class="keywordflow">return</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a> ? <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a> : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a> );
<a name="l00944"></a>00944       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) || <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) ) <span class="comment">// one operator null</span>
<a name="l00945"></a>00945         <span class="keywordflow">return</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a> ? TVL_False : <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a> );
<a name="l00946"></a>00946       <span class="keywordflow">else</span> <span class="comment">// both operators non-null</span>
<a name="l00947"></a>00947       {
<a name="l00948"></a>00948         <span class="keywordtype">bool</span> equal = <span class="keyword">false</span>;
<a name="l00949"></a>00949         <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( vL ) &amp;&amp; <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( vR ) )
<a name="l00950"></a>00950         {
<a name="l00951"></a>00951           <span class="keywordtype">double</span> fL = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00952"></a>00952           <span class="keywordtype">double</span> fR = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00953"></a>00953           equal = fL == fR;
<a name="l00954"></a>00954         }
<a name="l00955"></a>00955         <span class="keywordflow">else</span>
<a name="l00956"></a>00956         {
<a name="l00957"></a>00957           QString sL = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00958"></a>00958           QString sR = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00959"></a>00959           equal = QString::compare( sL, sR ) == 0;
<a name="l00960"></a>00960         }
<a name="l00961"></a>00961         <span class="keywordflow">if</span> ( equal )
<a name="l00962"></a>00962           <span class="keywordflow">return</span> mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a> ? TVL_True : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a>;
<a name="l00963"></a>00963         <span class="keywordflow">else</span>
<a name="l00964"></a>00964           <span class="keywordflow">return</span> mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a> ? TVL_False : <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a>;
<a name="l00965"></a>00965       }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa26113bd1006a383c640e585fb1486e78">boRegexp</a>:
<a name="l00968"></a>00968     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8aa26ef80634b913f0827f48cb3f7c11">boLike</a>:
<a name="l00969"></a>00969     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa18640756b1998576a4d019215f7e15f2">boNotLike</a>:
<a name="l00970"></a>00970     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa934c2155a54606b78e6b510e8cb77614">boILike</a>:
<a name="l00971"></a>00971     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa21c9dd2361d9a7dba2a2d8a76bd9d053">boNotILike</a>:
<a name="l00972"></a>00972       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) || <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) )
<a name="l00973"></a>00973         <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#a773396cccbd1ecd1596db50fb3eb5182">TVL_Unknown</a>;
<a name="l00974"></a>00974       <span class="keywordflow">else</span>
<a name="l00975"></a>00975       {
<a name="l00976"></a>00976         QString str    = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00977"></a>00977         QString regexp = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l00978"></a>00978         <span class="comment">// TODO: cache QRegExp in case that regexp is a literal string (i.e. it will stay constant)</span>
<a name="l00979"></a>00979         <span class="keywordtype">bool</span> matches;
<a name="l00980"></a>00980         <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8aa26ef80634b913f0827f48cb3f7c11">boLike</a> || mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa934c2155a54606b78e6b510e8cb77614">boILike</a> || mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa18640756b1998576a4d019215f7e15f2">boNotLike</a> || mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa21c9dd2361d9a7dba2a2d8a76bd9d053">boNotILike</a> ) <span class="comment">// change from LIKE syntax to regexp</span>
<a name="l00981"></a>00981         {
<a name="l00982"></a>00982           <span class="comment">// XXX escape % and _  ???</span>
<a name="l00983"></a>00983           regexp.replace( <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;.*&quot;</span> );
<a name="l00984"></a>00984           regexp.replace( <span class="stringliteral">&quot;_&quot;</span>, <span class="stringliteral">&quot;.&quot;</span> );
<a name="l00985"></a>00985           matches = QRegExp( regexp, mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8aa26ef80634b913f0827f48cb3f7c11">boLike</a> || mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa18640756b1998576a4d019215f7e15f2">boNotLike</a> ? Qt::CaseSensitive : Qt::CaseInsensitive ).exactMatch( str );
<a name="l00986"></a>00986         }
<a name="l00987"></a>00987         <span class="keywordflow">else</span>
<a name="l00988"></a>00988         {
<a name="l00989"></a>00989           matches = QRegExp( regexp ).indexIn( str ) != -1;
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992         <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa18640756b1998576a4d019215f7e15f2">boNotLike</a> || mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa21c9dd2361d9a7dba2a2d8a76bd9d053">boNotILike</a> )
<a name="l00993"></a>00993         {
<a name="l00994"></a>00994           matches = !matches;
<a name="l00995"></a>00995         }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997         <span class="keywordflow">return</span> matches ? TVL_True : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a>;
<a name="l00998"></a>00998       }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aad16fd22b27282b0157f3eb8095d15949">boConcat</a>:
<a name="l01001"></a>01001       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vL ) || <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( vR ) )
<a name="l01002"></a>01002         <span class="keywordflow">return</span> QVariant();
<a name="l01003"></a>01003       <span class="keywordflow">else</span>
<a name="l01004"></a>01004       {
<a name="l01005"></a>01005         QString sL = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vL, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01006"></a>01006         QString sR = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( vR, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01007"></a>01007         <span class="keywordflow">return</span> QVariant( sL + sR );
<a name="l01008"></a>01008       }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
<a name="l01011"></a>01011   }
<a name="l01012"></a>01012   Q_ASSERT( <span class="keyword">false</span> );
<a name="l01013"></a>01013   <span class="keywordflow">return</span> QVariant();
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#a02e341513c91b9c879520092b61c7535">01016</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#a02e341513c91b9c879520092b61c7535">QgsExpression::NodeBinaryOperator::compare</a>( <span class="keywordtype">double</span> diff )
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018   <span class="keywordflow">switch</span> ( mOp )
<a name="l01019"></a>01019   {
<a name="l01020"></a>01020     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aadcb265c1b60c488c8eeeaf6ba6848c6a">boEQ</a>: <span class="keywordflow">return</span> diff == 0;
<a name="l01021"></a>01021     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa6a03ee082ea1dd1fd501e2bce09bf0f8">boNE</a>: <span class="keywordflow">return</span> diff != 0;
<a name="l01022"></a>01022     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa3a7c1f19680afdef89e4ba02962f473a">boLT</a>: <span class="keywordflow">return</span> diff &lt; 0;
<a name="l01023"></a>01023     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa1b68b909fd5ed7cb3cc9ca815ea48a83">boGT</a>: <span class="keywordflow">return</span> diff &gt; 0;
<a name="l01024"></a>01024     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8d17d0c4976b738e99790f3b8753caa0">boLE</a>: <span class="keywordflow">return</span> diff &lt;= 0;
<a name="l01025"></a>01025     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa70b1d9e9b219fe55d294e3e408ab2d22">boGE</a>: <span class="keywordflow">return</span> diff &gt;= 0;
<a name="l01026"></a>01026     <span class="keywordflow">default</span>: Q_ASSERT( <span class="keyword">false</span> ); <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01027"></a>01027   }
<a name="l01028"></a>01028 }
<a name="l01029"></a>01029 
<a name="l01030"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#afc183f0f482bcdbed773989afec9f5a2">01030</a> <span class="keywordtype">int</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#afc183f0f482bcdbed773989afec9f5a2">QgsExpression::NodeBinaryOperator::computeInt</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
<a name="l01031"></a>01031 {
<a name="l01032"></a>01032   <span class="keywordflow">switch</span> ( mOp )
<a name="l01033"></a>01033   {
<a name="l01034"></a>01034     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa6fab8d4081c4895f37e96cc41df911e4">boPlus</a>: <span class="keywordflow">return</span> x+y;
<a name="l01035"></a>01035     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aac28bc81129fcdc61b61d5d15e54dfd51">boMinus</a>: <span class="keywordflow">return</span> x-y;
<a name="l01036"></a>01036     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa4da616886b37fa56cb23135dfabdeda2">boMul</a>: <span class="keywordflow">return</span> x*y;
<a name="l01037"></a>01037     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa71e9704355bfc06d84d2406d9c361cc6">boDiv</a>: <span class="keywordflow">return</span> x/y;
<a name="l01038"></a>01038     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa4ddd2b935e22147464918ad0f61112f7">boMod</a>: <span class="keywordflow">return</span> x%y;
<a name="l01039"></a>01039     <span class="keywordflow">default</span>: Q_ASSERT( <span class="keyword">false</span> ); <span class="keywordflow">return</span> 0;
<a name="l01040"></a>01040   }
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 
<a name="l01043"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#ad1e789fbcf7ade27d57d7f8beaec6067">01043</a> <span class="keywordtype">double</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#ad1e789fbcf7ade27d57d7f8beaec6067">QgsExpression::NodeBinaryOperator::computeDouble</a>( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y )
<a name="l01044"></a>01044 {
<a name="l01045"></a>01045   <span class="keywordflow">switch</span> ( mOp )
<a name="l01046"></a>01046   {
<a name="l01047"></a>01047     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa6fab8d4081c4895f37e96cc41df911e4">boPlus</a>: <span class="keywordflow">return</span> x+y;
<a name="l01048"></a>01048     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aac28bc81129fcdc61b61d5d15e54dfd51">boMinus</a>: <span class="keywordflow">return</span> x-y;
<a name="l01049"></a>01049     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa4da616886b37fa56cb23135dfabdeda2">boMul</a>: <span class="keywordflow">return</span> x*y;
<a name="l01050"></a>01050     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa71e9704355bfc06d84d2406d9c361cc6">boDiv</a>: <span class="keywordflow">return</span> x/y;
<a name="l01051"></a>01051     <span class="keywordflow">case</span> <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa4ddd2b935e22147464918ad0f61112f7">boMod</a>: <span class="keywordflow">return</span> fmod( x,y );
<a name="l01052"></a>01052     <span class="keywordflow">default</span>: Q_ASSERT( <span class="keyword">false</span> ); <span class="keywordflow">return</span> 0;
<a name="l01053"></a>01053   }
<a name="l01054"></a>01054 }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056 
<a name="l01057"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#a05fa2938df1736a0d4882651a71260dd">01057</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeBinaryOperator::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059   <span class="keywordtype">bool</span> resL = mOpLeft-&gt;prepare( parent, fields );
<a name="l01060"></a>01060   <span class="keywordtype">bool</span> resR = mOpRight-&gt;prepare( parent, fields );
<a name="l01061"></a>01061   <span class="keywordflow">return</span> resL &amp;&amp; resR;
<a name="l01062"></a>01062 }
<a name="l01063"></a>01063 
<a name="l01064"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#aed069ff9a00d4ae2e9fa7fe9f3ec1bb3">01064</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeBinaryOperator::dump</a>()<span class="keyword"> const</span>
<a name="l01065"></a>01065 <span class="keyword"></span>{
<a name="l01066"></a>01066   <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;%1 %2 %3&quot;</span> ).arg( mOpLeft-&gt;dump() ).arg( <a class="code" href="classQgsExpression.html#a056130107ebe0f5afdf298b4a93c5ac2">BinaryOperatorText</a>[mOp] ).arg( mOpRight-&gt;dump() );
<a name="l01067"></a>01067 }
<a name="l01068"></a>01068 
<a name="l01069"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#aee03af4ff3292a7116004e5d239045d0">01069</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeBinaryOperator::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l01070"></a>01070 <span class="keyword"></span>{
<a name="l01071"></a>01071   <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aad16fd22b27282b0157f3eb8095d15949">boConcat</a> )
<a name="l01072"></a>01072   {
<a name="l01073"></a>01073     <span class="comment">// the concat binary operator must only convert its operands</span>
<a name="l01074"></a>01074     mOpLeft-&gt;toOgcFilter( doc, element );
<a name="l01075"></a>01075     mOpRight-&gt;toOgcFilter( doc, element );
<a name="l01076"></a>01076     <span class="keywordflow">return</span>;
<a name="l01077"></a>01077   }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079   <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a> || mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaabf111823af81070abdcfd67529ca74b">boIsNot</a> )
<a name="l01080"></a>01080   {
<a name="l01081"></a>01081     <span class="comment">// check if one of the operands is NULL</span>
<a name="l01082"></a>01082     <a class="code" href="classQgsExpression_1_1NodeLiteral.html">QgsExpression::NodeLiteral</a> *opLeftLiteral = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classQgsExpression_1_1NodeLiteral.html">QgsExpression::NodeLiteral</a> *<span class="keyword">&gt;</span>( mOpLeft );
<a name="l01083"></a>01083     <a class="code" href="classQgsExpression_1_1NodeLiteral.html">QgsExpression::NodeLiteral</a> *opRightLiteral = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classQgsExpression_1_1NodeLiteral.html">QgsExpression::NodeLiteral</a> *<span class="keyword">&gt;</span>( mOpRight );
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <span class="keywordflow">if</span> ( opLeftLiteral &amp;&amp; opLeftLiteral-&gt;<a class="code" href="classQgsExpression_1_1NodeLiteral.html#ac5d5632e4222193ba670e81580885cf4">value</a>().isNull() &amp;&amp;
<a name="l01086"></a>01086          opRightLiteral &amp;&amp; opRightLiteral-&gt;<a class="code" href="classQgsExpression_1_1NodeLiteral.html#ac5d5632e4222193ba670e81580885cf4">value</a>().isNull() )
<a name="l01087"></a>01087     {
<a name="l01088"></a>01088       <span class="comment">// why could anybody find useful to use NULL IS NULL???</span>
<a name="l01089"></a>01089       <span class="comment">// BTW avoid issues by converting it to 1 = 1</span>
<a name="l01090"></a>01090       QDomElement eqElem = doc.createElement( <span class="stringliteral">&quot;ogc:PropertyIsEqual&quot;</span> );
<a name="l01091"></a>01091 
<a name="l01092"></a>01092       QDomElement literalElem = doc.createElement( <span class="stringliteral">&quot;ogc:Literal&quot;</span> );
<a name="l01093"></a>01093       literalElem.appendChild( doc.createTextNode( <span class="stringliteral">&quot;1&quot;</span> ) );
<a name="l01094"></a>01094       eqElem.appendChild( literalElem );
<a name="l01095"></a>01095 
<a name="l01096"></a>01096       literalElem = doc.createElement( <span class="stringliteral">&quot;ogc:Literal&quot;</span> );
<a name="l01097"></a>01097       literalElem.appendChild( doc.createTextNode( <span class="stringliteral">&quot;1&quot;</span> ) );
<a name="l01098"></a>01098       eqElem.appendChild( literalElem );
<a name="l01099"></a>01099 
<a name="l01100"></a>01100       element.appendChild( eqElem );
<a name="l01101"></a>01101     }
<a name="l01102"></a>01102     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (( opLeftLiteral &amp;&amp; opLeftLiteral-&gt;<a class="code" href="classQgsExpression_1_1NodeLiteral.html#ac5d5632e4222193ba670e81580885cf4">value</a>().isNull() ) ||
<a name="l01103"></a>01103              ( opRightLiteral &amp;&amp; opRightLiteral-&gt;<a class="code" href="classQgsExpression_1_1NodeLiteral.html#ac5d5632e4222193ba670e81580885cf4">value</a>().isNull() ) )
<a name="l01104"></a>01104     {
<a name="l01105"></a>01105       <span class="comment">// at least one operand is NULL, use &lt;ogc:PropertyIsNull&gt; element</span>
<a name="l01106"></a>01106       QDomElement isNullElem = doc.createElement( <span class="stringliteral">&quot;ogc:PropertyIsNull&quot;</span> );
<a name="l01107"></a>01107       <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *operand = opLeftLiteral-&gt;<a class="code" href="classQgsExpression_1_1NodeLiteral.html#ac5d5632e4222193ba670e81580885cf4">value</a>().isNull() ? mOpRight : mOpLeft;
<a name="l01108"></a>01108       operand-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a990fe68de4a381dbb183505ffecfd39e">toOgcFilter</a>( doc, isNullElem );
<a name="l01109"></a>01109 
<a name="l01110"></a>01110       <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaabf111823af81070abdcfd67529ca74b">boIsNot</a> )
<a name="l01111"></a>01111       {
<a name="l01112"></a>01112         <span class="comment">// append to &lt;ogc:Not&gt; element if IS NOT operator was required</span>
<a name="l01113"></a>01113         QDomElement notOpElem = doc.createElement( <span class="stringliteral">&quot;ogc:Not&quot;</span> );
<a name="l01114"></a>01114         notOpElem.appendChild( isNullElem );
<a name="l01115"></a>01115         element.appendChild( notOpElem );
<a name="l01116"></a>01116       }
<a name="l01117"></a>01117       <span class="keywordflow">else</span>
<a name="l01118"></a>01118       {
<a name="l01119"></a>01119         element.appendChild( isNullElem );
<a name="l01120"></a>01120       }
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122     <span class="keywordflow">else</span>
<a name="l01123"></a>01123     {
<a name="l01124"></a>01124       <span class="comment">// both operands are not null, use &lt;ogc:PropertyIsEqual&gt; element</span>
<a name="l01125"></a>01125       QDomElement eqElem = doc.createElement( <span class="stringliteral">&quot;ogc:PropertyIsEqual&quot;</span> );
<a name="l01126"></a>01126       mOpLeft-&gt;toOgcFilter( doc, eqElem );
<a name="l01127"></a>01127       mOpRight-&gt;toOgcFilter( doc, eqElem );
<a name="l01128"></a>01128       element.appendChild( eqElem );
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130     <span class="keywordflow">return</span>;
<a name="l01131"></a>01131   }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133   <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa934c2155a54606b78e6b510e8cb77614">boILike</a> )
<a name="l01134"></a>01134   {
<a name="l01135"></a>01135     <span class="comment">// XXX why ogc:PropertyIsLikeType extends ogc:ComparisonOpsType</span>
<a name="l01136"></a>01136     <span class="comment">// which has no matchCase attribute? Shouldn&#39;t it be better if</span>
<a name="l01137"></a>01137     <span class="comment">// would extend BinaryComparisonOpType which has that attribute</span>
<a name="l01138"></a>01138     <span class="comment">// and doesn&#39;t require to have a ogc:PropertyName as first parameter?</span>
<a name="l01139"></a>01139     <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a> ilikeExpr( QString( <span class="stringliteral">&quot;upper( %1 ) LIKE upper( %2 )&quot;</span> ).arg( mOpLeft-&gt;dump() ).arg( mOpRight-&gt;dump() ) );
<a name="l01140"></a>01140     ilikeExpr.<a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">toOgcFilter</a>( doc, element );
<a name="l01141"></a>01141     <span class="keywordflow">return</span>;
<a name="l01142"></a>01142   }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144   QString opText = <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a>[mOp];
<a name="l01145"></a>01145   <span class="keywordflow">if</span> ( opText.isEmpty() )
<a name="l01146"></a>01146   {
<a name="l01147"></a>01147     <span class="comment">// not implemented binary operators</span>
<a name="l01148"></a>01148     <span class="comment">// TODO: regex, % (mod), ^ (pow) are not supported yet</span>
<a name="l01149"></a>01149     element.appendChild( doc.createComment( QString( <span class="stringliteral">&quot;Binary operator %1 not implemented yet&quot;</span> ).arg( <a class="code" href="classQgsExpression.html#a056130107ebe0f5afdf298b4a93c5ac2">BinaryOperatorText</a>[mOp] ) ) );
<a name="l01150"></a>01150     <span class="keywordflow">return</span>;
<a name="l01151"></a>01151   }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153   QDomElement boElem = doc.createElement( <span class="stringliteral">&quot;ogc:&quot;</span> + opText );
<a name="l01154"></a>01154   <span class="keywordflow">if</span> ( mOp == <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aa8aa26ef80634b913f0827f48cb3f7c11">boLike</a> )
<a name="l01155"></a>01155   {
<a name="l01156"></a>01156     <span class="comment">// setup wildcards to &lt;ogc:PropertyIsLike&gt;</span>
<a name="l01157"></a>01157     boElem.setAttribute( <span class="stringliteral">&quot;wildCard&quot;</span>, <span class="stringliteral">&quot;%&quot;</span> );
<a name="l01158"></a>01158     boElem.setAttribute( <span class="stringliteral">&quot;singleChar&quot;</span>, <span class="stringliteral">&quot;?&quot;</span> );
<a name="l01159"></a>01159     boElem.setAttribute( <span class="stringliteral">&quot;escapeChar&quot;</span>, <span class="stringliteral">&quot;!&quot;</span> );
<a name="l01160"></a>01160   }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162   mOpLeft-&gt;toOgcFilter( doc, boElem );
<a name="l01163"></a>01163   mOpRight-&gt;toOgcFilter( doc, boElem );
<a name="l01164"></a>01164   element.appendChild( boElem );
<a name="l01165"></a>01165 }
<a name="l01166"></a>01166 
<a name="l01167"></a><a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html#a669fb1b67a8586046ffd1bd8cc994fb9">01167</a> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::NodeBinaryOperator::createFromOgcFilter</a>( QDomElement &amp;element, QString &amp;errorMessage )
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169   <span class="keywordflow">if</span> ( element.isNull() )
<a name="l01170"></a>01170     <span class="keywordflow">return</span> NULL;
<a name="l01171"></a>01171 
<a name="l01172"></a>01172   <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* opLeft = 0;
<a name="l01173"></a>01173   <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* opRight = 0;
<a name="l01174"></a>01174 
<a name="l01175"></a>01175   <span class="comment">// convert ogc:PropertyIsNull to IS operator with NULL right operand</span>
<a name="l01176"></a>01176   <span class="keywordflow">if</span> ( element.localName() == <span class="stringliteral">&quot;PropertyIsNull&quot;</span> )
<a name="l01177"></a>01177   {
<a name="l01178"></a>01178     QDomElement operandElem = element.firstChildElement();
<a name="l01179"></a>01179     opLeft = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l01180"></a>01180     <span class="keywordflow">if</span> ( !opLeft )
<a name="l01181"></a>01181       <span class="keywordflow">return</span> NULL;
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     opRight = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeLiteral.html">QgsExpression::NodeLiteral</a>( QVariant() );
<a name="l01184"></a>01184     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aaec5a3fc628fc5d8a330430a81d242743">boIs</a>, opLeft, opRight );
<a name="l01185"></a>01185   }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187   <span class="comment">// the other binary operators</span>
<a name="l01188"></a>01188   <span class="keywordtype">int</span> binaryOpCount = <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a> ) / <span class="keyword">sizeof</span>( <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a>[0] );
<a name="l01189"></a>01189   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; binaryOpCount; i++ )
<a name="l01190"></a>01190   {
<a name="l01191"></a>01191     QString ogcOperatorName = <a class="code" href="classQgsExpression.html#a7dc850e17fb192ac52b06d9eca06f8cc">BinaryOgcOperatorText</a>[ i ];
<a name="l01192"></a>01192     <span class="keywordflow">if</span> ( ogcOperatorName.isEmpty() )
<a name="l01193"></a>01193       <span class="keywordflow">continue</span>;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195     <span class="keywordflow">if</span> ( element.localName() != ogcOperatorName )
<a name="l01196"></a>01196       <span class="keywordflow">continue</span>;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     QDomElement operandElem = element.firstChildElement();
<a name="l01199"></a>01199     opLeft = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l01200"></a>01200     <span class="keywordflow">if</span> ( !opLeft )
<a name="l01201"></a>01201     {
<a name="l01202"></a>01202       <span class="keywordflow">if</span> ( errorMessage.isEmpty() )
<a name="l01203"></a>01203         errorMessage = QString( <span class="stringliteral">&quot;invalid left operand for &#39;%1&#39; binary operator&quot;</span> ).arg( ogcOperatorName );
<a name="l01204"></a>01204       <span class="keywordflow">break</span>;
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207     operandElem = operandElem.nextSiblingElement();
<a name="l01208"></a>01208     opRight = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l01209"></a>01209     <span class="keywordflow">if</span> ( !opRight )
<a name="l01210"></a>01210     {
<a name="l01211"></a>01211       <span class="keywordflow">if</span> ( errorMessage.isEmpty() )
<a name="l01212"></a>01212         errorMessage = QString( <span class="stringliteral">&quot;invalid right operand for &#39;%1&#39; binary operator&quot;</span> ).arg( ogcOperatorName );
<a name="l01213"></a>01213       <span class="keywordflow">break</span>;
<a name="l01214"></a>01214     }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>(( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261a">BinaryOperator</a> ) i, opLeft, opRight );
<a name="l01217"></a>01217   }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219   <span class="keywordflow">if</span> ( !opLeft &amp;&amp; !opRight )
<a name="l01220"></a>01220   {
<a name="l01221"></a>01221     errorMessage = QString( <span class="stringliteral">&quot;&#39;%1&#39; binary operator not supported.&quot;</span> ).arg( element.tagName() );
<a name="l01222"></a>01222     <span class="keywordflow">return</span> NULL;
<a name="l01223"></a>01223   }
<a name="l01224"></a>01224 
<a name="l01225"></a>01225   <span class="keywordflow">if</span> ( opLeft )
<a name="l01226"></a>01226     <span class="keyword">delete</span> opLeft;
<a name="l01227"></a>01227 
<a name="l01228"></a>01228   <span class="keywordflow">if</span> ( opRight )
<a name="l01229"></a>01229     <span class="keyword">delete</span> opRight;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231   <span class="keywordflow">return</span> NULL;
<a name="l01232"></a>01232 }
<a name="l01233"></a>01233 
<a name="l01234"></a>01234 <span class="comment">//</span>
<a name="l01235"></a>01235 
<a name="l01236"></a><a class="code" href="classQgsExpression_1_1NodeInOperator.html#a5b1b28f31db4edd4aee7fab689b04919">01236</a> QVariant <a class="code" href="classQgsExpression_1_1NodeInOperator.html#a5b1b28f31db4edd4aee7fab689b04919">QgsExpression::NodeInOperator::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l01237"></a>01237 {
<a name="l01238"></a>01238   <span class="keywordflow">if</span> ( mList-&gt;count() == 0 )
<a name="l01239"></a>01239     <span class="keywordflow">return</span> mNotIn ? <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a> : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a>;
<a name="l01240"></a>01240   QVariant v1 = mNode-&gt;eval( parent, f );
<a name="l01241"></a>01241   <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01242"></a>01242   <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( v1 ) )
<a name="l01243"></a>01243     <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#a773396cccbd1ecd1596db50fb3eb5182">TVL_Unknown</a>;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245   <span class="keywordtype">bool</span> listHasNull = <span class="keyword">false</span>;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mList-&gt;list() )
<a name="l01248"></a>01248   {
<a name="l01249"></a>01249     QVariant v2 = n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a2d7d24c38205d80b13da095ae8b005ae">eval</a>( parent, f );
<a name="l01250"></a>01250     <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01251"></a>01251     <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( v2 ) )
<a name="l01252"></a>01252       listHasNull = <span class="keyword">true</span>;
<a name="l01253"></a>01253     <span class="keywordflow">else</span>
<a name="l01254"></a>01254     {
<a name="l01255"></a>01255       <span class="keywordtype">bool</span> equal = <span class="keyword">false</span>;
<a name="l01256"></a>01256       <span class="comment">// check whether they are equal</span>
<a name="l01257"></a>01257       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( v1 ) &amp;&amp; <a class="code" href="qgsexpression_8cpp.html#a78975a1b02cff382591536cda30023a8">isDoubleSafe</a>( v2 ) )
<a name="l01258"></a>01258       {
<a name="l01259"></a>01259         <span class="keywordtype">double</span> f1 = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( v1, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01260"></a>01260         <span class="keywordtype">double</span> f2 = <a class="code" href="qgsexpression_8cpp.html#ae42168906924cace6bdf2f982cc7aa62">getDoubleValue</a>( v2, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01261"></a>01261         equal = f1 == f2;
<a name="l01262"></a>01262       }
<a name="l01263"></a>01263       <span class="keywordflow">else</span>
<a name="l01264"></a>01264       {
<a name="l01265"></a>01265         QString s1 = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( v1, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01266"></a>01266         QString s2 = <a class="code" href="qgsexpression_8cpp.html#ab692da72474c3ed14b8647a860e76692">getStringValue</a>( v2, parent ); <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01267"></a>01267         equal = QString::compare( s1, s2 ) == 0;
<a name="l01268"></a>01268       }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270       <span class="keywordflow">if</span> ( equal ) <span class="comment">// we know the result</span>
<a name="l01271"></a>01271         <span class="keywordflow">return</span> mNotIn ? <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a> : <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a>;
<a name="l01272"></a>01272     }
<a name="l01273"></a>01273   }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275   <span class="comment">// item not found</span>
<a name="l01276"></a>01276   <span class="keywordflow">if</span> ( listHasNull )
<a name="l01277"></a>01277     <span class="keywordflow">return</span> <a class="code" href="qgsexpression_8cpp.html#a773396cccbd1ecd1596db50fb3eb5182">TVL_Unknown</a>;
<a name="l01278"></a>01278   <span class="keywordflow">else</span>
<a name="l01279"></a>01279     <span class="keywordflow">return</span> mNotIn ? <a class="code" href="qgsexpression_8cpp.html#a142401757bd7db13028de363e611dce4">TVL_True</a> : <a class="code" href="qgsexpression_8cpp.html#a8e2b93d5218cd17408b65e21794bc174">TVL_False</a>;
<a name="l01280"></a>01280 }
<a name="l01281"></a>01281 
<a name="l01282"></a><a class="code" href="classQgsExpression_1_1NodeInOperator.html#a53c4e2c9798a426df1e6a5cf853e43e8">01282</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeInOperator::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l01283"></a>01283 {
<a name="l01284"></a>01284   <span class="keywordtype">bool</span> res = mNode-&gt;prepare( parent, fields );
<a name="l01285"></a>01285   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mList-&gt;list() )
<a name="l01286"></a>01286   {
<a name="l01287"></a>01287     res = res &amp;&amp; n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06b00463ee3220f3b63c683143bb4c20">prepare</a>( parent, fields );
<a name="l01288"></a>01288   }
<a name="l01289"></a>01289   <span class="keywordflow">return</span> res;
<a name="l01290"></a>01290 }
<a name="l01291"></a>01291 
<a name="l01292"></a><a class="code" href="classQgsExpression_1_1NodeInOperator.html#afb595982b7dac54cd007a6ae46ca1e77">01292</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeInOperator::dump</a>()<span class="keyword"> const</span>
<a name="l01293"></a>01293 <span class="keyword"></span>{
<a name="l01294"></a>01294   <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;%1 IN (%2)&quot;</span> ).arg( mNode-&gt;dump() ).arg( mList-&gt;dump() );
<a name="l01295"></a>01295 }
<a name="l01296"></a>01296 
<a name="l01297"></a><a class="code" href="classQgsExpression_1_1NodeInOperator.html#afc6e1ead0bd99b3385bdd679bedf4cf0">01297</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeInOperator::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l01298"></a>01298 <span class="keyword"></span>{
<a name="l01299"></a>01299   <span class="comment">// XXX use a function instead of multiple comparations?</span>
<a name="l01300"></a>01300 
<a name="l01301"></a>01301   QDomElement *parent = &amp;element;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303   QDomElement orElem;
<a name="l01304"></a>01304   <span class="keywordflow">if</span> ( mList-&gt;list().size() &gt; 1 )
<a name="l01305"></a>01305   {
<a name="l01306"></a>01306     orElem = doc.createElement( <span class="stringliteral">&quot;ogc:Or&quot;</span> );
<a name="l01307"></a>01307     element.appendChild( orElem );
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     parent = &amp;orElem;
<a name="l01310"></a>01310   }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mList-&gt;list() )
<a name="l01313"></a>01313   {
<a name="l01314"></a>01314     QDomElement eqElem = doc.createElement( <span class="stringliteral">&quot;ogc:PropertyIsEqualTo&quot;</span> );
<a name="l01315"></a>01315     mNode-&gt;toOgcFilter( doc, eqElem );
<a name="l01316"></a>01316     n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a990fe68de4a381dbb183505ffecfd39e">toOgcFilter</a>( doc, eqElem );
<a name="l01317"></a>01317 
<a name="l01318"></a>01318     parent-&gt;appendChild( eqElem );
<a name="l01319"></a>01319   }
<a name="l01320"></a>01320 }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322 <span class="comment">//</span>
<a name="l01323"></a>01323 
<a name="l01324"></a><a class="code" href="classQgsExpression_1_1NodeFunction.html#a07007325b087d2e045fc801e619f5f93">01324</a> QVariant <a class="code" href="classQgsExpression_1_1NodeFunction.html#a07007325b087d2e045fc801e619f5f93">QgsExpression::NodeFunction::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l01325"></a>01325 {
<a name="l01326"></a>01326   <span class="keyword">const</span> <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>&amp; fd = <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>()[mFnIndex];
<a name="l01327"></a>01327 
<a name="l01328"></a>01328   <span class="comment">// evaluate arguments</span>
<a name="l01329"></a>01329   QVariantList argValues;
<a name="l01330"></a>01330   <span class="keywordflow">if</span> ( mArgs )
<a name="l01331"></a>01331   {
<a name="l01332"></a>01332     <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mArgs-&gt;list() )
<a name="l01333"></a>01333     {
<a name="l01334"></a>01334       QVariant v = n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a2d7d24c38205d80b13da095ae8b005ae">eval</a>( parent, f );
<a name="l01335"></a>01335       <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01336"></a>01336       <span class="keywordflow">if</span> ( <a class="code" href="qgsexpression_8cpp.html#aac2e7b60e3dde4d3838c7a292c43227a">isNull</a>( v ) )
<a name="l01337"></a>01337         <span class="keywordflow">return</span> QVariant(); <span class="comment">// all &quot;normal&quot; functions return NULL when any parameter is NULL</span>
<a name="l01338"></a>01338       argValues.append( v );
<a name="l01339"></a>01339     }
<a name="l01340"></a>01340   }
<a name="l01341"></a>01341 
<a name="l01342"></a>01342   <span class="comment">// run the function</span>
<a name="l01343"></a>01343   QVariant res = fd.<a class="code" href="structQgsExpression_1_1FunctionDef.html#a3c14a7e4440b63fd110d7f25035b7b18" title="Pointer to fucntion.">mFcn</a>( argValues, f, parent );
<a name="l01344"></a>01344   <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346   <span class="comment">// everything went fine</span>
<a name="l01347"></a>01347   <span class="keywordflow">return</span> res;
<a name="l01348"></a>01348 }
<a name="l01349"></a>01349 
<a name="l01350"></a><a class="code" href="classQgsExpression_1_1NodeFunction.html#a25ee92fdba7a3079f538dbfb998720a3">01350</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeFunction::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l01351"></a>01351 {
<a name="l01352"></a>01352   <span class="keywordtype">bool</span> res = <span class="keyword">true</span>;
<a name="l01353"></a>01353   <span class="keywordflow">if</span> ( mArgs )
<a name="l01354"></a>01354   {
<a name="l01355"></a>01355     <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1Node.html">Node</a>* n, mArgs-&gt;list() )
<a name="l01356"></a>01356     {
<a name="l01357"></a>01357       res = res &amp;&amp; n-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06b00463ee3220f3b63c683143bb4c20">prepare</a>( parent, fields );
<a name="l01358"></a>01358     }
<a name="l01359"></a>01359   }
<a name="l01360"></a>01360   <span class="keywordflow">return</span> res;
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01363"></a><a class="code" href="classQgsExpression_1_1NodeFunction.html#a44f1b102e4f06b4d106562ec8c6a54b4">01363</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeFunction::dump</a>()<span class="keyword"> const</span>
<a name="l01364"></a>01364 <span class="keyword"></span>{
<a name="l01365"></a>01365   <span class="keyword">const</span> <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>&amp; fd = <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>()[mFnIndex];
<a name="l01366"></a>01366   <span class="keywordflow">if</span> ( fd.<a class="code" href="structQgsExpression_1_1FunctionDef.html#ad47610e848dc3d9dd98a0480c7dea0a3" title="The number of parameters this function takes.">mParams</a> == 0 )
<a name="l01367"></a>01367     <span class="keywordflow">return</span> fd.<a class="code" href="structQgsExpression_1_1FunctionDef.html#ab51cecaeba8153755c1247d2cc46aa31" title="The name of the function.">mName</a>; <span class="comment">// special column</span>
<a name="l01368"></a>01368   <span class="keywordflow">else</span>
<a name="l01369"></a>01369     <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;%1(%2)&quot;</span> ).arg( fd.<a class="code" href="structQgsExpression_1_1FunctionDef.html#ab51cecaeba8153755c1247d2cc46aa31" title="The name of the function.">mName</a> ).arg( mArgs ? mArgs-&gt;dump() : QString() ); <span class="comment">// function</span>
<a name="l01370"></a>01370 }
<a name="l01371"></a>01371 
<a name="l01372"></a><a class="code" href="classQgsExpression_1_1NodeFunction.html#ac1644355dda7eaef4cee22db60f441ab">01372</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeFunction::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l01373"></a>01373 <span class="keyword"></span>{
<a name="l01374"></a>01374   <span class="keyword">const</span> <a class="code" href="structQgsExpression_1_1FunctionDef.html">FunctionDef</a>&amp; fd = <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>()[mFnIndex];
<a name="l01375"></a>01375   <span class="keywordflow">if</span> ( fd.<a class="code" href="structQgsExpression_1_1FunctionDef.html#ad47610e848dc3d9dd98a0480c7dea0a3" title="The number of parameters this function takes.">mParams</a> == 0 )
<a name="l01376"></a>01376     <span class="keywordflow">return</span>; <span class="comment">// TODO: special column</span>
<a name="l01377"></a>01377 
<a name="l01378"></a>01378   QDomElement funcElem = doc.createElement( <span class="stringliteral">&quot;ogc:Function&quot;</span> );
<a name="l01379"></a>01379   funcElem.setAttribute( <span class="stringliteral">&quot;name&quot;</span>, fd.<a class="code" href="structQgsExpression_1_1FunctionDef.html#ab51cecaeba8153755c1247d2cc46aa31" title="The name of the function.">mName</a> );
<a name="l01380"></a>01380   mArgs-&gt;toOgcFilter( doc, funcElem );
<a name="l01381"></a>01381   element.appendChild( funcElem );
<a name="l01382"></a>01382 }
<a name="l01383"></a>01383 
<a name="l01384"></a><a class="code" href="classQgsExpression_1_1NodeFunction.html#a7d6a1f00fce0352707dae036eb56ab34">01384</a> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::NodeFunction::createFromOgcFilter</a>( QDomElement &amp;element, QString &amp;errorMessage )
<a name="l01385"></a>01385 {
<a name="l01386"></a>01386   <span class="keywordflow">if</span> ( element.isNull() )
<a name="l01387"></a>01387     <span class="keywordflow">return</span> NULL;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   <span class="keywordflow">if</span> ( element.localName() != <span class="stringliteral">&quot;Function&quot;</span> )
<a name="l01390"></a>01390   {
<a name="l01391"></a>01391     errorMessage = QString( <span class="stringliteral">&quot;ogc:Function expected, got %1&quot;</span> ).arg( element.tagName() );
<a name="l01392"></a>01392     <span class="keywordflow">return</span> NULL;
<a name="l01393"></a>01393   }
<a name="l01394"></a>01394 
<a name="l01395"></a>01395   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>().size(); i++ )
<a name="l01396"></a>01396   {
<a name="l01397"></a>01397     <a class="code" href="structQgsExpression_1_1FunctionDef.html">QgsExpression::FunctionDef</a> funcDef = <a class="code" href="classQgsExpression.html#a9884a8648fb0386790521c439271d009">BuiltinFunctions</a>()[i];
<a name="l01398"></a>01398 
<a name="l01399"></a>01399     <span class="keywordflow">if</span> ( element.attribute( <span class="stringliteral">&quot;name&quot;</span> ) != funcDef.<a class="code" href="structQgsExpression_1_1FunctionDef.html#ab51cecaeba8153755c1247d2cc46aa31" title="The name of the function.">mName</a> )
<a name="l01400"></a>01400       <span class="keywordflow">continue</span>;
<a name="l01401"></a>01401 
<a name="l01402"></a>01402     <a class="code" href="classQgsExpression_1_1NodeList.html">QgsExpression::NodeList</a> *args = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeList.html">QgsExpression::NodeList</a>();
<a name="l01403"></a>01403 
<a name="l01404"></a>01404     QDomElement operandElem = element.firstChildElement();
<a name="l01405"></a>01405     <span class="keywordflow">while</span> ( !operandElem.isNull() )
<a name="l01406"></a>01406     {
<a name="l01407"></a>01407       <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* op = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l01408"></a>01408       <span class="keywordflow">if</span> ( !op )
<a name="l01409"></a>01409       {
<a name="l01410"></a>01410         <span class="keyword">delete</span> args;
<a name="l01411"></a>01411         <span class="keywordflow">return</span> NULL;
<a name="l01412"></a>01412       }
<a name="l01413"></a>01413       args-&gt;<a class="code" href="classQgsExpression_1_1NodeList.html#a8983a69126090d6814bdfd7dcd6b0e87">append</a>( op );
<a name="l01414"></a>01414 
<a name="l01415"></a>01415       operandElem = operandElem.nextSiblingElement();
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417 
<a name="l01418"></a>01418     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeFunction.html">QgsExpression::NodeFunction</a>( i, args );
<a name="l01419"></a>01419   }
<a name="l01420"></a>01420 
<a name="l01421"></a>01421   <span class="keywordflow">return</span> NULL;
<a name="l01422"></a>01422 }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424 <span class="comment">//</span>
<a name="l01425"></a>01425 
<a name="l01426"></a><a class="code" href="classQgsExpression_1_1NodeLiteral.html#ae2a27f4414111571e9eecfd80e15862d">01426</a> QVariant <a class="code" href="classQgsExpression_1_1NodeLiteral.html#ae2a27f4414111571e9eecfd80e15862d">QgsExpression::NodeLiteral::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* , <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* )
<a name="l01427"></a>01427 {
<a name="l01428"></a>01428   <span class="keywordflow">return</span> mValue;
<a name="l01429"></a>01429 }
<a name="l01430"></a>01430 
<a name="l01431"></a><a class="code" href="classQgsExpression_1_1NodeLiteral.html#a02a4f048784857d35540ede6cd93cb9d">01431</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeLiteral::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* <span class="comment">/*parent*/</span>, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; <span class="comment">/*fields*/</span> )
<a name="l01432"></a>01432 {
<a name="l01433"></a>01433   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01434"></a>01434 }
<a name="l01435"></a>01435 
<a name="l01436"></a>01436 
<a name="l01437"></a><a class="code" href="classQgsExpression_1_1NodeLiteral.html#af921688274edb617b03074e93ecacf45">01437</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeLiteral::dump</a>()<span class="keyword"> const</span>
<a name="l01438"></a>01438 <span class="keyword"></span>{
<a name="l01439"></a>01439   <span class="keywordflow">if</span> ( mValue.isNull() )
<a name="l01440"></a>01440     <span class="keywordflow">return</span> <span class="stringliteral">&quot;NULL&quot;</span>;
<a name="l01441"></a>01441 
<a name="l01442"></a>01442   <span class="keywordflow">switch</span> ( mValue.type() )
<a name="l01443"></a>01443   {
<a name="l01444"></a>01444     <span class="keywordflow">case</span> QVariant::Int: <span class="keywordflow">return</span> QString::number( mValue.toInt() );
<a name="l01445"></a>01445     <span class="keywordflow">case</span> QVariant::Double: <span class="keywordflow">return</span> QString::number( mValue.toDouble() );
<a name="l01446"></a>01446     <span class="keywordflow">case</span> QVariant::String: <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;&#39;%1&#39;&quot;</span> ).arg( mValue.toString() );
<a name="l01447"></a>01447     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> QObject::tr( <span class="stringliteral">&quot;[unsupported type;%1; value:%2]&quot;</span> ).arg( mValue.typeName() ).arg( mValue.toString() );
<a name="l01448"></a>01448   }
<a name="l01449"></a>01449 }
<a name="l01450"></a>01450 
<a name="l01451"></a><a class="code" href="classQgsExpression_1_1NodeLiteral.html#aab08adeb7ad65b174a2bfb2585ef0e0b">01451</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeLiteral::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l01452"></a>01452 <span class="keyword"></span>{
<a name="l01453"></a>01453   QString value;
<a name="l01454"></a>01454   <span class="keywordflow">if</span> ( !mValue.isNull() )
<a name="l01455"></a>01455   {
<a name="l01456"></a>01456     <span class="keywordflow">switch</span> ( mValue.type() )
<a name="l01457"></a>01457     {
<a name="l01458"></a>01458       <span class="keywordflow">case</span> QVariant::Int:
<a name="l01459"></a>01459         value = QString::number( mValue.toInt() );
<a name="l01460"></a>01460         <span class="keywordflow">break</span>;
<a name="l01461"></a>01461       <span class="keywordflow">case</span> QVariant::Double:
<a name="l01462"></a>01462         value = QString::number( mValue.toDouble() );
<a name="l01463"></a>01463         <span class="keywordflow">break</span>;
<a name="l01464"></a>01464       <span class="keywordflow">case</span> QVariant::String:
<a name="l01465"></a>01465         value = mValue.toString();
<a name="l01466"></a>01466         <span class="keywordflow">break</span>;
<a name="l01467"></a>01467       <span class="keywordflow">default</span>:
<a name="l01468"></a>01468         <span class="keywordflow">break</span>;
<a name="l01469"></a>01469     }
<a name="l01470"></a>01470   }
<a name="l01471"></a>01471   QDomElement litElem = doc.createElement( <span class="stringliteral">&quot;ogc:Literal&quot;</span> );
<a name="l01472"></a>01472   litElem.appendChild( doc.createTextNode( value ) );
<a name="l01473"></a>01473   element.appendChild( litElem );
<a name="l01474"></a>01474 }
<a name="l01475"></a>01475 
<a name="l01476"></a><a class="code" href="classQgsExpression_1_1NodeLiteral.html#a93aea95b95032b5369663549df851d72">01476</a> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::NodeLiteral::createFromOgcFilter</a>( QDomElement &amp;element, QString &amp;errorMessage )
<a name="l01477"></a>01477 {
<a name="l01478"></a>01478   <span class="keywordflow">if</span> ( element.isNull() )
<a name="l01479"></a>01479     <span class="keywordflow">return</span> NULL;
<a name="l01480"></a>01480 
<a name="l01481"></a>01481   <span class="keywordflow">if</span> ( element.localName() != <span class="stringliteral">&quot;Literal&quot;</span> )
<a name="l01482"></a>01482   {
<a name="l01483"></a>01483     errorMessage = QString( <span class="stringliteral">&quot;ogc:Literal expected, got %1&quot;</span> ).arg( element.tagName() );
<a name="l01484"></a>01484     <span class="keywordflow">return</span> NULL;
<a name="l01485"></a>01485   }
<a name="l01486"></a>01486 
<a name="l01487"></a>01487   <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a> *root = 0;
<a name="l01488"></a>01488 
<a name="l01489"></a>01489   <span class="comment">// the literal content can have more children (e.g. CDATA section, text, ...)</span>
<a name="l01490"></a>01490   QDomNode childNode = element.firstChild();
<a name="l01491"></a>01491   <span class="keywordflow">while</span> ( !childNode.isNull() )
<a name="l01492"></a>01492   {
<a name="l01493"></a>01493     <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* operand = 0;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     <span class="keywordflow">if</span> ( childNode.nodeType() == QDomNode::ElementNode )
<a name="l01496"></a>01496     {
<a name="l01497"></a>01497       <span class="comment">// found a element node (e.g. PropertyName), convert it</span>
<a name="l01498"></a>01498       QDomElement operandElem = childNode.toElement();
<a name="l01499"></a>01499       operand = <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::Node::createFromOgcFilter</a>( operandElem, errorMessage );
<a name="l01500"></a>01500       <span class="keywordflow">if</span> ( !operand )
<a name="l01501"></a>01501       {
<a name="l01502"></a>01502         <span class="keywordflow">if</span> ( root )
<a name="l01503"></a>01503           <span class="keyword">delete</span> root;
<a name="l01504"></a>01504 
<a name="l01505"></a>01505         errorMessage = QString( <span class="stringliteral">&quot;&#39;%1&#39; is an invalid or not supported content for ogc:Literal&quot;</span> ).arg( operandElem.tagName() );
<a name="l01506"></a>01506         <span class="keywordflow">return</span> NULL;
<a name="l01507"></a>01507       }
<a name="l01508"></a>01508     }
<a name="l01509"></a>01509     <span class="keywordflow">else</span>
<a name="l01510"></a>01510     {
<a name="l01511"></a>01511       <span class="comment">// probably a text/CDATA node, convert its content to string</span>
<a name="l01512"></a>01512       operand = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeLiteral.html">QgsExpression::NodeLiteral</a>( childNode.nodeValue() );
<a name="l01513"></a>01513     }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515     <span class="keywordflow">if</span> ( !operand )
<a name="l01516"></a>01516       <span class="keywordflow">continue</span>;
<a name="l01517"></a>01517 
<a name="l01518"></a>01518     <span class="comment">// use the concat operator to merge the ogc:Literal children</span>
<a name="l01519"></a>01519     <span class="keywordflow">if</span> ( !root )
<a name="l01520"></a>01520     {
<a name="l01521"></a>01521       root = operand;
<a name="l01522"></a>01522     }
<a name="l01523"></a>01523     <span class="keywordflow">else</span>
<a name="l01524"></a>01524     {
<a name="l01525"></a>01525       root = <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeBinaryOperator.html">QgsExpression::NodeBinaryOperator</a>( <a class="code" href="classQgsExpression.html#ace7c0466d59e0e06ec1abbab5b3a261aad16fd22b27282b0157f3eb8095d15949">boConcat</a>, root, operand );
<a name="l01526"></a>01526     }
<a name="l01527"></a>01527 
<a name="l01528"></a>01528     childNode = childNode.nextSibling();
<a name="l01529"></a>01529   }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531   <span class="keywordflow">if</span> ( root )
<a name="l01532"></a>01532     <span class="keywordflow">return</span> root;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534   <span class="keywordflow">return</span> NULL;
<a name="l01535"></a>01535 }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537 <span class="comment">//</span>
<a name="l01538"></a>01538 
<a name="l01539"></a><a class="code" href="classQgsExpression_1_1NodeColumnRef.html#a459f27a0783d5ab75a0bba27fe2026f7">01539</a> QVariant <a class="code" href="classQgsExpression_1_1NodeColumnRef.html#a459f27a0783d5ab75a0bba27fe2026f7">QgsExpression::NodeColumnRef::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* <span class="comment">/*parent*/</span>, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l01540"></a>01540 {
<a name="l01541"></a>01541   <span class="keywordflow">return</span> f-&gt;<a class="code" href="classQgsFeature.html#ad80bca974bc7faa416f4e6ca29f7c3d0" title="Get the attributes for this feature.">attributeMap</a>()[mIndex];
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 
<a name="l01544"></a><a class="code" href="classQgsExpression_1_1NodeColumnRef.html#adda510cc67272804a1741fb57076bcd3">01544</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeColumnRef::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l01545"></a>01545 {
<a name="l01546"></a>01546   <span class="keywordflow">foreach</span>( <span class="keywordtype">int</span> i, fields.keys() )
<a name="l01547"></a>01547   {
<a name="l01548"></a>01548     <span class="keywordflow">if</span> ( QString::compare( fields[i].name(), mName, Qt::CaseInsensitive ) == 0 )
<a name="l01549"></a>01549     {
<a name="l01550"></a>01550       mIndex = i;
<a name="l01551"></a>01551       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01552"></a>01552     }
<a name="l01553"></a>01553   }
<a name="l01554"></a>01554   parent-&gt;<a class="code" href="classQgsExpression.html#a7dc26b6c0d30edeb057aeb2cfc172b1b">mEvalErrorString</a> = QObject::tr( <span class="stringliteral">&quot;Column &#39;%1&#39;&#39; not found&quot;</span> ).arg( mName );
<a name="l01555"></a>01555   mIndex = -1;
<a name="l01556"></a>01556   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01557"></a>01557 }
<a name="l01558"></a>01558 
<a name="l01559"></a><a class="code" href="classQgsExpression_1_1NodeColumnRef.html#a681a21678b32674d66022333fd0acd60">01559</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeColumnRef::dump</a>()<span class="keyword"> const</span>
<a name="l01560"></a>01560 <span class="keyword"></span>{
<a name="l01561"></a>01561   <span class="keywordflow">return</span> mName;
<a name="l01562"></a>01562 }
<a name="l01563"></a>01563 
<a name="l01564"></a><a class="code" href="classQgsExpression_1_1NodeColumnRef.html#aa38918cc0ecf5344f3594e3d92f69ce3">01564</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeColumnRef::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l01565"></a>01565 <span class="keyword"></span>{
<a name="l01566"></a>01566   QDomElement propElem = doc.createElement( <span class="stringliteral">&quot;ogc:PropertyName&quot;</span> );
<a name="l01567"></a>01567   propElem.appendChild( doc.createTextNode( mName ) );
<a name="l01568"></a>01568   element.appendChild( propElem );
<a name="l01569"></a>01569 }
<a name="l01570"></a>01570 
<a name="l01571"></a><a class="code" href="classQgsExpression_1_1NodeColumnRef.html#a3b68b95922405f188941b3b733b856e5">01571</a> <a class="code" href="classQgsExpression_1_1Node.html">QgsExpression::Node</a>* <a class="code" href="classQgsExpression.html#adff40179e39d6043939e3465494b0170">QgsExpression::NodeColumnRef::createFromOgcFilter</a>( QDomElement &amp;element, QString &amp;errorMessage )
<a name="l01572"></a>01572 {
<a name="l01573"></a>01573   <span class="keywordflow">if</span> ( element.isNull() )
<a name="l01574"></a>01574     <span class="keywordflow">return</span> NULL;
<a name="l01575"></a>01575 
<a name="l01576"></a>01576   <span class="keywordflow">if</span> ( element.localName() != <span class="stringliteral">&quot;PropertyName&quot;</span> )
<a name="l01577"></a>01577   {
<a name="l01578"></a>01578     errorMessage = QString( <span class="stringliteral">&quot;ogc:PropertyName expected, got %1&quot;</span> ).arg( element.tagName() );
<a name="l01579"></a>01579     <span class="keywordflow">return</span> NULL;
<a name="l01580"></a>01580   }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classQgsExpression_1_1NodeColumnRef.html">QgsExpression::NodeColumnRef</a>( element.firstChild().nodeValue() );
<a name="l01583"></a>01583 }
<a name="l01584"></a>01584 
<a name="l01585"></a>01585 <span class="comment">//</span>
<a name="l01586"></a>01586 
<a name="l01587"></a><a class="code" href="classQgsExpression_1_1NodeCondition.html#a851a42b02b658df9d457dab7d8a1312e">01587</a> QVariant <a class="code" href="classQgsExpression_1_1NodeCondition.html#a851a42b02b658df9d457dab7d8a1312e">QgsExpression::NodeCondition::eval</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a list of field/values...">QgsFeature</a>* f )
<a name="l01588"></a>01588 {
<a name="l01589"></a>01589   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1WhenThen.html">WhenThen</a>* cond, mConditions )
<a name="l01590"></a>01590   {
<a name="l01591"></a>01591     QVariant vWhen = cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#aa1fb512f9d498005df0a16a4dde267cd">mWhenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a2d7d24c38205d80b13da095ae8b005ae">eval</a>( parent, f );
<a name="l01592"></a>01592     <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41">TVL</a> tvl = <a class="code" href="qgsexpression_8cpp.html#a027c3998b765a80da4d5a1a0eb2ccf64">getTVLValue</a>( vWhen, parent );
<a name="l01593"></a>01593     <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01594"></a>01594     <span class="keywordflow">if</span> ( tvl == <a class="code" href="qgsexpression_8cpp.html#a7c099d420c3ea6fcba01ccd776df7c41a6d32c34708a0a3507c4bdb89219d650b">True</a> )
<a name="l01595"></a>01595     {
<a name="l01596"></a>01596       QVariant vRes = cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#af4962337b07aeef1d04818ce1b81e025">mThenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a2d7d24c38205d80b13da095ae8b005ae">eval</a>( parent, f );
<a name="l01597"></a>01597       <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01598"></a>01598       <span class="keywordflow">return</span> vRes;
<a name="l01599"></a>01599     }
<a name="l01600"></a>01600   }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602   <span class="keywordflow">if</span> ( mElseExp )
<a name="l01603"></a>01603   {
<a name="l01604"></a>01604     QVariant vElse = mElseExp-&gt;eval( parent, f );
<a name="l01605"></a>01605     <a class="code" href="qgsexpression_8cpp.html#a789fb8ecadf81beda9af24c3b82d53d3">ENSURE_NO_EVAL_ERROR</a>;
<a name="l01606"></a>01606     <span class="keywordflow">return</span> vElse;
<a name="l01607"></a>01607   }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609   <span class="comment">// return NULL if no condition is matching</span>
<a name="l01610"></a>01610   <span class="keywordflow">return</span> QVariant();
<a name="l01611"></a>01611 }
<a name="l01612"></a>01612 
<a name="l01613"></a><a class="code" href="classQgsExpression_1_1NodeCondition.html#aa6a4ab5334c05aa0ead3c4f081a09434">01613</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a82e11cb1c5ff780e5233d92a7ea67846" title="Get the expression ready for evaluation - find out column indexes.">QgsExpression::NodeCondition::prepare</a>( <a class="code" href="classQgsExpression.html" title="Class for parsing and evaluation of expressions (formerly called &quot;search strings&quot;).">QgsExpression</a>* parent, <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#aacd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields )
<a name="l01614"></a>01614 {
<a name="l01615"></a>01615   <span class="keywordtype">bool</span> res;
<a name="l01616"></a>01616   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1WhenThen.html">WhenThen</a>* cond, mConditions )
<a name="l01617"></a>01617   {
<a name="l01618"></a>01618     res = cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#aa1fb512f9d498005df0a16a4dde267cd">mWhenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06b00463ee3220f3b63c683143bb4c20">prepare</a>( parent, fields )
<a name="l01619"></a>01619           &amp; cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#af4962337b07aeef1d04818ce1b81e025">mThenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06b00463ee3220f3b63c683143bb4c20">prepare</a>( parent, fields );
<a name="l01620"></a>01620     <span class="keywordflow">if</span> ( !res ) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01621"></a>01621   }
<a name="l01622"></a>01622 
<a name="l01623"></a>01623   <span class="keywordflow">if</span> ( mElseExp )
<a name="l01624"></a>01624     <span class="keywordflow">return</span> mElseExp-&gt;prepare( parent, fields );
<a name="l01625"></a>01625 
<a name="l01626"></a>01626   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01627"></a>01627 }
<a name="l01628"></a>01628 
<a name="l01629"></a><a class="code" href="classQgsExpression_1_1NodeCondition.html#ae4f15f79e2eb751351179080838b159c">01629</a> QString <a class="code" href="classQgsExpression.html#aef8e6c127bedcac147158b68b86bb9bb" title="Return the parsed expression as a string - useful for debugging.">QgsExpression::NodeCondition::dump</a>()<span class="keyword"> const</span>
<a name="l01630"></a>01630 <span class="keyword"></span>{
<a name="l01631"></a>01631   QString msg = <span class="stringliteral">&quot;CONDITION:\n&quot;</span>;
<a name="l01632"></a>01632   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1WhenThen.html">WhenThen</a>* cond, mConditions )
<a name="l01633"></a>01633   {
<a name="l01634"></a>01634     msg += QString( <span class="stringliteral">&quot;- WHEN %1 THEN %2\n&quot;</span> ).arg( cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#aa1fb512f9d498005df0a16a4dde267cd">mWhenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06678388ac891f94284bd83ae2c3ccb0">dump</a>() ).arg( cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#af4962337b07aeef1d04818ce1b81e025">mThenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a06678388ac891f94284bd83ae2c3ccb0">dump</a>() );
<a name="l01635"></a>01635   }
<a name="l01636"></a>01636   <span class="keywordflow">if</span> ( mElseExp )
<a name="l01637"></a>01637     msg += QString( <span class="stringliteral">&quot;- ELSE %1&quot;</span> ).arg( mElseExp-&gt;dump() );
<a name="l01638"></a>01638   <span class="keywordflow">return</span> msg;
<a name="l01639"></a>01639 }
<a name="l01640"></a>01640 
<a name="l01641"></a><a class="code" href="classQgsExpression_1_1NodeCondition.html#a1e7fae1c9c9000d5f423ea7862dff99e">01641</a> <span class="keywordtype">void</span> <a class="code" href="classQgsExpression.html#a530cd6597a7ec83e38964a6432744e0d">QgsExpression::NodeCondition::toOgcFilter</a>( QDomDocument &amp;doc, QDomElement &amp;element )<span class="keyword"> const</span>
<a name="l01642"></a>01642 <span class="keyword"></span>{
<a name="l01643"></a>01643   <span class="comment">// TODO: if(cond) ... [else if (cond2) ...]* [else ...]</span>
<a name="l01644"></a>01644   element.appendChild( doc.createComment( <span class="stringliteral">&quot;CASE operator not implemented yet&quot;</span> ) );
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a><a class="code" href="classQgsExpression_1_1NodeCondition.html#a20df715d1b6f09b5c6fae9e3ab6e241d">01647</a> QStringList <a class="code" href="classQgsExpression.html#a2840ff7b8453e4087a446988999f4770" title="Get list of columns referenced by the expression.">QgsExpression::NodeCondition::referencedColumns</a>()<span class="keyword"> const</span>
<a name="l01648"></a>01648 <span class="keyword"></span>{
<a name="l01649"></a>01649   QStringList lst;
<a name="l01650"></a>01650   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1WhenThen.html">WhenThen</a>* cond, mConditions )
<a name="l01651"></a>01651   {
<a name="l01652"></a>01652     lst += cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#aa1fb512f9d498005df0a16a4dde267cd">mWhenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a81e0df7c055ecf815647c86123603de4">referencedColumns</a>() + cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#af4962337b07aeef1d04818ce1b81e025">mThenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#a81e0df7c055ecf815647c86123603de4">referencedColumns</a>();
<a name="l01653"></a>01653   }
<a name="l01654"></a>01654 
<a name="l01655"></a>01655   <span class="keywordflow">if</span> ( mElseExp )
<a name="l01656"></a>01656     lst += mElseExp-&gt;referencedColumns();
<a name="l01657"></a>01657 
<a name="l01658"></a>01658   <span class="keywordflow">return</span> lst;
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01661"></a><a class="code" href="classQgsExpression_1_1NodeCondition.html#adc49ebe61a8176fdf26481f96931f09b">01661</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsExpression.html#a457ea260f8f9a79f2b6db67b9e9fd17e" title="Returns true if the expression uses feature geometry for some computation.">QgsExpression::NodeCondition::needsGeometry</a>()<span class="keyword"> const</span>
<a name="l01662"></a>01662 <span class="keyword"></span>{
<a name="l01663"></a>01663   <span class="keywordflow">foreach</span>( <a class="code" href="classQgsExpression_1_1WhenThen.html">WhenThen</a>* cond, mConditions )
<a name="l01664"></a>01664   {
<a name="l01665"></a>01665     <span class="keywordflow">if</span> ( cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#aa1fb512f9d498005df0a16a4dde267cd">mWhenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#ae90edfcd18b28bb5dbd9b28c33d8a733">needsGeometry</a>() ||
<a name="l01666"></a>01666          cond-&gt;<a class="code" href="classQgsExpression_1_1WhenThen.html#af4962337b07aeef1d04818ce1b81e025">mThenExp</a>-&gt;<a class="code" href="classQgsExpression_1_1Node.html#ae90edfcd18b28bb5dbd9b28c33d8a733">needsGeometry</a>() )
<a name="l01667"></a>01667       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01668"></a>01668   }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670   <span class="keywordflow">if</span> ( mElseExp &amp;&amp; mElseExp-&gt;needsGeometry() )
<a name="l01671"></a>01671     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01674"></a>01674 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 19 2012 23:22:40 for Quantum GIS API Documentation by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
