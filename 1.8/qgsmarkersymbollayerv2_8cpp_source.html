<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Quantum GIS API Documentation: src/core/symbology-ng/qgsmarkersymbollayerv2.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Quantum GIS API Documentation
   &#160;<span id="projectnumber">1.8</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">src/core/symbology-ng/qgsmarkersymbollayerv2.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qgsmarkersymbollayerv2_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">    qgsmarkersymbollayerv2.cpp</span>
<a name="l00003"></a>00003 <span class="comment">    ---------------------</span>
<a name="l00004"></a>00004 <span class="comment">    begin                : November 2009</span>
<a name="l00005"></a>00005 <span class="comment">    copyright            : (C) 2009 by Martin Dobias</span>
<a name="l00006"></a>00006 <span class="comment">    email                : wonder.sk at gmail.com</span>
<a name="l00007"></a>00007 <span class="comment"> ***************************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> *                                                                         *</span>
<a name="l00009"></a>00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00010"></a>00010 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00011"></a>00011 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00012"></a>00012 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00013"></a>00013 <span class="comment"> *                                                                         *</span>
<a name="l00014"></a>00014 <span class="comment"> ***************************************************************************/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="qgsmarkersymbollayerv2_8h.html">qgsmarkersymbollayerv2.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="qgssymbollayerv2utils_8h.html">qgssymbollayerv2utils.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="qgsrendercontext_8h.html">qgsrendercontext.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="qgsapplication_8h.html">qgsapplication.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="qgslogger_8h.html">qgslogger.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="qgsproject_8h.html">qgsproject.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="qgssvgcache_8h.html">qgssvgcache.h</a>&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;QPainter&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;QSvgRenderer&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;QFileInfo&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;QDir&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;QDomDocument&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;QDomElement&gt;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">// MSVC compiler doesn&#39;t have defined M_PI in math.h</span>
<a name="l00035"></a>00035 <span class="preprocessor">#ifndef M_PI</span>
<a name="l00036"></a><a class="code" href="qgsmarkersymbollayerv2_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define M_PI          3.14159265358979323846</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">00039</a> <span class="preprocessor">#define DEG2RAD(x)    ((x)*M_PI/180)</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a3bb3c252c8bac3ee5a33b9207b22a6d1">00042</a> <span class="keyword">static</span> QPointF <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a3bb3c252c8bac3ee5a33b9207b22a6d1">_rotatedOffset</a>( <span class="keyword">const</span> QPointF&amp; offset, <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#ad8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)">angle</a> )
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   angle = <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( angle );
<a name="l00045"></a>00045   <span class="keywordtype">double</span> c = cos( angle ), s = sin( angle );
<a name="l00046"></a>00046   <span class="keywordflow">return</span> QPointF( offset.x() * c - offset.y() * s, offset.x() * s + offset.y() * c );
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab2490abfe06c97f1136be61ecf305bc5">00051</a> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab2490abfe06c97f1136be61ecf305bc5">QgsSimpleMarkerSymbolLayerV2::QgsSimpleMarkerSymbolLayerV2</a>( QString name, QColor color, QColor borderColor, <span class="keywordtype">double</span> <a class="code" href="qgssvgcache_8cpp.html#aba3c5d750d5dbd6e86c11ecaca62885e">size</a>, <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#ad8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)">angle</a> )
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> = <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aa62833d4bb67c510d64f1df127f86cb9">name</a>;
<a name="l00054"></a>00054   <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a> = <a class="code" href="classQgsSymbolLayerV2.html#a692837dc473ba2b206f8015aca8ec387">color</a>;
<a name="l00055"></a>00055   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a42463153536e3b0df948294276cb7c4a">mBorderColor</a> = <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aee0ac0fa53c272cc6f3ddea8acf080ae">borderColor</a>;
<a name="l00056"></a>00056   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a>;
<a name="l00057"></a>00057   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a>;
<a name="l00058"></a>00058   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> = QPointF( 0, 0 );
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4bcb43c9294e73d1265898b3aadf0aea">00061</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4bcb43c9294e73d1265898b3aadf0aea">QgsSimpleMarkerSymbolLayerV2::create</a>( <span class="keyword">const</span> <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a>&amp; props )
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063   QString <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aa62833d4bb67c510d64f1df127f86cb9">name</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a8668a29376b3d5d05f3d9e3606b40b8c">DEFAULT_SIMPLEMARKER_NAME</a>;
<a name="l00064"></a>00064   QColor <a class="code" href="classQgsSymbolLayerV2.html#a692837dc473ba2b206f8015aca8ec387">color</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#afb195ec17887c8e902e1ebc1430f4e2c">DEFAULT_SIMPLEMARKER_COLOR</a>;
<a name="l00065"></a>00065   QColor <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aee0ac0fa53c272cc6f3ddea8acf080ae">borderColor</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a77441b2f1b3b496c5b3382b2f0a5a069">DEFAULT_SIMPLEMARKER_BORDERCOLOR</a>;
<a name="l00066"></a>00066   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a7df68c1ac71fc920b1650bee491df080">DEFAULT_SIMPLEMARKER_SIZE</a>;
<a name="l00067"></a>00067   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a887133f30a77e87629a97031374ed706">DEFAULT_SIMPLEMARKER_ANGLE</a>;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;name&quot;</span> ) )
<a name="l00070"></a>00070     name = props[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l00071"></a>00071   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;color&quot;</span> ) )
<a name="l00072"></a>00072     color = <a class="code" href="classQgsSymbolLayerV2Utils.html#a942f2c54ef1be3c474313ff3739a9aa8">QgsSymbolLayerV2Utils::decodeColor</a>( props[<span class="stringliteral">&quot;color&quot;</span>] );
<a name="l00073"></a>00073   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;color_border&quot;</span> ) )
<a name="l00074"></a>00074     borderColor = <a class="code" href="classQgsSymbolLayerV2Utils.html#a942f2c54ef1be3c474313ff3739a9aa8">QgsSymbolLayerV2Utils::decodeColor</a>( props[<span class="stringliteral">&quot;color_border&quot;</span>] );
<a name="l00075"></a>00075   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;size&quot;</span> ) )
<a name="l00076"></a>00076     size = props[<span class="stringliteral">&quot;size&quot;</span>].toDouble();
<a name="l00077"></a>00077   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;angle&quot;</span> ) )
<a name="l00078"></a>00078     angle = props[<span class="stringliteral">&quot;angle&quot;</span>].toDouble();
<a name="l00079"></a>00079 
<a name="l00080"></a>00080   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html">QgsSimpleMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab2490abfe06c97f1136be61ecf305bc5">QgsSimpleMarkerSymbolLayerV2</a>( name, color, borderColor, size, angle );
<a name="l00081"></a>00081   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;offset&quot;</span> ) )
<a name="l00082"></a>00082     m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( <a class="code" href="classQgsSymbolLayerV2Utils.html#a1709e6b136de7414fcb77c11784e1ad5">QgsSymbolLayerV2Utils::decodePoint</a>( props[<span class="stringliteral">&quot;offset&quot;</span>] ) );
<a name="l00083"></a>00083   <span class="keywordflow">return</span> m;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4e355e7b14eb05d7005c5da81745c07b">00087</a> QString <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4e355e7b14eb05d7005c5da81745c07b">QgsSimpleMarkerSymbolLayerV2::layerType</a>()<span class="keyword"> const</span>
<a name="l00088"></a>00088 <span class="keyword"></span>{
<a name="l00089"></a>00089   <span class="keywordflow">return</span> <span class="stringliteral">&quot;SimpleMarker&quot;</span>;
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a34df117ba4d34a9de4b9f6a4fcc0df8b">00092</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a34df117ba4d34a9de4b9f6a4fcc0df8b">QgsSimpleMarkerSymbolLayerV2::startRender</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094   QColor brushColor = <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a>;
<a name="l00095"></a>00095   QColor penColor = <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a42463153536e3b0df948294276cb7c4a">mBorderColor</a>;
<a name="l00096"></a>00096   <span class="keywordflow">if</span> ( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() &lt; 1 )
<a name="l00097"></a>00097   {
<a name="l00098"></a>00098     penColor.setAlphaF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() );
<a name="l00099"></a>00099     brushColor.setAlphaF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() );
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9c80b74d61fc63396c252371594e8322">mBrush</a> = QBrush( brushColor );
<a name="l00102"></a>00102   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a> = QPen( penColor );
<a name="l00103"></a>00103   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a>.setWidthF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a>.widthF() ) );
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   QColor selBrushColor = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a250869300bc353d39df6c395a6cc8828">selectionColor</a>();
<a name="l00106"></a>00106   QColor selPenColor = selBrushColor == <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a> ? selBrushColor : <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a42463153536e3b0df948294276cb7c4a">mBorderColor</a>;
<a name="l00107"></a>00107   <span class="keywordflow">if</span> ( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() &lt; 1 )
<a name="l00108"></a>00108   {
<a name="l00109"></a>00109     selBrushColor.setAlphaF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() );
<a name="l00110"></a>00110     selPenColor.setAlphaF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() );
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4eaee7ef7ea1e58e1f321f4ef01c4dae">mSelBrush</a> = QBrush( selBrushColor );
<a name="l00113"></a>00113   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af19e9ba3ffe353609739341697815c00">mSelPen</a> = QPen( selPenColor );
<a name="l00114"></a>00114   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af19e9ba3ffe353609739341697815c00">mSelPen</a>.setWidthF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a>.widthF() ) );
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <span class="keywordtype">bool</span> hasDataDefinedRotation = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a9c451270557a3eb0106ede0027de1317">renderHints</a>() &amp; <a class="code" href="classQgsSymbolV2.html#a9dc8b734888424e619f2c4a86f9ba6f0a6a217e38f55c7e2e4b6103b734ca9a82">QgsSymbolV2::DataDefinedRotation</a>;
<a name="l00117"></a>00117   <span class="keywordtype">bool</span> hasDataDefinedSize = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a9c451270557a3eb0106ede0027de1317">renderHints</a>() &amp; <a class="code" href="classQgsSymbolV2.html#a9dc8b734888424e619f2c4a86f9ba6f0a41db449079555a7c403718f3950f313b">QgsSymbolV2::DataDefinedSizeScale</a>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119   <span class="comment">// use caching only when:</span>
<a name="l00120"></a>00120   <span class="comment">// - the size and rotation is not data-defined</span>
<a name="l00121"></a>00121   <span class="comment">// - drawing to screen (not printer)</span>
<a name="l00122"></a>00122   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adb95c9cc4125c7633b238b5a36278046">mUsingCache</a> = !hasDataDefinedRotation &amp;&amp; !hasDataDefinedSize &amp;&amp; !context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a08410b19ba505de2b13f35d334f9f9f5">forceVectorOutput</a>();
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <span class="comment">// use either QPolygonF or QPainterPath for drawing</span>
<a name="l00125"></a>00125   <span class="comment">// TODO: find out whether drawing directly doesn&#39;t bring overhead - if not, use it for all shapes</span>
<a name="l00126"></a>00126   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ace210cbf2b6f5130225a70a492050cf1">prepareShape</a>() ) <span class="comment">// drawing as a polygon</span>
<a name="l00127"></a>00127   {
<a name="l00128"></a>00128     <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#afed8cc4dfbcfa4041005635321ec44ea">preparePath</a>() ) <span class="comment">// drawing as a painter path</span>
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130       <span class="comment">// some markers can&#39;t be drawn as a polygon (circle, cross)</span>
<a name="l00131"></a>00131       <span class="comment">// For these set the selected border color to the selected color</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133       <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> != <span class="stringliteral">&quot;circle&quot;</span> )
<a name="l00134"></a>00134         <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af19e9ba3ffe353609739341697815c00">mSelPen</a>.setColor( selBrushColor );
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136     <span class="keywordflow">else</span>
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138       <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;unknown symbol&quot;</span> );
<a name="l00139"></a>00139       <span class="keywordflow">return</span>;
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141   }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   QMatrix transform;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   <span class="comment">// scale the shape (if the size is not going to be modified)</span>
<a name="l00146"></a>00146   <span class="keywordflow">if</span> ( !hasDataDefinedSize )
<a name="l00147"></a>00147   {
<a name="l00148"></a>00148     <span class="keywordtype">double</span> scaledSize = context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00149"></a>00149     <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adb95c9cc4125c7633b238b5a36278046">mUsingCache</a> )
<a name="l00150"></a>00150       scaledSize *= context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>();
<a name="l00151"></a>00151     <span class="keywordtype">double</span> half = scaledSize / 2.0;
<a name="l00152"></a>00152     transform.scale( half, half );
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <span class="comment">// rotate if the rotation is not going to be changed during the rendering</span>
<a name="l00156"></a>00156   <span class="keywordflow">if</span> ( !hasDataDefinedRotation &amp;&amp; <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> != 0 )
<a name="l00157"></a>00157   {
<a name="l00158"></a>00158     transform.rotate( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00159"></a>00159   }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a>.isEmpty() )
<a name="l00162"></a>00162     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> = transform.map( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> );
<a name="l00163"></a>00163   <span class="keywordflow">else</span>
<a name="l00164"></a>00164     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a> = transform.map( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a> );
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adb95c9cc4125c7633b238b5a36278046">mUsingCache</a> )
<a name="l00167"></a>00167   {
<a name="l00168"></a>00168     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aa905a7c7dfb5553827650506835baa74">prepareCache</a>( context );
<a name="l00169"></a>00169   }
<a name="l00170"></a>00170   <span class="keywordflow">else</span>
<a name="l00171"></a>00171   {
<a name="l00172"></a>00172     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a389264a42710e3a1db15cf083ee48ed7">mCache</a> = QImage();
<a name="l00173"></a>00173     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a> = QImage();
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aa905a7c7dfb5553827650506835baa74">00178</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aa905a7c7dfb5553827650506835baa74">QgsSimpleMarkerSymbolLayerV2::prepareCache</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <span class="keywordtype">double</span> scaledSize = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a0abd301edb92a70755ccd288b589aec6">outputPixelSize</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="comment">// calculate necessary image size for the cache</span>
<a name="l00183"></a>00183   <span class="keywordtype">double</span> pw = (( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a>.widthF() == 0 ? 1 : <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a>.widthF() ) + 1 ) / 2 * 2; <span class="comment">// make even (round up); handle cosmetic pen</span>
<a name="l00184"></a>00184   <span class="keywordtype">int</span> imageSize = (( int ) scaledSize + pw ) / 2 * 2 + 1; <span class="comment">//  make image width, height odd; account for pen width</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="keywordtype">double</span> center = (( double ) imageSize / 2 ) + 0.5; <span class="comment">// add 1/2 pixel for proper rounding when the figure&#39;s coordinates are added</span>
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a389264a42710e3a1db15cf083ee48ed7">mCache</a> = QImage( QSize( imageSize, imageSize ), QImage::Format_ARGB32_Premultiplied );
<a name="l00189"></a>00189   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a389264a42710e3a1db15cf083ee48ed7">mCache</a>.fill( 0 );
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   QPainter p;
<a name="l00192"></a>00192   p.begin( &amp;<a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a389264a42710e3a1db15cf083ee48ed7">mCache</a> );
<a name="l00193"></a>00193   p.setRenderHint( QPainter::Antialiasing );
<a name="l00194"></a>00194   p.setBrush( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9c80b74d61fc63396c252371594e8322">mBrush</a> );
<a name="l00195"></a>00195   p.setPen( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a> );
<a name="l00196"></a>00196   p.translate( QPointF( center, center ) );
<a name="l00197"></a>00197   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adddb48dc98ea782839288ebf85a0ce1a">drawMarker</a>( &amp;p, context );
<a name="l00198"></a>00198   p.end();
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="comment">// Construct the selected version of the Cache</span>
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   QColor selColor = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a250869300bc353d39df6c395a6cc8828">selectionColor</a>();
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a> = QImage( QSize( imageSize, imageSize ), QImage::Format_ARGB32_Premultiplied );
<a name="l00205"></a>00205   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a>.fill( 0 );
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   p.begin( &amp;<a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a> );
<a name="l00208"></a>00208   p.setRenderHint( QPainter::Antialiasing );
<a name="l00209"></a>00209   p.setBrush( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4eaee7ef7ea1e58e1f321f4ef01c4dae">mSelBrush</a> );
<a name="l00210"></a>00210   p.setPen( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af19e9ba3ffe353609739341697815c00">mSelPen</a> );
<a name="l00211"></a>00211   p.translate( QPointF( center, center ) );
<a name="l00212"></a>00212   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adddb48dc98ea782839288ebf85a0ce1a">drawMarker</a>( &amp;p, context );
<a name="l00213"></a>00213   p.end();
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <span class="comment">// Check that the selected version is different.  If not, then re-render,</span>
<a name="l00216"></a>00216   <span class="comment">// filling the background with the selection color and using the normal</span>
<a name="l00217"></a>00217   <span class="comment">// colors for the symbol .. could be ugly!</span>
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a> == <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a389264a42710e3a1db15cf083ee48ed7">mCache</a> )
<a name="l00220"></a>00220   {
<a name="l00221"></a>00221     p.begin( &amp;<a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a> );
<a name="l00222"></a>00222     p.setRenderHint( QPainter::Antialiasing );
<a name="l00223"></a>00223     p.fillRect( 0, 0, imageSize, imageSize, selColor );
<a name="l00224"></a>00224     p.setBrush( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9c80b74d61fc63396c252371594e8322">mBrush</a> );
<a name="l00225"></a>00225     p.setPen( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a> );
<a name="l00226"></a>00226     p.translate( QPointF( center, center ) );
<a name="l00227"></a>00227     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adddb48dc98ea782839288ebf85a0ce1a">drawMarker</a>( &amp;p, context );
<a name="l00228"></a>00228     p.end();
<a name="l00229"></a>00229   }
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af29839bb2a09bca507d38ee66f0424fb">00232</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af29839bb2a09bca507d38ee66f0424fb">QgsSimpleMarkerSymbolLayerV2::stopRender</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   Q_UNUSED( context );
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ace210cbf2b6f5130225a70a492050cf1">00237</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ace210cbf2b6f5130225a70a492050cf1">QgsSimpleMarkerSymbolLayerV2::prepareShape</a>()
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a>.clear();
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;square&quot;</span> || <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;rectangle&quot;</span> )
<a name="l00242"></a>00242   {
<a name="l00243"></a>00243     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> = QPolygonF( QRectF( QPointF( -1, -1 ), QPointF( 1, 1 ) ) );
<a name="l00244"></a>00244     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;diamond&quot;</span> )
<a name="l00247"></a>00247   {
<a name="l00248"></a>00248     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( -1, 0 ) &lt;&lt; QPointF( 0, 1 )
<a name="l00249"></a>00249     &lt;&lt; QPointF( 1, 0 ) &lt;&lt; QPointF( 0, -1 );
<a name="l00250"></a>00250     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00251"></a>00251   }
<a name="l00252"></a>00252   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;pentagon&quot;</span> )
<a name="l00253"></a>00253   {
<a name="l00254"></a>00254     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 288.0 ) ), - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 288.0 ) ) )
<a name="l00255"></a>00255     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 216.0 ) ), - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 216.0 ) ) )
<a name="l00256"></a>00256     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 144.0 ) ), - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 144.0 ) ) )
<a name="l00257"></a>00257     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 72.0 ) ), - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 72.0 ) ) )
<a name="l00258"></a>00258     &lt;&lt; QPointF( 0, -1 );
<a name="l00259"></a>00259     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;triangle&quot;</span> )
<a name="l00262"></a>00262   {
<a name="l00263"></a>00263     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( -1, 1 ) &lt;&lt; QPointF( 1, 1 ) &lt;&lt; QPointF( 0, -1 );
<a name="l00264"></a>00264     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00265"></a>00265   }
<a name="l00266"></a>00266   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;equilateral_triangle&quot;</span> )
<a name="l00267"></a>00267   {
<a name="l00268"></a>00268     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 240.0 ) ), - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 240.0 ) ) )
<a name="l00269"></a>00269     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 120.0 ) ), - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 120.0 ) ) )
<a name="l00270"></a>00270     &lt;&lt; QPointF( 0, -1 );
<a name="l00271"></a>00271     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00272"></a>00272   }
<a name="l00273"></a>00273   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;star&quot;</span> )
<a name="l00274"></a>00274   {
<a name="l00275"></a>00275     <span class="keywordtype">double</span> sixth = 1.0 / 3;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( 0, -1 )
<a name="l00278"></a>00278     &lt;&lt; QPointF( -sixth, -sixth )
<a name="l00279"></a>00279     &lt;&lt; QPointF( -1, -sixth )
<a name="l00280"></a>00280     &lt;&lt; QPointF( -sixth, 0 )
<a name="l00281"></a>00281     &lt;&lt; QPointF( -1, 1 )
<a name="l00282"></a>00282     &lt;&lt; QPointF( 0, + sixth )
<a name="l00283"></a>00283     &lt;&lt; QPointF( 1, 1 )
<a name="l00284"></a>00284     &lt;&lt; QPointF( + sixth, 0 )
<a name="l00285"></a>00285     &lt;&lt; QPointF( 1, -sixth )
<a name="l00286"></a>00286     &lt;&lt; QPointF( + sixth, -sixth );
<a name="l00287"></a>00287     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00288"></a>00288   }
<a name="l00289"></a>00289   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;regular_star&quot;</span> )
<a name="l00290"></a>00290   {
<a name="l00291"></a>00291     <span class="keywordtype">double</span> inner_r = cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 72.0 ) ) / cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 36.0 ) );
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( inner_r * sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 324.0 ) ), - inner_r * cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 324.0 ) ) )  <span class="comment">// 324</span>
<a name="l00294"></a>00294     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 288.0 ) ) , - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 288 ) ) )    <span class="comment">// 288</span>
<a name="l00295"></a>00295     &lt;&lt; QPointF( inner_r * sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 252.0 ) ), - inner_r * cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 252.0 ) ) )   <span class="comment">// 252</span>
<a name="l00296"></a>00296     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 216.0 ) ) , - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 216.0 ) ) )   <span class="comment">// 216</span>
<a name="l00297"></a>00297     &lt;&lt; QPointF( 0, inner_r )         <span class="comment">// 180</span>
<a name="l00298"></a>00298     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 144.0 ) ) , - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 144.0 ) ) )   <span class="comment">// 144</span>
<a name="l00299"></a>00299     &lt;&lt; QPointF( inner_r * sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 108.0 ) ), - inner_r * cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 108.0 ) ) )   <span class="comment">// 108</span>
<a name="l00300"></a>00300     &lt;&lt; QPointF( sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 72.0 ) ) , - cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 72.0 ) ) )    <span class="comment">//  72</span>
<a name="l00301"></a>00301     &lt;&lt; QPointF( inner_r * sin( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 36.0 ) ), - inner_r * cos( <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a2b4f9c3a8b58ecc8e9a6cda26417ba00">DEG2RAD</a>( 36.0 ) ) )   <span class="comment">//  36</span>
<a name="l00302"></a>00302     &lt;&lt; QPointF( 0, -1 );          <span class="comment">//   0</span>
<a name="l00303"></a>00303     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;arrow&quot;</span> )
<a name="l00306"></a>00306   {
<a name="l00307"></a>00307     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a>
<a name="l00308"></a>00308     &lt;&lt; QPointF( 0, -1 )
<a name="l00309"></a>00309     &lt;&lt; QPointF( 0.5,  -0.5 )
<a name="l00310"></a>00310     &lt;&lt; QPointF( 0.25, -0.25 )
<a name="l00311"></a>00311     &lt;&lt; QPointF( 0.25,  1 )
<a name="l00312"></a>00312     &lt;&lt; QPointF( -0.25,  1 )
<a name="l00313"></a>00313     &lt;&lt; QPointF( -0.25, -0.5 )
<a name="l00314"></a>00314     &lt;&lt; QPointF( -0.5,  -0.5 );
<a name="l00315"></a>00315     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00316"></a>00316   }
<a name="l00317"></a>00317   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;filled_arrowhead&quot;</span> )
<a name="l00318"></a>00318   {
<a name="l00319"></a>00319     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> &lt;&lt; QPointF( 0, 0 ) &lt;&lt; QPointF( -1, 1 ) &lt;&lt; QPointF( -1, -1 );
<a name="l00320"></a>00320     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#afed8cc4dfbcfa4041005635321ec44ea">00326</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#afed8cc4dfbcfa4041005635321ec44ea">QgsSimpleMarkerSymbolLayerV2::preparePath</a>()
<a name="l00327"></a>00327 {
<a name="l00328"></a>00328   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a> = QPainterPath();
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;circle&quot;</span> )
<a name="l00331"></a>00331   {
<a name="l00332"></a>00332     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.addEllipse( QRectF( -1, -1, 2, 2 ) ); <span class="comment">// x,y,w,h</span>
<a name="l00333"></a>00333     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00334"></a>00334   }
<a name="l00335"></a>00335   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;cross&quot;</span> )
<a name="l00336"></a>00336   {
<a name="l00337"></a>00337     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( -1, 0 );
<a name="l00338"></a>00338     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( 1, 0 ); <span class="comment">// horizontal</span>
<a name="l00339"></a>00339     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( 0, -1 );
<a name="l00340"></a>00340     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( 0, 1 ); <span class="comment">// vertical</span>
<a name="l00341"></a>00341     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00342"></a>00342   }
<a name="l00343"></a>00343   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;x&quot;</span> || <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;cross2&quot;</span> )
<a name="l00344"></a>00344   {
<a name="l00345"></a>00345     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( -1, -1 );
<a name="l00346"></a>00346     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( 1, 1 );
<a name="l00347"></a>00347     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( 1, -1 );
<a name="l00348"></a>00348     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( -1, 1 );
<a name="l00349"></a>00349     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00350"></a>00350   }
<a name="l00351"></a>00351   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;line&quot;</span> )
<a name="l00352"></a>00352   {
<a name="l00353"></a>00353     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( 0, -1 );
<a name="l00354"></a>00354     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( 0, 1 ); <span class="comment">// vertical line</span>
<a name="l00355"></a>00355     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a> == <span class="stringliteral">&quot;arrowhead&quot;</span> )
<a name="l00358"></a>00358   {
<a name="l00359"></a>00359     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( 0, 0 );
<a name="l00360"></a>00360     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( -1, -1 );
<a name="l00361"></a>00361     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.moveTo( 0, 0 );
<a name="l00362"></a>00362     <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a>.lineTo( -1, 1 );
<a name="l00363"></a>00363     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00369"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a08915958475e829362db43e6146a21b4">00369</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a08915958475e829362db43e6146a21b4">QgsSimpleMarkerSymbolLayerV2::renderPoint</a>( <span class="keyword">const</span> QPointF&amp; point, <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371   <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a>&amp; rc = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>();
<a name="l00372"></a>00372   QPainter* p = rc.<a class="code" href="classQgsRenderContext.html#a3acf9ad3fc76e62c90db63bf13d7e0fb">painter</a>();
<a name="l00373"></a>00373   <span class="keywordflow">if</span> ( !p )
<a name="l00374"></a>00374   {
<a name="l00375"></a>00375     <span class="keywordflow">return</span>;
<a name="l00376"></a>00376   }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   QPointF off( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a>.x() ), context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a>.y() ) );
<a name="l00379"></a>00379   <span class="keywordflow">if</span> ( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> )
<a name="l00380"></a>00380     off = <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a3bb3c252c8bac3ee5a33b9207b22a6d1">_rotatedOffset</a>( off, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00381"></a>00381 
<a name="l00382"></a>00382   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adb95c9cc4125c7633b238b5a36278046">mUsingCache</a> )
<a name="l00383"></a>00383   {
<a name="l00384"></a>00384     <span class="comment">// we will use cached image</span>
<a name="l00385"></a>00385     QImage &amp;img = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7339b8275a3500e3812d470ea87f6c00">selected</a>() ? <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a368cfe8e4c9825b459a8c42f806b10e7">mSelCache</a> : <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a389264a42710e3a1db15cf083ee48ed7">mCache</a>;
<a name="l00386"></a>00386     <span class="keywordtype">double</span> s = img.width() / context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>();
<a name="l00387"></a>00387     p-&gt;drawImage( QRectF( point.x() - s / 2.0 + off.x(),
<a name="l00388"></a>00388                           point.y() - s / 2.0 + off.y(),
<a name="l00389"></a>00389                           s, s ), img );
<a name="l00390"></a>00390   }
<a name="l00391"></a>00391   <span class="keywordflow">else</span>
<a name="l00392"></a>00392   {
<a name="l00393"></a>00393     QMatrix transform;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="keywordtype">bool</span> hasDataDefinedRotation = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a9c451270557a3eb0106ede0027de1317">renderHints</a>() &amp; <a class="code" href="classQgsSymbolV2.html#a9dc8b734888424e619f2c4a86f9ba6f0a6a217e38f55c7e2e4b6103b734ca9a82">QgsSymbolV2::DataDefinedRotation</a>;
<a name="l00396"></a>00396     <span class="keywordtype">bool</span> hasDataDefinedSize = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a9c451270557a3eb0106ede0027de1317">renderHints</a>() &amp; <a class="code" href="classQgsSymbolV2.html#a9dc8b734888424e619f2c4a86f9ba6f0a41db449079555a7c403718f3950f313b">QgsSymbolV2::DataDefinedSizeScale</a>;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     <span class="comment">// move to the desired position</span>
<a name="l00399"></a>00399     transform.translate( point.x() + off.x(), point.y() + off.y() );
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="comment">// resize if necessary</span>
<a name="l00402"></a>00402     <span class="keywordflow">if</span> ( hasDataDefinedSize )
<a name="l00403"></a>00403     {
<a name="l00404"></a>00404       <span class="keywordtype">double</span> scaledSize = context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00405"></a>00405       <span class="keywordtype">double</span> half = scaledSize / 2.0;
<a name="l00406"></a>00406       transform.scale( half, half );
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">// rotate if necessary</span>
<a name="l00410"></a>00410     <span class="keywordflow">if</span> ( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> != 0 &amp;&amp; hasDataDefinedRotation )
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412       transform.rotate( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     p-&gt;setBrush( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7339b8275a3500e3812d470ea87f6c00">selected</a>() ? <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a4eaee7ef7ea1e58e1f321f4ef01c4dae">mSelBrush</a> : <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9c80b74d61fc63396c252371594e8322">mBrush</a> );
<a name="l00416"></a>00416     p-&gt;setPen( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7339b8275a3500e3812d470ea87f6c00">selected</a>() ? <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#af19e9ba3ffe353609739341697815c00">mSelPen</a> : <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac9766f009131df79203da9b9a632d4d3">mPen</a> );
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">if</span> ( !<a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a>.isEmpty() )
<a name="l00419"></a>00419       p-&gt;drawPolygon( transform.map( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> ) );
<a name="l00420"></a>00420     <span class="keywordflow">else</span>
<a name="l00421"></a>00421       p-&gt;drawPath( transform.map( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a> ) );
<a name="l00422"></a>00422   }
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a485ed844b38fd3217dde6d6012782414">00426</a> <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a485ed844b38fd3217dde6d6012782414">QgsSimpleMarkerSymbolLayerV2::properties</a>()<span class="keyword"> const</span>
<a name="l00427"></a>00427 <span class="keyword"></span>{
<a name="l00428"></a>00428   <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> map;
<a name="l00429"></a>00429   map[<span class="stringliteral">&quot;name&quot;</span>] = <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a>;
<a name="l00430"></a>00430   map[<span class="stringliteral">&quot;color&quot;</span>] = <a class="code" href="classQgsSymbolLayerV2Utils.html#a2d71081dab2d4fc194cd0c5588e66cf1">QgsSymbolLayerV2Utils::encodeColor</a>( <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a> );
<a name="l00431"></a>00431   map[<span class="stringliteral">&quot;color_border&quot;</span>] = <a class="code" href="classQgsSymbolLayerV2Utils.html#a2d71081dab2d4fc194cd0c5588e66cf1">QgsSymbolLayerV2Utils::encodeColor</a>( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a42463153536e3b0df948294276cb7c4a">mBorderColor</a> );
<a name="l00432"></a>00432   map[<span class="stringliteral">&quot;size&quot;</span>] = QString::number( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00433"></a>00433   map[<span class="stringliteral">&quot;angle&quot;</span>] = QString::number( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00434"></a>00434   map[<span class="stringliteral">&quot;offset&quot;</span>] = <a class="code" href="classQgsSymbolLayerV2Utils.html#a8ed29d4fe064d67f7071647b53aeb340">QgsSymbolLayerV2Utils::encodePoint</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00435"></a>00435   <span class="keywordflow">return</span> map;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac1efff6b5f7cdf687adf1b63bb58d1ec">00438</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ac1efff6b5f7cdf687adf1b63bb58d1ec">QgsSimpleMarkerSymbolLayerV2::clone</a>()<span class="keyword"> const</span>
<a name="l00439"></a>00439 <span class="keyword"></span>{
<a name="l00440"></a>00440   <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html">QgsSimpleMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab2490abfe06c97f1136be61ecf305bc5">QgsSimpleMarkerSymbolLayerV2</a>( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a>, <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a>, <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a42463153536e3b0df948294276cb7c4a">mBorderColor</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00441"></a>00441   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00442"></a>00442   <span class="keywordflow">return</span> m;
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab57984a504bf4c7fd03275ab5fdfeb3a">00445</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab57984a504bf4c7fd03275ab5fdfeb3a">QgsSimpleMarkerSymbolLayerV2::writeSldMarker</a>( QDomDocument &amp;doc, QDomElement &amp;element, <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props )<span class="keyword"> const</span>
<a name="l00446"></a>00446 <span class="keyword"></span>{
<a name="l00447"></a>00447   <span class="comment">// &lt;Graphic&gt;</span>
<a name="l00448"></a>00448   QDomElement graphicElem = doc.createElement( <span class="stringliteral">&quot;se:Graphic&quot;</span> );
<a name="l00449"></a>00449   element.appendChild( graphicElem );
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <a class="code" href="classQgsSymbolLayerV2Utils.html#ae7f4d3bc466ba41079aaf087b7aff0d2">QgsSymbolLayerV2Utils::wellKnownMarkerToSld</a>( doc, graphicElem, <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a09ea90ec01b7f35d78a4cef3a7488a2b">mName</a>, <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a>, <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a42463153536e3b0df948294276cb7c4a">mBorderColor</a>, -1, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="comment">// &lt;Rotation&gt;</span>
<a name="l00454"></a>00454   QString angleFunc;
<a name="l00455"></a>00455   <span class="keywordtype">bool</span> ok;
<a name="l00456"></a>00456   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = props.value( <span class="stringliteral">&quot;angle&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ).toDouble( &amp;ok );
<a name="l00457"></a>00457   <span class="keywordflow">if</span> ( !ok )
<a name="l00458"></a>00458   {
<a name="l00459"></a>00459     angleFunc = QString( <span class="stringliteral">&quot;%1 + %2&quot;</span> ).arg( props.value( <span class="stringliteral">&quot;angle&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ) ).arg( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00460"></a>00460   }
<a name="l00461"></a>00461   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( angle + <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> != 0 )
<a name="l00462"></a>00462   {
<a name="l00463"></a>00463     angleFunc = QString::number( angle + <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465   <a class="code" href="classQgsSymbolLayerV2Utils.html#a2c170c5cb0180cd576b18876113c31d0">QgsSymbolLayerV2Utils::createRotationElement</a>( doc, graphicElem, angleFunc );
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   <span class="comment">// &lt;Displacement&gt;</span>
<a name="l00468"></a>00468   <a class="code" href="classQgsSymbolLayerV2Utils.html#af636bf6786998e7df7b88f0b689f5d16">QgsSymbolLayerV2Utils::createDisplacementElement</a>( doc, graphicElem, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adae112c679afda3b547fa458b42c8bb9">00471</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adae112c679afda3b547fa458b42c8bb9">QgsSimpleMarkerSymbolLayerV2::createFromSld</a>( QDomElement &amp;element )
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473   <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Entered.&quot;</span> );
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   QDomElement graphicElem = element.firstChildElement( <span class="stringliteral">&quot;Graphic&quot;</span> );
<a name="l00476"></a>00476   <span class="keywordflow">if</span> ( graphicElem.isNull() )
<a name="l00477"></a>00477     <span class="keywordflow">return</span> NULL;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   QString <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aa62833d4bb67c510d64f1df127f86cb9">name</a> = <span class="stringliteral">&quot;square&quot;</span>;
<a name="l00480"></a>00480   QColor <a class="code" href="classQgsSymbolLayerV2.html#a692837dc473ba2b206f8015aca8ec387">color</a>, <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#aee0ac0fa53c272cc6f3ddea8acf080ae">borderColor</a>;
<a name="l00481"></a>00481   <span class="keywordtype">double</span> borderWidth, <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsSymbolLayerV2Utils.html#a2ba512e77e7abc538116822c3bdb9f69">QgsSymbolLayerV2Utils::wellKnownMarkerFromSld</a>( graphicElem, name, color, borderColor, borderWidth, size ) )
<a name="l00484"></a>00484     <span class="keywordflow">return</span> NULL;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = 0.0;
<a name="l00487"></a>00487   QString angleFunc;
<a name="l00488"></a>00488   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSymbolLayerV2Utils.html#ae80d9580d6d4fc81110c9f2c561d8924">QgsSymbolLayerV2Utils::rotationFromSldElement</a>( graphicElem, angleFunc ) )
<a name="l00489"></a>00489   {
<a name="l00490"></a>00490     <span class="keywordtype">bool</span> ok;
<a name="l00491"></a>00491     <span class="keywordtype">double</span> d = angleFunc.toDouble( &amp;ok );
<a name="l00492"></a>00492     <span class="keywordflow">if</span> ( ok )
<a name="l00493"></a>00493       angle = d;
<a name="l00494"></a>00494   }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   QPointF <a class="code" href="classQgsMarkerSymbolLayerV2.html#aa8e02f3490619b2ebc394d991a12805d">offset</a>;
<a name="l00497"></a>00497   <a class="code" href="classQgsSymbolLayerV2Utils.html#aa3dbeae36f4c73eb0dcc68181284582a">QgsSymbolLayerV2Utils::displacementFromSldElement</a>( graphicElem, offset );
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <a class="code" href="classQgsMarkerSymbolLayerV2.html">QgsMarkerSymbolLayerV2</a> *m = <span class="keyword">new</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#ab2490abfe06c97f1136be61ecf305bc5">QgsSimpleMarkerSymbolLayerV2</a>( name, color, borderColor, size );
<a name="l00500"></a>00500   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#ac260e742581b997780afb8676d17edc2">setAngle</a>( angle );
<a name="l00501"></a>00501   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( offset );
<a name="l00502"></a>00502   <span class="keywordflow">return</span> m;
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adddb48dc98ea782839288ebf85a0ce1a">00505</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#adddb48dc98ea782839288ebf85a0ce1a">QgsSimpleMarkerSymbolLayerV2::drawMarker</a>( QPainter* p, <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507   Q_UNUSED( context );
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a>.count() != 0 )
<a name="l00510"></a>00510   {
<a name="l00511"></a>00511     p-&gt;drawPolygon( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a9b5d90d3f60b271979c1526f0a5cc04b">mPolygon</a> );
<a name="l00512"></a>00512   }
<a name="l00513"></a>00513   <span class="keywordflow">else</span>
<a name="l00514"></a>00514   {
<a name="l00515"></a>00515     p-&gt;drawPath( <a class="code" href="classQgsSimpleMarkerSymbolLayerV2.html#a7ea0d1e8c53ac31daefe78e56a5eae01">mPath</a> );
<a name="l00516"></a>00516   }
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 
<a name="l00523"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab31136171fe73a6c654da61e98e31ba7">00523</a> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab31136171fe73a6c654da61e98e31ba7">QgsSvgMarkerSymbolLayerV2::QgsSvgMarkerSymbolLayerV2</a>( QString name, <span class="keywordtype">double</span> <a class="code" href="qgssvgcache_8cpp.html#aba3c5d750d5dbd6e86c11ecaca62885e">size</a>, <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#ad8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)">angle</a> )
<a name="l00524"></a>00524 {
<a name="l00525"></a>00525   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a> = <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ada229da6bb5db51c2a574b5b91062e08" title="Get symbol&#39;s path from its name.">symbolNameToPath</a>( name );
<a name="l00526"></a>00526   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a>;
<a name="l00527"></a>00527   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a>;
<a name="l00528"></a>00528   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> = QPointF( 0, 0 );
<a name="l00529"></a>00529   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ac2d8deb5aabcd5e0c26e92d1d42899ce">mOutlineWidth</a> = 1.0;
<a name="l00530"></a>00530   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a20a442e09e35acd69212ccc0b60e9676">mFillColor</a> = QColor( Qt::black );
<a name="l00531"></a>00531   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a73360e6c308b5093d1c00f2bec72807c">mOutlineColor</a> = QColor( Qt::black );
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a4e164d94eaeb0f00a904430b9cbb2328">00535</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a4e164d94eaeb0f00a904430b9cbb2328">QgsSvgMarkerSymbolLayerV2::create</a>( <span class="keyword">const</span> <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a>&amp; props )
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537   QString name = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a8f0b94d9411cefd29449d6ea443e57af">DEFAULT_SVGMARKER_NAME</a>;
<a name="l00538"></a>00538   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a9bb0a3ef85d4027a1b4b011c6607aab6">DEFAULT_SVGMARKER_SIZE</a>;
<a name="l00539"></a>00539   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a699772d6d9b724c74fafa075d23ccd18">DEFAULT_SVGMARKER_ANGLE</a>;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;name&quot;</span> ) )
<a name="l00542"></a>00542     name = props[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l00543"></a>00543   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;size&quot;</span> ) )
<a name="l00544"></a>00544     size = props[<span class="stringliteral">&quot;size&quot;</span>].toDouble();
<a name="l00545"></a>00545   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;angle&quot;</span> ) )
<a name="l00546"></a>00546     angle = props[<span class="stringliteral">&quot;angle&quot;</span>].toDouble();
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html">QgsSvgMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab31136171fe73a6c654da61e98e31ba7">QgsSvgMarkerSymbolLayerV2</a>( name, size, angle );
<a name="l00549"></a>00549 
<a name="l00550"></a>00550   <span class="comment">//we only check the svg default parameters if necessary, since it could be expensive</span>
<a name="l00551"></a>00551   <span class="keywordflow">if</span> ( !props.contains( <span class="stringliteral">&quot;fill&quot;</span> ) &amp;&amp; !props.contains( <span class="stringliteral">&quot;outline&quot;</span> ) &amp;&amp; !props.contains( <span class="stringliteral">&quot;outline-width&quot;</span> ) )
<a name="l00552"></a>00552   {
<a name="l00553"></a>00553     QColor <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a77d7f7a246030bb02f3f1b2ddbcd335a">fillColor</a>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#abd3a6a557a4b621ea5501609a97b216c">outlineColor</a>;
<a name="l00554"></a>00554     <span class="keywordtype">double</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a2754af94b750d91a2a6c91495798f071">outlineWidth</a>;
<a name="l00555"></a>00555     <span class="keywordtype">bool</span> hasFillParam, hasOutlineParam, hasOutlineWidthParam;
<a name="l00556"></a>00556     <a class="code" href="classQgsSvgCache.html#a4903ea3275a2d0335227a9fba37bba66">QgsSvgCache::instance</a>()-&gt;<a class="code" href="classQgsSvgCache.html#a55c6d52e4975f8ecedd31e8ef07bea4d" title="Tests if an svg file contains parameters for fill, outline color, outline width.">containsParams</a>( name, hasFillParam, fillColor, hasOutlineParam, outlineColor, hasOutlineWidthParam, outlineWidth );
<a name="l00557"></a>00557     <span class="keywordflow">if</span> ( hasFillParam )
<a name="l00558"></a>00558     {
<a name="l00559"></a>00559       m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7b3cee9849d21c7542f4f7adc1eeb8fb">setFillColor</a>( fillColor );
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561     <span class="keywordflow">if</span> ( hasOutlineParam )
<a name="l00562"></a>00562     {
<a name="l00563"></a>00563       m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a75debeff98b186d7807e2a5dba09f392">setOutlineColor</a>( outlineColor );
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565     <span class="keywordflow">if</span> ( hasOutlineWidthParam )
<a name="l00566"></a>00566     {
<a name="l00567"></a>00567       m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aaba84209c98237b46b6ebf5d9c4c77f5">setOutlineWidth</a>( outlineWidth );
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569   }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;offset&quot;</span> ) )
<a name="l00572"></a>00572     m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( <a class="code" href="classQgsSymbolLayerV2Utils.html#a1709e6b136de7414fcb77c11784e1ad5">QgsSymbolLayerV2Utils::decodePoint</a>( props[<span class="stringliteral">&quot;offset&quot;</span>] ) );
<a name="l00573"></a>00573   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;fill&quot;</span> ) )
<a name="l00574"></a>00574     m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7b3cee9849d21c7542f4f7adc1eeb8fb">setFillColor</a>( QColor( props[<span class="stringliteral">&quot;fill&quot;</span>] ) );
<a name="l00575"></a>00575   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;outline&quot;</span> ) )
<a name="l00576"></a>00576     m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a75debeff98b186d7807e2a5dba09f392">setOutlineColor</a>( QColor( props[<span class="stringliteral">&quot;outline&quot;</span>] ) );
<a name="l00577"></a>00577   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;outline-width&quot;</span> ) )
<a name="l00578"></a>00578     m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aaba84209c98237b46b6ebf5d9c4c77f5">setOutlineWidth</a>( props[<span class="stringliteral">&quot;outline-width&quot;</span>].toDouble() );
<a name="l00579"></a>00579   <span class="keywordflow">return</span> m;
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00582"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a264b9f7ac75c743fcbfae1ecff2ba770">00582</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a264b9f7ac75c743fcbfae1ecff2ba770">QgsSvgMarkerSymbolLayerV2::setPath</a>( QString path )
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a> = <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a1e23151032219f8a2f5b1a7b2e67c203">path</a>;
<a name="l00585"></a>00585   QColor <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a77d7f7a246030bb02f3f1b2ddbcd335a">fillColor</a>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#abd3a6a557a4b621ea5501609a97b216c">outlineColor</a>;
<a name="l00586"></a>00586   <span class="keywordtype">double</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a2754af94b750d91a2a6c91495798f071">outlineWidth</a>;
<a name="l00587"></a>00587   <span class="keywordtype">bool</span> hasFillParam, hasOutlineParam, hasOutlineWidthParam;
<a name="l00588"></a>00588   <a class="code" href="classQgsSvgCache.html#a4903ea3275a2d0335227a9fba37bba66">QgsSvgCache::instance</a>()-&gt;<a class="code" href="classQgsSvgCache.html#a55c6d52e4975f8ecedd31e8ef07bea4d" title="Tests if an svg file contains parameters for fill, outline color, outline width.">containsParams</a>( path, hasFillParam, fillColor, hasOutlineParam, outlineColor, hasOutlineWidthParam, outlineWidth );
<a name="l00589"></a>00589   <span class="keywordflow">if</span> ( hasFillParam )
<a name="l00590"></a>00590   {
<a name="l00591"></a>00591     <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7b3cee9849d21c7542f4f7adc1eeb8fb">setFillColor</a>( fillColor );
<a name="l00592"></a>00592   }
<a name="l00593"></a>00593   <span class="keywordflow">if</span> ( hasOutlineParam )
<a name="l00594"></a>00594   {
<a name="l00595"></a>00595     <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a75debeff98b186d7807e2a5dba09f392">setOutlineColor</a>( outlineColor );
<a name="l00596"></a>00596   }
<a name="l00597"></a>00597   <span class="keywordflow">if</span> ( hasOutlineWidthParam )
<a name="l00598"></a>00598   {
<a name="l00599"></a>00599     <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aaba84209c98237b46b6ebf5d9c4c77f5">setOutlineWidth</a>( outlineWidth );
<a name="l00600"></a>00600   }
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 
<a name="l00604"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ad6dc9357340e790782e89815cc06c6d2">00604</a> QString <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ad6dc9357340e790782e89815cc06c6d2">QgsSvgMarkerSymbolLayerV2::layerType</a>()<span class="keyword"> const</span>
<a name="l00605"></a>00605 <span class="keyword"></span>{
<a name="l00606"></a>00606   <span class="keywordflow">return</span> <span class="stringliteral">&quot;SvgMarker&quot;</span>;
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7e6761a4303358d1a447e971dc46ff53">00609</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7e6761a4303358d1a447e971dc46ff53">QgsSvgMarkerSymbolLayerV2::startRender</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a24beb9bd46a1cd8e32f3cc5203293578">mOrigSize</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a>; <span class="comment">// save in case the size would be data defined</span>
<a name="l00612"></a>00612   Q_UNUSED( context );
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a87bc2c55224b11be402fa7b30f601d0e">00615</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a87bc2c55224b11be402fa7b30f601d0e">QgsSvgMarkerSymbolLayerV2::stopRender</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617   Q_UNUSED( context );
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00620"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7d41e48515201a47aefd27d21d31fcfe">00620</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7d41e48515201a47aefd27d21d31fcfe">QgsSvgMarkerSymbolLayerV2::renderPoint</a>( <span class="keyword">const</span> QPointF&amp; point, <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622   QPainter* p = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a3acf9ad3fc76e62c90db63bf13d7e0fb">painter</a>();
<a name="l00623"></a>00623   <span class="keywordflow">if</span> ( !p )
<a name="l00624"></a>00624   {
<a name="l00625"></a>00625     <span class="keywordflow">return</span>;
<a name="l00626"></a>00626   }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628   p-&gt;save();
<a name="l00629"></a>00629   QPointF outputOffset = QPointF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a>.x() ), context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a>.y() ) );
<a name="l00630"></a>00630   <span class="keywordflow">if</span> ( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> )
<a name="l00631"></a>00631     outputOffset = <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a3bb3c252c8bac3ee5a33b9207b22a6d1">_rotatedOffset</a>( outputOffset, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00632"></a>00632   p-&gt;translate( point + outputOffset );
<a name="l00633"></a>00633 
<a name="l00634"></a>00634   <span class="keywordtype">int</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a> = ( int )( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> ) );
<a name="l00635"></a>00635   <span class="keywordflow">if</span> ( size &lt; 1 ) <span class="comment">//don&#39;t render symbols with size below one pixel</span>
<a name="l00636"></a>00636   {
<a name="l00637"></a>00637     <span class="keywordflow">return</span>;
<a name="l00638"></a>00638   }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="keywordtype">bool</span> rotated = !<a class="code" href="qgis_8h.html#a14039c8aa54bda84192e28ecb298ed20">doubleNear</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a>, 0 );
<a name="l00641"></a>00641   <span class="keywordtype">bool</span> drawOnScreen = <a class="code" href="qgis_8h.html#a14039c8aa54bda84192e28ecb298ed20">doubleNear</a>( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>(), 1.0, 0.1 );
<a name="l00642"></a>00642   <span class="keywordflow">if</span> ( rotated )
<a name="l00643"></a>00643     p-&gt;rotate( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="keywordflow">if</span> ( drawOnScreen &amp;&amp; !rotated )
<a name="l00646"></a>00646   {
<a name="l00647"></a>00647     <span class="keyword">const</span> QImage&amp; img = <a class="code" href="classQgsSvgCache.html#a4903ea3275a2d0335227a9fba37bba66">QgsSvgCache::instance</a>()-&gt;<a class="code" href="classQgsSvgCache.html#a0ab9c72b226294a4e5b249c3b8d5aff7">svgAsImage</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a>, size, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a20a442e09e35acd69212ccc0b60e9676">mFillColor</a>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a73360e6c308b5093d1c00f2bec72807c">mOutlineColor</a>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ac2d8deb5aabcd5e0c26e92d1d42899ce">mOutlineWidth</a>,
<a name="l00648"></a>00648                         context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#af4b93052d1a48544b5cd7103a7596acb">scaleFactor</a>(), context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>() );
<a name="l00649"></a>00649     <span class="comment">//consider transparency</span>
<a name="l00650"></a>00650     <span class="keywordflow">if</span> ( !<a class="code" href="qgis_8h.html#a14039c8aa54bda84192e28ecb298ed20">doubleNear</a>( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>(), 1.0 ) )
<a name="l00651"></a>00651     {
<a name="l00652"></a>00652       QImage transparentImage = img.copy();
<a name="l00653"></a>00653       <a class="code" href="classQgsSymbolLayerV2Utils.html#acca307af6bd85500a8308b921589bfac" title="Multiplies opacity of image pixel values with a (global) transparency value.">QgsSymbolLayerV2Utils::multiplyImageOpacity</a>( &amp;transparentImage, context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() );
<a name="l00654"></a>00654       p-&gt;drawImage( -transparentImage.width() / 2.0, -transparentImage.height() / 2.0, transparentImage );
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656     <span class="keywordflow">else</span>
<a name="l00657"></a>00657     {
<a name="l00658"></a>00658       p-&gt;drawImage( -img.width() / 2.0, -img.height() / 2.0, img );
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660   }
<a name="l00661"></a>00661   <span class="keywordflow">else</span>
<a name="l00662"></a>00662   {
<a name="l00663"></a>00663     p-&gt;setOpacity( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>( ) );
<a name="l00664"></a>00664     <span class="keyword">const</span> QPicture&amp; pct = <a class="code" href="classQgsSvgCache.html#a4903ea3275a2d0335227a9fba37bba66">QgsSvgCache::instance</a>()-&gt;<a class="code" href="classQgsSvgCache.html#aa1dfbbc090ccec29361b5e7bf649242a">svgAsPicture</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a>, size, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a20a442e09e35acd69212ccc0b60e9676">mFillColor</a>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a73360e6c308b5093d1c00f2bec72807c">mOutlineColor</a>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ac2d8deb5aabcd5e0c26e92d1d42899ce">mOutlineWidth</a>,
<a name="l00665"></a>00665                           context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#af4b93052d1a48544b5cd7103a7596acb">scaleFactor</a>(), context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>() );
<a name="l00666"></a>00666     p-&gt;drawPicture( 0, 0, pct );
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   <span class="keywordflow">if</span> ( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7339b8275a3500e3812d470ea87f6c00">selected</a>() )
<a name="l00670"></a>00670   {
<a name="l00671"></a>00671     QPen pen( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a250869300bc353d39df6c395a6cc8828">selectionColor</a>() );
<a name="l00672"></a>00672     pen.setWidth( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( 1.0 ) );
<a name="l00673"></a>00673     p-&gt;setPen( pen );
<a name="l00674"></a>00674     p-&gt;setBrush( Qt::NoBrush );
<a name="l00675"></a>00675     <span class="keywordtype">double</span> sizePixel = context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00676"></a>00676     p-&gt;drawRect( QRectF( -sizePixel / 2.0, -sizePixel / 2.0, sizePixel, sizePixel ) );
<a name="l00677"></a>00677   }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679   p-&gt;restore();
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a5f060e34c4ee5545faf70766071dd4c4">00683</a> <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a5f060e34c4ee5545faf70766071dd4c4">QgsSvgMarkerSymbolLayerV2::properties</a>()<span class="keyword"> const</span>
<a name="l00684"></a>00684 <span class="keyword"></span>{
<a name="l00685"></a>00685   <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> map;
<a name="l00686"></a>00686   map[<span class="stringliteral">&quot;name&quot;</span>] = <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab7ae31239a87a2ea1748a4972ad65ecc" title="Get symbols&#39;s name from its path.">symbolPathToName</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a> );
<a name="l00687"></a>00687   map[<span class="stringliteral">&quot;size&quot;</span>] = QString::number( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00688"></a>00688   map[<span class="stringliteral">&quot;angle&quot;</span>] = QString::number( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00689"></a>00689   map[<span class="stringliteral">&quot;offset&quot;</span>] = <a class="code" href="classQgsSymbolLayerV2Utils.html#a8ed29d4fe064d67f7071647b53aeb340">QgsSymbolLayerV2Utils::encodePoint</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00690"></a>00690   map[<span class="stringliteral">&quot;fill&quot;</span>] = <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a20a442e09e35acd69212ccc0b60e9676">mFillColor</a>.name();
<a name="l00691"></a>00691   map[<span class="stringliteral">&quot;outline&quot;</span>] = <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a73360e6c308b5093d1c00f2bec72807c">mOutlineColor</a>.name();
<a name="l00692"></a>00692   map[<span class="stringliteral">&quot;outline-width&quot;</span>] = QString::number( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ac2d8deb5aabcd5e0c26e92d1d42899ce">mOutlineWidth</a> );
<a name="l00693"></a>00693   <span class="keywordflow">return</span> map;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aabad39201020f75bf9846db40cd5f3b3">00696</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aabad39201020f75bf9846db40cd5f3b3">QgsSvgMarkerSymbolLayerV2::clone</a>()<span class="keyword"> const</span>
<a name="l00697"></a>00697 <span class="keyword"></span>{
<a name="l00698"></a>00698   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html">QgsSvgMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab31136171fe73a6c654da61e98e31ba7">QgsSvgMarkerSymbolLayerV2</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00699"></a>00699   m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7b3cee9849d21c7542f4f7adc1eeb8fb">setFillColor</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a20a442e09e35acd69212ccc0b60e9676">mFillColor</a> );
<a name="l00700"></a>00700   m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a75debeff98b186d7807e2a5dba09f392">setOutlineColor</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a73360e6c308b5093d1c00f2bec72807c">mOutlineColor</a> );
<a name="l00701"></a>00701   m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aaba84209c98237b46b6ebf5d9c4c77f5">setOutlineWidth</a>( <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ac2d8deb5aabcd5e0c26e92d1d42899ce">mOutlineWidth</a> );
<a name="l00702"></a>00702   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00703"></a>00703   <span class="keywordflow">return</span> m;
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7f4e0a58dab270d0794af96bc371ec25">00706</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7f4e0a58dab270d0794af96bc371ec25">QgsSvgMarkerSymbolLayerV2::writeSldMarker</a>( QDomDocument &amp;doc, QDomElement &amp;element, <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props )<span class="keyword"> const</span>
<a name="l00707"></a>00707 <span class="keyword"></span>{
<a name="l00708"></a>00708   <span class="comment">// &lt;Graphic&gt;</span>
<a name="l00709"></a>00709   QDomElement graphicElem = doc.createElement( <span class="stringliteral">&quot;se:Graphic&quot;</span> );
<a name="l00710"></a>00710   element.appendChild( graphicElem );
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <a class="code" href="classQgsSymbolLayerV2Utils.html#a65160043e7a3ba4e4f744e364c447343">QgsSymbolLayerV2Utils::externalGraphicToSld</a>( doc, graphicElem, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a8e67afefe0da55cd4a2e0fbe3f8bf192">mPath</a>, <span class="stringliteral">&quot;image/svg+xml&quot;</span>, <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a20a442e09e35acd69212ccc0b60e9676">mFillColor</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="comment">// &lt;Rotation&gt;</span>
<a name="l00715"></a>00715   QString angleFunc;
<a name="l00716"></a>00716   <span class="keywordtype">bool</span> ok;
<a name="l00717"></a>00717   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = props.value( <span class="stringliteral">&quot;angle&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ).toDouble( &amp;ok );
<a name="l00718"></a>00718   <span class="keywordflow">if</span> ( !ok )
<a name="l00719"></a>00719   {
<a name="l00720"></a>00720     angleFunc = QString( <span class="stringliteral">&quot;%1 + %2&quot;</span> ).arg( props.value( <span class="stringliteral">&quot;angle&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ) ).arg( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00721"></a>00721   }
<a name="l00722"></a>00722   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( angle + <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> != 0 )
<a name="l00723"></a>00723   {
<a name="l00724"></a>00724     angleFunc = QString::number( angle + <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00725"></a>00725   }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727   <a class="code" href="classQgsSymbolLayerV2Utils.html#a2c170c5cb0180cd576b18876113c31d0">QgsSymbolLayerV2Utils::createRotationElement</a>( doc, graphicElem, angleFunc );
<a name="l00728"></a>00728 
<a name="l00729"></a>00729   <span class="comment">// &lt;Displacement&gt;</span>
<a name="l00730"></a>00730   <a class="code" href="classQgsSymbolLayerV2Utils.html#af636bf6786998e7df7b88f0b689f5d16">QgsSymbolLayerV2Utils::createDisplacementElement</a>( doc, graphicElem, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a6c526b21e2804ab9fc170053c8b050eb">00733</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a6c526b21e2804ab9fc170053c8b050eb">QgsSvgMarkerSymbolLayerV2::createFromSld</a>( QDomElement &amp;element )
<a name="l00734"></a>00734 {
<a name="l00735"></a>00735   <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Entered.&quot;</span> );
<a name="l00736"></a>00736 
<a name="l00737"></a>00737   QDomElement graphicElem = element.firstChildElement( <span class="stringliteral">&quot;Graphic&quot;</span> );
<a name="l00738"></a>00738   <span class="keywordflow">if</span> ( graphicElem.isNull() )
<a name="l00739"></a>00739     <span class="keywordflow">return</span> NULL;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741   QString <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a1e23151032219f8a2f5b1a7b2e67c203">path</a>, mimeType;
<a name="l00742"></a>00742   QColor <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a77d7f7a246030bb02f3f1b2ddbcd335a">fillColor</a>;
<a name="l00743"></a>00743   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a>;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsSymbolLayerV2Utils.html#a6767913e1ba268d511c5dd75108d19a4">QgsSymbolLayerV2Utils::externalGraphicFromSld</a>( graphicElem, path, mimeType, fillColor, size ) )
<a name="l00746"></a>00746     <span class="keywordflow">return</span> NULL;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748   <span class="keywordflow">if</span> ( mimeType != <span class="stringliteral">&quot;image/svg+xml&quot;</span> )
<a name="l00749"></a>00749     <span class="keywordflow">return</span> NULL;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = 0.0;
<a name="l00752"></a>00752   QString angleFunc;
<a name="l00753"></a>00753   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSymbolLayerV2Utils.html#ae80d9580d6d4fc81110c9f2c561d8924">QgsSymbolLayerV2Utils::rotationFromSldElement</a>( graphicElem, angleFunc ) )
<a name="l00754"></a>00754   {
<a name="l00755"></a>00755     <span class="keywordtype">bool</span> ok;
<a name="l00756"></a>00756     <span class="keywordtype">double</span> d = angleFunc.toDouble( &amp;ok );
<a name="l00757"></a>00757     <span class="keywordflow">if</span> ( ok )
<a name="l00758"></a>00758       angle = d;
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761   QPointF <a class="code" href="classQgsMarkerSymbolLayerV2.html#aa8e02f3490619b2ebc394d991a12805d">offset</a>;
<a name="l00762"></a>00762   <a class="code" href="classQgsSymbolLayerV2Utils.html#aa3dbeae36f4c73eb0dcc68181284582a">QgsSymbolLayerV2Utils::displacementFromSldElement</a>( graphicElem, offset );
<a name="l00763"></a>00763 
<a name="l00764"></a>00764   <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html">QgsSvgMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab31136171fe73a6c654da61e98e31ba7">QgsSvgMarkerSymbolLayerV2</a>( path, size );
<a name="l00765"></a>00765   m-&gt;<a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a7b3cee9849d21c7542f4f7adc1eeb8fb">setFillColor</a>( fillColor );
<a name="l00766"></a>00766   <span class="comment">//m-&gt;setOutlineColor( outlineColor );</span>
<a name="l00767"></a>00767   <span class="comment">//m-&gt;setOutlineWidth( outlineWidth );</span>
<a name="l00768"></a>00768   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#ac260e742581b997780afb8676d17edc2">setAngle</a>( angle );
<a name="l00769"></a>00769   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( offset );
<a name="l00770"></a>00770   <span class="keywordflow">return</span> m;
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 
<a name="l00774"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aee9cd5b990b5b1a5700ca55aa4c6bb7f">00774</a> QStringList <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#aee9cd5b990b5b1a5700ca55aa4c6bb7f" title="Return a list of all available svg files.">QgsSvgMarkerSymbolLayerV2::listSvgFiles</a>()
<a name="l00775"></a>00775 {
<a name="l00776"></a>00776   <span class="comment">// copied from QgsMarkerCatalogue - TODO: unify</span>
<a name="l00777"></a>00777   QStringList list;
<a name="l00778"></a>00778   QStringList svgPaths = <a class="code" href="classQgsApplication.html#a75edac33c93b4e8ad770f69f9a7d25a1" title="Returns the pathes to svg directories.">QgsApplication::svgPaths</a>();
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; svgPaths.size(); i++ )
<a name="l00781"></a>00781   {
<a name="l00782"></a>00782     QDir dir( svgPaths[i] );
<a name="l00783"></a>00783     <span class="keywordflow">foreach</span>( QString item, dir.entryList( QDir::Dirs | QDir::NoDotAndDotDot ) )
<a name="l00784"></a>00784     {
<a name="l00785"></a>00785       svgPaths.insert( i + 1, dir.path() + <span class="stringliteral">&quot;/&quot;</span> + item );
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     <span class="keywordflow">foreach</span>( QString item, dir.entryList( QStringList( <span class="stringliteral">&quot;*.svg&quot;</span> ), QDir::Files ) )
<a name="l00789"></a>00789     {
<a name="l00790"></a>00790       <span class="comment">// TODO test if it is correct SVG</span>
<a name="l00791"></a>00791       list.append( dir.path() + <span class="stringliteral">&quot;/&quot;</span> + item );
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793   }
<a name="l00794"></a>00794   <span class="keywordflow">return</span> list;
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ada229da6bb5db51c2a574b5b91062e08">00797</a> QString <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ada229da6bb5db51c2a574b5b91062e08" title="Get symbol&#39;s path from its name.">QgsSvgMarkerSymbolLayerV2::symbolNameToPath</a>( QString name )
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799   <span class="comment">// copied from QgsSymbol::setNamedPointSymbol - TODO: unify</span>
<a name="l00800"></a>00800 
<a name="l00801"></a>00801   <span class="comment">// we might have a full path...</span>
<a name="l00802"></a>00802   <span class="keywordflow">if</span> ( QFile( name ).exists() )
<a name="l00803"></a>00803     <span class="keywordflow">return</span> QFileInfo( name ).canonicalFilePath();
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   <span class="comment">// SVG symbol not found - probably a relative path was used</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   QStringList svgPaths = <a class="code" href="classQgsApplication.html#a75edac33c93b4e8ad770f69f9a7d25a1" title="Returns the pathes to svg directories.">QgsApplication::svgPaths</a>();
<a name="l00808"></a>00808   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; svgPaths.size(); i++ )
<a name="l00809"></a>00809   {
<a name="l00810"></a>00810     <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;SvgPath: &quot;</span> + svgPaths[i] );
<a name="l00811"></a>00811     QFileInfo myInfo( name );
<a name="l00812"></a>00812     QString myFileName = myInfo.fileName(); <span class="comment">// foo.svg</span>
<a name="l00813"></a>00813     QString myLowestDir = myInfo.dir().dirName();
<a name="l00814"></a>00814     QString myLocalPath = svgPaths[i] + <span class="stringliteral">&quot;/&quot;</span> + myLowestDir + <span class="stringliteral">&quot;/&quot;</span> + myFileName;
<a name="l00815"></a>00815 
<a name="l00816"></a>00816     <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Alternative svg path: &quot;</span> + myLocalPath );
<a name="l00817"></a>00817     <span class="keywordflow">if</span> ( QFile( myLocalPath ).exists() )
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819       <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Svg found in alternative path&quot;</span> );
<a name="l00820"></a>00820       <span class="keywordflow">return</span> QFileInfo( myLocalPath ).canonicalFilePath();
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( myInfo.isRelative() )
<a name="l00823"></a>00823     {
<a name="l00824"></a>00824       QFileInfo pfi( <a class="code" href="classQgsProject.html#a26df6e8516ac9625901108875681803b" title="access to canonical QgsProject instance">QgsProject::instance</a>()-&gt;fileName() );
<a name="l00825"></a>00825       QString alternatePath = pfi.canonicalPath() + QDir::separator() + name;
<a name="l00826"></a>00826       <span class="keywordflow">if</span> ( pfi.exists() &amp;&amp; QFile( alternatePath ).exists() )
<a name="l00827"></a>00827       {
<a name="l00828"></a>00828         <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Svg found in alternative path&quot;</span> );
<a name="l00829"></a>00829         <span class="keywordflow">return</span> QFileInfo( alternatePath ).canonicalFilePath();
<a name="l00830"></a>00830       }
<a name="l00831"></a>00831       <span class="keywordflow">else</span>
<a name="l00832"></a>00832       {
<a name="l00833"></a>00833         <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Svg not found in project path&quot;</span> );
<a name="l00834"></a>00834       }
<a name="l00835"></a>00835     }
<a name="l00836"></a>00836     <span class="keywordflow">else</span>
<a name="l00837"></a>00837     {
<a name="l00838"></a>00838       <span class="comment">//couldnt find the file, no happy ending :-(</span>
<a name="l00839"></a>00839       <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Computed alternate path but no svg there either&quot;</span> );
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841   }
<a name="l00842"></a>00842   <span class="keywordflow">return</span> QString();
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a><a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab7ae31239a87a2ea1748a4972ad65ecc">00845</a> QString <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#ab7ae31239a87a2ea1748a4972ad65ecc" title="Get symbols&#39;s name from its path.">QgsSvgMarkerSymbolLayerV2::symbolPathToName</a>( QString path )
<a name="l00846"></a>00846 {
<a name="l00847"></a>00847   <span class="comment">// copied from QgsSymbol::writeXML</span>
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   QFileInfo fi( path );
<a name="l00850"></a>00850   <span class="keywordflow">if</span> ( !fi.exists() )
<a name="l00851"></a>00851     <span class="keywordflow">return</span> path;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   path = fi.canonicalFilePath();
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   QStringList svgPaths = <a class="code" href="classQgsApplication.html#a75edac33c93b4e8ad770f69f9a7d25a1" title="Returns the pathes to svg directories.">QgsApplication::svgPaths</a>();
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; svgPaths.size(); i++ )
<a name="l00858"></a>00858   {
<a name="l00859"></a>00859     QString dir = QFileInfo( svgPaths[i] ).canonicalFilePath();
<a name="l00860"></a>00860 
<a name="l00861"></a>00861     <span class="keywordflow">if</span> ( !dir.isEmpty() &amp;&amp; path.startsWith( dir ) )
<a name="l00862"></a>00862     {
<a name="l00863"></a>00863       path = path.mid( dir.size() );
<a name="l00864"></a>00864       <span class="keywordflow">break</span>;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866   }
<a name="l00867"></a>00867 
<a name="l00868"></a>00868   <span class="keywordflow">return</span> <a class="code" href="classQgsSvgMarkerSymbolLayerV2.html#a1e23151032219f8a2f5b1a7b2e67c203">path</a>;
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 
<a name="l00873"></a>00873 
<a name="l00874"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54ad47319dd5a88ecb1cc7a321078d84">00874</a> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54ad47319dd5a88ecb1cc7a321078d84">QgsFontMarkerSymbolLayerV2::QgsFontMarkerSymbolLayerV2</a>( QString fontFamily, QChar chr, <span class="keywordtype">double</span> pointSize, QColor color, <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#ad8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)">angle</a> )
<a name="l00875"></a>00875 {
<a name="l00876"></a>00876   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#aa05c0db50bbef9e71c1b3b573e0c4d94">mFontFamily</a> = <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#af03b6bda9798d61257a3abfa0553b16f">fontFamily</a>;
<a name="l00877"></a>00877   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a1c3058c737a636d795588a135445b87d">mChr</a> = chr;
<a name="l00878"></a>00878   <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a> = <a class="code" href="classQgsSymbolLayerV2.html#a692837dc473ba2b206f8015aca8ec387">color</a>;
<a name="l00879"></a>00879   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a>;
<a name="l00880"></a>00880   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> = pointSize;
<a name="l00881"></a>00881   <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> = QPointF( 0, 0 );
<a name="l00882"></a>00882 }
<a name="l00883"></a>00883 
<a name="l00884"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a0c7b7f39d585493c754745c63b1a45be">00884</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a0c7b7f39d585493c754745c63b1a45be">QgsFontMarkerSymbolLayerV2::create</a>( <span class="keyword">const</span> <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a>&amp; props )
<a name="l00885"></a>00885 {
<a name="l00886"></a>00886   QString <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#af03b6bda9798d61257a3abfa0553b16f">fontFamily</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#aa81a43fcb98902ec84ec2abd246a062a">DEFAULT_FONTMARKER_FONT</a>;
<a name="l00887"></a>00887   QChar chr = <a class="code" href="qgsmarkersymbollayerv2_8h.html#a76ca54e1ad882dcdaf0288da37d73b4e">DEFAULT_FONTMARKER_CHR</a>;
<a name="l00888"></a>00888   <span class="keywordtype">double</span> pointSize = <a class="code" href="qgsmarkersymbollayerv2_8h.html#af728d5f0f7900972d57fb733703220a9">DEFAULT_FONTMARKER_SIZE</a>;
<a name="l00889"></a>00889   QColor <a class="code" href="classQgsSymbolLayerV2.html#a692837dc473ba2b206f8015aca8ec387">color</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#af4083280095447617b9f99f581d7ce0e">DEFAULT_FONTMARKER_COLOR</a>;
<a name="l00890"></a>00890   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = <a class="code" href="qgsmarkersymbollayerv2_8h.html#af1b49c675f91f284d8a86c789417f484">DEFAULT_FONTMARKER_ANGLE</a>;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;font&quot;</span> ) )
<a name="l00893"></a>00893     fontFamily = props[<span class="stringliteral">&quot;font&quot;</span>];
<a name="l00894"></a>00894   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;chr&quot;</span> ) &amp;&amp; props[<span class="stringliteral">&quot;chr&quot;</span>].length() &gt; 0 )
<a name="l00895"></a>00895     chr = props[<span class="stringliteral">&quot;chr&quot;</span>].at( 0 );
<a name="l00896"></a>00896   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;size&quot;</span> ) )
<a name="l00897"></a>00897     pointSize = props[<span class="stringliteral">&quot;size&quot;</span>].toDouble();
<a name="l00898"></a>00898   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;color&quot;</span> ) )
<a name="l00899"></a>00899     color = <a class="code" href="classQgsSymbolLayerV2Utils.html#a942f2c54ef1be3c474313ff3739a9aa8">QgsSymbolLayerV2Utils::decodeColor</a>( props[<span class="stringliteral">&quot;color&quot;</span>] );
<a name="l00900"></a>00900   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;angle&quot;</span> ) )
<a name="l00901"></a>00901     angle = props[<span class="stringliteral">&quot;angle&quot;</span>].toDouble();
<a name="l00902"></a>00902 
<a name="l00903"></a>00903   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html">QgsFontMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54ad47319dd5a88ecb1cc7a321078d84">QgsFontMarkerSymbolLayerV2</a>( fontFamily, chr, pointSize, color, angle );
<a name="l00904"></a>00904   <span class="keywordflow">if</span> ( props.contains( <span class="stringliteral">&quot;offset&quot;</span> ) )
<a name="l00905"></a>00905     m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( <a class="code" href="classQgsSymbolLayerV2Utils.html#a1709e6b136de7414fcb77c11784e1ad5">QgsSymbolLayerV2Utils::decodePoint</a>( props[<span class="stringliteral">&quot;offset&quot;</span>] ) );
<a name="l00906"></a>00906   <span class="keywordflow">return</span> m;
<a name="l00907"></a>00907 }
<a name="l00908"></a>00908 
<a name="l00909"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a2b768f3be7403954ca5d72ab1f1a0e9a">00909</a> QString <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a2b768f3be7403954ca5d72ab1f1a0e9a">QgsFontMarkerSymbolLayerV2::layerType</a>()<span class="keyword"> const</span>
<a name="l00910"></a>00910 <span class="keyword"></span>{
<a name="l00911"></a>00911   <span class="keywordflow">return</span> <span class="stringliteral">&quot;FontMarker&quot;</span>;
<a name="l00912"></a>00912 }
<a name="l00913"></a>00913 
<a name="l00914"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a46d51b628dd8c4bc92a802eedc14953f">00914</a> <span class="keywordtype">void</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a46d51b628dd8c4bc92a802eedc14953f">QgsFontMarkerSymbolLayerV2::startRender</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00915"></a>00915 {
<a name="l00916"></a>00916   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a0e55d4e1f908c002a56250cae4777293">mFont</a> = QFont( <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#aa05c0db50bbef9e71c1b3b573e0c4d94">mFontFamily</a> );
<a name="l00917"></a>00917   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a0e55d4e1f908c002a56250cae4777293">mFont</a>.setPixelSize( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> ) );
<a name="l00918"></a>00918   QFontMetrics fm( <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a0e55d4e1f908c002a56250cae4777293">mFont</a> );
<a name="l00919"></a>00919   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#ac6a6ae48fd0c5b78268ee31b6bd6f997">mChrOffset</a> = QPointF( fm.width( <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a1c3058c737a636d795588a135445b87d">mChr</a> ) / 2, -fm.ascent() / 2 );
<a name="l00920"></a>00920 
<a name="l00921"></a>00921   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#adbd9ba7a3d1ce0828cde6ef57f76486b">mOrigSize</a> = <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a>; <span class="comment">// save in case the size would be data defined</span>
<a name="l00922"></a>00922 }
<a name="l00923"></a>00923 
<a name="l00924"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54aaa3321b045c8945cb7e3ff774b538">00924</a> <span class="keywordtype">void</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54aaa3321b045c8945cb7e3ff774b538">QgsFontMarkerSymbolLayerV2::stopRender</a>( <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00925"></a>00925 {
<a name="l00926"></a>00926   Q_UNUSED( context );
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#af63591b1f0f3079e03a9e9fe29fcadc3">00929</a> <span class="keywordtype">void</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#af63591b1f0f3079e03a9e9fe29fcadc3">QgsFontMarkerSymbolLayerV2::renderPoint</a>( <span class="keyword">const</span> QPointF&amp; point, <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a>&amp; context )
<a name="l00930"></a>00930 {
<a name="l00931"></a>00931   QPainter* p = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7486624cf40ad812a12493a0cfb538e9">renderContext</a>().<a class="code" href="classQgsRenderContext.html#a3acf9ad3fc76e62c90db63bf13d7e0fb">painter</a>();
<a name="l00932"></a>00932   QColor penColor = context.<a class="code" href="classQgsSymbolV2RenderContext.html#a7339b8275a3500e3812d470ea87f6c00">selected</a>() ? context.<a class="code" href="classQgsSymbolV2RenderContext.html#a250869300bc353d39df6c395a6cc8828">selectionColor</a>() : <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a>;
<a name="l00933"></a>00933   penColor.setAlphaF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a29fa7f8394884b290db8cfa6c67a9434" title="Get alpha transparency 1 for opaque, 0 for invisible.">alpha</a>() );
<a name="l00934"></a>00934   p-&gt;setPen( penColor );
<a name="l00935"></a>00935   p-&gt;setFont( <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a0e55d4e1f908c002a56250cae4777293">mFont</a> );
<a name="l00936"></a>00936 
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   p-&gt;save();
<a name="l00939"></a>00939   QPointF outputOffset = QPointF( context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a>.x() ), context.<a class="code" href="classQgsSymbolV2RenderContext.html#aec3d3c86d84fae975f35345667a5a695">outputLineWidth</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a>.y() ) );
<a name="l00940"></a>00940   <span class="keywordflow">if</span> ( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> )
<a name="l00941"></a>00941     outputOffset = <a class="code" href="qgsmarkersymbollayerv2_8cpp.html#a3bb3c252c8bac3ee5a33b9207b22a6d1">_rotatedOffset</a>( outputOffset, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00942"></a>00942   p-&gt;translate( point + outputOffset );
<a name="l00943"></a>00943 
<a name="l00944"></a>00944   <span class="keywordflow">if</span> ( context.<a class="code" href="classQgsSymbolV2RenderContext.html#a9c451270557a3eb0106ede0027de1317">renderHints</a>() &amp; <a class="code" href="classQgsSymbolV2.html#a9dc8b734888424e619f2c4a86f9ba6f0a41db449079555a7c403718f3950f313b">QgsSymbolV2::DataDefinedSizeScale</a> )
<a name="l00945"></a>00945   {
<a name="l00946"></a>00946     <span class="keywordtype">double</span> s = <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> / <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#adbd9ba7a3d1ce0828cde6ef57f76486b">mOrigSize</a>;
<a name="l00947"></a>00947     p-&gt;scale( s, s );
<a name="l00948"></a>00948   }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950   <span class="keywordflow">if</span> ( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> != 0 )
<a name="l00951"></a>00951     p-&gt;rotate( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00952"></a>00952 
<a name="l00953"></a>00953   p-&gt;drawText( -<a class="code" href="classQgsFontMarkerSymbolLayerV2.html#ac6a6ae48fd0c5b78268ee31b6bd6f997">mChrOffset</a>, <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a1c3058c737a636d795588a135445b87d">mChr</a> );
<a name="l00954"></a>00954   p-&gt;restore();
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a490bbdda8e6f726e7d246944b8364eed">00957</a> <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a490bbdda8e6f726e7d246944b8364eed">QgsFontMarkerSymbolLayerV2::properties</a>()<span class="keyword"> const</span>
<a name="l00958"></a>00958 <span class="keyword"></span>{
<a name="l00959"></a>00959   <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props;
<a name="l00960"></a>00960   props[<span class="stringliteral">&quot;font&quot;</span>] = <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#aa05c0db50bbef9e71c1b3b573e0c4d94">mFontFamily</a>;
<a name="l00961"></a>00961   props[<span class="stringliteral">&quot;chr&quot;</span>] = <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a1c3058c737a636d795588a135445b87d">mChr</a>;
<a name="l00962"></a>00962   props[<span class="stringliteral">&quot;size&quot;</span>] = QString::number( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00963"></a>00963   props[<span class="stringliteral">&quot;color&quot;</span>] = <a class="code" href="classQgsSymbolLayerV2Utils.html#a2d71081dab2d4fc194cd0c5588e66cf1">QgsSymbolLayerV2Utils::encodeColor</a>( <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a> );
<a name="l00964"></a>00964   props[<span class="stringliteral">&quot;angle&quot;</span>] = QString::number( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00965"></a>00965   props[<span class="stringliteral">&quot;offset&quot;</span>] = <a class="code" href="classQgsSymbolLayerV2Utils.html#a8ed29d4fe064d67f7071647b53aeb340">QgsSymbolLayerV2Utils::encodePoint</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00966"></a>00966   <span class="keywordflow">return</span> props;
<a name="l00967"></a>00967 }
<a name="l00968"></a>00968 
<a name="l00969"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a3d2235c2d3a1de0ea81de43f398fdbf2">00969</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a3d2235c2d3a1de0ea81de43f398fdbf2">QgsFontMarkerSymbolLayerV2::clone</a>()<span class="keyword"> const</span>
<a name="l00970"></a>00970 <span class="keyword"></span>{
<a name="l00971"></a>00971   <a class="code" href="classQgsFontMarkerSymbolLayerV2.html">QgsFontMarkerSymbolLayerV2</a>* m = <span class="keyword">new</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54ad47319dd5a88ecb1cc7a321078d84">QgsFontMarkerSymbolLayerV2</a>( <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#aa05c0db50bbef9e71c1b3b573e0c4d94">mFontFamily</a>, <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a1c3058c737a636d795588a135445b87d">mChr</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a>, <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00972"></a>00972   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l00973"></a>00973   <span class="keywordflow">return</span> m;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a3030aae4290c26beca218d3b14478e2f">00976</a> <span class="keywordtype">void</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a3030aae4290c26beca218d3b14478e2f">QgsFontMarkerSymbolLayerV2::writeSldMarker</a>( QDomDocument &amp;doc, QDomElement &amp;element, <a class="code" href="qgsrendererv2_8h.html#ab13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props )<span class="keyword"> const</span>
<a name="l00977"></a>00977 <span class="keyword"></span>{
<a name="l00978"></a>00978   <span class="comment">// &lt;Graphic&gt;</span>
<a name="l00979"></a>00979   QDomElement graphicElem = doc.createElement( <span class="stringliteral">&quot;se:Graphic&quot;</span> );
<a name="l00980"></a>00980   element.appendChild( graphicElem );
<a name="l00981"></a>00981 
<a name="l00982"></a>00982   QString fontPath = QString( <span class="stringliteral">&quot;ttf://%1&quot;</span> ).arg( <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#aa05c0db50bbef9e71c1b3b573e0c4d94">mFontFamily</a> );
<a name="l00983"></a>00983   <span class="keywordtype">int</span> markIndex = <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a1c3058c737a636d795588a135445b87d">mChr</a>.unicode();
<a name="l00984"></a>00984   <a class="code" href="classQgsSymbolLayerV2Utils.html#a44ca722a645c62b6d8ba0b47969582d1">QgsSymbolLayerV2Utils::externalMarkerToSld</a>( doc, graphicElem, fontPath, <span class="stringliteral">&quot;ttf&quot;</span>, &amp;markIndex, <a class="code" href="classQgsSymbolLayerV2.html#a042b3eac41d39f58dd4b7d2126f646de">mColor</a>, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a2214c03015724f33752dbf938ef9269d">mSize</a> );
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="comment">// &lt;Rotation&gt;</span>
<a name="l00987"></a>00987   QString angleFunc;
<a name="l00988"></a>00988   <span class="keywordtype">bool</span> ok;
<a name="l00989"></a>00989   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = props.value( <span class="stringliteral">&quot;angle&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ).toDouble( &amp;ok );
<a name="l00990"></a>00990   <span class="keywordflow">if</span> ( !ok )
<a name="l00991"></a>00991   {
<a name="l00992"></a>00992     angleFunc = QString( <span class="stringliteral">&quot;%1 + %2&quot;</span> ).arg( props.value( <span class="stringliteral">&quot;angle&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ) ).arg( <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00993"></a>00993   }
<a name="l00994"></a>00994   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( angle + <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> != 0 )
<a name="l00995"></a>00995   {
<a name="l00996"></a>00996     angleFunc = QString::number( angle + <a class="code" href="classQgsMarkerSymbolLayerV2.html#a20d288e0495e52fd491f726efa1344be">mAngle</a> );
<a name="l00997"></a>00997   }
<a name="l00998"></a>00998   <a class="code" href="classQgsSymbolLayerV2Utils.html#a2c170c5cb0180cd576b18876113c31d0">QgsSymbolLayerV2Utils::createRotationElement</a>( doc, graphicElem, angleFunc );
<a name="l00999"></a>00999 
<a name="l01000"></a>01000   <span class="comment">// &lt;Displacement&gt;</span>
<a name="l01001"></a>01001   <a class="code" href="classQgsSymbolLayerV2Utils.html#af636bf6786998e7df7b88f0b689f5d16">QgsSymbolLayerV2Utils::createDisplacementElement</a>( doc, graphicElem, <a class="code" href="classQgsMarkerSymbolLayerV2.html#a09537cb980aa0cb86076f6f50ea5554c">mOffset</a> );
<a name="l01002"></a>01002 }
<a name="l01003"></a>01003 
<a name="l01004"></a><a class="code" href="classQgsFontMarkerSymbolLayerV2.html#acc6c6cdde5243b8095bf14fafc616ed3">01004</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#acc6c6cdde5243b8095bf14fafc616ed3">QgsFontMarkerSymbolLayerV2::createFromSld</a>( QDomElement &amp;element )
<a name="l01005"></a>01005 {
<a name="l01006"></a>01006   <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Entered.&quot;</span> );
<a name="l01007"></a>01007 
<a name="l01008"></a>01008   QDomElement graphicElem = element.firstChildElement( <span class="stringliteral">&quot;Graphic&quot;</span> );
<a name="l01009"></a>01009   <span class="keywordflow">if</span> ( graphicElem.isNull() )
<a name="l01010"></a>01010     <span class="keywordflow">return</span> NULL;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012   QString name, format;
<a name="l01013"></a>01013   QColor <a class="code" href="classQgsSymbolLayerV2.html#a692837dc473ba2b206f8015aca8ec387">color</a>;
<a name="l01014"></a>01014   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#aacdb8983965602283a7ee791e61ffd4a">size</a>;
<a name="l01015"></a>01015   <span class="keywordtype">int</span> chr;
<a name="l01016"></a>01016 
<a name="l01017"></a>01017   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsSymbolLayerV2Utils.html#ae48baaf0c73058fbafb7a94d37ab10ff">QgsSymbolLayerV2Utils::externalMarkerFromSld</a>( graphicElem, name, format, chr, color, size ) )
<a name="l01018"></a>01018     <span class="keywordflow">return</span> NULL;
<a name="l01019"></a>01019 
<a name="l01020"></a>01020   <span class="keywordflow">if</span> ( !name.startsWith( <span class="stringliteral">&quot;ttf://&quot;</span> ) || format != <span class="stringliteral">&quot;ttf&quot;</span> )
<a name="l01021"></a>01021     <span class="keywordflow">return</span> NULL;
<a name="l01022"></a>01022 
<a name="l01023"></a>01023   QString <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#af03b6bda9798d61257a3abfa0553b16f">fontFamily</a> = name.mid( 6 );
<a name="l01024"></a>01024 
<a name="l01025"></a>01025   <span class="keywordtype">double</span> <a class="code" href="classQgsMarkerSymbolLayerV2.html#af82cef4e619a64284adca184126d9a7f">angle</a> = 0.0;
<a name="l01026"></a>01026   QString angleFunc;
<a name="l01027"></a>01027   <span class="keywordflow">if</span> ( <a class="code" href="classQgsSymbolLayerV2Utils.html#ae80d9580d6d4fc81110c9f2c561d8924">QgsSymbolLayerV2Utils::rotationFromSldElement</a>( graphicElem, angleFunc ) )
<a name="l01028"></a>01028   {
<a name="l01029"></a>01029     <span class="keywordtype">bool</span> ok;
<a name="l01030"></a>01030     <span class="keywordtype">double</span> d = angleFunc.toDouble( &amp;ok );
<a name="l01031"></a>01031     <span class="keywordflow">if</span> ( ok )
<a name="l01032"></a>01032       angle = d;
<a name="l01033"></a>01033   }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   QPointF <a class="code" href="classQgsMarkerSymbolLayerV2.html#aa8e02f3490619b2ebc394d991a12805d">offset</a>;
<a name="l01036"></a>01036   <a class="code" href="classQgsSymbolLayerV2Utils.html#aa3dbeae36f4c73eb0dcc68181284582a">QgsSymbolLayerV2Utils::displacementFromSldElement</a>( graphicElem, offset );
<a name="l01037"></a>01037 
<a name="l01038"></a>01038   <a class="code" href="classQgsMarkerSymbolLayerV2.html">QgsMarkerSymbolLayerV2</a> *m = <span class="keyword">new</span> <a class="code" href="classQgsFontMarkerSymbolLayerV2.html#a54ad47319dd5a88ecb1cc7a321078d84">QgsFontMarkerSymbolLayerV2</a>( fontFamily, chr, size, color );
<a name="l01039"></a>01039   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#ac260e742581b997780afb8676d17edc2">setAngle</a>( angle );
<a name="l01040"></a>01040   m-&gt;<a class="code" href="classQgsMarkerSymbolLayerV2.html#adc7d26869ea52e49230cea8f8448bc9f">setOffset</a>( offset );
<a name="l01041"></a>01041   <span class="keywordflow">return</span> m;
<a name="l01042"></a>01042 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 19 2012 23:22:41 for Quantum GIS API Documentation by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
