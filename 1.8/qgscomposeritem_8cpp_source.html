<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Quantum GIS API Documentation: src/core/composer/qgscomposeritem.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Quantum GIS API Documentation
   &#160;<span id="projectnumber">1.8</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">src/core/composer/qgscomposeritem.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qgscomposeritem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">                         qgscomposeritem.cpp</span>
<a name="l00003"></a>00003 <span class="comment">                             -------------------</span>
<a name="l00004"></a>00004 <span class="comment">    begin                : January 2005</span>
<a name="l00005"></a>00005 <span class="comment">    copyright            : (C) 2005 by Radim Blazek</span>
<a name="l00006"></a>00006 <span class="comment">    email                : blazek@itc.it</span>
<a name="l00007"></a>00007 <span class="comment"> ***************************************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/***************************************************************************</span>
<a name="l00010"></a>00010 <span class="comment"> *                                                                         *</span>
<a name="l00011"></a>00011 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00012"></a>00012 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00013"></a>00013 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00014"></a>00014 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00015"></a>00015 <span class="comment"> *                                                                         *</span>
<a name="l00016"></a>00016 <span class="comment"> ***************************************************************************/</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;QWidget&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;QDomNode&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;QFile&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;QGraphicsScene&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;QGraphicsSceneMouseEvent&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;QGraphicsView&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;QPainter&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="qgscomposition_8h.html">qgscomposition.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="qgscomposeritem_8h.html">qgscomposeritem.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="qgsapplication_8h.html">qgsapplication.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="qgsrectangle_8h.html">qgsrectangle.h</a>&quot;</span> <span class="comment">//just for debugging</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="qgslogger_8h.html">qgslogger.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="qgssymbollayerv2utils_8h.html">qgssymbollayerv2utils.h</a>&quot;</span> <span class="comment">//for pointOnLineWithDistance</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">00037</a> <span class="preprocessor">#define FONT_WORKAROUND_SCALE 10 //scale factor for upscaling fontsize and downscaling painter</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="classQgsComposerItem.html#ac9cd65e653fe09d36e3993af594ae420">00039</a> <a class="code" href="classQgsComposerItem.html#ac9cd65e653fe09d36e3993af594ae420" title="Constructor.">QgsComposerItem::QgsComposerItem</a>( <a class="code" href="classQgsComposition.html" title="Graphics scene for map printing.">QgsComposition</a>* composition, <span class="keywordtype">bool</span> manageZValue )
<a name="l00040"></a>00040     : QObject( 0 )
<a name="l00041"></a>00041     , QGraphicsRectItem( 0 )
<a name="l00042"></a>00042     , mComposition( composition )
<a name="l00043"></a>00043     , mBoundingResizeRectangle( 0 )
<a name="l00044"></a>00044     , mFrame( true )
<a name="l00045"></a>00045     , mItemPositionLocked( false )
<a name="l00046"></a>00046     , mLastValidViewScaleFactor( -1 )
<a name="l00047"></a>00047     , mRotation( 0 )
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049   <a class="code" href="classQgsComposerItem.html#a7758c506b9d5d12db594271819e3fa52">init</a>( manageZValue );
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classQgsComposerItem.html#ac95ab5e87d48d0061168822b7397181c">00052</a> <a class="code" href="classQgsComposerItem.html#ac9cd65e653fe09d36e3993af594ae420" title="Constructor.">QgsComposerItem::QgsComposerItem</a>( qreal x, qreal y, qreal width, qreal height, <a class="code" href="classQgsComposition.html" title="Graphics scene for map printing.">QgsComposition</a>* composition, <span class="keywordtype">bool</span> manageZValue )
<a name="l00053"></a>00053     : QObject( 0 )
<a name="l00054"></a>00054     , QGraphicsRectItem( 0, 0, width, height, 0 )
<a name="l00055"></a>00055     , mComposition( composition )
<a name="l00056"></a>00056     , mBoundingResizeRectangle( 0 )
<a name="l00057"></a>00057     , mFrame( true )
<a name="l00058"></a>00058     , mItemPositionLocked( false )
<a name="l00059"></a>00059     , mLastValidViewScaleFactor( -1 )
<a name="l00060"></a>00060     , mRotation( 0 )
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062   <a class="code" href="classQgsComposerItem.html#a7758c506b9d5d12db594271819e3fa52">init</a>( manageZValue );
<a name="l00063"></a>00063   QTransform t;
<a name="l00064"></a>00064   t.translate( x, y );
<a name="l00065"></a>00065   setTransform( t );
<a name="l00066"></a>00066 }
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="classQgsComposerItem.html#a7758c506b9d5d12db594271819e3fa52">00068</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a7758c506b9d5d12db594271819e3fa52">QgsComposerItem::init</a>( <span class="keywordtype">bool</span> manageZValue )
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070   setFlag( QGraphicsItem::ItemIsSelectable, <span class="keyword">true</span> );
<a name="l00071"></a>00071   setAcceptsHoverEvents( <span class="keyword">true</span> );
<a name="l00072"></a>00072   <span class="comment">//set default pen and brush</span>
<a name="l00073"></a>00073   setBrush( QBrush( QColor( 255, 255, 255, 255 ) ) );
<a name="l00074"></a>00074   QPen defaultPen( QColor( 0, 0, 0 ) );
<a name="l00075"></a>00075   defaultPen.setWidthF( 0.3 );
<a name="l00076"></a>00076   setPen( defaultPen );
<a name="l00077"></a>00077   <span class="comment">//let z-Value be managed by composition</span>
<a name="l00078"></a>00078   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> &amp;&amp; manageZValue )
<a name="l00079"></a>00079   {
<a name="l00080"></a>00080     <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#a437c32e9789fa36f40c6f0b914b11cdf" title="Adds item to z list.">addItemToZList</a>( <span class="keyword">this</span> );
<a name="l00081"></a>00081   }
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="classQgsComposerItem.html#af67f0b9f49a1ff774958e5d50bc2e2d3">00084</a> <a class="code" href="classQgsComposerItem.html#af67f0b9f49a1ff774958e5d50bc2e2d3">QgsComposerItem::~QgsComposerItem</a>()
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> )
<a name="l00087"></a>00087   {
<a name="l00088"></a>00088     <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#a067efff30e0c393e418fe40cd3792556" title="Removes item from z list.">removeItemFromZList</a>( <span class="keyword">this</span> );
<a name="l00089"></a>00089   }
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="keyword">delete</span> <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>;
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="classQgsComposerItem.html#a293e9e9a2f28e3a042c6ca9bc558d6ba">00094</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a293e9e9a2f28e3a042c6ca9bc558d6ba" title="Set selected, selected item should be highlighted.">QgsComposerItem::setSelected</a>( <span class="keywordtype">bool</span> s )
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096   <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;entered.&quot;</span> );
<a name="l00097"></a>00097   <a class="code" href="classQgsComposerItem.html#a293e9e9a2f28e3a042c6ca9bc558d6ba" title="Set selected, selected item should be highlighted.">QGraphicsRectItem::setSelected</a>( s );
<a name="l00098"></a>00098   update(); <span class="comment">//to draw selection boxes</span>
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="classQgsComposerItem.html#a17fa045c45f2e9bf0d6bfdc6620ce847">00101</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#a17fa045c45f2e9bf0d6bfdc6620ce847" title="stores state in project">QgsComposerItem::writeSettings</a>( <span class="keywordtype">void</span> )  { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="classQgsComposerItem.html#a2cc639b18e5cefe16570a90df78bbafe">00103</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#a2cc639b18e5cefe16570a90df78bbafe" title="read state from project">QgsComposerItem::readSettings</a>( <span class="keywordtype">void</span> )  { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="classQgsComposerItem.html#a55cd75c2db84d16e71898e32ddd75781">00105</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#a55cd75c2db84d16e71898e32ddd75781" title="delete settings from project file">QgsComposerItem::removeSettings</a>( <span class="keywordtype">void</span> )  { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="classQgsComposerItem.html#a9cffbce10124a67646ae26e49a76bb23">00107</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#a9cffbce10124a67646ae26e49a76bb23" title="Writes parameter that are not subclass specific in document.">QgsComposerItem::_writeXML</a>( QDomElement&amp; itemElem, QDomDocument&amp; doc )<span class="keyword"> const</span>
<a name="l00108"></a>00108 <span class="keyword"></span>{
<a name="l00109"></a>00109   <span class="keywordflow">if</span> ( itemElem.isNull() )
<a name="l00110"></a>00110   {
<a name="l00111"></a>00111     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00112"></a>00112   }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   QDomElement composerItemElem = doc.createElement( <span class="stringliteral">&quot;ComposerItem&quot;</span> );
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <span class="comment">//frame</span>
<a name="l00117"></a>00117   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#a84d1da234929f0918560933b4936ff22" title="True if item fram needs to be painted.">mFrame</a> )
<a name="l00118"></a>00118   {
<a name="l00119"></a>00119     composerItemElem.setAttribute( <span class="stringliteral">&quot;frame&quot;</span>, <span class="stringliteral">&quot;true&quot;</span> );
<a name="l00120"></a>00120   }
<a name="l00121"></a>00121   <span class="keywordflow">else</span>
<a name="l00122"></a>00122   {
<a name="l00123"></a>00123     composerItemElem.setAttribute( <span class="stringliteral">&quot;frame&quot;</span>, <span class="stringliteral">&quot;false&quot;</span> );
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   <span class="comment">//scene rect</span>
<a name="l00127"></a>00127   composerItemElem.setAttribute( <span class="stringliteral">&quot;x&quot;</span>, QString::number( transform().dx() ) );
<a name="l00128"></a>00128   composerItemElem.setAttribute( <span class="stringliteral">&quot;y&quot;</span>, QString::number( transform().dy() ) );
<a name="l00129"></a>00129   composerItemElem.setAttribute( <span class="stringliteral">&quot;width&quot;</span>, QString::number( rect().width() ) );
<a name="l00130"></a>00130   composerItemElem.setAttribute( <span class="stringliteral">&quot;height&quot;</span>, QString::number( rect().height() ) );
<a name="l00131"></a>00131   composerItemElem.setAttribute( <span class="stringliteral">&quot;zValue&quot;</span>, QString::number( zValue() ) );
<a name="l00132"></a>00132   composerItemElem.setAttribute( <span class="stringliteral">&quot;outlineWidth&quot;</span>, QString::number( pen().widthF() ) );
<a name="l00133"></a>00133   composerItemElem.setAttribute( <span class="stringliteral">&quot;rotation&quot;</span>,  QString::number( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> ) );
<a name="l00134"></a>00134   composerItemElem.setAttribute( <span class="stringliteral">&quot;id&quot;</span>, <a class="code" href="classQgsComposerItem.html#a2f264b090ada171791e00407205504bc">mId</a> );
<a name="l00135"></a>00135   <span class="comment">//position lock for mouse moves/resizes</span>
<a name="l00136"></a>00136   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> )
<a name="l00137"></a>00137   {
<a name="l00138"></a>00138     composerItemElem.setAttribute( <span class="stringliteral">&quot;positionLock&quot;</span>, <span class="stringliteral">&quot;true&quot;</span> );
<a name="l00139"></a>00139   }
<a name="l00140"></a>00140   <span class="keywordflow">else</span>
<a name="l00141"></a>00141   {
<a name="l00142"></a>00142     composerItemElem.setAttribute( <span class="stringliteral">&quot;positionLock&quot;</span>, <span class="stringliteral">&quot;false&quot;</span> );
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   composerItemElem.setAttribute( <span class="stringliteral">&quot;lastValidViewScaleFactor&quot;</span>, QString::number( <a class="code" href="classQgsComposerItem.html#a1474eb918c9d75f869a8feb202fac447" title="Backup to restore item appearance if no view scale factor is available.">mLastValidViewScaleFactor</a> ) );
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">//frame color</span>
<a name="l00149"></a>00149   QDomElement frameColorElem = doc.createElement( <span class="stringliteral">&quot;FrameColor&quot;</span> );
<a name="l00150"></a>00150   QColor frameColor = pen().color();
<a name="l00151"></a>00151   frameColorElem.setAttribute( <span class="stringliteral">&quot;red&quot;</span>, QString::number( frameColor.red() ) );
<a name="l00152"></a>00152   frameColorElem.setAttribute( <span class="stringliteral">&quot;green&quot;</span>, QString::number( frameColor.green() ) );
<a name="l00153"></a>00153   frameColorElem.setAttribute( <span class="stringliteral">&quot;blue&quot;</span>, QString::number( frameColor.blue() ) );
<a name="l00154"></a>00154   frameColorElem.setAttribute( <span class="stringliteral">&quot;alpha&quot;</span>, QString::number( frameColor.alpha() ) );
<a name="l00155"></a>00155   composerItemElem.appendChild( frameColorElem );
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="comment">//background color</span>
<a name="l00158"></a>00158   QDomElement bgColorElem = doc.createElement( <span class="stringliteral">&quot;BackgroundColor&quot;</span> );
<a name="l00159"></a>00159   QColor bgColor = brush().color();
<a name="l00160"></a>00160   bgColorElem.setAttribute( <span class="stringliteral">&quot;red&quot;</span>, QString::number( bgColor.red() ) );
<a name="l00161"></a>00161   bgColorElem.setAttribute( <span class="stringliteral">&quot;green&quot;</span>, QString::number( bgColor.green() ) );
<a name="l00162"></a>00162   bgColorElem.setAttribute( <span class="stringliteral">&quot;blue&quot;</span>, QString::number( bgColor.blue() ) );
<a name="l00163"></a>00163   bgColorElem.setAttribute( <span class="stringliteral">&quot;alpha&quot;</span>, QString::number( bgColor.alpha() ) );
<a name="l00164"></a>00164   composerItemElem.appendChild( bgColorElem );
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   itemElem.appendChild( composerItemElem );
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="classQgsComposerItem.html#a76faf839b76bdc9ac3f3815bdf876885">00171</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#a76faf839b76bdc9ac3f3815bdf876885" title="Reads parameter that are not subclass specific in document.">QgsComposerItem::_readXML</a>( <span class="keyword">const</span> QDomElement&amp; itemElem, <span class="keyword">const</span> QDomDocument&amp; doc )
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173   Q_UNUSED( doc );
<a name="l00174"></a>00174   <span class="keywordflow">if</span> ( itemElem.isNull() )
<a name="l00175"></a>00175   {
<a name="l00176"></a>00176     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00177"></a>00177   }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   <span class="comment">//rotation</span>
<a name="l00180"></a>00180   <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> = itemElem.attribute( <span class="stringliteral">&quot;rotation&quot;</span>, <span class="stringliteral">&quot;0&quot;</span> ).toDouble();
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="comment">//id</span>
<a name="l00183"></a>00183   <a class="code" href="classQgsComposerItem.html#a2f264b090ada171791e00407205504bc">mId</a> = itemElem.attribute( <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;&quot;</span> );
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <span class="comment">//frame</span>
<a name="l00186"></a>00186   QString <a class="code" href="classQgsComposerItem.html#a51304c279212582711c6ee2ee7902055" title="Whether this item has a frame or not.">frame</a> = itemElem.attribute( <span class="stringliteral">&quot;frame&quot;</span> );
<a name="l00187"></a>00187   <span class="keywordflow">if</span> ( frame.compare( <span class="stringliteral">&quot;true&quot;</span>, Qt::CaseInsensitive ) == 0 )
<a name="l00188"></a>00188   {
<a name="l00189"></a>00189     <a class="code" href="classQgsComposerItem.html#a84d1da234929f0918560933b4936ff22" title="True if item fram needs to be painted.">mFrame</a> = <span class="keyword">true</span>;
<a name="l00190"></a>00190   }
<a name="l00191"></a>00191   <span class="keywordflow">else</span>
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     <a class="code" href="classQgsComposerItem.html#a84d1da234929f0918560933b4936ff22" title="True if item fram needs to be painted.">mFrame</a> = <span class="keyword">false</span>;
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196   <span class="comment">//position lock for mouse moves/resizes</span>
<a name="l00197"></a>00197   QString <a class="code" href="classQgsComposerItem.html#a4b8556b2b17c0c4e1cdce96afb50c164" title="Returns position lock for mouse drags (true means locked)">positionLock</a> = itemElem.attribute( <span class="stringliteral">&quot;positionLock&quot;</span> );
<a name="l00198"></a>00198   <span class="keywordflow">if</span> ( positionLock.compare( <span class="stringliteral">&quot;true&quot;</span>, Qt::CaseInsensitive ) == 0 )
<a name="l00199"></a>00199   {
<a name="l00200"></a>00200     <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> = <span class="keyword">true</span>;
<a name="l00201"></a>00201   }
<a name="l00202"></a>00202   <span class="keywordflow">else</span>
<a name="l00203"></a>00203   {
<a name="l00204"></a>00204     <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> = <span class="keyword">false</span>;
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="comment">//position</span>
<a name="l00208"></a>00208   <span class="keywordtype">double</span> x, y, width, height;
<a name="l00209"></a>00209   <span class="keywordtype">bool</span> xOk, yOk, widthOk, heightOk;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   x = itemElem.attribute( <span class="stringliteral">&quot;x&quot;</span> ).toDouble( &amp;xOk );
<a name="l00212"></a>00212   y = itemElem.attribute( <span class="stringliteral">&quot;y&quot;</span> ).toDouble( &amp;yOk );
<a name="l00213"></a>00213   width = itemElem.attribute( <span class="stringliteral">&quot;width&quot;</span> ).toDouble( &amp;widthOk );
<a name="l00214"></a>00214   height = itemElem.attribute( <span class="stringliteral">&quot;height&quot;</span> ).toDouble( &amp;heightOk );
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="keywordflow">if</span> ( !xOk || !yOk || !widthOk || !heightOk )
<a name="l00217"></a>00217   {
<a name="l00218"></a>00218     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   <a class="code" href="classQgsComposerItem.html#a1474eb918c9d75f869a8feb202fac447" title="Backup to restore item appearance if no view scale factor is available.">mLastValidViewScaleFactor</a> = itemElem.attribute( <span class="stringliteral">&quot;lastValidViewScaleFactor&quot;</span>, <span class="stringliteral">&quot;-1&quot;</span> ).toDouble();
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721" title="Sets this items bound in scene coordinates such that 1 item size units corresponds to 1 scene size un...">setSceneRect</a>( QRectF( x, y, width, height ) );
<a name="l00224"></a>00224   setZValue( itemElem.attribute( <span class="stringliteral">&quot;zValue&quot;</span> ).toDouble() );
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="comment">//pen</span>
<a name="l00227"></a>00227   QDomNodeList frameColorList = itemElem.elementsByTagName( <span class="stringliteral">&quot;FrameColor&quot;</span> );
<a name="l00228"></a>00228   <span class="keywordflow">if</span> ( frameColorList.size() &gt; 0 )
<a name="l00229"></a>00229   {
<a name="l00230"></a>00230     QDomElement frameColorElem = frameColorList.at( 0 ).toElement();
<a name="l00231"></a>00231     <span class="keywordtype">bool</span> redOk, greenOk, blueOk, alphaOk, widthOk;
<a name="l00232"></a>00232     <span class="keywordtype">int</span> penRed, penGreen, penBlue, penAlpha;
<a name="l00233"></a>00233     <span class="keywordtype">double</span> penWidth;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235     penWidth = itemElem.attribute( <span class="stringliteral">&quot;outlineWidth&quot;</span> ).toDouble( &amp;widthOk );
<a name="l00236"></a>00236     penRed = frameColorElem.attribute( <span class="stringliteral">&quot;red&quot;</span> ).toDouble( &amp;redOk );
<a name="l00237"></a>00237     penGreen = frameColorElem.attribute( <span class="stringliteral">&quot;green&quot;</span> ).toDouble( &amp;greenOk );
<a name="l00238"></a>00238     penBlue = frameColorElem.attribute( <span class="stringliteral">&quot;blue&quot;</span> ).toDouble( &amp;blueOk );
<a name="l00239"></a>00239     penAlpha = frameColorElem.attribute( <span class="stringliteral">&quot;alpha&quot;</span> ).toDouble( &amp;alphaOk );
<a name="l00240"></a>00240     <span class="keywordflow">if</span> ( redOk &amp;&amp; greenOk &amp;&amp; blueOk &amp;&amp; alphaOk &amp;&amp; widthOk )
<a name="l00241"></a>00241     {
<a name="l00242"></a>00242       QPen framePen( QColor( penRed, penGreen, penBlue, penAlpha ) );
<a name="l00243"></a>00243       framePen.setWidthF( penWidth );
<a name="l00244"></a>00244       setPen( framePen );
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246   }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   <span class="comment">//brush</span>
<a name="l00249"></a>00249   QDomNodeList bgColorList = itemElem.elementsByTagName( <span class="stringliteral">&quot;BackgroundColor&quot;</span> );
<a name="l00250"></a>00250   <span class="keywordflow">if</span> ( bgColorList.size() &gt; 0 )
<a name="l00251"></a>00251   {
<a name="l00252"></a>00252     QDomElement bgColorElem = bgColorList.at( 0 ).toElement();
<a name="l00253"></a>00253     <span class="keywordtype">bool</span> redOk, greenOk, blueOk, alphaOk;
<a name="l00254"></a>00254     <span class="keywordtype">int</span> bgRed, bgGreen, bgBlue, bgAlpha;
<a name="l00255"></a>00255     bgRed = bgColorElem.attribute( <span class="stringliteral">&quot;red&quot;</span> ).toDouble( &amp;redOk );
<a name="l00256"></a>00256     bgGreen = bgColorElem.attribute( <span class="stringliteral">&quot;green&quot;</span> ).toDouble( &amp;greenOk );
<a name="l00257"></a>00257     bgBlue = bgColorElem.attribute( <span class="stringliteral">&quot;blue&quot;</span> ).toDouble( &amp;blueOk );
<a name="l00258"></a>00258     bgAlpha = bgColorElem.attribute( <span class="stringliteral">&quot;alpha&quot;</span> ).toDouble( &amp;alphaOk );
<a name="l00259"></a>00259     <span class="keywordflow">if</span> ( redOk &amp;&amp; greenOk &amp;&amp; blueOk &amp;&amp; alphaOk )
<a name="l00260"></a>00260     {
<a name="l00261"></a>00261       QColor brushColor( bgRed, bgGreen, bgBlue, bgAlpha );
<a name="l00262"></a>00262       setBrush( QBrush( brushColor ) );
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="classQgsComposerItem.html#a8b158255f5ae7341af8f7523bce6db14">00268</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a8b158255f5ae7341af8f7523bce6db14" title="Starts new composer undo command.">QgsComposerItem::beginCommand</a>( <span class="keyword">const</span> QString&amp; commandText, <a class="code" href="classQgsComposerMergeCommand.html#a329040dc88651356dcf1e5ba257f4fae">QgsComposerMergeCommand::Context</a> c )
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> )
<a name="l00271"></a>00271   {
<a name="l00272"></a>00272     <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#a5ba038c1c02b245047459a7131b05b13" title="Allocates new item command and saves initial state in it.">beginCommand</a>( <span class="keyword">this</span>, commandText, c );
<a name="l00273"></a>00273   }
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a><a class="code" href="classQgsComposerItem.html#a94be9646b708699b469c1a816d723ce0">00276</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a94be9646b708699b469c1a816d723ce0" title="Finish current command and push it onto the undo stack.">QgsComposerItem::endCommand</a>()
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> )
<a name="l00279"></a>00279   {
<a name="l00280"></a>00280     <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#af1410dbbfee21de9f4fe5672a9460277" title="Saves end state of item and pushes command to the undo history.">endCommand</a>();
<a name="l00281"></a>00281   }
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="classQgsComposerItem.html#ad21020b8a56408f505b41b7a05cde407">00284</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#ad21020b8a56408f505b41b7a05cde407">QgsComposerItem::cancelCommand</a>()
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> )
<a name="l00287"></a>00287   {
<a name="l00288"></a>00288     <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#abdaa289c152907410d6702d40a9210af" title="Deletes current command.">cancelCommand</a>();
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 }
<a name="l00291"></a>00291 
<a name="l00292"></a><a class="code" href="classQgsComposerItem.html#a4feb787b018b58d01f7549859ac6ea1f">00292</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a4feb787b018b58d01f7549859ac6ea1f">QgsComposerItem::mouseMoveEvent</a>( QGraphicsSceneMouseEvent * event )
<a name="l00293"></a>00293 {
<a name="l00294"></a>00294   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> )
<a name="l00295"></a>00295   {
<a name="l00296"></a>00296     <span class="keywordflow">return</span>;
<a name="l00297"></a>00297   }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299   <span class="keywordflow">if</span> ( !isSelected() )
<a name="l00300"></a>00300   {
<a name="l00301"></a>00301     <span class="keywordflow">return</span>;
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> )
<a name="l00305"></a>00305   {
<a name="l00306"></a>00306     <span class="keywordtype">double</span> diffX = <span class="keyword">event</span>-&gt;lastScenePos().x() - <a class="code" href="classQgsComposerItem.html#a7e355c3b9edcb3dd375c4c4e156b7fd9" title="Position of the last mouse move event (in scene coordinates)">mLastMouseEventPos</a>.x();
<a name="l00307"></a>00307     <span class="keywordtype">double</span> diffY = <span class="keyword">event</span>-&gt;lastScenePos().y() - <a class="code" href="classQgsComposerItem.html#a7e355c3b9edcb3dd375c4c4e156b7fd9" title="Position of the last mouse move event (in scene coordinates)">mLastMouseEventPos</a>.y();
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <a class="code" href="classQgsComposerItem.html#a6d076dba2689d7e18e0cc8584cf6e535" title="Changes the rectangle of an item depending on current mouse action (resize or move)">changeItemRectangle</a>( event-&gt;lastScenePos(), <a class="code" href="classQgsComposerItem.html#a29cbf5617d9bfdfb361813aaee5fbe0a" title="Start point of the last mouse move action (in scene coordinates)">mMouseMoveStartPos</a>, <span class="keyword">this</span>, diffX, diffY, <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> );
<a name="l00310"></a>00310   }
<a name="l00311"></a>00311   <a class="code" href="classQgsComposerItem.html#a7e355c3b9edcb3dd375c4c4e156b7fd9" title="Position of the last mouse move event (in scene coordinates)">mLastMouseEventPos</a> = <span class="keyword">event</span>-&gt;lastScenePos();
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="classQgsComposerItem.html#ac98ae758774e0f78c17997cc3d6fc1eb">00314</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#ac98ae758774e0f78c17997cc3d6fc1eb">QgsComposerItem::mousePressEvent</a>( QGraphicsSceneMouseEvent * event )
<a name="l00315"></a>00315 {
<a name="l00316"></a>00316   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> )
<a name="l00317"></a>00317   {
<a name="l00318"></a>00318     <span class="keywordflow">return</span>;
<a name="l00319"></a>00319   }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   <span class="keywordflow">if</span> ( !isSelected() )
<a name="l00322"></a>00322   {
<a name="l00323"></a>00323     <span class="keywordflow">return</span>;
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   <span class="comment">//set current position and type of mouse move action</span>
<a name="l00327"></a>00327   <a class="code" href="classQgsComposerItem.html#a29cbf5617d9bfdfb361813aaee5fbe0a" title="Start point of the last mouse move action (in scene coordinates)">mMouseMoveStartPos</a> = <span class="keyword">event</span>-&gt;lastScenePos();
<a name="l00328"></a>00328   <a class="code" href="classQgsComposerItem.html#a7e355c3b9edcb3dd375c4c4e156b7fd9" title="Position of the last mouse move event (in scene coordinates)">mLastMouseEventPos</a> = <span class="keyword">event</span>-&gt;lastScenePos();
<a name="l00329"></a>00329   <a class="code" href="classQgsComposerItem.html#a97b4faa3ad4b9f4c30df4595d74acbac">mCurrentMouseMoveAction</a> = <a class="code" href="classQgsComposerItem.html#a452925c751a2d30902dcda6ce0a5897d" title="Finds out which mouse move action to choose depending on the cursor position inside the widget...">mouseMoveActionForPosition</a>( event-&gt;pos() );
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="comment">//remove the old rubber band item if it is still there</span>
<a name="l00332"></a>00332   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> )
<a name="l00333"></a>00333   {
<a name="l00334"></a>00334     scene()-&gt;removeItem( <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> );
<a name="l00335"></a>00335     <span class="keyword">delete</span> <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>;
<a name="l00336"></a>00336     <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> = 0;
<a name="l00337"></a>00337   }
<a name="l00338"></a>00338   <span class="comment">//create and show bounding rectangle</span>
<a name="l00339"></a>00339   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> = <span class="keyword">new</span> QGraphicsRectItem( 0 );
<a name="l00340"></a>00340   scene()-&gt;addItem( <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> );
<a name="l00341"></a>00341   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>-&gt;setRect( QRectF( 0, 0, rect().width(), rect().height() ) );
<a name="l00342"></a>00342   QTransform resizeTransform;
<a name="l00343"></a>00343   resizeTransform.translate( transform().dx(), transform().dy() );
<a name="l00344"></a>00344   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>-&gt;setTransform( resizeTransform );
<a name="l00345"></a>00345 
<a name="l00346"></a>00346   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>-&gt;setBrush( Qt::NoBrush );
<a name="l00347"></a>00347   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>-&gt;setPen( QPen( QColor( 0, 0, 0 ), 0 ) );
<a name="l00348"></a>00348   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>-&gt;setZValue( 90 );
<a name="l00349"></a>00349   <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>-&gt;show();
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a><a class="code" href="classQgsComposerItem.html#a1f0a9da3fa5a8f5e322897c03a49232b">00352</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a1f0a9da3fa5a8f5e322897c03a49232b">QgsComposerItem::mouseReleaseEvent</a>( QGraphicsSceneMouseEvent * event )
<a name="l00353"></a>00353 {
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> )
<a name="l00356"></a>00356   {
<a name="l00357"></a>00357     <span class="keywordflow">return</span>;
<a name="l00358"></a>00358   }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="keywordflow">if</span> ( !isSelected() )
<a name="l00361"></a>00361   {
<a name="l00362"></a>00362     <span class="keywordflow">return</span>;
<a name="l00363"></a>00363   }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <span class="comment">//delete frame rectangle</span>
<a name="l00366"></a>00366   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> )
<a name="l00367"></a>00367   {
<a name="l00368"></a>00368     scene()-&gt;removeItem( <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> );
<a name="l00369"></a>00369     <span class="keyword">delete</span> <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a>;
<a name="l00370"></a>00370     <a class="code" href="classQgsComposerItem.html#adbcaf537f71ed9c375fc8ebdf97e1847" title="Rectangle used during move and resize actions.">mBoundingResizeRectangle</a> = 0;
<a name="l00371"></a>00371   }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   QPointF mouseMoveStopPoint = <span class="keyword">event</span>-&gt;lastScenePos();
<a name="l00374"></a>00374   <span class="keywordtype">double</span> diffX = mouseMoveStopPoint.x() - <a class="code" href="classQgsComposerItem.html#a29cbf5617d9bfdfb361813aaee5fbe0a" title="Start point of the last mouse move action (in scene coordinates)">mMouseMoveStartPos</a>.x();
<a name="l00375"></a>00375   <span class="keywordtype">double</span> diffY = mouseMoveStopPoint.y() - <a class="code" href="classQgsComposerItem.html#a29cbf5617d9bfdfb361813aaee5fbe0a" title="Start point of the last mouse move action (in scene coordinates)">mMouseMoveStartPos</a>.y();
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="comment">//it was only a click</span>
<a name="l00378"></a>00378   <span class="keywordflow">if</span> ( qAbs( diffX ) &lt; <a class="code" href="namespaceMathUtils.html#a5a39e80b84c74c7b254f7cdba6f7872a" title="returns the minimum of two doubles or the first argument if both are equal">std::numeric_limits&lt;double&gt;::min</a>() &amp;&amp; qAbs( diffY ) &lt; <a class="code" href="namespaceMathUtils.html#a5a39e80b84c74c7b254f7cdba6f7872a" title="returns the minimum of two doubles or the first argument if both are equal">std::numeric_limits&lt;double&gt;::min</a>() )
<a name="l00379"></a>00379   {
<a name="l00380"></a>00380     <span class="keywordflow">return</span>;
<a name="l00381"></a>00381   }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <a class="code" href="classQgsComposerItem.html#a8b158255f5ae7341af8f7523bce6db14" title="Starts new composer undo command.">beginCommand</a>( tr( <span class="stringliteral">&quot;Change item position&quot;</span> ) );
<a name="l00384"></a>00384   <a class="code" href="classQgsComposerItem.html#a6d076dba2689d7e18e0cc8584cf6e535" title="Changes the rectangle of an item depending on current mouse action (resize or move)">changeItemRectangle</a>( mouseMoveStopPoint, <a class="code" href="classQgsComposerItem.html#a29cbf5617d9bfdfb361813aaee5fbe0a" title="Start point of the last mouse move action (in scene coordinates)">mMouseMoveStartPos</a>, <span class="keyword">this</span>, diffX, diffY, <span class="keyword">this</span> );
<a name="l00385"></a>00385   <a class="code" href="classQgsComposerItem.html#a94be9646b708699b469c1a816d723ce0" title="Finish current command and push it onto the undo stack.">endCommand</a>();
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <span class="comment">//reset default action</span>
<a name="l00388"></a>00388   <a class="code" href="classQgsComposerItem.html#a97b4faa3ad4b9f4c30df4595d74acbac">mCurrentMouseMoveAction</a> = <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a9b2684167de0c0681863799f89d97949">QgsComposerItem::MoveItem</a>;
<a name="l00389"></a>00389   setCursor( Qt::ArrowCursor );
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="classQgsComposerItem.html#a5cbdbfc1e5fc7bc7e3000af1ddc27c9f">00392</a> Qt::CursorShape <a class="code" href="classQgsComposerItem.html#a5cbdbfc1e5fc7bc7e3000af1ddc27c9f" title="Finds out the appropriate cursor for the current mouse position in the widget (e.g.">QgsComposerItem::cursorForPosition</a>( <span class="keyword">const</span> QPointF&amp; itemCoordPos )
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534" title="Describes the action (move or resize in different directon) to be done during mouse move...">QgsComposerItem::MouseMoveAction</a> mouseAction = <a class="code" href="classQgsComposerItem.html#a452925c751a2d30902dcda6ce0a5897d" title="Finds out which mouse move action to choose depending on the cursor position inside the widget...">mouseMoveActionForPosition</a>( itemCoordPos );
<a name="l00395"></a>00395   <span class="keywordflow">switch</span> ( mouseAction )
<a name="l00396"></a>00396   {
<a name="l00397"></a>00397     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a79d24de0a406de1e5e3bb75d71fb3dd8">NoAction</a>:
<a name="l00398"></a>00398       <span class="keywordflow">return</span> Qt::ForbiddenCursor;
<a name="l00399"></a>00399     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a9b2684167de0c0681863799f89d97949">MoveItem</a>:
<a name="l00400"></a>00400       <span class="keywordflow">return</span> Qt::SizeAllCursor;
<a name="l00401"></a>00401     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ac628004ef4a33af589989fc2ba44a631">ResizeUp</a>:
<a name="l00402"></a>00402     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ac9aec2b75ebc817826e8b4648fc935f3">ResizeDown</a>:
<a name="l00403"></a>00403       <span class="keywordflow">return</span> Qt::SizeVerCursor;
<a name="l00404"></a>00404     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ae1fa0fe08ebc99ab59de9819d3c28230">ResizeLeft</a>:
<a name="l00405"></a>00405     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a3f563dfb2e94e179ffef6e0af32af8e0">ResizeRight</a>:
<a name="l00406"></a>00406       <span class="keywordflow">return</span> Qt::SizeHorCursor;
<a name="l00407"></a>00407     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a377eeab59ede5bdd956b50e36b7a7f2b">ResizeLeftUp</a>:
<a name="l00408"></a>00408     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534aa3d40e99277edc36b7c2ac21f19eef51">ResizeRightDown</a>:
<a name="l00409"></a>00409       <span class="keywordflow">return</span> Qt::SizeFDiagCursor;
<a name="l00410"></a>00410     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ab3cca47ad3fc1289e69d4d7d0df8f1e9">ResizeRightUp</a>:
<a name="l00411"></a>00411     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a78fd64e48702d3e02c885365f01b517a">ResizeLeftDown</a>:
<a name="l00412"></a>00412       <span class="keywordflow">return</span> Qt::SizeBDiagCursor;
<a name="l00413"></a>00413     <span class="keywordflow">default</span>:
<a name="l00414"></a>00414       <span class="keywordflow">return</span> Qt::ArrowCursor;
<a name="l00415"></a>00415   }
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a><a class="code" href="classQgsComposerItem.html#a452925c751a2d30902dcda6ce0a5897d">00418</a> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534" title="Describes the action (move or resize in different directon) to be done during mouse move...">QgsComposerItem::MouseMoveAction</a> <a class="code" href="classQgsComposerItem.html#a452925c751a2d30902dcda6ce0a5897d" title="Finds out which mouse move action to choose depending on the cursor position inside the widget...">QgsComposerItem::mouseMoveActionForPosition</a>( <span class="keyword">const</span> QPointF&amp; itemCoordPos )
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="comment">//no action at all if item position is locked for mouse</span>
<a name="l00422"></a>00422   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> )
<a name="l00423"></a>00423   {
<a name="l00424"></a>00424     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a79d24de0a406de1e5e3bb75d71fb3dd8">QgsComposerItem::NoAction</a>;
<a name="l00425"></a>00425   }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427   <span class="keywordtype">bool</span> nearLeftBorder = <span class="keyword">false</span>;
<a name="l00428"></a>00428   <span class="keywordtype">bool</span> nearRightBorder = <span class="keyword">false</span>;
<a name="l00429"></a>00429   <span class="keywordtype">bool</span> nearLowerBorder = <span class="keyword">false</span>;
<a name="l00430"></a>00430   <span class="keywordtype">bool</span> nearUpperBorder = <span class="keyword">false</span>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="keywordtype">double</span> borderTolerance = <a class="code" href="classQgsComposerItem.html#a420e87d2e0daa4461dab9c54cd585344" title="Returns the current (zoom level dependent) tolerance to decide if mouse position is close enough to t...">rectHandlerBorderTolerance</a>();
<a name="l00433"></a>00433 
<a name="l00434"></a>00434   <span class="keywordflow">if</span> ( itemCoordPos.x() &lt; borderTolerance )
<a name="l00435"></a>00435   {
<a name="l00436"></a>00436     nearLeftBorder = <span class="keyword">true</span>;
<a name="l00437"></a>00437   }
<a name="l00438"></a>00438   <span class="keywordflow">if</span> ( itemCoordPos.y() &lt; borderTolerance )
<a name="l00439"></a>00439   {
<a name="l00440"></a>00440     nearUpperBorder = <span class="keyword">true</span>;
<a name="l00441"></a>00441   }
<a name="l00442"></a>00442   <span class="keywordflow">if</span> ( itemCoordPos.x() &gt; ( rect().width() - borderTolerance ) )
<a name="l00443"></a>00443   {
<a name="l00444"></a>00444     nearRightBorder = <span class="keyword">true</span>;
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446   <span class="keywordflow">if</span> ( itemCoordPos.y() &gt; ( rect().height() - borderTolerance ) )
<a name="l00447"></a>00447   {
<a name="l00448"></a>00448     nearLowerBorder = <span class="keyword">true</span>;
<a name="l00449"></a>00449   }
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="keywordflow">if</span> ( nearLeftBorder &amp;&amp; nearUpperBorder )
<a name="l00452"></a>00452   {
<a name="l00453"></a>00453     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a377eeab59ede5bdd956b50e36b7a7f2b">QgsComposerItem::ResizeLeftUp</a>;
<a name="l00454"></a>00454   }
<a name="l00455"></a>00455   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearLeftBorder &amp;&amp; nearLowerBorder )
<a name="l00456"></a>00456   {
<a name="l00457"></a>00457     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a78fd64e48702d3e02c885365f01b517a">QgsComposerItem::ResizeLeftDown</a>;
<a name="l00458"></a>00458   }
<a name="l00459"></a>00459   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearRightBorder &amp;&amp; nearUpperBorder )
<a name="l00460"></a>00460   {
<a name="l00461"></a>00461     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ab3cca47ad3fc1289e69d4d7d0df8f1e9">QgsComposerItem::ResizeRightUp</a>;
<a name="l00462"></a>00462   }
<a name="l00463"></a>00463   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearRightBorder &amp;&amp; nearLowerBorder )
<a name="l00464"></a>00464   {
<a name="l00465"></a>00465     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534aa3d40e99277edc36b7c2ac21f19eef51">QgsComposerItem::ResizeRightDown</a>;
<a name="l00466"></a>00466   }
<a name="l00467"></a>00467   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearLeftBorder )
<a name="l00468"></a>00468   {
<a name="l00469"></a>00469     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ae1fa0fe08ebc99ab59de9819d3c28230">QgsComposerItem::ResizeLeft</a>;
<a name="l00470"></a>00470   }
<a name="l00471"></a>00471   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearRightBorder )
<a name="l00472"></a>00472   {
<a name="l00473"></a>00473     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a3f563dfb2e94e179ffef6e0af32af8e0">QgsComposerItem::ResizeRight</a>;
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearUpperBorder )
<a name="l00476"></a>00476   {
<a name="l00477"></a>00477     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ac628004ef4a33af589989fc2ba44a631">QgsComposerItem::ResizeUp</a>;
<a name="l00478"></a>00478   }
<a name="l00479"></a>00479   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nearLowerBorder )
<a name="l00480"></a>00480   {
<a name="l00481"></a>00481     <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ac9aec2b75ebc817826e8b4648fc935f3">QgsComposerItem::ResizeDown</a>;
<a name="l00482"></a>00482   }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a9b2684167de0c0681863799f89d97949">QgsComposerItem::MoveItem</a>; <span class="comment">//default</span>
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00487"></a><a class="code" href="classQgsComposerItem.html#a6d076dba2689d7e18e0cc8584cf6e535">00487</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a6d076dba2689d7e18e0cc8584cf6e535" title="Changes the rectangle of an item depending on current mouse action (resize or move)">QgsComposerItem::changeItemRectangle</a>( <span class="keyword">const</span> QPointF&amp; currentPosition,
<a name="l00488"></a>00488     <span class="keyword">const</span> QPointF&amp; mouseMoveStartPos,
<a name="l00489"></a>00489     <span class="keyword">const</span> QGraphicsRectItem* originalItem,
<a name="l00490"></a>00490     <span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy,
<a name="l00491"></a>00491     QGraphicsRectItem* changeItem )
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493   Q_UNUSED( dx );
<a name="l00494"></a>00494   Q_UNUSED( dy );
<a name="l00495"></a>00495   <span class="keywordflow">if</span> ( !changeItem || !originalItem || !<a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> )
<a name="l00496"></a>00496   {
<a name="l00497"></a>00497     <span class="keywordflow">return</span>;
<a name="l00498"></a>00498   }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <span class="comment">//test if change item is a composer item. If so, prefer call to  setSceneRect() instead of setTransform() and setRect()</span>
<a name="l00501"></a>00501   <a class="code" href="classQgsComposerItem.html" title="A item that forms part of a map composition.">QgsComposerItem</a>* changeComposerItem = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classQgsComposerItem.html" title="A item that forms part of a map composition.">QgsComposerItem</a> *<span class="keyword">&gt;</span>( changeItem );
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keywordtype">double</span> mx = 0.0, my = 0.0, rx = 0.0, ry = 0.0;
<a name="l00504"></a>00504   QPointF snappedPosition = <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#ada2e2b294e4dd9504950f935b43de1b3" title="Snaps a scene coordinate point to grid.">snapPointToGrid</a>( currentPosition );
<a name="l00505"></a>00505   <span class="comment">//double diffX = snappedPosition.x() - mouseMoveStartPos.x();</span>
<a name="l00506"></a>00506   <span class="comment">//double diffY = snappedPosition.y() - mouseMoveStartPos.y();</span>
<a name="l00507"></a>00507   <span class="keywordtype">double</span> diffX = 0;
<a name="l00508"></a>00508   <span class="keywordtype">double</span> diffY = 0;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="keywordflow">switch</span> ( <a class="code" href="classQgsComposerItem.html#a97b4faa3ad4b9f4c30df4595d74acbac">mCurrentMouseMoveAction</a> )
<a name="l00511"></a>00511   {
<a name="l00512"></a>00512       <span class="comment">//vertical resize</span>
<a name="l00513"></a>00513     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ac628004ef4a33af589989fc2ba44a631">QgsComposerItem::ResizeUp</a>:
<a name="l00514"></a>00514       diffY = snappedPosition.y() - originalItem-&gt;transform().dy();
<a name="l00515"></a>00515       mx = 0; my = diffY; rx = 0; ry = -diffY;
<a name="l00516"></a>00516       <span class="keywordflow">break</span>;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ac9aec2b75ebc817826e8b4648fc935f3">QgsComposerItem::ResizeDown</a>:
<a name="l00519"></a>00519       diffY = snappedPosition.y() - ( originalItem-&gt;transform().dy() + originalItem-&gt;rect().height() );
<a name="l00520"></a>00520       mx = 0; my = 0; rx = 0; ry = diffY;
<a name="l00521"></a>00521       <span class="keywordflow">break</span>;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523       <span class="comment">//horizontal resize</span>
<a name="l00524"></a>00524     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ae1fa0fe08ebc99ab59de9819d3c28230">QgsComposerItem::ResizeLeft</a>:
<a name="l00525"></a>00525       diffX = snappedPosition.x() - originalItem-&gt;transform().dx();
<a name="l00526"></a>00526       mx = diffX, my = 0; rx = -diffX; ry = 0;
<a name="l00527"></a>00527       <span class="keywordflow">break</span>;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a3f563dfb2e94e179ffef6e0af32af8e0">QgsComposerItem::ResizeRight</a>:
<a name="l00530"></a>00530       diffX = snappedPosition.x() - ( originalItem-&gt;transform().dx() + originalItem-&gt;rect().width() );
<a name="l00531"></a>00531       mx = 0; my = 0; rx = diffX, ry = 0;
<a name="l00532"></a>00532       <span class="keywordflow">break</span>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       <span class="comment">//diagonal resize</span>
<a name="l00535"></a>00535     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a377eeab59ede5bdd956b50e36b7a7f2b">QgsComposerItem::ResizeLeftUp</a>:
<a name="l00536"></a>00536       diffX = snappedPosition.x() - originalItem-&gt;transform().dx();
<a name="l00537"></a>00537       diffY = snappedPosition.y() - originalItem-&gt;transform().dy();
<a name="l00538"></a>00538       mx = diffX, my = diffY; rx = -diffX; ry = -diffY;
<a name="l00539"></a>00539       <span class="keywordflow">break</span>;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534aa3d40e99277edc36b7c2ac21f19eef51">QgsComposerItem::ResizeRightDown</a>:
<a name="l00542"></a>00542       diffX = snappedPosition.x() - ( originalItem-&gt;transform().dx() + originalItem-&gt;rect().width() );
<a name="l00543"></a>00543       diffY = snappedPosition.y() - ( originalItem-&gt;transform().dy() + originalItem-&gt;rect().height() );
<a name="l00544"></a>00544       mx = 0; my = 0; rx = diffX, ry = diffY;
<a name="l00545"></a>00545       <span class="keywordflow">break</span>;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534ab3cca47ad3fc1289e69d4d7d0df8f1e9">QgsComposerItem::ResizeRightUp</a>:
<a name="l00548"></a>00548       diffX = snappedPosition.x() - ( originalItem-&gt;transform().dx() + originalItem-&gt;rect().width() );
<a name="l00549"></a>00549       diffY = snappedPosition.y() - originalItem-&gt;transform().dy();
<a name="l00550"></a>00550       mx = 0; my = diffY, rx = diffX, ry = -diffY;
<a name="l00551"></a>00551       <span class="keywordflow">break</span>;
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a78fd64e48702d3e02c885365f01b517a">QgsComposerItem::ResizeLeftDown</a>:
<a name="l00554"></a>00554       diffX = snappedPosition.x() - originalItem-&gt;transform().dx();
<a name="l00555"></a>00555       diffY = snappedPosition.y() - ( originalItem-&gt;transform().dy() + originalItem-&gt;rect().height() );
<a name="l00556"></a>00556       mx = diffX, my = 0; rx = -diffX; ry = diffY;
<a name="l00557"></a>00557       <span class="keywordflow">break</span>;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a9b2684167de0c0681863799f89d97949">QgsComposerItem::MoveItem</a>:
<a name="l00560"></a>00560     {
<a name="l00561"></a>00561       <span class="comment">//calculate total move difference</span>
<a name="l00562"></a>00562       <span class="keywordtype">double</span> moveX = currentPosition.x() - mouseMoveStartPos.x();
<a name="l00563"></a>00563       <span class="keywordtype">double</span> moveY = currentPosition.y() - mouseMoveStartPos.y();
<a name="l00564"></a>00564 
<a name="l00565"></a>00565       QPointF upperLeftPoint( originalItem-&gt;transform().dx() + moveX, originalItem-&gt;transform().dy() + moveY );
<a name="l00566"></a>00566       QPointF snappedLeftPoint = <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#ada2e2b294e4dd9504950f935b43de1b3" title="Snaps a scene coordinate point to grid.">snapPointToGrid</a>( upperLeftPoint );
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       <span class="keywordtype">double</span> moveRectX = snappedLeftPoint.x() - originalItem-&gt;transform().dx();
<a name="l00569"></a>00569       <span class="keywordtype">double</span> moveRectY = snappedLeftPoint.y() - originalItem-&gt;transform().dy();
<a name="l00570"></a>00570 
<a name="l00571"></a>00571       <span class="keywordflow">if</span> ( !changeComposerItem )
<a name="l00572"></a>00572       {
<a name="l00573"></a>00573         QTransform moveTransform;
<a name="l00574"></a>00574         moveTransform.translate( originalItem-&gt;transform().dx() + moveRectX, originalItem-&gt;transform().dy() + moveRectY );
<a name="l00575"></a>00575         changeItem-&gt;setTransform( moveTransform );
<a name="l00576"></a>00576       }
<a name="l00577"></a>00577       <span class="keywordflow">else</span>  <span class="comment">//for composer items, we prefer setSceneRect as subclasses can implement custom behaviour (e.g. item group)</span>
<a name="l00578"></a>00578       {
<a name="l00579"></a>00579         changeComposerItem-&gt;<a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721" title="Sets this items bound in scene coordinates such that 1 item size units corresponds to 1 scene size un...">setSceneRect</a>( QRectF( originalItem-&gt;transform().dx() + moveRectX,
<a name="l00580"></a>00580                                           originalItem-&gt;transform().dy() + moveRectY,
<a name="l00581"></a>00581                                           originalItem-&gt;rect().width(), originalItem-&gt;rect().height() ) );
<a name="l00582"></a>00582         changeComposerItem-&gt;<a class="code" href="classQgsComposerItem.html#a2115127bc69b566af696766cae73defc" title="Updates item, with the possibility to do custom update for subclasses.">updateItem</a>();
<a name="l00583"></a>00583       }
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585     <span class="keywordflow">return</span>;
<a name="l00586"></a>00586     <span class="keywordflow">case</span> <a class="code" href="classQgsComposerItem.html#af37286455b9dccda5206913532986534a79d24de0a406de1e5e3bb75d71fb3dd8">QgsComposerItem::NoAction</a>:
<a name="l00587"></a>00587       <span class="keywordflow">break</span>;
<a name="l00588"></a>00588   }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="keywordflow">if</span> ( !changeComposerItem )
<a name="l00591"></a>00591   {
<a name="l00592"></a>00592     QTransform itemTransform;
<a name="l00593"></a>00593     itemTransform.translate( originalItem-&gt;transform().dx() + mx, originalItem-&gt;transform().dy() + my );
<a name="l00594"></a>00594     changeItem-&gt;setTransform( itemTransform );
<a name="l00595"></a>00595     QRectF itemRect( 0, 0, originalItem-&gt;rect().width() + rx,  originalItem-&gt;rect().height() + ry );
<a name="l00596"></a>00596     changeItem-&gt;setRect( itemRect );
<a name="l00597"></a>00597   }
<a name="l00598"></a>00598   <span class="keywordflow">else</span> <span class="comment">//for composer items, we prefer setSceneRect as subclasses can implement custom behaviour (e.g. item group)</span>
<a name="l00599"></a>00599   {
<a name="l00600"></a>00600     changeComposerItem-&gt;<a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721" title="Sets this items bound in scene coordinates such that 1 item size units corresponds to 1 scene size un...">setSceneRect</a>( QRectF( originalItem-&gt;transform().dx() + mx, originalItem-&gt;transform().dy() + my,
<a name="l00601"></a>00601                                       originalItem-&gt;rect().width() + rx, originalItem-&gt;rect().height() + ry ) );
<a name="l00602"></a>00602     changeComposerItem-&gt;<a class="code" href="classQgsComposerItem.html#a2115127bc69b566af696766cae73defc" title="Updates item, with the possibility to do custom update for subclasses.">updateItem</a>();
<a name="l00603"></a>00603   }
<a name="l00604"></a>00604 }
<a name="l00605"></a>00605 
<a name="l00606"></a><a class="code" href="classQgsComposerItem.html#a3dcdb50ea8569d3f30ded5cb71c8af85">00606</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a3dcdb50ea8569d3f30ded5cb71c8af85" title="Draw selection boxes around item.">QgsComposerItem::drawSelectionBoxes</a>( QPainter* p )
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a> )
<a name="l00609"></a>00609   {
<a name="l00610"></a>00610     <span class="keywordflow">return</span>;
<a name="l00611"></a>00611   }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ab1959d11ac7e03968720940814a0c912">mComposition</a>-&gt;<a class="code" href="classQgsComposition.html#ad111d728fe5cbdc7d35fc1c3511bbd3f">plotStyle</a>() == <a class="code" href="classQgsComposition.html#a781e9904ed2424387b4af5a0cefeeb63a98d3bcc2687df9cf8ed29cf14091aec0">QgsComposition::Preview</a> )
<a name="l00614"></a>00614   {
<a name="l00615"></a>00615     <span class="comment">//size of symbol boxes depends on zoom level in composer view</span>
<a name="l00616"></a>00616     <span class="keywordtype">double</span> rectHandlerSize = <a class="code" href="classQgsComposerItem.html#a420e87d2e0daa4461dab9c54cd585344" title="Returns the current (zoom level dependent) tolerance to decide if mouse position is close enough to t...">rectHandlerBorderTolerance</a>();
<a name="l00617"></a>00617     <span class="keywordtype">double</span> sizeLockSymbol = <a class="code" href="classQgsComposerItem.html#a5714bd6b1731494024a20015c99526cd" title="Returns the size of the lock symbol depending on the composer zoom level and the item size...">lockSymbolSize</a>();
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#ac002ee5d0ab5a24edc69eae86a7cd675" title="True if item position and size cannot be changed with mouse move.">mItemPositionLocked</a> )
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621       <span class="comment">//draw lock symbol at upper left edge. Use QImage to be independent of the graphic system</span>
<a name="l00622"></a>00622       QString lockIconPath = <a class="code" href="classQgsApplication.html#a29d8cdc3a25ac133c9a759a8c406435e" title="Returns the path to the currently active theme directory.">QgsApplication::activeThemePath</a>() + <span class="stringliteral">&quot;/mIconLock.png&quot;</span>;
<a name="l00623"></a>00623       <span class="keywordflow">if</span> ( !QFile::exists( lockIconPath ) )
<a name="l00624"></a>00624       {
<a name="l00625"></a>00625         lockIconPath = <a class="code" href="classQgsApplication.html#a470df054c4bfa22e0b9a9481c49b0f97" title="Returns the path to the default theme directory.">QgsApplication::defaultThemePath</a>() + <span class="stringliteral">&quot;/mIconLock.png&quot;</span>;
<a name="l00626"></a>00626       }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628       QImage lockImage( lockIconPath );
<a name="l00629"></a>00629       <span class="keywordflow">if</span> ( !lockImage.isNull() )
<a name="l00630"></a>00630       {
<a name="l00631"></a>00631         p-&gt;drawImage( QRectF( 0, 0, sizeLockSymbol, sizeLockSymbol ), lockImage, QRectF( 0, 0, lockImage.width(), lockImage.height() ) );
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633     }
<a name="l00634"></a>00634     <span class="keywordflow">else</span> <span class="comment">//draw blue squares</span>
<a name="l00635"></a>00635     {
<a name="l00636"></a>00636       p-&gt;setPen( QColor( 50, 100, 120, 200 ) );
<a name="l00637"></a>00637       p-&gt;setBrush( QColor( 200, 200, 210, 120 ) );
<a name="l00638"></a>00638       p-&gt;drawRect( QRectF( 0, 0, rectHandlerSize, rectHandlerSize ) );
<a name="l00639"></a>00639       p-&gt;drawRect( QRectF( rect().width() - rectHandlerSize, 0, rectHandlerSize, rectHandlerSize ) );
<a name="l00640"></a>00640       p-&gt;drawRect( QRectF( rect().width() - rectHandlerSize, rect().height() - rectHandlerSize, rectHandlerSize, rectHandlerSize ) );
<a name="l00641"></a>00641       p-&gt;drawRect( QRectF( 0, rect().height() - rectHandlerSize, rectHandlerSize, rectHandlerSize ) );
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643   }
<a name="l00644"></a>00644 }
<a name="l00645"></a>00645 
<a name="l00646"></a><a class="code" href="classQgsComposerItem.html#aae8ec9db0e2823528e2657d90d0c2559">00646</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#aae8ec9db0e2823528e2657d90d0c2559" title="Draw black frame around item.">QgsComposerItem::drawFrame</a>( QPainter* p )
<a name="l00647"></a>00647 {
<a name="l00648"></a>00648   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#a84d1da234929f0918560933b4936ff22" title="True if item fram needs to be painted.">mFrame</a> &amp;&amp; p )
<a name="l00649"></a>00649   {
<a name="l00650"></a>00650     p-&gt;setPen( pen() );
<a name="l00651"></a>00651     p-&gt;setBrush( Qt::NoBrush );
<a name="l00652"></a>00652     p-&gt;setRenderHint( QPainter::Antialiasing, <span class="keyword">true</span> );
<a name="l00653"></a>00653     p-&gt;drawRect( QRectF( 0, 0, rect().width(), rect().height() ) );
<a name="l00654"></a>00654   }
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="classQgsComposerItem.html#ac13597c49f497e2f2b2273db96da75c6">00657</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#ac13597c49f497e2f2b2273db96da75c6" title="Moves item in canvas coordinates.">QgsComposerItem::move</a>( <span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy )
<a name="l00658"></a>00658 {
<a name="l00659"></a>00659   QTransform t = transform();
<a name="l00660"></a>00660   QRectF newSceneRect( t.dx() + dx, t.dy() + dy, rect().width(), rect().height() );
<a name="l00661"></a>00661   <a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721" title="Sets this items bound in scene coordinates such that 1 item size units corresponds to 1 scene size un...">setSceneRect</a>( newSceneRect );
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a><a class="code" href="classQgsComposerItem.html#abc1ef7713140b085f214330aaf7dd6b8">00664</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#abc1ef7713140b085f214330aaf7dd6b8" title="Moves the item to a new position (in canvas coordinates)">QgsComposerItem::setItemPosition</a>( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8">ItemPositionMode</a> itemPoint )
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666   <span class="keywordtype">double</span> width = rect().width();
<a name="l00667"></a>00667   <span class="keywordtype">double</span> height = rect().height();
<a name="l00668"></a>00668   <a class="code" href="classQgsComposerItem.html#abc1ef7713140b085f214330aaf7dd6b8" title="Moves the item to a new position (in canvas coordinates)">setItemPosition</a>( x, y, width, height, itemPoint );
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a><a class="code" href="classQgsComposerItem.html#a6ed11becc557a458a1843351be5d2829">00671</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#abc1ef7713140b085f214330aaf7dd6b8" title="Moves the item to a new position (in canvas coordinates)">QgsComposerItem::setItemPosition</a>( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> width, <span class="keywordtype">double</span> height, <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8">ItemPositionMode</a> itemPoint )
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673   <span class="keywordtype">double</span> upperLeftX = x;
<a name="l00674"></a>00674   <span class="keywordtype">double</span> upperLeftY = y;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676   <span class="comment">//adjust x-coordinate if placement is not done to a left point</span>
<a name="l00677"></a>00677   <span class="keywordflow">if</span> ( itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8a7a134d65ec8655bf13cd963d579f677f">UpperMiddle</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8a39113117c190125b53bc56cf690b6560">Middle</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8af25f77605e64fbbfdc90f66daaeea509">LowerMiddle</a> )
<a name="l00678"></a>00678   {
<a name="l00679"></a>00679     upperLeftX -= width / 2.0;
<a name="l00680"></a>00680   }
<a name="l00681"></a>00681   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8a6fff238542311655e7a7d84c9056e12e">UpperRight</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8ae7f3fa967434177671fbfa832ce0261c">MiddleRight</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8aab7be0a30bb6641c160ef606512723bc">LowerRight</a> )
<a name="l00682"></a>00682   {
<a name="l00683"></a>00683     upperLeftX -= width;
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="comment">//adjust y-coordinate if placement is not done to an upper point</span>
<a name="l00687"></a>00687   <span class="keywordflow">if</span> ( itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8ae8a2694a562d2edc84ab933df6038e67">MiddleLeft</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8a39113117c190125b53bc56cf690b6560">Middle</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8ae7f3fa967434177671fbfa832ce0261c">MiddleRight</a> )
<a name="l00688"></a>00688   {
<a name="l00689"></a>00689     upperLeftY -= height / 2.0;
<a name="l00690"></a>00690   }
<a name="l00691"></a>00691   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8a410ee3154b557e539a456c0e7cad30bd">LowerLeft</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8af25f77605e64fbbfdc90f66daaeea509">LowerMiddle</a> || itemPoint == <a class="code" href="classQgsComposerItem.html#af59c6221f8cbef9c78cb7a1b675c5dc8aab7be0a30bb6641c160ef606512723bc">LowerRight</a> )
<a name="l00692"></a>00692   {
<a name="l00693"></a>00693     upperLeftY -= height;
<a name="l00694"></a>00694   }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721" title="Sets this items bound in scene coordinates such that 1 item size units corresponds to 1 scene size un...">setSceneRect</a>( QRectF( upperLeftX, upperLeftY, width, height ) );
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a><a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721">00699</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a940bc3adc0eeb367f74514eebbd28721" title="Sets this items bound in scene coordinates such that 1 item size units corresponds to 1 scene size un...">QgsComposerItem::setSceneRect</a>( <span class="keyword">const</span> QRectF&amp; rectangle )
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701   <span class="comment">//setRect in item coordinates</span>
<a name="l00702"></a>00702   <span class="keywordtype">double</span> newWidth = rectangle.width();
<a name="l00703"></a>00703   <span class="keywordtype">double</span> newHeight = rectangle.height();
<a name="l00704"></a>00704   <span class="keywordtype">double</span> xTranslation = rectangle.x();
<a name="l00705"></a>00705   <span class="keywordtype">double</span> yTranslation = rectangle.y();
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   <span class="comment">//correction if width and/or height are negative</span>
<a name="l00708"></a>00708   <span class="keywordflow">if</span> ( rectangle.width() &lt; 0 )
<a name="l00709"></a>00709   {
<a name="l00710"></a>00710     newWidth = - rectangle.width();
<a name="l00711"></a>00711     xTranslation -= newWidth;
<a name="l00712"></a>00712   }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="keywordflow">if</span> ( rectangle.height() &lt; 0 )
<a name="l00715"></a>00715   {
<a name="l00716"></a>00716     newHeight = - rectangle.height();
<a name="l00717"></a>00717     yTranslation -= newHeight;
<a name="l00718"></a>00718   }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720   QRectF newRect( 0, 0, newWidth, newHeight );
<a name="l00721"></a>00721   QGraphicsRectItem::setRect( newRect );
<a name="l00722"></a>00722 
<a name="l00723"></a>00723   <span class="comment">//set up transformation matrix for item coordinates</span>
<a name="l00724"></a>00724   QTransform t;
<a name="l00725"></a>00725   t.translate( xTranslation, yTranslation );
<a name="l00726"></a>00726   setTransform( t );
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a><a class="code" href="classQgsComposerItem.html#ac1e47e1155ea3f4a60cebaf0cb4aef04">00729</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#ac1e47e1155ea3f4a60cebaf0cb4aef04" title="Draw background.">QgsComposerItem::drawBackground</a>( QPainter* p )
<a name="l00730"></a>00730 {
<a name="l00731"></a>00731   <span class="keywordflow">if</span> ( p )
<a name="l00732"></a>00732   {
<a name="l00733"></a>00733     p-&gt;setBrush( brush() );
<a name="l00734"></a>00734     p-&gt;setPen( Qt::NoPen );
<a name="l00735"></a>00735     p-&gt;setRenderHint( QPainter::Antialiasing, <span class="keyword">true</span> );
<a name="l00736"></a>00736     p-&gt;drawRect( QRectF( 0, 0, rect().width(), rect().height() ) );
<a name="l00737"></a>00737   }
<a name="l00738"></a>00738 }
<a name="l00739"></a>00739 
<a name="l00740"></a><a class="code" href="classQgsComposerItem.html#aa128244bd87dc751df3fab9922323dd7">00740</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#aa128244bd87dc751df3fab9922323dd7">QgsComposerItem::hoverMoveEvent</a>( QGraphicsSceneHoverEvent * event )
<a name="l00741"></a>00741 {
<a name="l00742"></a>00742   <span class="keywordflow">if</span> ( isSelected() )
<a name="l00743"></a>00743   {
<a name="l00744"></a>00744     setCursor( <a class="code" href="classQgsComposerItem.html#a5cbdbfc1e5fc7bc7e3000af1ddc27c9f" title="Finds out the appropriate cursor for the current mouse position in the widget (e.g.">cursorForPosition</a>( event-&gt;pos() ) );
<a name="l00745"></a>00745   }
<a name="l00746"></a>00746   <span class="keywordflow">else</span>
<a name="l00747"></a>00747   {
<a name="l00748"></a>00748     setCursor( Qt::ArrowCursor );
<a name="l00749"></a>00749   }
<a name="l00750"></a>00750 }
<a name="l00751"></a>00751 
<a name="l00752"></a><a class="code" href="classQgsComposerItem.html#a04f7752e953054161713339e4280e00a">00752</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a04f7752e953054161713339e4280e00a" title="Draws Text.">QgsComposerItem::drawText</a>( QPainter* p, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keyword">const</span> QString&amp; text, <span class="keyword">const</span> QFont&amp; font )<span class="keyword"> const</span>
<a name="l00753"></a>00753 <span class="keyword"></span>{
<a name="l00754"></a>00754   QFont textFont = <a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf" title="Returns a font where size is in pixel and font size is upscaled with FONT_WORKAROUND_SCALE.">scaledFontPixelSize</a>( font );
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   p-&gt;save();
<a name="l00757"></a>00757   p-&gt;setFont( textFont );
<a name="l00758"></a>00758   p-&gt;setPen( QColor( 0, 0, 0 ) ); <span class="comment">//draw text always in black</span>
<a name="l00759"></a>00759   <span class="keywordtype">double</span> scaleFactor = 1.0 / <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a>;
<a name="l00760"></a>00760   p-&gt;scale( scaleFactor, scaleFactor );
<a name="l00761"></a>00761   p-&gt;drawText( QPointF( x * <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a>, y * FONT_WORKAROUND_SCALE ), text );
<a name="l00762"></a>00762   p-&gt;restore();
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="classQgsComposerItem.html#a0e35436884d335b3e929c765bad51a56">00765</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a04f7752e953054161713339e4280e00a" title="Draws Text.">QgsComposerItem::drawText</a>( QPainter* p, <span class="keyword">const</span> QRectF&amp; rect, <span class="keyword">const</span> QString&amp; text, <span class="keyword">const</span> QFont&amp; font, Qt::AlignmentFlag halignement, Qt::AlignmentFlag valignment )<span class="keyword"> const</span>
<a name="l00766"></a>00766 <span class="keyword"></span>{
<a name="l00767"></a>00767   QFont textFont = <a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf" title="Returns a font where size is in pixel and font size is upscaled with FONT_WORKAROUND_SCALE.">scaledFontPixelSize</a>( font );
<a name="l00768"></a>00768 
<a name="l00769"></a>00769   QRectF scaledRect( rect.x() * <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a>, rect.y() * <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a>,
<a name="l00770"></a>00770                      rect.width() * <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a>, rect.height() * <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a> );
<a name="l00771"></a>00771 
<a name="l00772"></a>00772   p-&gt;save();
<a name="l00773"></a>00773   p-&gt;setFont( textFont );
<a name="l00774"></a>00774   <span class="keywordtype">double</span> scaleFactor = 1.0 / <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a>;
<a name="l00775"></a>00775   p-&gt;scale( scaleFactor, scaleFactor );
<a name="l00776"></a>00776   p-&gt;drawText( scaledRect, halignement | valignment | Qt::TextWordWrap, text );
<a name="l00777"></a>00777   p-&gt;restore();
<a name="l00778"></a>00778 }
<a name="l00779"></a><a class="code" href="classQgsComposerItem.html#aebdc00b745aeb90adde6ca4ae42417b4">00779</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#aebdc00b745aeb90adde6ca4ae42417b4" title="Draws arrowhead.">QgsComposerItem::drawArrowHead</a>( QPainter* p, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#ad8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)">angle</a>, <span class="keywordtype">double</span> arrowHeadWidth )<span class="keyword"> const</span>
<a name="l00780"></a>00780 <span class="keyword"></span>{
<a name="l00781"></a>00781   <span class="keywordflow">if</span> ( !p )
<a name="l00782"></a>00782   {
<a name="l00783"></a>00783     <span class="keywordflow">return</span>;
<a name="l00784"></a>00784   }
<a name="l00785"></a>00785   <span class="keywordtype">double</span> angleRad = angle / 180.0 * <a class="code" href="qgsdistancearea_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l00786"></a>00786   QPointF middlePoint( x, y );
<a name="l00787"></a>00787   <span class="comment">//rotate both arrow points</span>
<a name="l00788"></a>00788   QPointF p1 = QPointF( -arrowHeadWidth / 2.0, arrowHeadWidth );
<a name="l00789"></a>00789   QPointF p2 = QPointF( arrowHeadWidth / 2.0, arrowHeadWidth );
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   QPointF p1Rotated, p2Rotated;
<a name="l00792"></a>00792   p1Rotated.setX( p1.x() * cos( angleRad ) + p1.y() * -sin( angleRad ) );
<a name="l00793"></a>00793   p1Rotated.setY( p1.x() * sin( angleRad ) + p1.y() * cos( angleRad ) );
<a name="l00794"></a>00794   p2Rotated.setX( p2.x() * cos( angleRad ) + p2.y() * -sin( angleRad ) );
<a name="l00795"></a>00795   p2Rotated.setY( p2.x() * sin( angleRad ) + p2.y() * cos( angleRad ) );
<a name="l00796"></a>00796 
<a name="l00797"></a>00797   QPolygonF arrowHeadPoly;
<a name="l00798"></a>00798   arrowHeadPoly &lt;&lt; middlePoint;
<a name="l00799"></a>00799   arrowHeadPoly &lt;&lt; QPointF( middlePoint.x() + p1Rotated.x(), middlePoint.y() + p1Rotated.y() );
<a name="l00800"></a>00800   arrowHeadPoly &lt;&lt; QPointF( middlePoint.x() + p2Rotated.x(), middlePoint.y() + p2Rotated.y() );
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   p-&gt;save();
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   QPen arrowPen = p-&gt;pen();
<a name="l00805"></a>00805   arrowPen.setJoinStyle( Qt::RoundJoin );
<a name="l00806"></a>00806   QBrush arrowBrush = p-&gt;brush();
<a name="l00807"></a>00807   arrowBrush.setStyle( Qt::SolidPattern );
<a name="l00808"></a>00808   p-&gt;setPen( arrowPen );
<a name="l00809"></a>00809   p-&gt;setBrush( arrowBrush );
<a name="l00810"></a>00810   arrowBrush.setStyle( Qt::SolidPattern );
<a name="l00811"></a>00811   p-&gt;drawPolygon( arrowHeadPoly );
<a name="l00812"></a>00812 
<a name="l00813"></a>00813   p-&gt;restore();
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a><a class="code" href="classQgsComposerItem.html#a9e3bd8de1bd84db97fe0446a74d1af57">00816</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a9e3bd8de1bd84db97fe0446a74d1af57" title="Returns the font width in millimeters (considers upscaling and downscaling with FONT_WORKAROUND_SCALE...">QgsComposerItem::textWidthMillimeters</a>( <span class="keyword">const</span> QFont&amp; font, <span class="keyword">const</span> QString&amp; text )<span class="keyword"> const</span>
<a name="l00817"></a>00817 <span class="keyword"></span>{
<a name="l00818"></a>00818   QFont metricsFont = <a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf" title="Returns a font where size is in pixel and font size is upscaled with FONT_WORKAROUND_SCALE.">scaledFontPixelSize</a>( font );
<a name="l00819"></a>00819   QFontMetrics fontMetrics( metricsFont );
<a name="l00820"></a>00820   <span class="keywordflow">return</span> ( fontMetrics.width( text ) / <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a> );
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a><a class="code" href="classQgsComposerItem.html#a325b4ff315aba7bac8c7ef0287fbd6fe">00823</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a325b4ff315aba7bac8c7ef0287fbd6fe" title="Returns the font height of a character in millimeters.">QgsComposerItem::fontHeightCharacterMM</a>( <span class="keyword">const</span> QFont&amp; font, <span class="keyword">const</span> QChar&amp; c )<span class="keyword"> const</span>
<a name="l00824"></a>00824 <span class="keyword"></span>{
<a name="l00825"></a>00825   QFont metricsFont = <a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf" title="Returns a font where size is in pixel and font size is upscaled with FONT_WORKAROUND_SCALE.">scaledFontPixelSize</a>( font );
<a name="l00826"></a>00826   QFontMetricsF fontMetrics( metricsFont );
<a name="l00827"></a>00827   <span class="keywordflow">return</span> ( fontMetrics.boundingRect( c ).height() / <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a> );
<a name="l00828"></a>00828 }
<a name="l00829"></a>00829 
<a name="l00830"></a><a class="code" href="classQgsComposerItem.html#ab9aff68cdc2378b3c532a676301a1e9b">00830</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#ab9aff68cdc2378b3c532a676301a1e9b" title="Returns the font ascent in Millimeters (considers upscaling and downscaling with FONT_WORKAROUND_SCAL...">QgsComposerItem::fontAscentMillimeters</a>( <span class="keyword">const</span> QFont&amp; font )<span class="keyword"> const</span>
<a name="l00831"></a>00831 <span class="keyword"></span>{
<a name="l00832"></a>00832   QFont metricsFont = <a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf" title="Returns a font where size is in pixel and font size is upscaled with FONT_WORKAROUND_SCALE.">scaledFontPixelSize</a>( font );
<a name="l00833"></a>00833   QFontMetricsF fontMetrics( metricsFont );
<a name="l00834"></a>00834   <span class="keywordflow">return</span> ( fontMetrics.ascent() / <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a> );
<a name="l00835"></a>00835 }
<a name="l00836"></a>00836 
<a name="l00837"></a><a class="code" href="classQgsComposerItem.html#a4656e6790a6bf2a80c97b3d97166f83c">00837</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a4656e6790a6bf2a80c97b3d97166f83c" title="Calculates font to from point size to pixel size.">QgsComposerItem::pixelFontSize</a>( <span class="keywordtype">double</span> pointSize )<span class="keyword"> const</span>
<a name="l00838"></a>00838 <span class="keyword"></span>{
<a name="l00839"></a>00839   <span class="keywordflow">return</span> ( pointSize * 0.3527 );
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00842"></a><a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf">00842</a> QFont <a class="code" href="classQgsComposerItem.html#abcd44ec7c9c9d4799dda59fbca8453cf" title="Returns a font where size is in pixel and font size is upscaled with FONT_WORKAROUND_SCALE.">QgsComposerItem::scaledFontPixelSize</a>( <span class="keyword">const</span> QFont&amp; font )<span class="keyword"> const</span>
<a name="l00843"></a>00843 <span class="keyword"></span>{
<a name="l00844"></a>00844   QFont scaledFont = font;
<a name="l00845"></a>00845   <span class="keywordtype">double</span> pixelSize = <a class="code" href="classQgsComposerItem.html#a4656e6790a6bf2a80c97b3d97166f83c" title="Calculates font to from point size to pixel size.">pixelFontSize</a>( font.pointSizeF() ) * <a class="code" href="qgscomposeritem_8cpp.html#a8b00fdb80585f5cbdc132db0e7ea6f22">FONT_WORKAROUND_SCALE</a> + 0.5;
<a name="l00846"></a>00846   scaledFont.setPixelSize( pixelSize );
<a name="l00847"></a>00847   <span class="keywordflow">return</span> scaledFont;
<a name="l00848"></a>00848 }
<a name="l00849"></a>00849 
<a name="l00850"></a><a class="code" href="classQgsComposerItem.html#a15ed581faea19b6766dcf44f05445bcf">00850</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a15ed581faea19b6766dcf44f05445bcf" title="Returns angle of the line from p1 to p2 (clockwise, starting at N)">QgsComposerItem::angle</a>( <span class="keyword">const</span> QPointF&amp; p1, <span class="keyword">const</span> QPointF&amp; p2 )<span class="keyword"> const</span>
<a name="l00851"></a>00851 <span class="keyword"></span>{
<a name="l00852"></a>00852   <span class="keywordtype">double</span> xDiff = p2.x() - p1.x();
<a name="l00853"></a>00853   <span class="keywordtype">double</span> yDiff = p2.y() - p1.y();
<a name="l00854"></a>00854   <span class="keywordtype">double</span> length = sqrt( xDiff * xDiff + yDiff * yDiff );
<a name="l00855"></a>00855   <span class="keywordflow">if</span> ( length &lt;= 0 )
<a name="l00856"></a>00856   {
<a name="l00857"></a>00857     <span class="keywordflow">return</span> 0;
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860   <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a15ed581faea19b6766dcf44f05445bcf" title="Returns angle of the line from p1 to p2 (clockwise, starting at N)">angle</a> = acos(( -yDiff * length ) / ( length * length ) ) * 180 / <a class="code" href="qgsdistancearea_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l00861"></a>00861   <span class="keywordflow">if</span> ( xDiff &lt; 0 )
<a name="l00862"></a>00862   {
<a name="l00863"></a>00863     <span class="keywordflow">return</span> ( 360 - angle );
<a name="l00864"></a>00864   }
<a name="l00865"></a>00865   <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#a15ed581faea19b6766dcf44f05445bcf" title="Returns angle of the line from p1 to p2 (clockwise, starting at N)">angle</a>;
<a name="l00866"></a>00866 }
<a name="l00867"></a>00867 
<a name="l00868"></a><a class="code" href="classQgsComposerItem.html#a497f6fc072955e33a6d9e1a8238460eb">00868</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a497f6fc072955e33a6d9e1a8238460eb" title="Returns the zoom factor of the graphics view.">QgsComposerItem::horizontalViewScaleFactor</a>()<span class="keyword"> const</span>
<a name="l00869"></a>00869 <span class="keyword"></span>{
<a name="l00870"></a>00870   <span class="keywordtype">double</span> result = -1;
<a name="l00871"></a>00871   <span class="keywordflow">if</span> ( scene() )
<a name="l00872"></a>00872   {
<a name="l00873"></a>00873     QList&lt;QGraphicsView*&gt; viewList = scene()-&gt;views();
<a name="l00874"></a>00874     <span class="keywordflow">if</span> ( viewList.size() &gt; 0 ) <span class="comment">//if not, probably this function was called from non-gui code</span>
<a name="l00875"></a>00875     {
<a name="l00876"></a>00876       QGraphicsView* currentView = viewList.at( 0 );
<a name="l00877"></a>00877       <span class="keywordflow">if</span> ( currentView-&gt;isVisible() )
<a name="l00878"></a>00878       {
<a name="l00879"></a>00879         result = currentView-&gt;transform().m11();
<a name="l00880"></a>00880         <a class="code" href="classQgsComposerItem.html#a1474eb918c9d75f869a8feb202fac447" title="Backup to restore item appearance if no view scale factor is available.">mLastValidViewScaleFactor</a> = result;
<a name="l00881"></a>00881       }
<a name="l00882"></a>00882     }
<a name="l00883"></a>00883   }
<a name="l00884"></a>00884   <span class="keywordflow">return</span> result;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a><a class="code" href="classQgsComposerItem.html#a420e87d2e0daa4461dab9c54cd585344">00887</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a420e87d2e0daa4461dab9c54cd585344" title="Returns the current (zoom level dependent) tolerance to decide if mouse position is close enough to t...">QgsComposerItem::rectHandlerBorderTolerance</a>()<span class="keyword"> const</span>
<a name="l00888"></a>00888 <span class="keyword"></span>{
<a name="l00889"></a>00889   <span class="comment">//size of symbol boxes depends on zoom level in composer view</span>
<a name="l00890"></a>00890   <span class="keywordtype">double</span> viewScaleFactor = <a class="code" href="classQgsComposerItem.html#a497f6fc072955e33a6d9e1a8238460eb" title="Returns the zoom factor of the graphics view.">horizontalViewScaleFactor</a>();
<a name="l00891"></a>00891   <span class="keywordtype">double</span> rectHandlerSize = 10.0 / viewScaleFactor;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893   <span class="comment">//make sure the boxes don&#39;t get too large</span>
<a name="l00894"></a>00894   <span class="keywordflow">if</span> ( rectHandlerSize &gt; ( rect().width() / 3 ) )
<a name="l00895"></a>00895   {
<a name="l00896"></a>00896     rectHandlerSize = rect().width() / 3;
<a name="l00897"></a>00897   }
<a name="l00898"></a>00898   <span class="keywordflow">if</span> ( rectHandlerSize &gt; ( rect().height() / 3 ) )
<a name="l00899"></a>00899   {
<a name="l00900"></a>00900     rectHandlerSize = rect().height() / 3;
<a name="l00901"></a>00901   }
<a name="l00902"></a>00902   <span class="keywordflow">return</span> rectHandlerSize;
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00905"></a><a class="code" href="classQgsComposerItem.html#a5714bd6b1731494024a20015c99526cd">00905</a> <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a5714bd6b1731494024a20015c99526cd" title="Returns the size of the lock symbol depending on the composer zoom level and the item size...">QgsComposerItem::lockSymbolSize</a>()<span class="keyword"> const</span>
<a name="l00906"></a>00906 <span class="keyword"></span>{
<a name="l00907"></a>00907   <span class="keywordtype">double</span> <a class="code" href="classQgsComposerItem.html#a5714bd6b1731494024a20015c99526cd" title="Returns the size of the lock symbol depending on the composer zoom level and the item size...">lockSymbolSize</a> = 20.0 / <a class="code" href="classQgsComposerItem.html#a497f6fc072955e33a6d9e1a8238460eb" title="Returns the zoom factor of the graphics view.">horizontalViewScaleFactor</a>();
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   <span class="keywordflow">if</span> ( lockSymbolSize &gt; ( rect().width() / 3 ) )
<a name="l00910"></a>00910   {
<a name="l00911"></a>00911     lockSymbolSize = rect().width() / 3;
<a name="l00912"></a>00912   }
<a name="l00913"></a>00913   <span class="keywordflow">if</span> ( lockSymbolSize &gt; ( rect().height() / 3 ) )
<a name="l00914"></a>00914   {
<a name="l00915"></a>00915     lockSymbolSize = rect().height() / 3;
<a name="l00916"></a>00916   }
<a name="l00917"></a>00917   <span class="keywordflow">return</span> <a class="code" href="classQgsComposerItem.html#a5714bd6b1731494024a20015c99526cd" title="Returns the size of the lock symbol depending on the composer zoom level and the item size...">lockSymbolSize</a>;
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="classQgsComposerItem.html#a774dd78a4f360c7e8abfd6c73bf84914">00920</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a774dd78a4f360c7e8abfd6c73bf84914" title="Update mouse cursor at (item) position.">QgsComposerItem::updateCursor</a>( <span class="keyword">const</span> QPointF&amp; itemPos )
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922   setCursor( <a class="code" href="classQgsComposerItem.html#a5cbdbfc1e5fc7bc7e3000af1ddc27c9f" title="Finds out the appropriate cursor for the current mouse position in the widget (e.g.">cursorForPosition</a>( itemPos ) );
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a><a class="code" href="classQgsComposerItem.html#a5a83172879f12b857f9c8181aa1ce970">00925</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a5a83172879f12b857f9c8181aa1ce970">QgsComposerItem::setRotation</a>( <span class="keywordtype">double</span> r )
<a name="l00926"></a>00926 {
<a name="l00927"></a>00927   <span class="keywordflow">if</span> ( r &gt; 360 )
<a name="l00928"></a>00928   {
<a name="l00929"></a>00929     <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> = (( int )r ) % 360;
<a name="l00930"></a>00930   }
<a name="l00931"></a>00931   <span class="keywordflow">else</span>
<a name="l00932"></a>00932   {
<a name="l00933"></a>00933     <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> = r;
<a name="l00934"></a>00934   }
<a name="l00935"></a>00935   emit <a class="code" href="classQgsComposerItem.html#aeea907dea29324ebc3adc7a30577b34d" title="Is emitted on rotation change to notify north arrow pictures.">rotationChanged</a>( r );
<a name="l00936"></a>00936   update();
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a><a class="code" href="classQgsComposerItem.html#aff0d68a17455e291f4f6bcd5a2965bde">00939</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#aff0d68a17455e291f4f6bcd5a2965bde" title="Calculates width and hight of the picture (in mm) such that it fits into the item frame with the give...">QgsComposerItem::imageSizeConsideringRotation</a>( <span class="keywordtype">double</span>&amp; width, <span class="keywordtype">double</span>&amp; height )<span class="keyword"> const</span>
<a name="l00940"></a>00940 <span class="keyword"></span>{
<a name="l00941"></a>00941   <span class="keywordflow">if</span> ( qAbs( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> ) &lt;= 0.0 ) <span class="comment">//width and height stays the same if there is no rotation</span>
<a name="l00942"></a>00942   {
<a name="l00943"></a>00943     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00944"></a>00944   }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946   <span class="keywordtype">double</span> x1 = 0;
<a name="l00947"></a>00947   <span class="keywordtype">double</span> y1 = 0;
<a name="l00948"></a>00948   <span class="keywordtype">double</span> x2 = width;
<a name="l00949"></a>00949   <span class="keywordtype">double</span> y2 = 0;
<a name="l00950"></a>00950   <span class="keywordtype">double</span> x3 = width;
<a name="l00951"></a>00951   <span class="keywordtype">double</span> y3 = height;
<a name="l00952"></a>00952   <span class="keywordtype">double</span> x4 = 0;
<a name="l00953"></a>00953   <span class="keywordtype">double</span> y4 = height;
<a name="l00954"></a>00954   <span class="keywordtype">double</span> midX = width / 2.0;
<a name="l00955"></a>00955   <span class="keywordtype">double</span> midY = height / 2.0;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x1, y1, width, height ) )
<a name="l00958"></a>00958   {
<a name="l00959"></a>00959     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00960"></a>00960   }
<a name="l00961"></a>00961   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x2, y2, width, height ) )
<a name="l00962"></a>00962   {
<a name="l00963"></a>00963     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00964"></a>00964   }
<a name="l00965"></a>00965   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x3, y3, width, height ) )
<a name="l00966"></a>00966   {
<a name="l00967"></a>00967     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00968"></a>00968   }
<a name="l00969"></a>00969   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x4, y4, width, height ) )
<a name="l00970"></a>00970   {
<a name="l00971"></a>00971     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00972"></a>00972   }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 
<a name="l00975"></a>00975   <span class="comment">//assume points 1 and 3 are on the rectangle boundaries. Calculate 2 and 4.</span>
<a name="l00976"></a>00976   <span class="keywordtype">double</span> distM1 = sqrt(( x1 - midX ) * ( x1 - midX ) + ( y1 - midY ) * ( y1 - midY ) );
<a name="l00977"></a>00977   QPointF p2 = <a class="code" href="classQgsSymbolLayerV2Utils.html#ab17649cad5ff1e8ee2cf8495adfd835b" title="Returns a point on the line from startPoint to directionPoint that is a certain distance away from th...">QgsSymbolLayerV2Utils::pointOnLineWithDistance</a>( QPointF( midX, midY ), QPointF( x2, y2 ), distM1 );
<a name="l00978"></a>00978 
<a name="l00979"></a>00979   <span class="keywordflow">if</span> ( p2.x() &lt; width &amp;&amp; p2.x() &gt; 0 &amp;&amp; p2.y() &lt; height &amp;&amp; p2.y() &gt; 0 )
<a name="l00980"></a>00980   {
<a name="l00981"></a>00981     width = sqrt(( p2.x() - x1 ) * ( p2.x() - x1 ) + ( p2.y() - y1 ) * ( p2.y() - y1 ) );
<a name="l00982"></a>00982     height = sqrt(( x3 - p2.x() ) * ( x3 - p2.x() ) + ( y3 - p2.y() ) * ( y3 - p2.y() ) );
<a name="l00983"></a>00983     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00984"></a>00984   }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="comment">//else assume that points 2 and 4 are on the rectangle boundaries. Calculate 1 and 3</span>
<a name="l00987"></a>00987   <span class="keywordtype">double</span> distM2 = sqrt(( x2 - midX ) * ( x2 - midX ) + ( y2 - midY ) * ( y2 - midY ) );
<a name="l00988"></a>00988   QPointF p1 = <a class="code" href="classQgsSymbolLayerV2Utils.html#ab17649cad5ff1e8ee2cf8495adfd835b" title="Returns a point on the line from startPoint to directionPoint that is a certain distance away from th...">QgsSymbolLayerV2Utils::pointOnLineWithDistance</a>( QPointF( midX, midY ), QPointF( x1, y1 ), distM2 );
<a name="l00989"></a>00989   QPointF p3 = <a class="code" href="classQgsSymbolLayerV2Utils.html#ab17649cad5ff1e8ee2cf8495adfd835b" title="Returns a point on the line from startPoint to directionPoint that is a certain distance away from th...">QgsSymbolLayerV2Utils::pointOnLineWithDistance</a>( QPointF( midX, midY ), QPointF( x3, y3 ), distM2 );
<a name="l00990"></a>00990   width = sqrt(( x2 - p1.x() ) * ( x2 - p1.x() ) + ( y2 - p1.y() ) * ( y2 - p1.y() ) );
<a name="l00991"></a>00991   height = sqrt(( p3.x() - x2 ) * ( p3.x() - x2 ) + ( p3.y() - y2 ) * ( p3.y() - y2 ) );
<a name="l00992"></a>00992   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 
<a name="l00995"></a>00995 <span class="preprocessor">#if 0</span>
<a name="l00996"></a>00996 <span class="preprocessor"></span>  <span class="keywordtype">double</span> x1 = 0;
<a name="l00997"></a>00997   <span class="keywordtype">double</span> y1 = 0;
<a name="l00998"></a>00998   <span class="keywordtype">double</span> x2 = width;
<a name="l00999"></a>00999   <span class="keywordtype">double</span> y2 = 0;
<a name="l01000"></a>01000   <span class="keywordtype">double</span> x3 = width;
<a name="l01001"></a>01001   <span class="keywordtype">double</span> y3 = height;
<a name="l01002"></a>01002 
<a name="l01003"></a>01003   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x1, y1, width, height ) )
<a name="l01004"></a>01004   {
<a name="l01005"></a>01005     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01006"></a>01006   }
<a name="l01007"></a>01007   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x2, y2, width, height ) )
<a name="l01008"></a>01008   {
<a name="l01009"></a>01009     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01010"></a>01010   }
<a name="l01011"></a>01011   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">cornerPointOnRotatedAndScaledRect</a>( x3, y3, width, height ) )
<a name="l01012"></a>01012   {
<a name="l01013"></a>01013     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01014"></a>01014   }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016   width = sqrt(( x2 - x1 ) * ( x2 - x1 ) + ( y2 - y1 ) * ( y2 - y1 ) );
<a name="l01017"></a>01017   height = sqrt(( x3 - x2 ) * ( x3 - x2 ) + ( y3 - y2 ) * ( y3 - y2 ) );
<a name="l01018"></a>01018   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01019"></a>01019 <span class="preprocessor">#endif //0</span>
<a name="l01020"></a>01020 <span class="preprocessor"></span>}
<a name="l01021"></a>01021 
<a name="l01022"></a><a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749">01022</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsComposerItem.html#a1b4c7e9fcb791f322b9423e5662e0749" title="Calculates corner point after rotation and scaling.">QgsComposerItem::cornerPointOnRotatedAndScaledRect</a>( <span class="keywordtype">double</span>&amp; x, <span class="keywordtype">double</span>&amp; y, <span class="keywordtype">double</span> width, <span class="keywordtype">double</span> height )<span class="keyword"> const</span>
<a name="l01023"></a>01023 <span class="keyword"></span>{
<a name="l01024"></a>01024   <span class="comment">//first rotate point clockwise</span>
<a name="l01025"></a>01025   <span class="keywordtype">double</span> rotToRad = <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> * <a class="code" href="qgsdistancearea_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 180.0;
<a name="l01026"></a>01026   QPointF midpoint( width / 2.0, height / 2.0 );
<a name="l01027"></a>01027   <span class="keywordtype">double</span> xVector = x - midpoint.x();
<a name="l01028"></a>01028   <span class="keywordtype">double</span> yVector = y - midpoint.y();
<a name="l01029"></a>01029   <span class="comment">//double xRotated = cos(rotToRad) * xVector + sin(rotToRad) * yVector;</span>
<a name="l01030"></a>01030   <span class="comment">//double yRotated = -sin(rotToRad) * xVector + cos(rotToRad) * yVector;</span>
<a name="l01031"></a>01031   <span class="keywordtype">double</span> xRotated = cos( rotToRad ) * xVector - sin( rotToRad ) * yVector;
<a name="l01032"></a>01032   <span class="keywordtype">double</span> yRotated = sin( rotToRad ) * xVector + cos( rotToRad ) * yVector;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   <span class="comment">//create line from midpoint to rotated point</span>
<a name="l01035"></a>01035   QLineF line( midpoint.x(), midpoint.y(), midpoint.x() + xRotated, midpoint.y() + yRotated );
<a name="l01036"></a>01036 
<a name="l01037"></a>01037   <span class="comment">//intersect with all four borders and return result</span>
<a name="l01038"></a>01038   QList&lt;QLineF&gt; borders;
<a name="l01039"></a>01039   borders &lt;&lt; QLineF( 0, 0, width, 0 );
<a name="l01040"></a>01040   borders &lt;&lt; QLineF( width, 0, width, height );
<a name="l01041"></a>01041   borders &lt;&lt; QLineF( width, height, 0, height );
<a name="l01042"></a>01042   borders &lt;&lt; QLineF( 0, height, 0, 0 );
<a name="l01043"></a>01043 
<a name="l01044"></a>01044   QList&lt;QLineF&gt;::const_iterator it = borders.constBegin();
<a name="l01045"></a>01045   QPointF intersectionPoint;
<a name="l01046"></a>01046 
<a name="l01047"></a>01047   <span class="keywordflow">for</span> ( ; it != borders.constEnd(); ++it )
<a name="l01048"></a>01048   {
<a name="l01049"></a>01049     <span class="keywordflow">if</span> ( line.intersect( *it, &amp;intersectionPoint ) == QLineF::BoundedIntersection )
<a name="l01050"></a>01050     {
<a name="l01051"></a>01051       x = intersectionPoint.x();
<a name="l01052"></a>01052       y = intersectionPoint.y();
<a name="l01053"></a>01053       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055   }
<a name="l01056"></a>01056   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01057"></a>01057 }
<a name="l01058"></a>01058 
<a name="l01059"></a><a class="code" href="classQgsComposerItem.html#aa15a0d2fd56fb07c4cb967dbebe109b7">01059</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#aa15a0d2fd56fb07c4cb967dbebe109b7" title="Calculates width / height of the bounding box of a rotated rectangle (mRotation)">QgsComposerItem::sizeChangedByRotation</a>( <span class="keywordtype">double</span>&amp; width, <span class="keywordtype">double</span>&amp; height )
<a name="l01060"></a>01060 {
<a name="l01061"></a>01061   <span class="keywordflow">if</span> ( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a> == 0.0 )
<a name="l01062"></a>01062   {
<a name="l01063"></a>01063     <span class="keywordflow">return</span>;
<a name="l01064"></a>01064   }
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   <span class="comment">//vector to p1</span>
<a name="l01067"></a>01067   <span class="keywordtype">double</span> x1 = -width / 2.0;
<a name="l01068"></a>01068   <span class="keywordtype">double</span> y1 = -height / 2.0;
<a name="l01069"></a>01069   <a class="code" href="classQgsComposerItem.html#a73bda50dcf73ac77b4668d641c47c2a7" title="Rotates a point / vector.">rotate</a>( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a>, x1, y1 );
<a name="l01070"></a>01070   <span class="comment">//vector to p2</span>
<a name="l01071"></a>01071   <span class="keywordtype">double</span> x2 = width / 2.0;
<a name="l01072"></a>01072   <span class="keywordtype">double</span> y2 = -height / 2.0;
<a name="l01073"></a>01073   <a class="code" href="classQgsComposerItem.html#a73bda50dcf73ac77b4668d641c47c2a7" title="Rotates a point / vector.">rotate</a>( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a>, x2, y2 );
<a name="l01074"></a>01074   <span class="comment">//vector to p3</span>
<a name="l01075"></a>01075   <span class="keywordtype">double</span> x3 = width / 2.0;
<a name="l01076"></a>01076   <span class="keywordtype">double</span> y3 = height / 2.0;
<a name="l01077"></a>01077   <a class="code" href="classQgsComposerItem.html#a73bda50dcf73ac77b4668d641c47c2a7" title="Rotates a point / vector.">rotate</a>( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a>, x3, y3 );
<a name="l01078"></a>01078   <span class="comment">//vector to p4</span>
<a name="l01079"></a>01079   <span class="keywordtype">double</span> x4 = -width / 2.0;
<a name="l01080"></a>01080   <span class="keywordtype">double</span> y4 = height / 2.0;
<a name="l01081"></a>01081   <a class="code" href="classQgsComposerItem.html#a73bda50dcf73ac77b4668d641c47c2a7" title="Rotates a point / vector.">rotate</a>( <a class="code" href="classQgsComposerItem.html#a72374a5d3b1a307606cac7a5c364a333" title="Item rotation in degrees, clockwise.">mRotation</a>, x4, y4 );
<a name="l01082"></a>01082 
<a name="l01083"></a>01083   <span class="comment">//double midpoint</span>
<a name="l01084"></a>01084   QPointF midpoint( width / 2.0, height / 2.0 );
<a name="l01085"></a>01085 
<a name="l01086"></a>01086   QPolygonF rotatedRectPoly;
<a name="l01087"></a>01087   rotatedRectPoly &lt;&lt; QPointF( midpoint.x() + x1, midpoint.y() + y1 );
<a name="l01088"></a>01088   rotatedRectPoly &lt;&lt; QPointF( midpoint.x() + x2, midpoint.y() + y2 );
<a name="l01089"></a>01089   rotatedRectPoly &lt;&lt; QPointF( midpoint.x() + x3, midpoint.y() + y3 );
<a name="l01090"></a>01090   rotatedRectPoly &lt;&lt; QPointF( midpoint.x() + x4, midpoint.y() + y4 );
<a name="l01091"></a>01091   QRectF boundingRect = rotatedRectPoly.boundingRect();
<a name="l01092"></a>01092   width = boundingRect.width();
<a name="l01093"></a>01093   height = boundingRect.height();
<a name="l01094"></a>01094 }
<a name="l01095"></a>01095 
<a name="l01096"></a><a class="code" href="classQgsComposerItem.html#a73bda50dcf73ac77b4668d641c47c2a7">01096</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#a73bda50dcf73ac77b4668d641c47c2a7" title="Rotates a point / vector.">QgsComposerItem::rotate</a>( <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#ad8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)">angle</a>, <span class="keywordtype">double</span>&amp; x, <span class="keywordtype">double</span>&amp; y )<span class="keyword"> const</span>
<a name="l01097"></a>01097 <span class="keyword"></span>{
<a name="l01098"></a>01098   <span class="keywordtype">double</span> rotToRad = angle * <a class="code" href="qgsdistancearea_8cpp.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 180.0;
<a name="l01099"></a>01099   <span class="keywordtype">double</span> xRot, yRot;
<a name="l01100"></a>01100   xRot = x * cos( rotToRad ) - y * sin( rotToRad );
<a name="l01101"></a>01101   yRot = x * sin( rotToRad ) + y * cos( rotToRad );
<a name="l01102"></a>01102   x = xRot;
<a name="l01103"></a>01103   y = yRot;
<a name="l01104"></a>01104 }
<a name="l01105"></a>01105 
<a name="l01106"></a><a class="code" href="classQgsComposerItem.html#aa084113b7bab7b14625154cf7297007c">01106</a> <span class="keywordtype">void</span> <a class="code" href="classQgsComposerItem.html#aa084113b7bab7b14625154cf7297007c">QgsComposerItem::repaint</a>()
<a name="l01107"></a>01107 {
<a name="l01108"></a>01108   update();
<a name="l01109"></a>01109 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 19 2012 23:22:39 for Quantum GIS API Documentation by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
