<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Quantum GIS API Documentation: src/core/symbology-ng/qgssymbollayerv2utils.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>src/core/symbology-ng/qgssymbollayerv2utils.cpp</h1><a href="qgssymbollayerv2utils_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include "<a class="code" href="qgssymbollayerv2utils_8h.html">qgssymbollayerv2utils.h</a>"</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="preprocessor">#include "<a class="code" href="qgssymbollayerv2_8h.html">qgssymbollayerv2.h</a>"</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include "<a class="code" href="qgssymbollayerv2registry_8h.html">qgssymbollayerv2registry.h</a>"</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="qgssymbolv2_8h.html">qgssymbolv2.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="qgsvectorcolorrampv2_8h.html">qgsvectorcolorrampv2.h</a>"</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="qgslogger_8h.html">qgslogger.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="qgsrendercontext_8h.html">qgsrendercontext.h</a>"</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;QColor&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;QDomNode&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;QDomElement&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;QIcon&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;QPainter&gt;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#2d71081dab2d4fc194cd0c5588e66cf1">00018</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#2d71081dab2d4fc194cd0c5588e66cf1">QgsSymbolLayerV2Utils::encodeColor</a>( QColor color )
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020   <span class="keywordflow">return</span> QString( <span class="stringliteral">"%1,%2,%3,%4"</span> ).arg( color.red() ).arg( color.green() ).arg( color.blue() ).arg( color.alpha() );
<a name="l00021"></a>00021 }
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#942f2c54ef1be3c474313ff3739a9aa8">00023</a> QColor <a class="code" href="classQgsSymbolLayerV2Utils.html#942f2c54ef1be3c474313ff3739a9aa8">QgsSymbolLayerV2Utils::decodeColor</a>( QString str )
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025   QStringList lst = str.split( <span class="stringliteral">","</span> );
<a name="l00026"></a>00026   <span class="keywordflow">if</span> ( lst.count() &lt; 3 )
<a name="l00027"></a>00027   {
<a name="l00028"></a>00028     <span class="keywordflow">return</span> QColor();
<a name="l00029"></a>00029   }
<a name="l00030"></a>00030   <span class="keywordtype">int</span> red, green, blue, alpha;
<a name="l00031"></a>00031   red = lst[0].toInt();
<a name="l00032"></a>00032   green = lst[1].toInt();
<a name="l00033"></a>00033   blue = lst[2].toInt();
<a name="l00034"></a>00034   alpha = 255;
<a name="l00035"></a>00035   <span class="keywordflow">if</span> ( lst.count() &gt; 3 )
<a name="l00036"></a>00036   {
<a name="l00037"></a>00037     alpha = lst[3].toInt();
<a name="l00038"></a>00038   }
<a name="l00039"></a>00039   <span class="keywordflow">return</span> QColor( red, green, blue, alpha );
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#9dfe67cf729b4711a4cc1d0636491b9f">00042</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#9dfe67cf729b4711a4cc1d0636491b9f">QgsSymbolLayerV2Utils::encodePenStyle</a>( Qt::PenStyle style )
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   <span class="keywordflow">switch</span> ( style )
<a name="l00045"></a>00045   {
<a name="l00046"></a>00046     <span class="keywordflow">case</span> Qt::NoPen:          <span class="keywordflow">return</span> <span class="stringliteral">"no"</span>;
<a name="l00047"></a>00047     <span class="keywordflow">case</span> Qt::SolidLine:      <span class="keywordflow">return</span> <span class="stringliteral">"solid"</span>;
<a name="l00048"></a>00048     <span class="keywordflow">case</span> Qt::DashLine:       <span class="keywordflow">return</span> <span class="stringliteral">"dash"</span>;
<a name="l00049"></a>00049     <span class="keywordflow">case</span> Qt::DotLine:        <span class="keywordflow">return</span> <span class="stringliteral">"dot"</span>;
<a name="l00050"></a>00050     <span class="keywordflow">case</span> Qt::DashDotLine:    <span class="keywordflow">return</span> <span class="stringliteral">"dash dot"</span>;
<a name="l00051"></a>00051     <span class="keywordflow">case</span> Qt::DashDotDotLine: <span class="keywordflow">return</span> <span class="stringliteral">"dash dot dot"</span>;
<a name="l00052"></a>00052     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">"???"</span>;
<a name="l00053"></a>00053   }
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#01dbfedb2d2501595e67f6827f72785b">00056</a> Qt::PenStyle <a class="code" href="classQgsSymbolLayerV2Utils.html#01dbfedb2d2501595e67f6827f72785b">QgsSymbolLayerV2Utils::decodePenStyle</a>( QString str )
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"no"</span> ) <span class="keywordflow">return</span> Qt::NoPen;
<a name="l00059"></a>00059   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"solid"</span> ) <span class="keywordflow">return</span> Qt::SolidLine;
<a name="l00060"></a>00060   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dash"</span> ) <span class="keywordflow">return</span> Qt::DashLine;
<a name="l00061"></a>00061   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dot"</span> ) <span class="keywordflow">return</span> Qt::DotLine;
<a name="l00062"></a>00062   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dash dot"</span> ) <span class="keywordflow">return</span> Qt::DashDotLine;
<a name="l00063"></a>00063   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dast dot dot"</span> ) <span class="keywordflow">return</span> Qt::DashDotDotLine;
<a name="l00064"></a>00064   <span class="keywordflow">return</span> Qt::SolidLine;
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#bce56212fb3fc83666b6bd881f79309b">00067</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#bce56212fb3fc83666b6bd881f79309b">QgsSymbolLayerV2Utils::encodePenJoinStyle</a>( Qt::PenJoinStyle style )
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069   <span class="keywordflow">switch</span> ( style )
<a name="l00070"></a>00070   {
<a name="l00071"></a>00071     <span class="keywordflow">case</span> Qt::BevelJoin: <span class="keywordflow">return</span> <span class="stringliteral">"bevel"</span>;
<a name="l00072"></a>00072     <span class="keywordflow">case</span> Qt::MiterJoin: <span class="keywordflow">return</span> <span class="stringliteral">"miter"</span>;
<a name="l00073"></a>00073     <span class="keywordflow">case</span> Qt::RoundJoin: <span class="keywordflow">return</span> <span class="stringliteral">"round"</span>;
<a name="l00074"></a>00074     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">"???"</span>;
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#b5264113bf302d3bf68af91261ff3b8d">00078</a> Qt::PenJoinStyle <a class="code" href="classQgsSymbolLayerV2Utils.html#b5264113bf302d3bf68af91261ff3b8d">QgsSymbolLayerV2Utils::decodePenJoinStyle</a>( QString str )
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"bevel"</span> ) <span class="keywordflow">return</span> Qt::BevelJoin;
<a name="l00081"></a>00081   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"miter"</span> ) <span class="keywordflow">return</span> Qt::MiterJoin;
<a name="l00082"></a>00082   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"round"</span> ) <span class="keywordflow">return</span> Qt::RoundJoin;
<a name="l00083"></a>00083   <span class="keywordflow">return</span> Qt::BevelJoin;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#5cfff3b5fa65f2cf7583732ed3d56071">00086</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#5cfff3b5fa65f2cf7583732ed3d56071">QgsSymbolLayerV2Utils::encodePenCapStyle</a>( Qt::PenCapStyle style )
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088   <span class="keywordflow">switch</span> ( style )
<a name="l00089"></a>00089   {
<a name="l00090"></a>00090     <span class="keywordflow">case</span> Qt::SquareCap: <span class="keywordflow">return</span> <span class="stringliteral">"square"</span>;
<a name="l00091"></a>00091     <span class="keywordflow">case</span> Qt::FlatCap:   <span class="keywordflow">return</span> <span class="stringliteral">"flat"</span>;
<a name="l00092"></a>00092     <span class="keywordflow">case</span> Qt::RoundCap:  <span class="keywordflow">return</span> <span class="stringliteral">"round"</span>;
<a name="l00093"></a>00093     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">"???"</span>;
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#f2b591840d314e967b1b08022a34f3d8">00097</a> Qt::PenCapStyle <a class="code" href="classQgsSymbolLayerV2Utils.html#f2b591840d314e967b1b08022a34f3d8">QgsSymbolLayerV2Utils::decodePenCapStyle</a>( QString str )
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"square"</span> ) <span class="keywordflow">return</span> Qt::SquareCap;
<a name="l00100"></a>00100   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"flat"</span> ) <span class="keywordflow">return</span> Qt::FlatCap;
<a name="l00101"></a>00101   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"round"</span> ) <span class="keywordflow">return</span> Qt::RoundCap;
<a name="l00102"></a>00102   <span class="keywordflow">return</span> Qt::SquareCap;
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#b29594d9d687ab2981a26a3cfea9e86b">00106</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#b29594d9d687ab2981a26a3cfea9e86b">QgsSymbolLayerV2Utils::encodeBrushStyle</a>( Qt::BrushStyle style )
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108   <span class="keywordflow">switch</span> ( style )
<a name="l00109"></a>00109   {
<a name="l00110"></a>00110     <span class="keywordflow">case</span> Qt::SolidPattern : <span class="keywordflow">return</span> <span class="stringliteral">"solid"</span>;
<a name="l00111"></a>00111     <span class="keywordflow">case</span> Qt::HorPattern : <span class="keywordflow">return</span> <span class="stringliteral">"horizontal"</span>;
<a name="l00112"></a>00112     <span class="keywordflow">case</span> Qt::VerPattern : <span class="keywordflow">return</span> <span class="stringliteral">"vertical"</span>;
<a name="l00113"></a>00113     <span class="keywordflow">case</span> Qt::CrossPattern : <span class="keywordflow">return</span> <span class="stringliteral">"cross"</span>;
<a name="l00114"></a>00114     <span class="keywordflow">case</span> Qt::BDiagPattern : <span class="keywordflow">return</span> <span class="stringliteral">"b_diagonal"</span>;
<a name="l00115"></a>00115     <span class="keywordflow">case</span> Qt::FDiagPattern : <span class="keywordflow">return</span>  <span class="stringliteral">"f_diagonal"</span>;
<a name="l00116"></a>00116     <span class="keywordflow">case</span> Qt::DiagCrossPattern : <span class="keywordflow">return</span> <span class="stringliteral">"diagonal_x"</span>;
<a name="l00117"></a>00117     <span class="keywordflow">case</span> Qt::Dense1Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense1"</span>;
<a name="l00118"></a>00118     <span class="keywordflow">case</span> Qt::Dense2Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense2"</span>;
<a name="l00119"></a>00119     <span class="keywordflow">case</span> Qt::Dense3Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense3"</span>;
<a name="l00120"></a>00120     <span class="keywordflow">case</span> Qt::Dense4Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense4"</span>;
<a name="l00121"></a>00121     <span class="keywordflow">case</span> Qt::Dense5Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense5"</span>;
<a name="l00122"></a>00122     <span class="keywordflow">case</span> Qt::Dense6Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense6"</span>;
<a name="l00123"></a>00123     <span class="keywordflow">case</span> Qt::Dense7Pattern  : <span class="keywordflow">return</span> <span class="stringliteral">"dense7"</span>;
<a name="l00124"></a>00124     <span class="keywordflow">case</span> Qt::NoBrush : <span class="keywordflow">return</span> <span class="stringliteral">"no"</span>;
<a name="l00125"></a>00125     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">"???"</span>;
<a name="l00126"></a>00126   }
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#06545973408623b85f876cd27d6968f8">00129</a> Qt::BrushStyle <a class="code" href="classQgsSymbolLayerV2Utils.html#06545973408623b85f876cd27d6968f8">QgsSymbolLayerV2Utils::decodeBrushStyle</a>( QString str )
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"solid"</span> ) <span class="keywordflow">return</span> Qt::SolidPattern;
<a name="l00132"></a>00132   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"horizontal"</span> ) <span class="keywordflow">return</span> Qt::HorPattern;
<a name="l00133"></a>00133   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"vertical"</span> ) <span class="keywordflow">return</span> Qt::VerPattern;
<a name="l00134"></a>00134   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"cross"</span> ) <span class="keywordflow">return</span> Qt::CrossPattern;
<a name="l00135"></a>00135   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"b_diagonal"</span> ) <span class="keywordflow">return</span> Qt::BDiagPattern;
<a name="l00136"></a>00136   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"f_diagonal"</span> ) <span class="keywordflow">return</span> Qt::FDiagPattern;
<a name="l00137"></a>00137   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"diagonal_x"</span> ) <span class="keywordflow">return</span> Qt::DiagCrossPattern;
<a name="l00138"></a>00138   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense1"</span> ) <span class="keywordflow">return</span> Qt::Dense1Pattern;
<a name="l00139"></a>00139   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense2"</span> ) <span class="keywordflow">return</span> Qt::Dense2Pattern;
<a name="l00140"></a>00140   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense3"</span> ) <span class="keywordflow">return</span> Qt::Dense3Pattern;
<a name="l00141"></a>00141   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense4"</span> ) <span class="keywordflow">return</span> Qt::Dense4Pattern;
<a name="l00142"></a>00142   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense5"</span> ) <span class="keywordflow">return</span> Qt::Dense5Pattern;
<a name="l00143"></a>00143   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense6"</span> ) <span class="keywordflow">return</span> Qt::Dense6Pattern;
<a name="l00144"></a>00144   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"dense7"</span> ) <span class="keywordflow">return</span> Qt::Dense7Pattern;
<a name="l00145"></a>00145   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"no"</span> ) <span class="keywordflow">return</span> Qt::NoBrush;
<a name="l00146"></a>00146   <span class="keywordflow">return</span> Qt::SolidPattern;
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#8ed29d4fe064d67f7071647b53aeb340">00149</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#8ed29d4fe064d67f7071647b53aeb340">QgsSymbolLayerV2Utils::encodePoint</a>( QPointF point )
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151   <span class="keywordflow">return</span> QString( <span class="stringliteral">"%1,%2"</span> ).arg( point.x() ).arg( point.y() );
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#1709e6b136de7414fcb77c11784e1ad5">00154</a> QPointF <a class="code" href="classQgsSymbolLayerV2Utils.html#1709e6b136de7414fcb77c11784e1ad5">QgsSymbolLayerV2Utils::decodePoint</a>( QString str )
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156   QStringList lst = str.split( <span class="charliteral">','</span> );
<a name="l00157"></a>00157   <span class="keywordflow">if</span> ( lst.count() != 2 )
<a name="l00158"></a>00158     <span class="keywordflow">return</span> QPointF( 0, 0 );
<a name="l00159"></a>00159   <span class="keywordflow">return</span> QPointF( lst[0].toDouble(), lst[1].toDouble() );
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#658933661eb39b9fd5af92ff5222f442">00162</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#658933661eb39b9fd5af92ff5222f442">QgsSymbolLayerV2Utils::encodeOutputUnit</a>( <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5">QgsSymbolV2::OutputUnit</a> unit )
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <span class="keywordflow">switch</span> ( unit )
<a name="l00165"></a>00165   {
<a name="l00166"></a>00166     <span class="keywordflow">case</span> <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5a16772c4bcbb62aea03204507411e9e4">QgsSymbolV2::MM</a>:
<a name="l00167"></a>00167       <span class="keywordflow">return</span> <span class="stringliteral">"MM"</span>;
<a name="l00168"></a>00168     <span class="keywordflow">case</span> <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f55f55b00f099c099289450e6ab727bb46">QgsSymbolV2::MapUnit</a>:
<a name="l00169"></a>00169       <span class="keywordflow">return</span> <span class="stringliteral">"MapUnit"</span>;
<a name="l00170"></a>00170     <span class="keywordflow">default</span>:
<a name="l00171"></a>00171       <span class="keywordflow">return</span> <span class="stringliteral">"MM"</span>;
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#71b0e8d945f0371ed96e170fd0d7062f">00175</a> <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5">QgsSymbolV2::OutputUnit</a> <a class="code" href="classQgsSymbolLayerV2Utils.html#71b0e8d945f0371ed96e170fd0d7062f">QgsSymbolLayerV2Utils::decodeOutputUnit</a>( QString str )
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177   <span class="keywordflow">if</span> ( str == <span class="stringliteral">"MM"</span> )
<a name="l00178"></a>00178   {
<a name="l00179"></a>00179     <span class="keywordflow">return</span> <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5a16772c4bcbb62aea03204507411e9e4">QgsSymbolV2::MM</a>;
<a name="l00180"></a>00180   }
<a name="l00181"></a>00181   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( str == <span class="stringliteral">"MapUnit"</span> )
<a name="l00182"></a>00182   {
<a name="l00183"></a>00183     <span class="keywordflow">return</span> <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f55f55b00f099c099289450e6ab727bb46">QgsSymbolV2::MapUnit</a>;
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="comment">// milimeters are default</span>
<a name="l00187"></a>00187   <span class="keywordflow">return</span> <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5a16772c4bcbb62aea03204507411e9e4">QgsSymbolV2::MM</a>;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#48fc6cbe6e385c40d6437f946c758f32">00190</a> QString <a class="code" href="classQgsSymbolLayerV2Utils.html#48fc6cbe6e385c40d6437f946c758f32">QgsSymbolLayerV2Utils::encodeRealVector</a>( <span class="keyword">const</span> QVector&lt;qreal&gt;&amp; v )
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192   QString vectorString;
<a name="l00193"></a>00193   QVector&lt;qreal&gt;::const_iterator it = v.constBegin();
<a name="l00194"></a>00194   <span class="keywordflow">for</span> ( ; it != v.constEnd(); ++it )
<a name="l00195"></a>00195   {
<a name="l00196"></a>00196     <span class="keywordflow">if</span> ( it != v.constBegin() )
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198       vectorString.append( <span class="stringliteral">";"</span> );
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200     vectorString.append( QString::number( *it ) );
<a name="l00201"></a>00201   }
<a name="l00202"></a>00202   <span class="keywordflow">return</span> vectorString;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#a4e54c1b58a78b8c427fb3ea8647c243">00205</a> QVector&lt;qreal&gt; <a class="code" href="classQgsSymbolLayerV2Utils.html#a4e54c1b58a78b8c427fb3ea8647c243">QgsSymbolLayerV2Utils::decodeRealVector</a>( <span class="keyword">const</span> QString&amp; s )
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207   QVector&lt;qreal&gt; resultVector;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   QStringList realList = s.split( <span class="stringliteral">";"</span> );
<a name="l00210"></a>00210   QStringList::const_iterator it = realList.constBegin();
<a name="l00211"></a>00211   <span class="keywordflow">for</span> ( ; it != realList.constEnd(); ++it )
<a name="l00212"></a>00212   {
<a name="l00213"></a>00213     resultVector.append( it-&gt;toDouble() );
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="keywordflow">return</span> resultVector;
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#5e1f14efd2158378142c76ab41171426">00219</a> QIcon <a class="code" href="classQgsSymbolLayerV2Utils.html#5e1f14efd2158378142c76ab41171426">QgsSymbolLayerV2Utils::symbolPreviewIcon</a>( <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* symbol, QSize size )
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221   <span class="keywordflow">return</span> QIcon( <a class="code" href="classQgsSymbolLayerV2Utils.html#74f8124fd5a7d68c168b71ebead78552">symbolPreviewPixmap</a>( symbol, size ) );
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#74f8124fd5a7d68c168b71ebead78552">00224</a> QPixmap <a class="code" href="classQgsSymbolLayerV2Utils.html#74f8124fd5a7d68c168b71ebead78552">QgsSymbolLayerV2Utils::symbolPreviewPixmap</a>( <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* symbol, QSize size )
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226   Q_ASSERT( symbol );
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   QPixmap pixmap( size );
<a name="l00229"></a>00229   QPainter painter;
<a name="l00230"></a>00230   painter.begin( &amp;pixmap );
<a name="l00231"></a>00231   painter.setRenderHint( QPainter::Antialiasing );
<a name="l00232"></a>00232   painter.eraseRect( QRect( QPoint( 0, 0 ), size ) );
<a name="l00233"></a>00233   symbol-&gt;<a class="code" href="classQgsSymbolV2.html#ae8dea684447e88b1b6590c2a70e4a99">drawPreviewIcon</a>( &amp;painter, size );
<a name="l00234"></a>00234   painter.end();
<a name="l00235"></a>00235   <span class="keywordflow">return</span> pixmap;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 
<a name="l00239"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#2822ae30544294e54d5b8f81f6fe1116">00239</a> QIcon <a class="code" href="classQgsSymbolLayerV2Utils.html#2822ae30544294e54d5b8f81f6fe1116">QgsSymbolLayerV2Utils::symbolLayerPreviewIcon</a>( <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* layer, <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5">QgsSymbolV2::OutputUnit</a> u, QSize size )
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241   QPixmap pixmap( size );
<a name="l00242"></a>00242   QPainter painter;
<a name="l00243"></a>00243   painter.begin( &amp;pixmap );
<a name="l00244"></a>00244   painter.setRenderHint( QPainter::Antialiasing );
<a name="l00245"></a>00245   painter.eraseRect( QRect( QPoint( 0, 0 ), size ) );
<a name="l00246"></a>00246   <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a> renderContext = <a class="code" href="classQgsSymbolLayerV2Utils.html#47a6843936d926609917de666cc81fec" title="Creates a render context for a pixel based device.">createRenderContext</a>( &amp;painter );
<a name="l00247"></a>00247   <a class="code" href="classQgsSymbolV2RenderContext.html">QgsSymbolV2RenderContext</a> symbolContext( renderContext, u );
<a name="l00248"></a>00248   layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#36b22e2483f4150d1fb58ad3caa61e8c">drawPreviewIcon</a>( symbolContext, size );
<a name="l00249"></a>00249   painter.end();
<a name="l00250"></a>00250   <span class="keywordflow">return</span> QIcon( pixmap );
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#a3c88562d4f9fe39a3fa03bcf8a42cf0">00253</a> QIcon <a class="code" href="classQgsSymbolLayerV2Utils.html#a3c88562d4f9fe39a3fa03bcf8a42cf0">QgsSymbolLayerV2Utils::colorRampPreviewIcon</a>( <a class="code" href="classQgsVectorColorRampV2.html">QgsVectorColorRampV2</a>* ramp, QSize size )
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255   <span class="keywordflow">return</span> QIcon( <a class="code" href="classQgsSymbolLayerV2Utils.html#1fa841d8ccd8a9aebd6a7c32e892ffe0">colorRampPreviewPixmap</a>( ramp, size ) );
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#1fa841d8ccd8a9aebd6a7c32e892ffe0">00258</a> QPixmap <a class="code" href="classQgsSymbolLayerV2Utils.html#1fa841d8ccd8a9aebd6a7c32e892ffe0">QgsSymbolLayerV2Utils::colorRampPreviewPixmap</a>( <a class="code" href="classQgsVectorColorRampV2.html">QgsVectorColorRampV2</a>* ramp, QSize size )
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260   QPixmap pixmap( size );
<a name="l00261"></a>00261   QPainter painter;
<a name="l00262"></a>00262   painter.begin( &amp;pixmap );
<a name="l00263"></a>00263   painter.setRenderHint( QPainter::Antialiasing );
<a name="l00264"></a>00264   painter.eraseRect( QRect( QPoint( 0, 0 ), size ) );
<a name="l00265"></a>00265   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; size.width(); i++ )
<a name="l00266"></a>00266   {
<a name="l00267"></a>00267     QPen pen( ramp-&gt;<a class="code" href="classQgsVectorColorRampV2.html#6ae0935946d7b6c20dd6ad0450f533f6">color</a>(( <span class="keywordtype">double</span> ) i / size.width() ) );
<a name="l00268"></a>00268     painter.setPen( pen );
<a name="l00269"></a>00269     painter.drawLine( i, 0, i, size.height() - 1 );
<a name="l00270"></a>00270   }
<a name="l00271"></a>00271   painter.end();
<a name="l00272"></a>00272   <span class="keywordflow">return</span> pixmap;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="preprocessor">#include &lt;QPolygonF&gt;</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00279"></a>00279 <span class="preprocessor">#include &lt;cfloat&gt;</span>
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="comment">// calculate line's angle and tangent</span>
<a name="l00283"></a><a class="code" href="qgssymbollayerv2utils_8cpp.html#1715008cc3b6fedaae75a7930c101928">00283</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="qgssymbollayerv2utils_8cpp.html#1715008cc3b6fedaae75a7930c101928">lineInfo</a>( QPointF p1, QPointF p2, <span class="keywordtype">double</span>&amp; <a class="code" href="namespaceMathUtils.html#d8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)...">angle</a>, <span class="keywordtype">double</span>&amp; t )
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285   <span class="keywordtype">double</span> x1 = p1.x(), y1 = p1.y(), x2 = p2.x(), y2 = p2.y();
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   <span class="keywordflow">if</span> ( x1 == x2 &amp;&amp; y1 == y2 )
<a name="l00288"></a>00288     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <span class="comment">// tangent</span>
<a name="l00291"></a>00291   t = ( x1 == x2 ? DBL_MAX : ( y2 - y1 ) / ( x2 - x1 ) );
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="comment">// angle</span>
<a name="l00294"></a>00294   <span class="keywordflow">if</span> ( t == DBL_MAX )
<a name="l00295"></a>00295     angle = ( y2 &gt; y1 ? <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 2 : <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> * 3 / 2 );  <span class="comment">// angle is 90 or 270</span>
<a name="l00296"></a>00296   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( t == 0 )
<a name="l00297"></a>00297     angle = ( x2 &gt; x1 ? 0 : <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> ); <span class="comment">// angle is 0 or 180</span>
<a name="l00298"></a>00298   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( t &gt;= 0 )
<a name="l00299"></a>00299     angle = ( y2 &gt; y1 ? atan( t ) : <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> + atan( t ) );
<a name="l00300"></a>00300   <span class="keywordflow">else</span> <span class="comment">// t &lt; 0</span>
<a name="l00301"></a>00301     angle = ( y2 &gt; y1 ? <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> + atan( t ) : atan( t ) );
<a name="l00302"></a>00302 
<a name="l00303"></a>00303   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">// offset a point with an angle and distance</span>
<a name="l00307"></a><a class="code" href="qgssymbollayerv2utils_8cpp.html#860867f0c9075d8f6a6170b7c252ee54">00307</a> <span class="keyword">static</span> QPointF <a class="code" href="qgssymbollayerv2utils_8cpp.html#860867f0c9075d8f6a6170b7c252ee54">offsetPoint</a>( QPointF pt, <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#d8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)...">angle</a>, <span class="keywordtype">double</span> dist )
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309   <span class="keywordflow">return</span> QPointF( pt.x() + dist * cos( angle ), pt.y() + dist * sin( angle ) );
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">// calc intersection of two (infinite) lines defined by one point and tangent</span>
<a name="l00313"></a><a class="code" href="qgssymbollayerv2utils_8cpp.html#57f12828cd73da317dea7cb623335095">00313</a> <span class="keyword">static</span> QPointF <a class="code" href="qgssymbollayerv2utils_8cpp.html#57f12828cd73da317dea7cb623335095">linesIntersection</a>( QPointF p1, <span class="keywordtype">double</span> t1, QPointF p2, <span class="keywordtype">double</span> t2 )
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315   <span class="comment">// parallel lines? (or the difference between angles is less than cca 0.1 degree)</span>
<a name="l00316"></a>00316   <span class="keywordflow">if</span> (( t1 == DBL_MAX &amp;&amp; t2 == DBL_MAX ) || fabs( t1 - t2 ) &lt; 0.001 )
<a name="l00317"></a>00317     <span class="keywordflow">return</span> QPointF();
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="keywordtype">double</span> x, y;
<a name="l00320"></a>00320   <span class="keywordflow">if</span> ( t1 == DBL_MAX || t2 == DBL_MAX )
<a name="l00321"></a>00321   {
<a name="l00322"></a>00322     <span class="comment">// in case one line is with angle 90 resp. 270 degrees (tangent undefined)</span>
<a name="l00323"></a>00323     <span class="comment">// swap them so that line 2 is with undefined tangent</span>
<a name="l00324"></a>00324     <span class="keywordflow">if</span> ( t1 == DBL_MAX )
<a name="l00325"></a>00325     {
<a name="l00326"></a>00326       QPointF pSwp = p1; p1 = p2; p2 = pSwp;
<a name="l00327"></a>00327       <span class="keywordtype">double</span>  tSwp = t1; t1 = t2; t2 = tSwp;
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     x = p2.x();
<a name="l00331"></a>00331   }
<a name="l00332"></a>00332   <span class="keywordflow">else</span>
<a name="l00333"></a>00333   {
<a name="l00334"></a>00334     <span class="comment">// usual case</span>
<a name="l00335"></a>00335     x = (( p1.y() - p2.y() ) + t2 * p2.x() - t1 * p1.x() ) / ( t2 - t1 );
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   y = p1.y() + t1 * ( x - p1.x() );
<a name="l00339"></a>00339   <span class="keywordflow">return</span> QPointF( x, y );
<a name="l00340"></a>00340 }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 
<a name="l00343"></a><a class="code" href="qgssymbollayerv2utils_8h.html#9d845b13e80c7bb324c0504c64d52941">00343</a> QPolygonF <a class="code" href="qgssymbollayerv2utils_8cpp.html#9d845b13e80c7bb324c0504c64d52941" title="calculate line shifted by a specified distance">offsetLine</a>( QPolygonF polyline, <span class="keywordtype">double</span> dist )
<a name="l00344"></a>00344 {
<a name="l00345"></a>00345   QPolygonF newLine;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="keywordflow">if</span> ( polyline.count() &lt; 2 )
<a name="l00348"></a>00348     <span class="keywordflow">return</span> newLine;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350   <span class="keywordtype">double</span> <a class="code" href="namespaceMathUtils.html#d8c3e8d699ab12a55e6883baa6b65c6b" title="Calculates the angle between two segments (in 2 dimension, z-values are ignored)...">angle</a> = 0.0, t_new, t_old = 0;
<a name="l00351"></a>00351   QPointF pt_old, pt_new;
<a name="l00352"></a>00352   QPointF p1 = polyline[0], p2;
<a name="l00353"></a>00353   <span class="keywordtype">bool</span> first_point = <span class="keyword">true</span>;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 1; i &lt; polyline.count(); i++ )
<a name="l00356"></a>00356   {
<a name="l00357"></a>00357     p2 = polyline[i];
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="keywordflow">if</span> ( !<a class="code" href="qgssymbollayerv2utils_8cpp.html#1715008cc3b6fedaae75a7930c101928">lineInfo</a>( p1, p2, angle, t_new ) )
<a name="l00360"></a>00360       <span class="keywordflow">continue</span>; <span class="comment">// not a line...</span>
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     pt_new = <a class="code" href="qgssymbollayerv2utils_8cpp.html#860867f0c9075d8f6a6170b7c252ee54">offsetPoint</a>( p1, angle + <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 2, dist );
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keywordflow">if</span> ( ! first_point )
<a name="l00365"></a>00365     {
<a name="l00366"></a>00366       <span class="comment">// if it's not the first line segment</span>
<a name="l00367"></a>00367       <span class="comment">// calc intersection with last line (with offset)</span>
<a name="l00368"></a>00368       QPointF pt_tmp = <a class="code" href="qgssymbollayerv2utils_8cpp.html#57f12828cd73da317dea7cb623335095">linesIntersection</a>( pt_old, t_old, pt_new, t_new );
<a name="l00369"></a>00369       <span class="keywordflow">if</span> ( !pt_tmp.isNull() ) pt_new = pt_tmp;
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     newLine.append( pt_new );
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     pt_old = pt_new;
<a name="l00375"></a>00375     t_old = t_new;
<a name="l00376"></a>00376     p1 = p2;
<a name="l00377"></a>00377     first_point = <span class="keyword">false</span>;
<a name="l00378"></a>00378   }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <span class="comment">// last line segment:</span>
<a name="l00381"></a>00381   pt_new = <a class="code" href="qgssymbollayerv2utils_8cpp.html#860867f0c9075d8f6a6170b7c252ee54">offsetPoint</a>( p2, angle + <a class="code" href="qgsdistancearea_8cpp.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> / 2, dist );
<a name="l00382"></a>00382   newLine.append( pt_new );
<a name="l00383"></a>00383   <span class="keywordflow">return</span> newLine;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 
<a name="l00389"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#eb26044ca3b2ce149bf2a02075e3f15a">00389</a> <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* <a class="code" href="classQgsSymbolLayerV2Utils.html#eb26044ca3b2ce149bf2a02075e3f15a">QgsSymbolLayerV2Utils::loadSymbol</a>( QDomElement&amp; element )
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391   <a class="code" href="qgssymbolv2_8h.html#bcf4e5696820a1c44827956f48787f1b">QgsSymbolLayerV2List</a> layers;
<a name="l00392"></a>00392   QDomNode layerNode = element.firstChild();
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   <span class="keywordflow">while</span> ( !layerNode.isNull() )
<a name="l00395"></a>00395   {
<a name="l00396"></a>00396     QDomElement e = layerNode.toElement();
<a name="l00397"></a>00397     <span class="keywordflow">if</span> ( !e.isNull() )
<a name="l00398"></a>00398     {
<a name="l00399"></a>00399       <span class="keywordflow">if</span> ( e.tagName() != <span class="stringliteral">"layer"</span> )
<a name="l00400"></a>00400       {
<a name="l00401"></a>00401         <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"unknown tag "</span> + e.tagName() );
<a name="l00402"></a>00402       }
<a name="l00403"></a>00403       <span class="keywordflow">else</span>
<a name="l00404"></a>00404       {
<a name="l00405"></a>00405         <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* layer = <a class="code" href="classQgsSymbolLayerV2Utils.html#eb50541b19a247aa79a99f00b795e9f2">loadSymbolLayer</a>( e );
<a name="l00406"></a>00406         <span class="keywordflow">if</span> ( layer != NULL )
<a name="l00407"></a>00407           layers.append( layer );
<a name="l00408"></a>00408       }
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410     layerNode = layerNode.nextSibling();
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   <span class="keywordflow">if</span> ( layers.count() == 0 )
<a name="l00414"></a>00414   {
<a name="l00415"></a>00415     <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"no layers for symbol"</span> );
<a name="l00416"></a>00416     <span class="keywordflow">return</span> NULL;
<a name="l00417"></a>00417   }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   QString symbolType = element.attribute( <span class="stringliteral">"type"</span> );
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* symbol = 0;
<a name="l00422"></a>00422   <span class="keywordflow">if</span> ( symbolType == <span class="stringliteral">"line"</span> )
<a name="l00423"></a>00423     symbol = <span class="keyword">new</span> <a class="code" href="classQgsLineSymbolV2.html">QgsLineSymbolV2</a>( layers );
<a name="l00424"></a>00424   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( symbolType == <span class="stringliteral">"fill"</span> )
<a name="l00425"></a>00425     symbol = <span class="keyword">new</span> <a class="code" href="classQgsFillSymbolV2.html">QgsFillSymbolV2</a>( layers );
<a name="l00426"></a>00426   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( symbolType == <span class="stringliteral">"marker"</span> )
<a name="l00427"></a>00427     symbol = <span class="keyword">new</span> <a class="code" href="classQgsMarkerSymbolV2.html">QgsMarkerSymbolV2</a>( layers );
<a name="l00428"></a>00428   <span class="keywordflow">else</span>
<a name="l00429"></a>00429   {
<a name="l00430"></a>00430     <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"unknown symbol type "</span> + symbolType );
<a name="l00431"></a>00431     <span class="keywordflow">return</span> NULL;
<a name="l00432"></a>00432   }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434   symbol-&gt;<a class="code" href="classQgsSymbolV2.html#b7507bfcdaeca7242bf502602e8ada2e">setOutputUnit</a>( <a class="code" href="classQgsSymbolLayerV2Utils.html#71b0e8d945f0371ed96e170fd0d7062f">decodeOutputUnit</a>( element.attribute( <span class="stringliteral">"outputUnit"</span> ) ) );
<a name="l00435"></a>00435   symbol-&gt;<a class="code" href="classQgsSymbolV2.html#63f3806411733b2d2b7f7f438e558f74">setAlpha</a>( element.attribute( <span class="stringliteral">"alpha"</span>, <span class="stringliteral">"1.0"</span> ).toDouble() );
<a name="l00436"></a>00436 
<a name="l00437"></a>00437   <span class="keywordflow">return</span> symbol;
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#eb50541b19a247aa79a99f00b795e9f2">00440</a> <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* <a class="code" href="classQgsSymbolLayerV2Utils.html#eb50541b19a247aa79a99f00b795e9f2">QgsSymbolLayerV2Utils::loadSymbolLayer</a>( QDomElement&amp; element )
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442   QString layerClass = element.attribute( <span class="stringliteral">"class"</span> );
<a name="l00443"></a>00443   <span class="keywordtype">bool</span> locked = element.attribute( <span class="stringliteral">"locked"</span> ).toInt();
<a name="l00444"></a>00444   <span class="keywordtype">int</span> pass = element.attribute( <span class="stringliteral">"pass"</span> ).toInt();
<a name="l00445"></a>00445 
<a name="l00446"></a>00446   <span class="comment">// parse properties</span>
<a name="l00447"></a>00447   <a class="code" href="qgssymbollayerv2utils_8h.html#b13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props = <a class="code" href="classQgsSymbolLayerV2Utils.html#aba11031edbc30687446d38a7fb90ad7">parseProperties</a>( element );
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* layer;
<a name="l00450"></a>00450   layer = <a class="code" href="classQgsSymbolLayerV2Registry.html#a684b28fb452c4b56c43496fa7eba139" title="return the single instance of this class (instantiate it if not exists)">QgsSymbolLayerV2Registry::instance</a>()-&gt;<a class="code" href="classQgsSymbolLayerV2Registry.html#791fe6ecb3d9cd03f9a3cde1db3bb828" title="create a new instance of symbol layer given symbol layer name and properties">createSymbolLayer</a>( layerClass, props );
<a name="l00451"></a>00451   <span class="keywordflow">if</span> ( layer )
<a name="l00452"></a>00452   {
<a name="l00453"></a>00453     layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#15dc1d60ce7555106c67357504a0c354">setLocked</a>( locked );
<a name="l00454"></a>00454     layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#53ffb55f9589b6e5b8a2cbbd3a41a58b">setRenderingPass</a>( pass );
<a name="l00455"></a>00455     <span class="keywordflow">return</span> layer;
<a name="l00456"></a>00456   }
<a name="l00457"></a>00457   <span class="keywordflow">else</span>
<a name="l00458"></a>00458   {
<a name="l00459"></a>00459     <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"unknown class "</span> + layerClass );
<a name="l00460"></a>00460     <span class="keywordflow">return</span> NULL;
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a><a class="code" href="qgssymbollayerv2utils_8cpp.html#ba45b981e8cb255305f37dfb8c82daba">00464</a> <span class="keyword">static</span> QString <a class="code" href="qgssymbollayerv2utils_8cpp.html#ba45b981e8cb255305f37dfb8c82daba">_nameForSymbolType</a>( <a class="code" href="classQgsSymbolV2.html#5d1dc41b5e445d244383f02a237e95dd">QgsSymbolV2::SymbolType</a> type )
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   <span class="keywordflow">switch</span> ( type )
<a name="l00467"></a>00467   {
<a name="l00468"></a>00468     <span class="keywordflow">case</span> <a class="code" href="classQgsSymbolV2.html#5d1dc41b5e445d244383f02a237e95ddad15218ce2c6269c707ae0dd9ba50481">QgsSymbolV2::Line</a>: <span class="keywordflow">return</span> <span class="stringliteral">"line"</span>;
<a name="l00469"></a>00469     <span class="keywordflow">case</span> <a class="code" href="classQgsSymbolV2.html#5d1dc41b5e445d244383f02a237e95dd20de105177cc62462d5d9c9e4e63a791">QgsSymbolV2::Marker</a>: <span class="keywordflow">return</span> <span class="stringliteral">"marker"</span>;
<a name="l00470"></a>00470     <span class="keywordflow">case</span> <a class="code" href="classQgsSymbolV2.html#5d1dc41b5e445d244383f02a237e95ddf1c0cd5e0ff9c72aacc988abc6290ee3">QgsSymbolV2::Fill</a>: <span class="keywordflow">return</span> <span class="stringliteral">"fill"</span>;
<a name="l00471"></a>00471     <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l00472"></a>00472   }
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 
<a name="l00475"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#45f8d3234a33c7ace81115b9fac0d922">00475</a> QDomElement <a class="code" href="classQgsSymbolLayerV2Utils.html#45f8d3234a33c7ace81115b9fac0d922">QgsSymbolLayerV2Utils::saveSymbol</a>( QString name, <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* symbol, QDomDocument&amp; doc, <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a>* subSymbols )
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477   Q_ASSERT( symbol );
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   QDomElement symEl = doc.createElement( <span class="stringliteral">"symbol"</span> );
<a name="l00480"></a>00480   symEl.setAttribute( <span class="stringliteral">"type"</span>, <a class="code" href="qgssymbollayerv2utils_8cpp.html#ba45b981e8cb255305f37dfb8c82daba">_nameForSymbolType</a>( symbol-&gt;<a class="code" href="classQgsSymbolV2.html#a582dfed1c81b5714a5e219d2612d171">type</a>() ) );
<a name="l00481"></a>00481   symEl.setAttribute( <span class="stringliteral">"name"</span>, name );
<a name="l00482"></a>00482   symEl.setAttribute( <span class="stringliteral">"outputUnit"</span>, <a class="code" href="classQgsSymbolLayerV2Utils.html#658933661eb39b9fd5af92ff5222f442">encodeOutputUnit</a>( symbol-&gt;<a class="code" href="classQgsSymbolV2.html#78c9ca5bea9add7419f751607008de15">outputUnit</a>() ) );
<a name="l00483"></a>00483   symEl.setAttribute( <span class="stringliteral">"alpha"</span>, symbol-&gt;<a class="code" href="classQgsSymbolV2.html#9714891b54ccbcdafe49e534dc872b1e">alpha</a>() );
<a name="l00484"></a>00484   <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"num layers "</span> + QString::number( symbol-&gt;<a class="code" href="classQgsSymbolV2.html#45a4281959125392c456b44e1cebc8f3">symbolLayerCount</a>() ) );
<a name="l00485"></a>00485   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; symbol-&gt;<a class="code" href="classQgsSymbolV2.html#45a4281959125392c456b44e1cebc8f3">symbolLayerCount</a>(); i++ )
<a name="l00486"></a>00486   {
<a name="l00487"></a>00487     <a class="code" href="classQgsSymbolLayerV2.html">QgsSymbolLayerV2</a>* layer = symbol-&gt;<a class="code" href="classQgsSymbolV2.html#f7d0f51d232383934958eef6736ea23d">symbolLayer</a>( i );
<a name="l00488"></a>00488 
<a name="l00489"></a>00489     QDomElement layerEl = doc.createElement( <span class="stringliteral">"layer"</span> );
<a name="l00490"></a>00490     layerEl.setAttribute( <span class="stringliteral">"class"</span>, layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#649469c389d39326aab49fbe842d4598">layerType</a>() );
<a name="l00491"></a>00491     layerEl.setAttribute( <span class="stringliteral">"locked"</span>, layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#60129f218e6d14d1ef8831f82b40279d">isLocked</a>() );
<a name="l00492"></a>00492     layerEl.setAttribute( <span class="stringliteral">"pass"</span>, layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#6d66d480f0209d093fa3883cfd56a2be">renderingPass</a>() );
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="keywordflow">if</span> ( subSymbols != NULL &amp;&amp; layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#11ce7363354949d402bbb5515503738e">subSymbol</a>() != NULL )
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496       QString subname = QString( <span class="stringliteral">"@%1@%2"</span> ).arg( name ).arg( i );
<a name="l00497"></a>00497       subSymbols-&gt;insert( subname, layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#11ce7363354949d402bbb5515503738e">subSymbol</a>() );
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <a class="code" href="classQgsSymbolLayerV2Utils.html#34f12e56d708c00be6d845079185a263">saveProperties</a>( layer-&gt;<a class="code" href="classQgsSymbolLayerV2.html#eeefd77c7195b8542df1a1c4b6be6f7a">properties</a>(), doc, layerEl );
<a name="l00501"></a>00501     symEl.appendChild( layerEl );
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="keywordflow">return</span> symEl;
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#aba11031edbc30687446d38a7fb90ad7">00508</a> <a class="code" href="qgssymbollayerv2utils_8h.html#b13d4e9821da606b92748097c691b9dd">QgsStringMap</a> <a class="code" href="classQgsSymbolLayerV2Utils.html#aba11031edbc30687446d38a7fb90ad7">QgsSymbolLayerV2Utils::parseProperties</a>( QDomElement&amp; element )
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510   <a class="code" href="qgssymbollayerv2utils_8h.html#b13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props;
<a name="l00511"></a>00511   QDomElement e = element.firstChildElement();
<a name="l00512"></a>00512   <span class="keywordflow">while</span> ( !e.isNull() )
<a name="l00513"></a>00513   {
<a name="l00514"></a>00514     <span class="keywordflow">if</span> ( e.tagName() != <span class="stringliteral">"prop"</span> )
<a name="l00515"></a>00515     {
<a name="l00516"></a>00516       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"unknown tag "</span> + e.tagName() );
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518     <span class="keywordflow">else</span>
<a name="l00519"></a>00519     {
<a name="l00520"></a>00520       QString propKey = e.attribute( <span class="stringliteral">"k"</span> );
<a name="l00521"></a>00521       QString propValue = e.attribute( <span class="stringliteral">"v"</span> );
<a name="l00522"></a>00522       props[propKey] = propValue;
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524     e = e.nextSiblingElement();
<a name="l00525"></a>00525   }
<a name="l00526"></a>00526   <span class="keywordflow">return</span> props;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#34f12e56d708c00be6d845079185a263">00530</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSymbolLayerV2Utils.html#34f12e56d708c00be6d845079185a263">QgsSymbolLayerV2Utils::saveProperties</a>( <a class="code" href="qgssymbollayerv2utils_8h.html#b13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props, QDomDocument&amp; doc, QDomElement&amp; element )
<a name="l00531"></a>00531 {
<a name="l00532"></a>00532   <span class="keywordflow">for</span> ( QgsStringMap::iterator it = props.begin(); it != props.end(); ++it )
<a name="l00533"></a>00533   {
<a name="l00534"></a>00534     QDomElement propEl = doc.createElement( <span class="stringliteral">"prop"</span> );
<a name="l00535"></a>00535     propEl.setAttribute( <span class="stringliteral">"k"</span>, it.key() );
<a name="l00536"></a>00536     propEl.setAttribute( <span class="stringliteral">"v"</span>, it.value() );
<a name="l00537"></a>00537     element.appendChild( propEl );
<a name="l00538"></a>00538   }
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#045dfbcf12255f59ad14edae4e31bfef">00541</a> <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a> <a class="code" href="classQgsSymbolLayerV2Utils.html#045dfbcf12255f59ad14edae4e31bfef">QgsSymbolLayerV2Utils::loadSymbols</a>( QDomElement&amp; element )
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543   <span class="comment">// go through symbols one-by-one and load them</span>
<a name="l00544"></a>00544 
<a name="l00545"></a>00545   <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a> symbols;
<a name="l00546"></a>00546   QDomElement e = element.firstChildElement();
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <span class="keywordflow">while</span> ( !e.isNull() )
<a name="l00549"></a>00549   {
<a name="l00550"></a>00550     <span class="keywordflow">if</span> ( e.tagName() == <span class="stringliteral">"symbol"</span> )
<a name="l00551"></a>00551     {
<a name="l00552"></a>00552       <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* symbol = <a class="code" href="classQgsSymbolLayerV2Utils.html#eb26044ca3b2ce149bf2a02075e3f15a">QgsSymbolLayerV2Utils::loadSymbol</a>( e );
<a name="l00553"></a>00553       <span class="keywordflow">if</span> ( symbol != NULL )
<a name="l00554"></a>00554         symbols.insert( e.attribute( <span class="stringliteral">"name"</span> ), symbol );
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556     <span class="keywordflow">else</span>
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"unknown tag: "</span> + e.tagName() );
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560     e = e.nextSiblingElement();
<a name="l00561"></a>00561   }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   <span class="comment">// now walk through the list of symbols and find those prefixed with @</span>
<a name="l00565"></a>00565   <span class="comment">// these symbols are sub-symbols of some other symbol layers</span>
<a name="l00566"></a>00566   <span class="comment">// e.g. symbol named "@foo@1" is sub-symbol of layer 1 in symbol "foo"</span>
<a name="l00567"></a>00567   QStringList subsymbols;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <span class="keywordflow">for</span> ( QMap&lt;QString, QgsSymbolV2*&gt;::iterator it = symbols.begin(); it != symbols.end(); ++it )
<a name="l00570"></a>00570   {
<a name="l00571"></a>00571     <span class="keywordflow">if</span> ( it.key()[0] != <span class="charliteral">'@'</span> )
<a name="l00572"></a>00572       <span class="keywordflow">continue</span>;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <span class="comment">// add to array (for deletion)</span>
<a name="l00575"></a>00575     subsymbols.append( it.key() );
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     QStringList parts = it.key().split( <span class="stringliteral">"@"</span> );
<a name="l00578"></a>00578     <span class="keywordflow">if</span> ( parts.count() &lt; 3 )
<a name="l00579"></a>00579     {
<a name="l00580"></a>00580       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"found subsymbol with invalid name: "</span> + it.key() );
<a name="l00581"></a>00581       <span class="keyword">delete</span> it.value(); <span class="comment">// we must delete it</span>
<a name="l00582"></a>00582       <span class="keywordflow">continue</span>; <span class="comment">// some invalid syntax</span>
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584     QString symname = parts[1];
<a name="l00585"></a>00585     <span class="keywordtype">int</span> symlayer = parts[2].toInt();
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="keywordflow">if</span> ( !symbols.contains( symname ) )
<a name="l00588"></a>00588     {
<a name="l00589"></a>00589       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"subsymbol references invalid symbol: "</span> + symname );
<a name="l00590"></a>00590       <span class="keyword">delete</span> it.value(); <span class="comment">// we must delete it</span>
<a name="l00591"></a>00591       <span class="keywordflow">continue</span>;
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* sym = symbols[symname];
<a name="l00595"></a>00595     <span class="keywordflow">if</span> ( symlayer &lt; 0 || symlayer &gt;= sym-&gt;<a class="code" href="classQgsSymbolV2.html#45a4281959125392c456b44e1cebc8f3">symbolLayerCount</a>() )
<a name="l00596"></a>00596     {
<a name="l00597"></a>00597       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"subsymbol references invalid symbol layer: "</span> + QString::number( symlayer ) );
<a name="l00598"></a>00598       <span class="keyword">delete</span> it.value(); <span class="comment">// we must delete it</span>
<a name="l00599"></a>00599       <span class="keywordflow">continue</span>;
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <span class="comment">// set subsymbol takes ownership</span>
<a name="l00603"></a>00603     <span class="keywordtype">bool</span> res = sym-&gt;<a class="code" href="classQgsSymbolV2.html#f7d0f51d232383934958eef6736ea23d">symbolLayer</a>( symlayer )-&gt;<a class="code" href="classQgsSymbolLayerV2.html#7c473878e17645082e8be7b7d2f3c6e4">setSubSymbol</a>( it.value() );
<a name="l00604"></a>00604     <span class="keywordflow">if</span> ( !res )
<a name="l00605"></a>00605     {
<a name="l00606"></a>00606       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"symbol layer refused subsymbol: "</span> + it.key() );
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   <span class="comment">// now safely remove sub-symbol entries (they have been already deleted or the ownership was taken away)</span>
<a name="l00613"></a>00613   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; subsymbols.count(); i++ )
<a name="l00614"></a>00614     symbols.take( subsymbols[i] );
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="keywordflow">return</span> symbols;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#2b4e58c54b0097f3b7263826a0004b91">00619</a> QDomElement <a class="code" href="classQgsSymbolLayerV2Utils.html#2b4e58c54b0097f3b7263826a0004b91">QgsSymbolLayerV2Utils::saveSymbols</a>( <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a>&amp; symbols, QString tagName, QDomDocument&amp; doc )
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621   QDomElement symbolsElem = doc.createElement( tagName );
<a name="l00622"></a>00622 
<a name="l00623"></a>00623   QMap&lt;QString, QgsSymbolV2*&gt; subSymbols;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625   <span class="comment">// save symbols</span>
<a name="l00626"></a>00626   <span class="keywordflow">for</span> ( QMap&lt;QString, QgsSymbolV2*&gt;::iterator its = symbols.begin(); its != symbols.end(); ++its )
<a name="l00627"></a>00627   {
<a name="l00628"></a>00628     QDomElement symEl = <a class="code" href="classQgsSymbolLayerV2Utils.html#45f8d3234a33c7ace81115b9fac0d922">saveSymbol</a>( its.key(), its.value(), doc, &amp;subSymbols );
<a name="l00629"></a>00629     symbolsElem.appendChild( symEl );
<a name="l00630"></a>00630   }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632   <span class="comment">// add subsymbols, don't allow subsymbols for them (to keep things simple)</span>
<a name="l00633"></a>00633   <span class="keywordflow">for</span> ( QMap&lt;QString, QgsSymbolV2*&gt;::iterator itsub = subSymbols.begin(); itsub != subSymbols.end(); ++itsub )
<a name="l00634"></a>00634   {
<a name="l00635"></a>00635     QDomElement subsymEl = <a class="code" href="classQgsSymbolLayerV2Utils.html#45f8d3234a33c7ace81115b9fac0d922">saveSymbol</a>( itsub.key(), itsub.value(), doc );
<a name="l00636"></a>00636     symbolsElem.appendChild( subsymEl );
<a name="l00637"></a>00637   }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="keywordflow">return</span> symbolsElem;
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#6eb691949007752b46fd423db2f4918d">00642</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSymbolLayerV2Utils.html#6eb691949007752b46fd423db2f4918d">QgsSymbolLayerV2Utils::clearSymbolMap</a>( <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a>&amp; symbols )
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644   <span class="keywordflow">foreach</span>( QString name, symbols.keys() )
<a name="l00645"></a>00645   <span class="keyword">delete</span> symbols.value( name );
<a name="l00646"></a>00646   symbols.clear();
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 
<a name="l00650"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#201aed53e03fa1c2c483a1e4498360d0">00650</a> <a class="code" href="classQgsVectorColorRampV2.html">QgsVectorColorRampV2</a>* <a class="code" href="classQgsSymbolLayerV2Utils.html#201aed53e03fa1c2c483a1e4498360d0">QgsSymbolLayerV2Utils::loadColorRamp</a>( QDomElement&amp; element )
<a name="l00651"></a>00651 {
<a name="l00652"></a>00652   QString rampType = element.attribute( <span class="stringliteral">"type"</span> );
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="comment">// parse properties</span>
<a name="l00655"></a>00655   <a class="code" href="qgssymbollayerv2utils_8h.html#b13d4e9821da606b92748097c691b9dd">QgsStringMap</a> props = <a class="code" href="classQgsSymbolLayerV2Utils.html#aba11031edbc30687446d38a7fb90ad7">QgsSymbolLayerV2Utils::parseProperties</a>( element );
<a name="l00656"></a>00656 
<a name="l00657"></a>00657   <span class="keywordflow">if</span> ( rampType == <span class="stringliteral">"gradient"</span> )
<a name="l00658"></a>00658     <span class="keywordflow">return</span> <a class="code" href="classQgsVectorGradientColorRampV2.html#d581ef5ca1713afa59db315c59a1e893">QgsVectorGradientColorRampV2::create</a>( props );
<a name="l00659"></a>00659   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( rampType == <span class="stringliteral">"random"</span> )
<a name="l00660"></a>00660     <span class="keywordflow">return</span> <a class="code" href="classQgsVectorRandomColorRampV2.html#35c12b1c4ecc3fbc0591eab6ca7ea1db">QgsVectorRandomColorRampV2::create</a>( props );
<a name="l00661"></a>00661   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( rampType == <span class="stringliteral">"colorbrewer"</span> )
<a name="l00662"></a>00662     <span class="keywordflow">return</span> <a class="code" href="classQgsVectorColorBrewerColorRampV2.html#8fd72f093cc56b8a9438a2d3ccbcfcf2">QgsVectorColorBrewerColorRampV2::create</a>( props );
<a name="l00663"></a>00663   <span class="keywordflow">else</span>
<a name="l00664"></a>00664   {
<a name="l00665"></a>00665     <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"unknown colorramp type "</span> + rampType );
<a name="l00666"></a>00666     <span class="keywordflow">return</span> NULL;
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 
<a name="l00671"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#aa61a339ffba55e350f493bf3de2866d">00671</a> QDomElement <a class="code" href="classQgsSymbolLayerV2Utils.html#aa61a339ffba55e350f493bf3de2866d">QgsSymbolLayerV2Utils::saveColorRamp</a>( QString name, <a class="code" href="classQgsVectorColorRampV2.html">QgsVectorColorRampV2</a>* ramp, QDomDocument&amp; doc )
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673   QDomElement rampEl = doc.createElement( <span class="stringliteral">"colorramp"</span> );
<a name="l00674"></a>00674   rampEl.setAttribute( <span class="stringliteral">"type"</span>, ramp-&gt;<a class="code" href="classQgsVectorColorRampV2.html#bb45737ec43efa535110fb7236654948">type</a>() );
<a name="l00675"></a>00675   rampEl.setAttribute( <span class="stringliteral">"name"</span>, name );
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <a class="code" href="classQgsSymbolLayerV2Utils.html#34f12e56d708c00be6d845079185a263">QgsSymbolLayerV2Utils::saveProperties</a>( ramp-&gt;<a class="code" href="classQgsVectorColorRampV2.html#d4d01c51cf2d065dfa756a5127c6699a">properties</a>(), doc, rampEl );
<a name="l00678"></a>00678   <span class="keywordflow">return</span> rampEl;
<a name="l00679"></a>00679 }
<a name="l00680"></a>00680 
<a name="l00681"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#f830d37febc022300af542f1c298a562">00681</a> <span class="keywordtype">double</span> <a class="code" href="classQgsSymbolLayerV2Utils.html#f830d37febc022300af542f1c298a562" title="Returns the line width scale factor depending on the unit and the paint device.">QgsSymbolLayerV2Utils::lineWidthScaleFactor</a>( <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a>&amp; c, <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5">QgsSymbolV2::OutputUnit</a> u )
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="keywordflow">if</span> ( u == <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5a16772c4bcbb62aea03204507411e9e4">QgsSymbolV2::MM</a> )
<a name="l00685"></a>00685   {
<a name="l00686"></a>00686     <span class="keywordflow">return</span> c.<a class="code" href="classQgsRenderContext.html#f4b93052d1a48544b5cd7103a7596acb">scaleFactor</a>();
<a name="l00687"></a>00687   }
<a name="l00688"></a>00688   <span class="keywordflow">else</span> <span class="comment">//QgsSymbol::MapUnit</span>
<a name="l00689"></a>00689   {
<a name="l00690"></a>00690     <span class="keywordtype">double</span> mup = c.<a class="code" href="classQgsRenderContext.html#be5b3cb445070d6f5343132d6c347e65">mapToPixel</a>().<a class="code" href="classQgsMapToPixel.html#d8c374aa5e47057d4c2f45a5ced78bd0" title="Return current map units per pixel.">mapUnitsPerPixel</a>();
<a name="l00691"></a>00691     <span class="keywordflow">if</span> ( mup &gt; 0 )
<a name="l00692"></a>00692     {
<a name="l00693"></a>00693       <span class="keywordflow">return</span> 1.0 / mup;
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695     <span class="keywordflow">else</span>
<a name="l00696"></a>00696     {
<a name="l00697"></a>00697       <span class="keywordflow">return</span> 1.0;
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699   }
<a name="l00700"></a>00700 }
<a name="l00701"></a>00701 
<a name="l00702"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#0ebef6832ef61502fc069e09ffe28193">00702</a> <span class="keywordtype">double</span> <a class="code" href="classQgsSymbolLayerV2Utils.html#0ebef6832ef61502fc069e09ffe28193" title="Returns scale factor painter units -&amp;gt; pixel dimensions.">QgsSymbolLayerV2Utils::pixelSizeScaleFactor</a>( <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a>&amp; c, <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5">QgsSymbolV2::OutputUnit</a> u )
<a name="l00703"></a>00703 {
<a name="l00704"></a>00704   <span class="keywordflow">if</span> ( u == <a class="code" href="classQgsSymbolV2.html#b8fc576fe626ba0c5865c8dc3a9eb8f5a16772c4bcbb62aea03204507411e9e4">QgsSymbolV2::MM</a> )
<a name="l00705"></a>00705   {
<a name="l00706"></a>00706     <span class="keywordflow">return</span> ( c.<a class="code" href="classQgsRenderContext.html#f4b93052d1a48544b5cd7103a7596acb">scaleFactor</a>() * c.<a class="code" href="classQgsRenderContext.html#499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>() );
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708   <span class="keywordflow">else</span> <span class="comment">//QgsSymbol::MapUnit</span>
<a name="l00709"></a>00709   {
<a name="l00710"></a>00710     <span class="keywordtype">double</span> mup = c.<a class="code" href="classQgsRenderContext.html#be5b3cb445070d6f5343132d6c347e65">mapToPixel</a>().<a class="code" href="classQgsMapToPixel.html#d8c374aa5e47057d4c2f45a5ced78bd0" title="Return current map units per pixel.">mapUnitsPerPixel</a>();
<a name="l00711"></a>00711     <span class="keywordflow">if</span> ( mup &gt; 0 )
<a name="l00712"></a>00712     {
<a name="l00713"></a>00713       <span class="keywordflow">return</span> c.<a class="code" href="classQgsRenderContext.html#499f7c7cb3dad9ea71f0f3e83760fe0b">rasterScaleFactor</a>() / c.<a class="code" href="classQgsRenderContext.html#be5b3cb445070d6f5343132d6c347e65">mapToPixel</a>().<a class="code" href="classQgsMapToPixel.html#d8c374aa5e47057d4c2f45a5ced78bd0" title="Return current map units per pixel.">mapUnitsPerPixel</a>();
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715     <span class="keywordflow">else</span>
<a name="l00716"></a>00716     {
<a name="l00717"></a>00717       <span class="keywordflow">return</span> 1.0;
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719   }
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00722"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#47a6843936d926609917de666cc81fec">00722</a> <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a> <a class="code" href="classQgsSymbolLayerV2Utils.html#47a6843936d926609917de666cc81fec" title="Creates a render context for a pixel based device.">QgsSymbolLayerV2Utils::createRenderContext</a>( QPainter* p )
<a name="l00723"></a>00723 {
<a name="l00724"></a>00724   <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a> context;
<a name="l00725"></a>00725   context.<a class="code" href="classQgsRenderContext.html#be42574149f534251692dc3f3212bafa">setPainter</a>( p );
<a name="l00726"></a>00726   context.<a class="code" href="classQgsRenderContext.html#054725b49ba62bbe41b26285712379b8">setRasterScaleFactor</a>( 1.0 );
<a name="l00727"></a>00727   <span class="keywordflow">if</span> ( p &amp;&amp; p-&gt;device() )
<a name="l00728"></a>00728   {
<a name="l00729"></a>00729     context.<a class="code" href="classQgsRenderContext.html#22162d18b545e59518c8fa9ce72a3b37">setScaleFactor</a>( p-&gt;device()-&gt;logicalDpiX() / 25.4 );
<a name="l00730"></a>00730   }
<a name="l00731"></a>00731   <span class="keywordflow">else</span>
<a name="l00732"></a>00732   {
<a name="l00733"></a>00733     context.<a class="code" href="classQgsRenderContext.html#22162d18b545e59518c8fa9ce72a3b37">setScaleFactor</a>( 3.465 ); <span class="comment">//assume 88 dpi as standard value</span>
<a name="l00734"></a>00734   }
<a name="l00735"></a>00735   <span class="keywordflow">return</span> context;
<a name="l00736"></a>00736 }
<a name="l00737"></a>00737 
<a name="l00738"></a><a class="code" href="classQgsSymbolLayerV2Utils.html#cca307af6bd85500a8308b921589bfac">00738</a> <span class="keywordtype">void</span> <a class="code" href="classQgsSymbolLayerV2Utils.html#cca307af6bd85500a8308b921589bfac" title="Multiplies opacity of image pixel values with a (global) transparency value.">QgsSymbolLayerV2Utils::multiplyImageOpacity</a>( QImage* image, qreal alpha )
<a name="l00739"></a>00739 {
<a name="l00740"></a>00740   <span class="keywordflow">if</span> ( !image )
<a name="l00741"></a>00741   {
<a name="l00742"></a>00742     <span class="keywordflow">return</span>;
<a name="l00743"></a>00743   }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745   QRgb myRgb;
<a name="l00746"></a>00746   QImage::Format format = image-&gt;format();
<a name="l00747"></a>00747   <span class="keywordflow">if</span> ( format != QImage::Format_ARGB32_Premultiplied &amp;&amp; format != QImage::Format_ARGB32 )
<a name="l00748"></a>00748   {
<a name="l00749"></a>00749     <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"no alpha channel."</span> );
<a name="l00750"></a>00750     <span class="keywordflow">return</span>;
<a name="l00751"></a>00751   }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753   <span class="comment">//change the alpha component of every pixel</span>
<a name="l00754"></a>00754   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> heightIndex = 0; heightIndex &lt; image-&gt;height(); ++heightIndex )
<a name="l00755"></a>00755   {
<a name="l00756"></a>00756     QRgb* scanLine = ( QRgb* )image-&gt;scanLine( heightIndex );
<a name="l00757"></a>00757     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> widthIndex = 0; widthIndex &lt; image-&gt;width(); ++widthIndex )
<a name="l00758"></a>00758     {
<a name="l00759"></a>00759       myRgb = scanLine[widthIndex];
<a name="l00760"></a>00760       <span class="keywordflow">if</span> ( format == QImage::Format_ARGB32_Premultiplied )
<a name="l00761"></a>00761         scanLine[widthIndex] = qRgba( alpha * qRed( myRgb ), alpha * qGreen( myRgb ), alpha * qBlue( myRgb ), alpha * qAlpha( myRgb ) );
<a name="l00762"></a>00762       <span class="keywordflow">else</span>
<a name="l00763"></a>00763         scanLine[widthIndex] = qRgba( qRed( myRgb ), qGreen( myRgb ), qBlue( myRgb ), alpha * qAlpha( myRgb ) );
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765   }
<a name="l00766"></a>00766 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Feb 4 19:16:07 2012 for Quantum GIS API Documentation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
