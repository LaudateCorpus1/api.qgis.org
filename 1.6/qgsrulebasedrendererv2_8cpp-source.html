<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Quantum GIS API Documentation: src/core/symbology-ng/qgsrulebasedrendererv2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>src/core/symbology-ng/qgsrulebasedrendererv2.cpp</h1><a href="qgsrulebasedrendererv2_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">    qgsrulebasedrendererv2.cpp - Rule-based renderer (symbology-ng)</span>
<a name="l00003"></a>00003 <span class="comment">    ---------------------</span>
<a name="l00004"></a>00004 <span class="comment">    begin                : May 2010</span>
<a name="l00005"></a>00005 <span class="comment">    copyright            : (C) 2010 by Martin Dobias</span>
<a name="l00006"></a>00006 <span class="comment">    email                : wonder.sk at gmail.com</span>
<a name="l00007"></a>00007 <span class="comment"> ***************************************************************************</span>
<a name="l00008"></a>00008 <span class="comment"> *                                                                         *</span>
<a name="l00009"></a>00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00010"></a>00010 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00011"></a>00011 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00012"></a>00012 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00013"></a>00013 <span class="comment"> *                                                                         *</span>
<a name="l00014"></a>00014 <span class="comment"> ***************************************************************************/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include "<a class="code" href="qgsrulebasedrendererv2_8h.html">qgsrulebasedrendererv2.h</a>"</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="qgssearchtreenode_8h.html">qgssearchtreenode.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="qgssymbollayerv2utils_8h.html">qgssymbollayerv2utils.h</a>"</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="qgsrendercontext_8h.html">qgsrendercontext.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="qgsvectorlayer_8h.html">qgsvectorlayer.h</a>"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="qgslogger_8h.html">qgslogger.h</a>"</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;QSet&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;QDomDocument&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;QDomElement&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8efa9a20f31df8f0637252c2799e9894">00031</a> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8efa9a20f31df8f0637252c2799e9894" title="Constructor takes ownership of the symbol.">QgsRuleBasedRendererV2::Rule::Rule</a>( <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* symbol, <span class="keywordtype">int</span> scaleMinDenom, <span class="keywordtype">int</span> scaleMaxDenom, QString filterExp )
<a name="l00032"></a>00032     : mSymbol( symbol ),
<a name="l00033"></a>00033     mScaleMinDenom( scaleMinDenom ), mScaleMaxDenom( scaleMaxDenom ),
<a name="l00034"></a>00034     mFilterExp( filterExp )
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036   <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4706519d519777b88ea01b8d9c3d95f2">initFilter</a>();
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#0bc33edd9779d30b8af25d75e507b03c">00039</a> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8efa9a20f31df8f0637252c2799e9894" title="Constructor takes ownership of the symbol.">QgsRuleBasedRendererV2::Rule::Rule</a>( <span class="keyword">const</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; other )
<a name="l00040"></a>00040     : <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#87cad2aaeceebe6cc08761e72b9acf00">mSymbol</a>( NULL )
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042   *<span class="keyword">this</span> = other;
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#06a2c7026dbf97f2f80ee78d47a10925">00045</a> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#06a2c7026dbf97f2f80ee78d47a10925">QgsRuleBasedRendererV2::Rule::~Rule</a>()
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047   <span class="keyword">delete</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#87cad2aaeceebe6cc08761e72b9acf00">mSymbol</a>;
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4706519d519777b88ea01b8d9c3d95f2">00050</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4706519d519777b88ea01b8d9c3d95f2">QgsRuleBasedRendererV2::Rule::initFilter</a>()
<a name="l00051"></a>00051 {
<a name="l00052"></a>00052   <span class="keywordflow">if</span> ( !<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#7275ccd838950790498d11c5f40b2124">mFilterExp</a>.isEmpty() )
<a name="l00053"></a>00053   {
<a name="l00054"></a>00054     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#233beba8384273cec9ebd9a22c9f492d">mFilterParsed</a>.<a class="code" href="classQgsSearchString.html#2a256f563b3517e83bc959bc49d6e134" title="sets search string and parses search tree on success returns true and sets member...">setString</a>( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#7275ccd838950790498d11c5f40b2124">mFilterExp</a> );
<a name="l00055"></a>00055     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4d84e4f51de8ce3959f74d5fe141c7dd">mFilterTree</a> = <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#233beba8384273cec9ebd9a22c9f492d">mFilterParsed</a>.<a class="code" href="classQgsSearchString.html#e50b1bf66aed8c14be6fdc7e4f6d81f8" title="getter functions">tree</a>(); <span class="comment">// may be NULL if there's no input</span>
<a name="l00056"></a>00056   }
<a name="l00057"></a>00057   <span class="keywordflow">else</span>
<a name="l00058"></a>00058   {
<a name="l00059"></a>00059     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4d84e4f51de8ce3959f74d5fe141c7dd">mFilterTree</a> = NULL;
<a name="l00060"></a>00060   }
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c283cf34f9bacf8039f30629a710b162">00063</a> QString <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c283cf34f9bacf8039f30629a710b162">QgsRuleBasedRendererV2::Rule::dump</a>()<span class="keyword"> const</span>
<a name="l00064"></a>00064 <span class="keyword"></span>{
<a name="l00065"></a>00065   <span class="keywordflow">return</span> QString( <span class="stringliteral">"RULE - scale [%1,%2] - filter %3 - symbol %4"</span> )
<a name="l00066"></a>00066          .arg( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#12a869c23cd7b20700e5d190b12a0eea">mScaleMinDenom</a> ).arg( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c93655c07682e55e750bdd47aed799a8">mScaleMaxDenom</a> )
<a name="l00067"></a>00067          .arg( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#7275ccd838950790498d11c5f40b2124">mFilterExp</a> ).arg( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#87cad2aaeceebe6cc08761e72b9acf00">mSymbol</a>-&gt;<a class="code" href="classQgsSymbolV2.html#cbc965208ce32b48671389cb5a9a88dd">dump</a>() );
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#54aac5e8a7a43249811374c3c037c6d7">00071</a> QStringList <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#54aac5e8a7a43249811374c3c037c6d7">QgsRuleBasedRendererV2::Rule::needsFields</a>()<span class="keyword"> const</span>
<a name="l00072"></a>00072 <span class="keyword"></span>{
<a name="l00073"></a>00073   <span class="keywordflow">if</span> ( ! <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4d84e4f51de8ce3959f74d5fe141c7dd">mFilterTree</a> )
<a name="l00074"></a>00074     <span class="keywordflow">return</span> QStringList();
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <span class="keywordflow">return</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4d84e4f51de8ce3959f74d5fe141c7dd">mFilterTree</a>-&gt;<a class="code" href="classQgsSearchTreeNode.html#5ff478a37b892641e1373089b86e1d76" title="return a list of referenced columns in the tree">referencedColumns</a>();
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#1827572cb00ff6cf30e53620cfc172b7">00079</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#1827572cb00ff6cf30e53620cfc172b7">QgsRuleBasedRendererV2::Rule::isFilterOK</a>( <span class="keyword">const</span> <a class="code" href="qgsfield_8h.html#acd5afec301c03ed9499abb2bad2554b">QgsFieldMap</a>&amp; fields, <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a...">QgsFeature</a>&amp; f )<span class="keyword"> const</span>
<a name="l00080"></a>00080 <span class="keyword"></span>{
<a name="l00081"></a>00081   <span class="keywordflow">if</span> ( ! <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4d84e4f51de8ce3959f74d5fe141c7dd">mFilterTree</a> )
<a name="l00082"></a>00082     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keywordtype">bool</span> res = <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4d84e4f51de8ce3959f74d5fe141c7dd">mFilterTree</a>-&gt;<a class="code" href="classQgsSearchTreeNode.html#c8cffbb0aa18c85e592ee0546f4e1363" title="checks whether the node tree is valid against supplied attributes">checkAgainst</a>( fields, f );
<a name="l00085"></a>00085   <span class="comment">//print "is_ok", res, feature.id(), feature.attributeMap()</span>
<a name="l00086"></a>00086   <span class="keywordflow">return</span> res;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#529994dbf1622af84cca3a620f948a54">00089</a> <span class="keywordtype">bool</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#529994dbf1622af84cca3a620f948a54">QgsRuleBasedRendererV2::Rule::isScaleOK</a>( <span class="keywordtype">double</span> scale )<span class="keyword"> const</span>
<a name="l00090"></a>00090 <span class="keyword"></span>{
<a name="l00091"></a>00091   <span class="keywordflow">if</span> ( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#12a869c23cd7b20700e5d190b12a0eea">mScaleMinDenom</a> == 0 &amp;&amp; <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c93655c07682e55e750bdd47aed799a8">mScaleMaxDenom</a> == 0 )
<a name="l00092"></a>00092     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00093"></a>00093   <span class="keywordflow">if</span> ( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#12a869c23cd7b20700e5d190b12a0eea">mScaleMinDenom</a> != 0 &amp;&amp; <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#12a869c23cd7b20700e5d190b12a0eea">mScaleMinDenom</a> &gt; scale )
<a name="l00094"></a>00094     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00095"></a>00095   <span class="keywordflow">if</span> ( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c93655c07682e55e750bdd47aed799a8">mScaleMaxDenom</a> != 0 &amp;&amp; <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c93655c07682e55e750bdd47aed799a8">mScaleMaxDenom</a> &lt; scale )
<a name="l00096"></a>00096     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00097"></a>00097   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#ce671865571935af3f178dbb771608c1">00100</a> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#ce671865571935af3f178dbb771608c1">QgsRuleBasedRendererV2::Rule::operator=</a>( <span class="keyword">const</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a> &amp; other )
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102   <span class="keywordflow">if</span> ( <span class="keyword">this</span> != &amp;other )
<a name="l00103"></a>00103   {
<a name="l00104"></a>00104     <span class="keyword">delete</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#87cad2aaeceebe6cc08761e72b9acf00">mSymbol</a>;
<a name="l00105"></a>00105     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#87cad2aaeceebe6cc08761e72b9acf00">mSymbol</a> = other.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#87cad2aaeceebe6cc08761e72b9acf00">mSymbol</a>-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>();
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#12a869c23cd7b20700e5d190b12a0eea">mScaleMinDenom</a> = other.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#12a869c23cd7b20700e5d190b12a0eea">mScaleMinDenom</a>;
<a name="l00108"></a>00108     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c93655c07682e55e750bdd47aed799a8">mScaleMaxDenom</a> = other.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#c93655c07682e55e750bdd47aed799a8">mScaleMaxDenom</a>;
<a name="l00109"></a>00109     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#7275ccd838950790498d11c5f40b2124">mFilterExp</a> = other.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#7275ccd838950790498d11c5f40b2124">mFilterExp</a>;
<a name="l00110"></a>00110     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#4706519d519777b88ea01b8d9c3d95f2">initFilter</a>();
<a name="l00111"></a>00111   }
<a name="l00112"></a>00112   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="classQgsRuleBasedRendererV2.html#8304f3ad113319d904b9b28a17c0527a">00117</a> <a class="code" href="classQgsRuleBasedRendererV2.html#8304f3ad113319d904b9b28a17c0527a" title="Constructor. Takes ownership of the defult symbol.">QgsRuleBasedRendererV2::QgsRuleBasedRendererV2</a>( <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* defaultSymbol )
<a name="l00118"></a>00118     : <a class="code" href="classQgsFeatureRendererV2.html">QgsFeatureRendererV2</a>( <span class="stringliteral">"RuleRenderer"</span> )
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120   <a class="code" href="classQgsRuleBasedRendererV2.html#04831ea884ae2c6bfbca43da029f6107" title="the default symbol, used for the first rule with no filter">mDefaultSymbol</a> = defaultSymbol;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122   <span class="comment">// add the default rule</span>
<a name="l00123"></a>00123   <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a> &lt;&lt; <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>( defaultSymbol-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>() );
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="classQgsRuleBasedRendererV2.html#5bd410ef076cfc3d9060b539fb33f649">00127</a> <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* <a class="code" href="classQgsRuleBasedRendererV2.html#5bd410ef076cfc3d9060b539fb33f649" title="return symbol for current feature. Should not be used individually: there could be...">QgsRuleBasedRendererV2::symbolForFeature</a>( <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a...">QgsFeature</a>&amp; feature )
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129   <span class="keywordflow">return</span> <a class="code" href="classQgsRuleBasedRendererV2.html#61560618e13cdc010d168feca5feb0b8">mCurrentSymbol</a>;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="classQgsRuleBasedRendererV2.html#e5bf997a129bfd2ee9500b316475a6cc">00132</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#e5bf997a129bfd2ee9500b316475a6cc">QgsRuleBasedRendererV2::renderFeature</a>( <a class="code" href="classQgsFeature.html" title="The feature class encapsulates a single feature including its id, geometry and a...">QgsFeature</a>&amp; feature,
<a name="l00133"></a>00133     <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a>&amp; context,
<a name="l00134"></a>00134     <span class="keywordtype">int</span> layer,
<a name="l00135"></a>00135     <span class="keywordtype">bool</span> selected,
<a name="l00136"></a>00136     <span class="keywordtype">bool</span> drawVertexMarker )
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138   <span class="keywordflow">for</span> ( QList&lt;Rule*&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.end(); ++it )
<a name="l00139"></a>00139   {
<a name="l00140"></a>00140     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>* rule = *it;
<a name="l00141"></a>00141     <span class="keywordflow">if</span> ( rule-&gt;<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#1827572cb00ff6cf30e53620cfc172b7">isFilterOK</a>( <a class="code" href="classQgsRuleBasedRendererV2.html#9f1875b03d56050c4894d72e1bb92076">mCurrentFields</a>, feature ) )
<a name="l00142"></a>00142     {
<a name="l00143"></a>00143       <a class="code" href="classQgsRuleBasedRendererV2.html#61560618e13cdc010d168feca5feb0b8">mCurrentSymbol</a> = rule-&gt;<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>();
<a name="l00144"></a>00144       <span class="comment">// will ask for mCurrentSymbol</span>
<a name="l00145"></a>00145       <a class="code" href="classQgsFeatureRendererV2.html#a5957a875a9469a4e5912d8c5f5c2f50">QgsFeatureRendererV2::renderFeature</a>( feature, context, layer, selected, drawVertexMarker );
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147   }
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="classQgsRuleBasedRendererV2.html#23117d29d3b8cc87acf86f2c15b76b5a">00151</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#23117d29d3b8cc87acf86f2c15b76b5a">QgsRuleBasedRendererV2::startRender</a>( <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a>&amp; context, <span class="keyword">const</span> <a class="code" href="classQgsVectorLayer.html" title="Vector layer backed by a data source provider.">QgsVectorLayer</a> *vlayer )
<a name="l00152"></a>00152 {
<a name="l00153"></a>00153   <span class="keywordtype">double</span> currentScale = context.<a class="code" href="classQgsRenderContext.html#a5a5a968992a4854f1fc193f31e9c9cb">rendererScale</a>();
<a name="l00154"></a>00154   <span class="comment">// filter out rules which are not compatible with this scale</span>
<a name="l00155"></a>00155 
<a name="l00156"></a>00156   <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.clear();
<a name="l00157"></a>00157   <span class="keywordflow">for</span> ( QList&lt;Rule&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.end(); ++it )
<a name="l00158"></a>00158   {
<a name="l00159"></a>00159     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>&amp; rule = *it;
<a name="l00160"></a>00160     <span class="keywordflow">if</span> ( rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#529994dbf1622af84cca3a620f948a54">isScaleOK</a>( currentScale ) )
<a name="l00161"></a>00161       <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.append( &amp;rule );
<a name="l00162"></a>00162   }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <a class="code" href="classQgsRuleBasedRendererV2.html#9f1875b03d56050c4894d72e1bb92076">mCurrentFields</a> = vlayer-&gt;<a class="code" href="classQgsVectorLayer.html#d7fab6c5b64e1657edafadc11d64b13f" title="returns field list in the to-be-committed state">pendingFields</a>();
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="keywordflow">for</span> ( QList&lt;Rule*&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.end(); ++it )
<a name="l00167"></a>00167   {
<a name="l00168"></a>00168     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>* rule = *it;
<a name="l00169"></a>00169     rule-&gt;<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>()-&gt;<a class="code" href="classQgsSymbolV2.html#08d90120d177929737a103411ffcb1f9">startRender</a>( context );
<a name="l00170"></a>00170   }
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a><a class="code" href="classQgsRuleBasedRendererV2.html#42202f0c6850c1d08c60bfbdd367c13d">00173</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#42202f0c6850c1d08c60bfbdd367c13d">QgsRuleBasedRendererV2::stopRender</a>( <a class="code" href="classQgsRenderContext.html" title="Contains information about the context of a rendering operation.">QgsRenderContext</a>&amp; context )
<a name="l00174"></a>00174 {
<a name="l00175"></a>00175   <span class="keywordflow">for</span> ( QList&lt;Rule*&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.end(); ++it )
<a name="l00176"></a>00176   {
<a name="l00177"></a>00177     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>* rule = *it;
<a name="l00178"></a>00178     rule-&gt;<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>()-&gt;<a class="code" href="classQgsSymbolV2.html#b70bbea2b61fb9e734766f265f6625df">stopRender</a>( context );
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <a class="code" href="classQgsRuleBasedRendererV2.html#3f8677b0ebc62583027c3600641e7b71">mCurrentRules</a>.clear();
<a name="l00182"></a>00182   <a class="code" href="classQgsRuleBasedRendererV2.html#9f1875b03d56050c4894d72e1bb92076">mCurrentFields</a>.clear();
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="classQgsRuleBasedRendererV2.html#90bf6331869ed98010127b68359dcc2e">00185</a> QList&lt;QString&gt; <a class="code" href="classQgsRuleBasedRendererV2.html#90bf6331869ed98010127b68359dcc2e">QgsRuleBasedRendererV2::usedAttributes</a>()
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187   QSet&lt;QString&gt; attrs;
<a name="l00188"></a>00188   <span class="keywordflow">for</span> ( QList&lt;Rule&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.end(); ++it )
<a name="l00189"></a>00189   {
<a name="l00190"></a>00190     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>&amp; rule = *it;
<a name="l00191"></a>00191     attrs.unite( rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#54aac5e8a7a43249811374c3c037c6d7">needsFields</a>().toSet() );
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193   <span class="keywordflow">return</span> attrs.values();
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="classQgsRuleBasedRendererV2.html#727c5840056989431ef9a270a28a6cf0">00196</a> <a class="code" href="classQgsFeatureRendererV2.html">QgsFeatureRendererV2</a>* <a class="code" href="classQgsRuleBasedRendererV2.html#727c5840056989431ef9a270a28a6cf0">QgsRuleBasedRendererV2::clone</a>()
<a name="l00197"></a>00197 {
<a name="l00198"></a>00198   <a class="code" href="classQgsSymbolV2.html">QgsSymbolV2</a>* s = <a class="code" href="classQgsRuleBasedRendererV2.html#04831ea884ae2c6bfbca43da029f6107" title="the default symbol, used for the first rule with no filter">mDefaultSymbol</a>-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>();
<a name="l00199"></a>00199   <a class="code" href="classQgsRuleBasedRendererV2.html" title="When drawing a vector layer with rule-based renderer, it goes through the rules and...">QgsRuleBasedRendererV2</a>* r = <span class="keyword">new</span> <a class="code" href="classQgsRuleBasedRendererV2.html#8304f3ad113319d904b9b28a17c0527a" title="Constructor. Takes ownership of the defult symbol.">QgsRuleBasedRendererV2</a>( s );
<a name="l00200"></a>00200   r-&gt;<a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a> = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>;
<a name="l00201"></a>00201   <span class="keywordflow">return</span> r;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="classQgsRuleBasedRendererV2.html#f91d7afff769c9530582e96a4029112e">00204</a> <a class="code" href="qgsrendererv2_8h.html#9f09acd7f1100a081e20f5ad8d83f017">QgsSymbolV2List</a> <a class="code" href="classQgsRuleBasedRendererV2.html#f91d7afff769c9530582e96a4029112e" title="for symbol levels">QgsRuleBasedRendererV2::symbols</a>()
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206   <a class="code" href="qgsrendererv2_8h.html#9f09acd7f1100a081e20f5ad8d83f017">QgsSymbolV2List</a> lst;
<a name="l00207"></a>00207   <span class="keywordflow">for</span> ( QList&lt;Rule&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.end(); ++it )
<a name="l00208"></a>00208   {
<a name="l00209"></a>00209     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>&amp; rule = *it;
<a name="l00210"></a>00210     lst.append( rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>() );
<a name="l00211"></a>00211   }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="keywordflow">return</span> lst;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="classQgsRuleBasedRendererV2.html#80dec29727eb0142e7a30184f7bd9b94">00216</a> QDomElement <a class="code" href="classQgsRuleBasedRendererV2.html#80dec29727eb0142e7a30184f7bd9b94" title="store renderer info to XML element">QgsRuleBasedRendererV2::save</a>( QDomDocument&amp; doc )
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218   QDomElement rendererElem = doc.createElement( <a class="code" href="qgsrendererv2_8h.html#5f848f627cd0a3f8512fead534f1fde7">RENDERER_TAG_NAME</a> );
<a name="l00219"></a>00219   rendererElem.setAttribute( <span class="stringliteral">"type"</span>, <span class="stringliteral">"RuleRenderer"</span> );
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   QDomElement rulesElem = doc.createElement( <span class="stringliteral">"rules"</span> );
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a> <a class="code" href="classQgsRuleBasedRendererV2.html#f91d7afff769c9530582e96a4029112e" title="for symbol levels">symbols</a>;
<a name="l00224"></a>00224   symbols[<span class="stringliteral">"default"</span>] = <a class="code" href="classQgsRuleBasedRendererV2.html#04831ea884ae2c6bfbca43da029f6107" title="the default symbol, used for the first rule with no filter">mDefaultSymbol</a>;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="keywordtype">int</span> i = 0;
<a name="l00227"></a>00227   <span class="keywordflow">for</span> ( QList&lt;Rule&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.end(); ++i, ++it )
<a name="l00228"></a>00228   {
<a name="l00229"></a>00229     <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>&amp; rule = *it;
<a name="l00230"></a>00230     symbols[QString::number( i )] = rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>();
<a name="l00231"></a>00231     QDomElement ruleElem = doc.createElement( <span class="stringliteral">"rule"</span> );
<a name="l00232"></a>00232     ruleElem.setAttribute( <span class="stringliteral">"symbol"</span>, i );
<a name="l00233"></a>00233     ruleElem.setAttribute( <span class="stringliteral">"filter"</span>, rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#e6014df241b637373cb74561bef0aeae">filterExpression</a>() );
<a name="l00234"></a>00234     ruleElem.setAttribute( <span class="stringliteral">"scalemindenom"</span>, rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#b1d303e7d817b74c93fe0a6b6a12f696">scaleMinDenom</a>() );
<a name="l00235"></a>00235     ruleElem.setAttribute( <span class="stringliteral">"scalemaxdenom"</span>, rule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#f307ab4b4b7c950c7786ce8bd6b6491d">scaleMaxDenom</a>() );
<a name="l00236"></a>00236     rulesElem.appendChild( ruleElem );
<a name="l00237"></a>00237   }
<a name="l00238"></a>00238   rendererElem.appendChild( rulesElem );
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   QDomElement symbolsElem = <a class="code" href="classQgsSymbolLayerV2Utils.html#2b4e58c54b0097f3b7263826a0004b91">QgsSymbolLayerV2Utils::saveSymbols</a>( symbols, <span class="stringliteral">"symbols"</span>, doc );
<a name="l00241"></a>00241   rendererElem.appendChild( symbolsElem );
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   <span class="keywordflow">return</span> rendererElem;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a><a class="code" href="classQgsRuleBasedRendererV2.html#5264f06ae8617cfa478fcc1dccec0848">00247</a> <a class="code" href="qgsrendererv2_8h.html#891453295779b8f901fc3024cc02d8ce">QgsLegendSymbologyList</a> <a class="code" href="classQgsRuleBasedRendererV2.html#5264f06ae8617cfa478fcc1dccec0848" title="return a list of symbology items for the legend">QgsRuleBasedRendererV2::legendSymbologyItems</a>( QSize iconSize )
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249   <a class="code" href="qgsrendererv2_8h.html#891453295779b8f901fc3024cc02d8ce">QgsLegendSymbologyList</a> lst;
<a name="l00250"></a>00250   <span class="keywordflow">for</span> ( QList&lt;Rule&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.end(); ++it )
<a name="l00251"></a>00251   {
<a name="l00252"></a>00252     QPixmap pix = <a class="code" href="classQgsSymbolLayerV2Utils.html#74f8124fd5a7d68c168b71ebead78552">QgsSymbolLayerV2Utils::symbolPreviewPixmap</a>( it-&gt;symbol(), iconSize );
<a name="l00253"></a>00253     lst &lt;&lt; qMakePair( it-&gt;filterExpression(), pix );
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255   <span class="keywordflow">return</span> lst;
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="classQgsRuleBasedRendererV2.html#8775c0f13c0e7916c09a31cbe5c645d2">00258</a> <a class="code" href="qgsrendererv2_8h.html#b3223b25199299e0eaabe4e2737f068f">QgsLegendSymbolList</a> <a class="code" href="classQgsRuleBasedRendererV2.html#8775c0f13c0e7916c09a31cbe5c645d2" title="return a list of item text / symbol">QgsRuleBasedRendererV2::legendSymbolItems</a>()
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260   <a class="code" href="qgsrendererv2_8h.html#b3223b25199299e0eaabe4e2737f068f">QgsLegendSymbolList</a> lst;
<a name="l00261"></a>00261   <span class="keywordflow">for</span> ( QList&lt;Rule&gt;::iterator it = <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.begin(); it != <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.end(); ++it )
<a name="l00262"></a>00262   {
<a name="l00263"></a>00263     lst &lt;&lt; qMakePair( it-&gt;filterExpression(), it-&gt;symbol() );
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265   <span class="keywordflow">return</span> lst;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="classQgsRuleBasedRendererV2.html#2674e396415032d658ee188149ab03bb">00269</a> <a class="code" href="classQgsFeatureRendererV2.html">QgsFeatureRendererV2</a>* <a class="code" href="classQgsRuleBasedRendererV2.html#2674e396415032d658ee188149ab03bb">QgsRuleBasedRendererV2::create</a>( QDomElement&amp; element )
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271   <span class="comment">// load symbols</span>
<a name="l00272"></a>00272   QDomElement symbolsElem = element.firstChildElement( <span class="stringliteral">"symbols"</span> );
<a name="l00273"></a>00273   <span class="keywordflow">if</span> ( symbolsElem.isNull() )
<a name="l00274"></a>00274     <span class="keywordflow">return</span> NULL;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   <a class="code" href="qgsrendererv2_8h.html#65ba6d09763ac88d210dbff1ebfe9dae">QgsSymbolV2Map</a> symbolMap = <a class="code" href="classQgsSymbolLayerV2Utils.html#045dfbcf12255f59ad14edae4e31bfef">QgsSymbolLayerV2Utils::loadSymbols</a>( symbolsElem );
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <span class="keywordflow">if</span> ( !symbolMap.contains( <span class="stringliteral">"default"</span> ) )
<a name="l00279"></a>00279   {
<a name="l00280"></a>00280     <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"default symbol not found!"</span> );
<a name="l00281"></a>00281     <span class="keywordflow">return</span> NULL;
<a name="l00282"></a>00282   }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <a class="code" href="classQgsRuleBasedRendererV2.html" title="When drawing a vector layer with rule-based renderer, it goes through the rules and...">QgsRuleBasedRendererV2</a>* r = <span class="keyword">new</span> <a class="code" href="classQgsRuleBasedRendererV2.html#8304f3ad113319d904b9b28a17c0527a" title="Constructor. Takes ownership of the defult symbol.">QgsRuleBasedRendererV2</a>( symbolMap.take( <span class="stringliteral">"default"</span> ) );
<a name="l00285"></a>00285   r-&gt;<a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.clear();
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   QDomElement rulesElem = element.firstChildElement( <span class="stringliteral">"rules"</span> );
<a name="l00288"></a>00288   QDomElement ruleElem = rulesElem.firstChildElement( <span class="stringliteral">"rule"</span> );
<a name="l00289"></a>00289   <span class="keywordflow">while</span> ( !ruleElem.isNull() )
<a name="l00290"></a>00290   {
<a name="l00291"></a>00291     QString symbolIdx = ruleElem.attribute( <span class="stringliteral">"symbol"</span> );
<a name="l00292"></a>00292     <span class="keywordflow">if</span> ( symbolMap.contains( symbolIdx ) )
<a name="l00293"></a>00293     {
<a name="l00294"></a>00294       QString filterExp = ruleElem.attribute( <span class="stringliteral">"filter"</span> );
<a name="l00295"></a>00295       <span class="keywordtype">int</span> scaleMinDenom = ruleElem.attribute( <span class="stringliteral">"scalemindenom"</span>, <span class="stringliteral">"0"</span> ).toInt();
<a name="l00296"></a>00296       <span class="keywordtype">int</span> scaleMaxDenom = ruleElem.attribute( <span class="stringliteral">"scalemaxdenom"</span>, <span class="stringliteral">"0"</span> ).toInt();
<a name="l00297"></a>00297       r-&gt;<a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.append( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>( symbolMap.take( symbolIdx ), scaleMinDenom, scaleMaxDenom, filterExp ) );
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299     <span class="keywordflow">else</span>
<a name="l00300"></a>00300     {
<a name="l00301"></a>00301       <a class="code" href="qgslogger_8h.html#b273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">"symbol for rule "</span> + symbolIdx + <span class="stringliteral">" not found! (skipping)"</span> );
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303     ruleElem = ruleElem.nextSiblingElement( <span class="stringliteral">"rule"</span> );
<a name="l00304"></a>00304   }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   <span class="comment">// delete symbols if there are any more</span>
<a name="l00307"></a>00307   <a class="code" href="classQgsSymbolLayerV2Utils.html#6eb691949007752b46fd423db2f4918d">QgsSymbolLayerV2Utils::clearSymbolMap</a>( symbolMap );
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   <span class="keywordflow">return</span> r;
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="classQgsRuleBasedRendererV2.html#a7417121c42c97f3ce7bf32a9ea48cf1">00313</a> <span class="keywordtype">int</span> <a class="code" href="classQgsRuleBasedRendererV2.html#a7417121c42c97f3ce7bf32a9ea48cf1" title="return the total number of rules">QgsRuleBasedRendererV2::ruleCount</a>()
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315   <span class="keywordflow">return</span> <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.count();
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="classQgsRuleBasedRendererV2.html#92a03f940f71057e23501559089fb68a">00318</a> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; <a class="code" href="classQgsRuleBasedRendererV2.html#92a03f940f71057e23501559089fb68a" title="get reference to rule at index (valid indexes: 0...count-1)">QgsRuleBasedRendererV2::ruleAt</a>( <span class="keywordtype">int</span> index )
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320   <span class="keywordflow">return</span> <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>[index];
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a><a class="code" href="classQgsRuleBasedRendererV2.html#c93c64cb8df8b08297edef6e174a4353">00323</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#c93c64cb8df8b08297edef6e174a4353" title="add rule to the end of the list of rules">QgsRuleBasedRendererV2::addRule</a>( <span class="keyword">const</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; rule )
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325   <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.append( rule );
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="classQgsRuleBasedRendererV2.html#5400b6453eaaaca3489df66c687727b8">00328</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#5400b6453eaaaca3489df66c687727b8" title="insert rule to a specific position of the list of rules">QgsRuleBasedRendererV2::insertRule</a>( <span class="keywordtype">int</span> index, <span class="keyword">const</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; rule )
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330   <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.insert( index, rule );
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a><a class="code" href="classQgsRuleBasedRendererV2.html#6ea2bc82ce91aa2d38db944f25044883">00333</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#6ea2bc82ce91aa2d38db944f25044883" title="modify the rule at a specific position of the list of rules">QgsRuleBasedRendererV2::updateRuleAt</a>( <span class="keywordtype">int</span> index, <span class="keyword">const</span> <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; rule )
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335   <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>[index] = rule;
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="classQgsRuleBasedRendererV2.html#a665b09259eeaed9e6fc21fd3481a963">00338</a> <span class="keywordtype">void</span> <a class="code" href="classQgsRuleBasedRendererV2.html#a665b09259eeaed9e6fc21fd3481a963" title="remove the rule at the specified index">QgsRuleBasedRendererV2::removeRuleAt</a>( <span class="keywordtype">int</span> index )
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340   <a class="code" href="classQgsRuleBasedRendererV2.html#0518a2413af27bce3361b41504b89ec3" title="the list of rules">mRules</a>.removeAt( index );
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="preprocessor">#include "<a class="code" href="qgscategorizedsymbolrendererv2_8h.html">qgscategorizedsymbolrendererv2.h</a>"</span>
<a name="l00344"></a>00344 <span class="preprocessor">#include "<a class="code" href="qgsgraduatedsymbolrendererv2_8h.html">qgsgraduatedsymbolrendererv2.h</a>"</span>
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="classQgsRuleBasedRendererV2.html#e63be8650712d40f6f53b6b0614d9402">00346</a> QList&lt;QgsRuleBasedRendererV2::Rule&gt; <a class="code" href="classQgsRuleBasedRendererV2.html#e63be8650712d40f6f53b6b0614d9402" title="take a rule and create a list of new rules based on the categories from categorized...">QgsRuleBasedRendererV2::refineRuleCategories</a>( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; initialRule, <a class="code" href="classQgsCategorizedSymbolRendererV2.html">QgsCategorizedSymbolRendererV2</a>* r )
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348   QList&lt;Rule&gt; rules;
<a name="l00349"></a>00349   <span class="keywordflow">foreach</span>( <span class="keyword">const</span> <a class="code" href="classQgsRendererCategoryV2.html">QgsRendererCategoryV2</a>&amp; cat, r-&gt;<a class="code" href="classQgsCategorizedSymbolRendererV2.html#50e7df5475da387d06667f8d334d60e6">categories</a>() )
<a name="l00350"></a>00350   {
<a name="l00351"></a>00351     QString newfilter = QString( <span class="stringliteral">"%1 = '%2'"</span> ).arg( r-&gt;<a class="code" href="classQgsCategorizedSymbolRendererV2.html#0c2e2f43665f4873d15647e3281d4b48">classAttribute</a>() ).arg( cat.<a class="code" href="classQgsRendererCategoryV2.html#47a77918c1f42961f9960a0bb9ffcc2d">value</a>().toString() );
<a name="l00352"></a>00352     QString filter = initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#e6014df241b637373cb74561bef0aeae">filterExpression</a>();
<a name="l00353"></a>00353     <span class="keywordflow">if</span> ( filter.isEmpty() )
<a name="l00354"></a>00354       filter = newfilter;
<a name="l00355"></a>00355     <span class="keywordflow">else</span>
<a name="l00356"></a>00356       filter = QString( <span class="stringliteral">"(%1) AND (%2)"</span> ).arg( filter ).arg( newfilter );
<a name="l00357"></a>00357     rules.append( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>( cat.<a class="code" href="classQgsRendererCategoryV2.html#c7440c99c4ac915ebb22d80305ad33c9">symbol</a>()-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>(), initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#b1d303e7d817b74c93fe0a6b6a12f696">scaleMinDenom</a>(), initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#f307ab4b4b7c950c7786ce8bd6b6491d">scaleMaxDenom</a>(), filter ) );
<a name="l00358"></a>00358   }
<a name="l00359"></a>00359   <span class="keywordflow">return</span> rules;
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00362"></a><a class="code" href="classQgsRuleBasedRendererV2.html#b9723c30a21098f3ee40568077fbb072">00362</a> QList&lt;QgsRuleBasedRendererV2::Rule&gt; <a class="code" href="classQgsRuleBasedRendererV2.html#b9723c30a21098f3ee40568077fbb072" title="take a rule and create a list of new rules based on the ranges from graduated symbol...">QgsRuleBasedRendererV2::refineRuleRanges</a>( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; initialRule, <a class="code" href="classQgsGraduatedSymbolRendererV2.html">QgsGraduatedSymbolRendererV2</a>* r )
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364   QList&lt;Rule&gt; rules;
<a name="l00365"></a>00365   <span class="keywordflow">foreach</span>( <span class="keyword">const</span> <a class="code" href="classQgsRendererRangeV2.html">QgsRendererRangeV2</a>&amp; rng, r-&gt;<a class="code" href="classQgsGraduatedSymbolRendererV2.html#02995155f03508913648a2769f216d9b">ranges</a>() )
<a name="l00366"></a>00366   {
<a name="l00367"></a>00367     QString newfilter = QString( <span class="stringliteral">"%1 &gt;= '%2' AND %1 &lt;= '%3'"</span> ).arg( r-&gt;<a class="code" href="classQgsGraduatedSymbolRendererV2.html#947ad68f950ce64a3c37392f5d8066b9">classAttribute</a>() ).arg( rng.<a class="code" href="classQgsRendererRangeV2.html#d84959a824d919c6a8b1f5484ad47d87">lowerValue</a>() ).arg( rng.<a class="code" href="classQgsRendererRangeV2.html#e09d28e4de28ddacf53b5e99a24e6f41">upperValue</a>() );
<a name="l00368"></a>00368     QString filter = initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#e6014df241b637373cb74561bef0aeae">filterExpression</a>();
<a name="l00369"></a>00369     <span class="keywordflow">if</span> ( filter.isEmpty() )
<a name="l00370"></a>00370       filter = newfilter;
<a name="l00371"></a>00371     <span class="keywordflow">else</span>
<a name="l00372"></a>00372       filter = QString( <span class="stringliteral">"(%1) AND (%2)"</span> ).arg( filter ).arg( newfilter );
<a name="l00373"></a>00373     rules.append( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>( rng.<a class="code" href="classQgsRendererRangeV2.html#1db8155e8f8b64f4904089ed368c0f8b">symbol</a>()-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>(), initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#b1d303e7d817b74c93fe0a6b6a12f696">scaleMinDenom</a>(), initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#f307ab4b4b7c950c7786ce8bd6b6491d">scaleMaxDenom</a>(), filter ) );
<a name="l00374"></a>00374   }
<a name="l00375"></a>00375   <span class="keywordflow">return</span> rules;
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="classQgsRuleBasedRendererV2.html#2ab60c495920b1fcf4688a8a0c5b1a72">00378</a> QList&lt;QgsRuleBasedRendererV2::Rule&gt; <a class="code" href="classQgsRuleBasedRendererV2.html#2ab60c495920b1fcf4688a8a0c5b1a72" title="take a rule and create a list of new rules with intervals of scales given by the...">QgsRuleBasedRendererV2::refineRuleScales</a>( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">QgsRuleBasedRendererV2::Rule</a>&amp; initialRule, QList&lt;int&gt; scales )
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380   qSort( scales ); <span class="comment">// make sure the scales are in ascending order</span>
<a name="l00381"></a>00381   QList&lt;Rule&gt; rules;
<a name="l00382"></a>00382   <span class="keywordtype">int</span> oldScale = initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#b1d303e7d817b74c93fe0a6b6a12f696">scaleMinDenom</a>();
<a name="l00383"></a>00383   <span class="keywordtype">int</span> maxDenom = initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#f307ab4b4b7c950c7786ce8bd6b6491d">scaleMaxDenom</a>();
<a name="l00384"></a>00384   <span class="keywordflow">foreach</span>( <span class="keywordtype">int</span> scale, scales )
<a name="l00385"></a>00385   {
<a name="l00386"></a>00386     <span class="keywordflow">if</span> ( initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#b1d303e7d817b74c93fe0a6b6a12f696">scaleMinDenom</a>() &gt;= scale )
<a name="l00387"></a>00387       <span class="keywordflow">continue</span>; <span class="comment">// jump over the first scales out of the interval</span>
<a name="l00388"></a>00388     <span class="keywordflow">if</span> ( maxDenom != 0 &amp;&amp; maxDenom  &lt;= scale )
<a name="l00389"></a>00389       <span class="keywordflow">break</span>; <span class="comment">// ignore the latter scales out of the interval</span>
<a name="l00390"></a>00390     rules.append( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>( initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>()-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>(), oldScale, scale, initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#e6014df241b637373cb74561bef0aeae">filterExpression</a>() ) );
<a name="l00391"></a>00391     oldScale = scale;
<a name="l00392"></a>00392   }
<a name="l00393"></a>00393   <span class="comment">// last rule</span>
<a name="l00394"></a>00394   rules.append( <a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html" title="This class keeps data about a rules for rule-based renderer.">Rule</a>( initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#8507e7ab9ce1f6ce236ad366d740c0ce">symbol</a>()-&gt;<a class="code" href="classQgsSymbolV2.html#35724135ff0c451b377e5a8abf483ee2">clone</a>(), oldScale, maxDenom, initialRule.<a class="code" href="classQgsRuleBasedRendererV2_1_1Rule.html#e6014df241b637373cb74561bef0aeae">filterExpression</a>() ) );
<a name="l00395"></a>00395   <span class="keywordflow">return</span> rules;
<a name="l00396"></a>00396 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Feb 4 19:16:07 2012 for Quantum GIS API Documentation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
